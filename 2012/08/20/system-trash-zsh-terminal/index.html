<!doctype html>
<html class="no-js" lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>
     Use the system trash with ZSH terminal - Pixelastic 
  </title>
  <meta name="description" content="Personal blog of Tim Carry. Posting mostly on tech-related stuff.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/forms.css">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

<body class="layout-reverse theme-base-0b">
  <div class="sidebar">
    <div class="container">
      <div class="sidebar-about">
        <h1><a href="/index.html">Pixelastic</a></h1>
        <p class="lead">Personal blog of Tim Carry. Posting mostly on tech-related stuff.</p>
      </div>

      <ul class="sidebar-nav">
        <li class="sidebar-nav-item">
          <a href="/">Home</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/about/">About</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/archive/">Archive</a>
        </li>
      </ul>
      <div class="sidebar-footer">Website code available on <a href="https://github.com/pixelastic/blog.pixelastic.com">GitHub</a></div>
    </div>
  </div>

  <div class="content container">
    <div class="post">
  <h1 class="post-title">Use the system trash with ZSH terminal</h1>
  <span class="post-date">20 Aug 2012</span>
  <p>When you start using the terminal as your main file explorer instead of a GUI
one, you soon discover two important things.</p>

<p>First, it is much faster to browse accross your filesystem, copying and moving
files in the terminal that it is with your mouse. This is hard to believe at
first (how can writing text on a dull black screen be faster than
drag&#39;n&#39;dropping ?) but it is nonetheless true (after a bit of practice, sure).</p>

<p>The second thing is that it is also much much easier to *<em>permanently delete
very important files *</em>as deleting a file through the terminal has no trash
bin nor any other safeguard mechanism.</p>

<h2>Scripting a rm replacement</h2>

<p>At first, I scripted my own rm <code>rm</code> replacement that was manually moving files
to <code>~/.local/share/Trash/files</code> (the common Trash directory) instead of
deleting them. But it was a bit naive and couldn&#39;t really work on removable
drives nor provide a &quot;restore&quot; mechanism.</p>

<p>Fortunatly, the <code>trash-cli</code> package on Ubuntu provides a set of methods to
deal with the trash from the command line. They have very explicit names such
as <code>trash</code>, <code>list-trash</code>, <code>restore-trash</code> or <code>empty-trash</code>.</p>

<h2>ZSH aliases</h2>

<p>I had to resort to quite a bit of ZSH tweaking to make it a perfect <code>rm</code>
replacement. First, I added a simple alias for the <code>rm</code> command.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="nb">alias </span><span class="nv">rm</span><span class="o">=</span><span class="s1">&#39;trash&#39;</span>
</code></pre></div>
<p>Then I also wanted to change the default <code>rmdir</code> command. I could have used
the same type of alias (<code>alias rmdir=&#39;trash&#39;</code>) but I would have lost the
builtin ZSH autocompletion of directories zsh provides with <code>rmdir</code>.</p>

<p>When you define aliases with ZSH, you can choose if you want it to
autocomplete based on the right hand side of your alias
(<code>NO_COMPLETE_ALIASES</code>) or the left hand side (<code>COMPLETE_ALIASES</code>). Yes, the
name of the options seem wrong to me too, but this is actually how it works.</p>

<p>I prefer setting <code>NO_COMPLETE_ALIASES</code> so I can use the correct autocompletion
on my commands with my aliases, but for the <code>rmdir</code> case this was proving to
be an issue.</p>

<h2>rmdir autocompletion</h2>

<p>So, I started writing my own <code>rmdir</code> implementation in a custom script. This
was merely a wrapper to <code>rmdir</code> but putting it in its own script allowed me to
change its name and thus changing its autocomplete method.</p>

<p>I named it <code>better-rmdir</code>, and put it in my <code>$PATH</code>. Here is the code</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/usr/bin/zsh</span>
trash <span class="nv">$@</span>
</code></pre></div>
<p>As you can see, this is just a wrapper, taking the initial arguments and
passing them to <code>trash</code>.</p>

<p>But I also created a file named <code>_better-rmdir</code> and put it in my <code>$FPATH</code>
(this is where ZSH goes looking to autocomplete methods). I just copied the
code of the original <code>_directories</code> method (that you can probably find in
<code>/usr/share/zsh/functions/Completion/Unix/</code>), and adapted it to fit my newly
created <code>better-rmdir</code></p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#compdef better-rmdir</span>
<span class="nb">local </span>expl
_wanted directories expl directory _files -/ <span class="s2">&quot;$@&quot;</span> -
</code></pre></div>
<p>And finally, I added an alias (<code>alias rmdir=&#39;better-rmdir&#39;</code>) and everytime I
ask for an autocomplete on <code>rmdir</code> it actually looks for the autocomplete of
<code>better-rmdir</code>, which is the code contained in <code>_better-rmdir</code> and which in
turn return only directories.</p>

<p>Now I have complete <code>rm</code> and <code>rmdir</code> commands in my terminal that move files
to the trash.</p>

  <div class="tag-list">
    
      <a href="/tags/autocomplete">#autocomplete</a>
    
      <a href="/tags/rm">#rm</a>
    
      <a href="/tags/linux">#linux</a>
    
      <a href="/tags/zsh">#zsh</a>
    
      <a href="/tags/rmdir">#rmdir</a>
    
  </div>
</div>

<!-- <div class="related"> -->
<!--   <h2>Related Posts</h2> -->
<!--   <ul class="related-posts"> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/2014/01/07/utf-8-encoding-included-jsp-files/"> -->
<!--             UTF-8 encoding for included .jsp files -->
<!--             <small>07 Jan 2014</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/2013/09/27/understanding-nginx-location-blocks-rewrite-rules/"> -->
<!--             Understanding nginx location blocks and rewrite rules -->
<!--             <small>27 Sep 2013</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/2013/09/09/telecharger-parisweb-2012-sous-forme-de-podcasts/"> -->
<!--             Télécharger ParisWeb 2012 sous forme de podcasts -->
<!--             <small>09 Sep 2013</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--   </ul> -->
<!-- </div> -->

  </div>

</body>

</html>
