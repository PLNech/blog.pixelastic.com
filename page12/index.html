<!doctype html>
<html class="no-js" lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>
     Pixelastic 
  </title>
  <meta name="description" content="Personal blog of Tim Carry. Posting mostly on tech-related stuff.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/forms.css">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

<body class="layout-reverse theme-base-0b">
  <div class="sidebar">
    <div class="container">
      <div class="sidebar-about">
        <h1><a href="/index.html">Pixelastic</a></h1>
        <p class="lead">Personal blog of Tim Carry. Posting mostly on tech-related stuff.</p>
      </div>

      <ul class="sidebar-nav">
        <li class="sidebar-nav-item active">
          <a href="/">Home</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/about/">About</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/archive/">Archive</a>
        </li>
      </ul>
      <div class="sidebar-footer">Website code available on <a href="https://github.com/pixelastic/blog.pixelastic.com">GitHub</a></div>
    </div>
  </div>

  <div class="content container">
    <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/07/15/testing-facebook-credits-local-environment/">
        Testing Facebook Credits in a local environment
      </a>
    </h1>

    <span class="post-date">15 Jul 2011</span>

    <p>Testing Facebook API has always been a pain for me. Their documentation is
still crappy and examples are wrong or/and outdated. Things don&#39;t exactly work
the same way when you&#39;re testing with &quot;Test account&quot; or real accounts.</p>

<p>One of the things that helped me much was to create a test application and set
its canvas url to a local server. As the iframe call is done through the
client, I can test local code without the need to upload stuff to an online
server.</p>

<p>I could even test Requests and Streams through this method as it&#39;s the
Javascript SDK that does all the AJAX calls. The only tiny issue was with
Stream images as Facebook requests them server-side before displaying them, I
had to put some placeholder images online.</p>

<p>But today, with the testing of the new Facebook Credits API, new horizon of
pains arised. Facebook will make no less than three calls to one of my server
callback url, but does not make them client-side.</p>

<p>I still don&#39;t want to upload my code to a debug server just to test this
feature, so I decided to put in place a little IP/port forwarding. Thanks to
tips from my colleague <a href="http://leo-peltier.fr/">LĂŠo</a>, this was done in a
matter of minutes.</p>

<h2>Setting up the DNS/port forwarding</h2>

<p>First, we&#39;ll need a url that Facebook will call. I want this url to point to
my local server. So all I had to do was to create a simple DNS redirect at
dyndns.com that point to my local IP.</p>

<p>Let it be http://customname.dyndns-office.com/</p>

<p>Paste this url in the &quot;callback url&quot; field of your Facebook Credits config
page.</p>

<p>Then, I&#39;ll assign a fixed internal IP to my computer so that it won&#39;t change
on each reboot. My router can do that just fine, by assigning a fixed internal
IP based on the MAC adress.</p>

<p>Let it be 192.168.0.51</p>

<p>Now, we&#39;ll redirect every call on the router through port 80 (http) to that
url. My router admin panel can also do that just fine, in its DHCP
configuration.</p>

<p>Finally, we&#39;ll have to update the server virtualhost config to point all
incoming requests matching <code>customname.dyndns-office.com</code> to the server files.</p>

<h2>A side note</h2>

<p>There is one last little gotcha to be aware of.</p>

<p>It does not seem to be possible to access one of your network computer from an
external IP (as we just configured) FROM one of your network computer.</p>

<p>In other words, if you would like to test your config, do not type
<code>http://customname.dyndns-office.com/</code> in your browser on one of the computers
sharing the same network as 192.168.0.51.</p>

<p>Instead, use a free wifi connection, a ssh tunnel or curl from an external
server you own.</p>

<p>In my case, locally testing <code>http://customname.dyndns-office.com/</code> always
brought me to my router admin panel and did not forward the port correctly.
Doing a <code>curl http://customname.dyndns-office.com/</code> from one of my online
servers correctly returned what I wanted.</p>

<h2>Back to Facebook</h2>

<p>Back to our Facebook example, you still won&#39;t be able to see any outputs from
the calls Facebook is making to your app. Your best bet is to have a logging
system that will write on disk or in the DB so your can track the calls.</p>

<p>Also note that you have to load the page in the iframe canvas, even for your
tests. You can&#39;t simply load an html page and call <code>FB.ui({method:&quot;pay&quot;})</code>,
this will result in error 1151. Always load in the whole FB page.</p>


    <div class="tag-list">
      
        <a href="/tags/fbcredits">#fbcredits</a>
      
        <a href="/tags/facebook">#facebook</a>
      
        <a href="/tags/dyndns">#dyndns</a>
      
        <a href="/tags/curl">#curl</a>
      
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/07/06/working-wednesday-5-rails-documentation-zombies/">
        Working on Wednesday #5 : Rails documentation and Zombies
      </a>
    </h1>

    <span class="post-date">06 Jul 2011</span>

    <p>Today I continue on my Rails for Zombie learning. Actually, I wake up kind of
late (11am), had to deal with noisy neighbors and make some shopping before
being really able to start working. It&#39;s 2pm now, and I just open my browser.</p>

<h2>Back to Zombies</h2>

<p>I like the clean syntax Ruby provides. I like being able to pass custom
parameters without having to care about the order. This could be achieved in
cakePHP using array for options, but is much more clean the Ruby way, using
<code>truncate(zombie.graveyard, :length =&gt; 10, :omission =&gt; &#39;&#39;)</code></p>

<p>Also the <code>link_to</code> and <code>new_{Model}_path</code>, <code>edit_{Model}_path</code> are clever and
allow easy access to the link you always use. This force you to logically
organise your app.</p>

<p>The way Rails controllers pass vars to the view (using <code>@</code>) is also cleaner
than the cakePHP <code>set</code> method. I love those little things the language
permits.</p>

<p><code>before_filter</code> also seems more powerful than in cake world, being able to
define several of them and restrict them to certain action. Could be extended
(I guess) to an ApplicationController that could check on <code>show</code>, <code>edit</code>, etc
that the specified id exists and display an error message if not.</p>

<p>I didn&#39;t quite get the various <code>respond_as</code> for JSON and XML. Why should I
have to pass the <code>@tweet</code> while I don&#39;t have to for the html view ?</p>

<p>Also, the Rails routings system is more appealing to me than its cakePHP
counterpart. I would have loved to have such a nice tutorial for cake when I
learned it. Routing is very well explained in Rails for Zombies.</p>

<p>After completing the Zombie tutorial, I headed to the famous blog tutorial
every web language should have. Once again, I started reading the doc and a
few things caught my attention as very promising :</p>

<h2>Command line interface</h2>

<p>I like the way one can create a new app simply with one command line. Such
feature is also provided by cakePHP but I never managed to make it work the
way I wanted to. That might have been influenced by the fact that I was
working on Windows at that time.</p>

<h2>Directory structure</h2>

<p>I also note that a Rail application seems greatly structured : there are
spaces defined for documentation, tests, database migration, dependencies,
logs, deployment scripts and so on.</p>

<h2>Databases</h2>

<p>This is great that Rails directly provides two distinct DB configurations :
development and production. I will no longer have to do it myself.</p>

<p>Rails also uses SQLite3 as the default database for development. As I wasn&#39;t
very familiar with this technology, I made some researchs. Turns out that
SQLite is a very simple DB system, perfectlynsuited for the development period
as it does not require a DB server.</p>


    <div class="tag-list">
      
        <a href="/tags/ruby-on-rails">#ruby-on-rails</a>
      
        <a href="/tags/wednesday">#wednesday</a>
      
        <a href="/tags/gem">#gem</a>
      
        <a href="/tags/ruby">#ruby</a>
      
        <a href="/tags/rails">#rails</a>
      
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/07/05/environment-vars-lighttpd-config-files/">
        Using environment vars in lighttpd config files
      </a>
    </h1>

    <span class="post-date">05 Jul 2011</span>

    <p>Our game is hosted on a farm of servers behind a load balancer. All servers
are identical except for their names (<code>prod-01</code>, <code>prod-02</code>, etc) and virtual
IP addresses.</p>

<p>In PHP, if I try to access <code>$_SERVER[&#39;SERVER_NAME&#39;]</code>, I only got the domain
name &quot;prod.game.com&quot;. Actually, this was exactly the same var as the
<code>$_SERVER[&#39;HTTP_HOST&#39;]</code>.</p>

<p>For logging purposes, I needed to know the name of the server that my script
was currently running on. So I updated my <code>lighttpd.conf</code></p>

<p>Lighty has a feature called <code>include_shell</code> that you can use in its config
files. It will basically run a shell script and add its output to your file.</p>

<p>So I wrote a simple shell script to define a <code>var.serverName</code> (this is a
custom value, name it as you want, but keep the <code>var</code> prefix) and then re-use
when needed.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s1">&#39;var.serverName=&quot;&#39;</span><span class="k">$(</span>uname -n<span class="k">)</span><span class="s1">&#39;&quot;&#39;</span>
</code></pre></div>
<p>Then, I included it in my <code>lighttpd.conf</code> file using <code>include_shell
&quot;/etc/lighttpd/scripts/serverName.sh&quot;</code></p>

<p>To define the PHP SERVER_NAME value :</p>
<div class="highlight"><pre><code class="language-ini" data-lang="ini"><span class="na">setenv.add-environment</span> <span class="o">=</span> <span class="s">(</span>
<span class="s">  &quot;SERVER_NAME&quot; =&gt; var.serverName</span>
<span class="err">)</span>
</code></pre></div>
<p>To add it as a Server: response Header :</p>
<div class="highlight"><pre><code class="language-ini" data-lang="ini"><span class="na">server.tag</span> <span class="o">=</span> <span class="s">var.serverName</span>
</code></pre></div>
<p>Note that <code>include_shell</code> directives are only called when you start lighty and
not on every request.</p>


    <div class="tag-list">
      
        <a href="/tags/lighttpd">#lighttpd</a>
      
        <a href="/tags/include-shell">#include-shell</a>
      
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/07/04/incorrect-mysql-date/">
        Incorrect MySQL date
      </a>
    </h1>

    <span class="post-date">04 Jul 2011</span>

    <p>Several ingame time calculation we made in game are based on Paris time. Some
weeks ago, we decided to make a pass on all our servers to always use Paris
Time (GMT +1).</p>

<p>Today, I spotted that logs we save in the DB have some date inaccuracy. It
appears that our mysql server and instances weren&#39;t always updated to the
correct date. Some hours later, here is what I learned :</p>

<h2>Finding and updating MySQL date</h2>

<p>You can tell what timezone mysql should use when you start the service. If you
don&#39;t specify anything, it will use the system time. Once loaded, you can get
its time by running <code>SELECT NOW()</code>.</p>

<p>This is the easiest way to spot errors.</p>

<p>To know the defined timezone, run <code>SELECT @@global.time_zone</code>. If not defined,
you&#39;ll read <code>SYSTEM</code>, which is not very helpful.</p>

<p>Note here that even if you changed the system date AFTER you started mysql,
mysql will still use the date that was in effect when you first launched it.</p>

<p>It means that changing your server time will not affet running mysql
processes. You&#39;ll have to restart mysql to do that : <code>sudo /etc/init.d/mysql
restart</code></p>

<h2>Finding and updating the server date</h2>

<p>Even after restarting mysql on some servers, the mysql date was still
incorrect. After connecting the the sql server, I found that it was the server
time that was incorrectly set (I just type <code>date</code>).</p>

<p>To update the current time zone, I had to call <code>sudo dpkg-reconfigure tzdata</code>
(I&#39;m using ubuntu) and choose the correct city</p>

<h2>Updating mysql running through ndb_mgm</h2>

<p>I&#39;m no server expert, so this part was a little trickier. Some of our
databases are using ndb cluster for replication. Reloading those
configurations was harder.</p>

<p>First, I had to connect to the server running the ndb management and call
<code>ndb_mgm</code>. In the later prompt, I typed show and this get me the list of all
servers currently managed.</p>

<p>I then shut them down typing <code>shutdown</code>.</p>

<p>The, I reloaded the management and the node running on this server by doing
<code>sudo /etc/init.d/mysql-ndb-mgm restart</code> and <code>sudo /etc/init.d/mysql-ndb
restart</code></p>

<p>Finally, I had to connect to all the servers I saw earlier (with the show
command) and run <code>sudo /etc/init.d/mysql-ndb restart</code>on each of them</p>


    <div class="tag-list">
      
        <a href="/tags/ndb">#ndb</a>
      
        <a href="/tags/timezone">#timezone</a>
      
        <a href="/tags/date">#date</a>
      
        <a href="/tags/mysql">#mysql</a>
      
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/06/30/parisjs-8/">
        ParisJS #8
      </a>
    </h1>

    <span class="post-date">30 Jun 2011</span>

    <p><em>(The whole conferences were in french, but as I&#39;m writing every post on my
blog in english, I&#39;ll write this one too.)</em></p>

<p>Tonight I was attenting the 8th parisjs meetup. We had the chance to have it
hosted at Valtech, in a very wealthy part of Paris, in somptuous quarters and
a large room with giant screen (and great pizzas too).</p>

<p>Anyway, this time the meetup was split in two : first part was made of
complete talks, while second part only had small lightning talks. With pizza
and beer in between.</p>

<h2>Wakanda</h2>

<p>The first talk was about <a href="http://www.wakanda.org/">Wakanda</a>. Wakanda is a
complete suite of client/server Javascript which goal is to help create
business oriented apps. It is created by the same company as 4D, but this time
is completly open source.</p>

<p>The product seemed well done, but kinda monolithic : server side js, client
side javascript framework, application studio, debugguer.</p>

<p>I can surely see it used for creating Intranet applications, for some very
specific business cases. I have an ambiguous feeling about Wakanda. I think
they did a very good job, the whole package seems really neat, the IDE is
clear, client/server communication is smooth, etc. On the other hand I&#39;m
always suspicious of apps that can do everything.</p>

<p><em>(Note that I didn&#39;t try the product, I only heard about it tonight for the
first time and watched a 20min presentation so that&#39;s a little light for me to
give a precise opinion)</em></p>

<h2>Joshfire Framework</h2>

<p>A few months ago, <a href="http://twitter.com/sylvinus">@sylvinus</a> from
<a href="http://joshfire.com/">Joshfire</a> told us that they planned to realease their
framework, modeslty named <a href="http://framework.joshfire.com/">Joshfire</a>.</p>

<p>This is by far the most interesting presentation of the meetup. Joshfire is a
javascript framework aimed at working seamlessly between any devices :
desktop, mobile, iPad, TV, anything.</p>

<p>It&#39;s basic idea is to abstract to its bare bone any interaction. From what I
remember, for any &quot;page&quot; you want to define you have to write two JSON
structures.</p>

<p>One defines the data tree (what your data is), the other defines the UI tree
(how your data can be interacted with). It also ships with some adapters (an
adapter is the link between the UI Tree and a specific device).</p>

<p>All you have to do to port your Joshfire app to a new device is to write (or
grab if it already exists) an adapter. The main logic and data code is the
same for every device, the maintenance is now only focused on any specific
device.</p>

<p>Even if the main idea of Joshfire is awesome, their documentation and
licensing is even more awesome : the project is already completly documented,
with examples and is also completly free and <a href="https://github.com/joshfire/joshfire-framework">available on
github</a>.</p>

<h2>CSON, no sorry, JISON</h2>

<p><a href="http://twitter.com/jie">@jie</a> was supposed to talk about CSON, a compressed
JSON. But as he already gave a very similar talk (about BSON) at the last</p>

<h1>parisnode event, he changed the subject.</h1>

<p>I&#39;m not really sure what the real subject of the talk was. I think he
mentionned compiling Javascript into Javascript (much like CoffeeScript), but
it eventually turned into a Jison demo.</p>

<p>Jison seems to be a tool for automating lexing and parsing languages, to
output new code. In effect, this could allow for transforming a custom
language into an existing language. CoffeeScript, Haml or Sass works that way
: they take a new language as input, and return Js, Html or Css as output.</p>

<p>The advantages are that the custom language is usually much more concise, easy
to write and easy to read.</p>

<p>Anyway, this presentation was full of nice quotes :</p>

<blockquote>
<p>The language I&#39;m about to show you is totally useless.</p>

<p>Pipe ? What is that ? Oh, you mean the strokes.</p>

<p>The bad thing about Jison is that its documentation is crap</p>

<p>Why does it work ? It was supposed to fail !</p>
</blockquote>

<h2>Overview of a dev life</h2>

<p>This talk wasn&#39;t about any new shiny technology. It was about those old
browsers and bad habits we had 10 years ago, and how we still managed to make
great websites.</p>

<p>This remind me of the &quot;good ol&#39; days&quot; when I discovered the web with FrontPage
and ClaraSoft. When IE6 was considered a modern browser.</p>

<p><a href="http://twitter.com/molokoloco">@molokoloco</a> show us that he managed to
simulate ajax using nested iframe, had a website still online and running even
after 10 years, was able to code full websites in 3 days, and had read more
than 50.000 blog posts. And all that while still using Windows and
Dreamweaver.</p>

<p><em>(Small side note : I praise both @molokoloco and @jie for what they managed
to do. I know how easy it is to procrastinate and configure UI, test new tools
and IDE instead of getting things done. That didn&#39;t seem to be an issue for
them.)</em></p>

<h2>mongoDB</h2>

<p>This talk was the first in the serie of lightning talks (less than 20mn). It
was about mongoDB and how to integrate it in a nodejs app.</p>

<p>As I had never tried nor nodejs nor mongoDB I didn&#39;t quite grasp what it was
really about. All I get is that in order to get a result from a mongoDB query,
one have to go through 3 steps of connection to the DB. In the asynchronous
world of nodejs, this doesn&#39;t work well, so each step has to fire a callback
once executed.</p>

<p>From there, I was lost. There was something about manually calling a callback
once initialized, but honestly I didn&#39;t get it.</p>

<p>Anyway, I learned from a small talk during pizza time that mongoDB was better
than couchDB (performance-wise), and that one have to sacrifice binding to the
altar of redundancy to get really fast response time.</p>

<h2>Audio demo in less than 1kB. No, 800B. No, wait, 200B</h2>

<p>This time the talk was a very fun demo. Using some simple minification
techniques, Js was able to play a random music.</p>

<p>This involved encoding the wav file in base64 (taking special care of some
chars), and then playing it in an audio tag. Adding a bit of random to play a
different note on each loop.</p>

<p>Fun, but interesting.</p>

<h2>Some words about the Observer Pattern</h2>

<p>This talk was more about theory than practice. Maybe it was the late hour, but
it didn&#39;t catch my attention as the other did. Maybe someone would re-explain
it to me ?</p>

<p>Well, I got the general idea : coding a js snippet that hard code the name of
the elements that should react is bad practice because of the maintanability
nightmare it cause when elements are removed.</p>

<p>Instead, the speaker advocate the use of a MessageBroker. Some kind of general
listener that then dispatch event to element registered to that event (am I
right ?).</p>

<p>Then someone in the audience noted that the opposite pattern should work
better : that every element registered itself to an event and react when such
event is fired (am I still right ?)</p>

<p>Honestly, I really am not sure about this talk, so if anyone could fill the
blanks and correct me, I&#39;d be glad.</p>

<h2>Sencha and Sencha Touch</h2>

<p>I won&#39;t go into too much detail on that talk. This was a generic presentation
of Sencha (formerly known as ExtJs). I already had the basic understanding of
ExtJs (but not the expertise of some of the ExtJs experts in the room), so I
was really only half listening.</p>

<p>Sencha is a great product. It is very similar to what Wakanda was showing in
the first talk. It is destined to data-heavy applications with lots of
numbers, columns, charts, pies, etc.</p>

<p>Sencha Touch is a mobile version of Sencha. It is iOS oriented and emulate the
standard UI elements in HTML.</p>

<h2>Mozilla Labs</h2>

<p>A quick list of the Mozilla Labs projects. I honestly don&#39;t remember them all,
except Tilt that is a 3D viewer of any web page. It simply calculate the DOM
depth and create a pyramid-like structure that you can browser in 3D.</p>

<p>I&#39;m sure that beyond the cool and shiny aspect, it can be useful as a
debug/optimisation tool.</p>

<h2>Conclusion</h2>

<p>Once again, thanks to #parisjs for those talks, always inspiring and a way to
meet new people.</p>

<p><em>For all the new readers, I have an unfixed bug in my comment section : your
post can be invalidated if your are using Chrome with an email auto-filler. My
custom anti-spam will flag you as spam because Chrome fills an hidden honeypot
field.</em></p>


    <div class="tag-list">
      
        <a href="/tags/sencha">#sencha</a>
      
        <a href="/tags/json">#json</a>
      
        <a href="/tags/parisjs">#parisjs</a>
      
        <a href="/tags/javascript">#javascript</a>
      
        <a href="/tags/extjs">#extjs</a>
      
        <a href="/tags/joshfire">#joshfire</a>
      
        <a href="/tags/nodejs">#nodejs</a>
      
        <a href="/tags/4d">#4d</a>
      
        <a href="/tags/mongodb">#mongodb</a>
      
        <a href="/tags/wakanda">#wakanda</a>
      
        <a href="/tags/lexer">#lexer</a>
      
    </div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page13">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page11">Newer</a>
    
  
</div>

  </div>

</body>

</html>
