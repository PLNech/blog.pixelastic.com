<!doctype html>
<html class="no-js" lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>
     Pixelastic 
  </title>
  <meta name="description" content="Personal blog of Tim Carry. Posting mostly on tech-related stuff.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/forms.css">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

<body class="layout-reverse theme-base-0b">
  <div class="sidebar">
    <div class="container">
      <div class="sidebar-about">
        <h1><a href="/index.html">Pixelastic</a></h1>
        <p class="lead">Personal blog of Tim Carry. Posting mostly on tech-related stuff.</p>
      </div>

      <ul class="sidebar-nav">
        <li class="sidebar-nav-item active">
          <a href="/">Home</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/about/">About</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/archive/">Archive</a>
        </li>
      </ul>
      <div class="sidebar-footer">Website code available on <a href="https://github.com/pixelastic/blog.pixelastic.com">GitHub</a></div>
    </div>
  </div>

  <div class="content container">
    <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/06/15/working-wednesday-2-quit-php/">
        Working on Wednesday #2 : Why I want to quit PHP
      </a>
    </h1>

    <span class="post-date">15 Jun 2011</span>

    <p>Here it is : my first Wednesday off. Well, not completely off because I had a
technical meeting this whole morning, and my cousin dropped by in the evening
so... I finally didn&#39;t have as much time reading and learning as I wanted to.</p>

<p>Anyway, those past weeks I started thinking about what I intended to learn,
and why. The main reason is that I want to be able to build website and apps
faster, with less hassle and better overall quality. And the more I thought
about that, the more it became obvious that PHP was the main bottleneck.</p>

<h2>My journey accross PHP land</h2>

<p>I&#39;ve been writing PHP for the last 12 years. I started as a script kiddy,
putting things together, hacking strings, saving stuff in databases, building
my own toolbox and finally making websites out of it.</p>

<p>Then, as I started my first job in a web development company, I started to
organize stuff to be able to use and reuse code accross projects.</p>

<p>Later, when I started as a freelancer, I learned cakePHP, and it let me much
more time to focus on each project while still reusing the common code of
previous projects easily.</p>

<h2>PHP is just so easy</h2>

<p>I can be considered a PHP coder. I have some years of experience to
consolidate that. Nevertheless, I don&#39;t consider myself &quot;good&quot; at PHP. I just
write PHP, and that&#39;s all.</p>

<p>I think there isn&#39;t any flavour in writing PHP : it is so easy anyone can do
it. I don&#39;t feel like I know those special stuff that can make one an
&quot;expert&quot;. PHP just feels so easy, you just write code and it works.</p>

<p>The only area where I can think that my years of experience can be used is in
tracking PHP bug or weird error messages (If you haven&#39;t <a href="http://www.phpsadness.com/">read this
website</a>, go now).</p>

<p>It just does not feel right to be able to say <em>&quot;Yeah, you should work with me.
Why ? Because my strength is that I&#39;m very good at understanding PHP bugs&quot;.</em></p>

<p>There is no &quot;PHP Philosophy&quot;, no good practices that were kept in mind by PHP
lead developers when they wrote the language and they wanted us to follow.
Instead, we just have a bunch of functions, and play with it as in a sandbox.</p>

<h2>Adding some pattern in this mess</h2>

<p>Over the years you learn (the hard way) how to organise your code. PHP5 gives
a little hope by adding more OO features. No need to get back on the namespace
delimiter choice, this is one more example of the PHP weirdness we&#39;ll have to
work with.</p>

<p>The best thing that happened to me in PHP world over those years is cakePHP.
It took me quite some time to get it, having to learn the whole MVC pattern
(and deal with some of cake internal inconsistencies/limitations) but the
result was worth it.</p>

<p>A clear separation of model structure, controller logic and view rendering
gave me my sanity back. I does abstract a lot of things, and makes things
cleaner on the outside, you can just concentrate on writing your app code.</p>

<p>But even with cakePHP, you still have to write PHP.</p>

<h2>Summing up</h2>

<p>So, to sum up, here are my feelings about PHP</p>

<ul>
<li>No peculiar love for the PHP syntax and (non-)patterns</li>
<li>Growing list of bugs/inconsistencies you have to work with</li>
<li>Don&#39;t feel like I&#39;m any better than any new PHP coder, no skill required</li>
<li>Best thing in PHP is cakePHP, an external framework</li>
</ul>

<p>That&#39;s why PHP is the first language I&#39;ll drop in my new learning, and I&#39;ll
replace it with Ruby.</p>

<p>Ruby seems to fit more in my vision of a language that tells its developers
what are the good and bad way of writing code. And as cakePHP is largely based
upon Rails, I think catching up won&#39;t be too difficult.</p>

<p>Also, Rails just realease it&#39;s version 3, so now the best time to learn it
from scratch.</p>

<h2>Next week</h2>

<p>This first day off was much shorter than I expected it to be. I wanted to
start coding some Rails code, following the Rails for Zombies tutorial. I also
had plans for using vim a little more.</p>

<p>Next week I might write about vim, or maybe how to organize javascript code,
depending on the time I had.</p>


    <div class="tag-list">
      
        <a href="/tags/php">#php</a>
      
        <a href="/tags/cakephp">#cakephp</a>
      
        <a href="/tags/ruby-on-rails">#ruby-on-rails</a>
      
        <a href="/tags/wednesday">#wednesday</a>
      
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/06/06/ghost-posting-fb-ui-streams/">
        Ghost posting on FB.ui streams
      </a>
    </h1>

    <span class="post-date">06 Jun 2011</span>

    <p>We had a bit of an issue when launching our app a few weeks ago. Everything
was working fine on our test apps, but when live, all the stream messages we
posted (we call them &quot;Sharings&quot;) had a random text appended.</p>

<p>Most of the time it was a generic Facebook text, but sometimes it was a
creepier SQL request just displayed plain on the user feed.</p>

<p>The Facebook text was (for the sake of search engine goodness):</p>

<blockquote>
<p>Facebook is a social utility that connects people with friends and others
who work, study and live around them. People use Facebook to keep up with
friends, upload an unlimited number of photos, post links and videos, and
learn more about the people they meet.</p>
</blockquote>

<p>As the issue only occurs in production mode and never on any of our test
environments, this was pretty difficult to debug.</p>

<p>Here was the code used to post the Sharing :</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">FB</span><span class="p">.</span><span class="nx">ui</span><span class="p">({</span>
  <span class="p">[...],</span>
  <span class="s1">&#39;title&#39;</span> <span class="o">:</span> <span class="s1">&#39;Title of the Sharing&#39;</span><span class="p">,</span>
  <span class="s1">&#39;caption&#39;</span> <span class="o">:</span> <span class="s1">&#39;Text of the Sharing&#39;</span>
<span class="p">});</span>
</code></pre></div>
<p>As I later found out, the <code>caption</code>key is not supposed to hold the Sharing
text. The <code>description</code>key should be used for that. I&#39;m not exactly sure was
<code>caption</code>was for, but it seems that if you let the <code>description</code>key empty,
then Facebook fills it automatically with a placeholder text.</p>

<p>The solution simply was to put the text in the <code>description</code>text, and leaving
the <code>caption</code>key empty :</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">FB</span><span class="p">.</span><span class="nx">ui</span><span class="p">({</span>
  <span class="s1">&#39;title&#39;</span> <span class="o">:</span> <span class="s1">&#39;Title of the Sharing&#39;</span><span class="p">,</span>
  <span class="s1">&#39;caption&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;description&#39;</span> <span class="o">:</span> <span class="s1">&#39;Text of the Sharing&#39;</span>
<span class="p">});</span>
</code></pre></div>
<p>As this behaviour is counter-intuitive, undocumented and random, I think
posting it here could help other lost souls like me.</p>


    <div class="tag-list">
      
        <a href="/tags/description">#description</a>
      
        <a href="/tags/feed">#feed</a>
      
        <a href="/tags/caption">#caption</a>
      
        <a href="/tags/stream">#stream</a>
      
        <a href="/tags/javascript">#javascript</a>
      
        <a href="/tags/fb-ui">#fb-ui</a>
      
        <a href="/tags/facebook">#facebook</a>
      
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/06/03/browser-caching-behavior/">
        SWF caching issues accross browsers
      </a>
    </h1>

    <span class="post-date">03 Jun 2011</span>

    <p>Here are some quick notes on various browser caching behavior. I was fiddling
with Wireshark to optimise my caching strategy and found some quirks one
should be aware of.</p>

<p>First, let&#39;s define some reload vocabulary.</p>

<ul>
<li><strong>initial load</strong> is the first time the page is loaded, when the cache is empty.</li>
<li><strong>hard reload</strong> is the classical reload. Clicking the Reload icon, or pressing Ctrl+R / F5.</li>
<li><strong>link reload</strong> is when the page is loaded again after you click on a link to it</li>
<li><strong>soft reload</strong> will be loading the page again by pressing enter in the address bar</li>
<li><strong>navigational reload</strong> is the reloading of a page that occurs while using the previous/next buttons.</li>
</ul>

<p>For the rest of this blog post, we will assume an HTML page loading the same
.jpg file multiple times and the same swf file multiple times too (we will use
both IE specific and general swf markup).</p>

<p>The html itself is not cached.</p>

<p>Also, all those static assets will have a <code>Cache-Control:max-age=29030400</code>
header.</p>

<p>All the network tests have been made using Wireshark.</p>

<h2>Chrome</h2>

<p><strong>Initial load</strong> : Download of jpg and swf once each. Perfect.</p>

<p><strong>Link reload &amp; navigational reload</strong>: Nor jpg nor swf is loaded again. Perfect.</p>

<p>*<em>Soft reload &amp; hard reload *</em>: The jpg is downloaded again but not the swf. Chrome sends a <code>Cache-Control:max-age=0</code> header to the jpg request, to force loading it again.</p>

<p>Reloading images is a standard behavior on images, but I wouldn&#39;t have
expected it on soft reloads.</p>

<h2>Safari 5 Win</h2>

<p>Safari behaves much like Chrome, with one important difference. It does not
cache swf files at all.</p>

<p><strong>Initial load</strong> : The jpg gets downloaded perfectly, but the swf gets downloaded multiple times, one per instance.</p>

<p><strong>Link reload &amp; navigational reload</strong> : The jpg is correctly fetched from cache, but the swf are all downloaded again. No swf is ever cached.</p>

<p><strong>Soft reload &amp; hard reload</strong> : Much as Chrome, Safari forces the reload of the jpg here. As you might guess, it also reload all the swf too, multiple times.</p>

<p>It means that Safari 5 does not cache any swf file at all. That&#39;s pretty
impressive.</p>

<p>This same caching bug is talked about <a href="http://don.blogs.smugmug.com/2008/04/04/nasty-bug-safari-doesnt-cache-%0Astuff/">on this other
blog</a>. I&#39;ve also tried including flash files from within another flash file
(much like the <a href="http://www.alistapart.com/articles/flashsatay">Satay method</a>).
The results are the same : no swf flash is ever cached, even in the same html
request.</p>

<p>It is supposed to have been fixed in Safari Mac (anyone can confirm this? I
don&#39;t own a Mac) but the issue is still here on Safari Windows.</p>

<h2>IE6, IE7 and IE8</h2>

<p>IE6, IE7 and IE8 behaves the same here. They have a less severe version of the
bug than Safari 5. At the time of writing I didn&#39;t have IE9 to test on it.</p>

<p><strong>Initial load</strong> : Same bug as Safari here. The swf are downloaded multiple times, once for each instance. The jpg is only download once.</p>

<p><strong>Link reload, navigational reload and soft reload</strong> : This time, everything is fetched from the cache. Actually, even the html is seems fetched from cache (I didn&#39;t investigate that much)</p>

<p><strong>Hard reload</strong> : Html and jpg are fetched from the server, swf file stays in the cache.</p>

<p>It appears that (surprisingly) IE behaves quite well. Its caching behavior is
more aggressive than the others (soft reload is really soft). However, it
still have a nasty side effect of loading swf files multiple times on the same
page. Shouldn&#39;t happen a lot in the real world, but still nice to know.</p>

<h2>Firefox 4.0</h2>

<p><strong>Initial load</strong> : No issue arising. It does fetch each resource once.</p>

<p><strong>Link reload, navigational reload and soft reload</strong> : Fetches everything from cache, nice.</p>

<p><strong>Hard reload</strong> : Re-request jpg and swf files by adding a <code>Cache-Control: max-age=0</code> request header. This feels like the expected behavior.</p>


    <div class="tag-list">
      
        <a href="/tags/webperf">#webperf</a>
      
        <a href="/tags/ie8">#ie8</a>
      
        <a href="/tags/flash">#flash</a>
      
        <a href="/tags/swf">#swf</a>
      
        <a href="/tags/ie7">#ie7</a>
      
        <a href="/tags/ie6">#ie6</a>
      
        <a href="/tags/firefox">#firefox</a>
      
        <a href="/tags/chrome">#chrome</a>
      
        <a href="/tags/cache">#cache</a>
      
        <a href="/tags/cache-control">#cache-control</a>
      
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/06/01/care-favicon/">
        Take care of that favicon
      </a>
    </h1>

    <span class="post-date">01 Jun 2011</span>

    <p>Even if you are not referencing it in your HTML markup, browsers will try to
get a file named <code>/favicon.ico</code> on your server root. Let&#39;s see some good
practice regarding this file.</p>

<h2>Make it small</h2>

<p>The smaller the file, the faster it will get downloaded. As it is a less than
important file, we don&#39;t want to delay the loading of our page for such a tiny
graphic. The default file format for such a file is <code>image/x-icon</code>, meaning
the .ico extension.</p>

<p>I think it&#39;s a Microsoft legacy format, but well understood by every browser.
Be careful when putting your favicon, don&#39;t just find a cool <code>.ico</code> file and
drop it here. Icon files are containers, they hold various image format
ranging from 16x16 to 512x512.</p>

<p>You clearly don&#39;t need the bigger one and the 16x16 will be highly enough. So,
be careful.</p>

<p>The best way of creating the favicon I&#39;ve found is to first create it as a
<code>.gif</code>, then running ImageMagick upon it. On Linux, this means running</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">convert favicon.gif -resize 16x16! favicon.ico
</code></pre></div>
<h2>Make it cacheable</h2>

<p>This file will be requested by the browser on every request, so you&#39;d better
make it cacheable to limit the number of requests.</p>

<p>Also, note that you can&#39;t change the name of the file, <code>favicon.ico</code> will
always be fetched.</p>

<p>I choose to cache mine for a year, like any other static asset. I could have
gone for a month, to allow updating them more often but I&#39;ve never ever
changed a favicon, so a year seems better.</p>

<h2>A note on Safari Win</h2>

<p>From the tests I&#39;ve done, almost all browsers behave the same regarding
favicon fetching and caching : the fetch it last, and do not issue a Cache-
Control:max-age=0 on a refresh to force redownloading it.</p>

<p>Except Safari Win. It fetch it along other downloads and re-dewnload it on a
page refresh.</p>


    <div class="tag-list">
      
        <a href="/tags/webperf">#webperf</a>
      
        <a href="/tags/favicon">#favicon</a>
      
        <a href="/tags/caching">#caching</a>
      
    </div>
  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2011/05/30/php-sessions-pragma-cache-header/">
        PHP sessions and the Pragma:no-cache header
      </a>
    </h1>

    <span class="post-date">30 May 2011</span>

    <p>You may have seen the <code>Pragma:no-cache</code> response header on various website (if
you&#39;re that kind of guy actually reading HTTP response headers...).</p>

<p>What you may not know is that this Header doesn&#39;t actually exists. The Pragma
header <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.32">is supposed to
be</a> *<em>Request
*</em>header, not a *<em>Response *</em>header.</p>

<p>It is not only useless, it may also trigger strange caching bugs in IE6. I&#39;m
sure you know what kind of IE6 quirks I&#39;m talking about. The best is to remove
it, just to be sure.</p>

<p>This is a common misconception (I myself didn&#39;t know that before reading <a href="http://www.mnot.net/cache_docs/">this
excellent caching tutorial</a>), and that header
is still returned in a lot of request.</p>

<p>For example, if you set your <code>session.cache_limiter</code> to <code>nocache</code>in your
<code>php.ini</code>, then PHP will send this header (as defined in the
<a href="http://ca.php.net/manual/en/function.session-cache-%0Alimiter.php">session<em>cache</em>limiter</a> doc. This is obviously wrong.</p>

<p>It also adds a weird <code>Expires: Thu, 19 Nov 1981 08:52:00 GMT</code> header. I don&#39;t
like it as it allow easy fingerprinting of the server-side technology used.</p>

<p>I changed my <code>session.cache_delimiter</code> value to <code>private_no_expire</code> to return
better headers.</p>

<p>First, it removed the useless <code>Pragma</code>, but it also removes the <code>Expires
</code>header (<code>Cache-Control</code> is enough).</p>


    <div class="tag-list">
      
        <a href="/tags/php">#php</a>
      
        <a href="/tags/cache">#cache</a>
      
        <a href="/tags/session">#session</a>
      
        <a href="/tags/webperf">#webperf</a>
      
        <a href="/tags/wpo">#wpo</a>
      
        <a href="/tags/pragma">#pragma</a>
      
        <a href="/tags/cache-delimiter">#cache-delimiter</a>
      
    </div>
  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page15">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page13">Newer</a>
    
  
</div>

  </div>

</body>

</html>
