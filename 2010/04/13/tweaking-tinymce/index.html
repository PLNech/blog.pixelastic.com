<!doctype html>
<html class="no-js" lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>
     Tweaking tinyMCE - Pixelastic 
  </title>
  <meta name="description" content="Personal blog of Tim Carry. Posting mostly on tech-related stuff.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/forms.css">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

<body class="layout-reverse theme-base-0b">
  <div class="sidebar">
    <div class="container">
      <div class="sidebar-about">
        <h1><a href="/index.html">Pixelastic</a></h1>
        <p class="lead">Personal blog of Tim Carry. Posting mostly on tech-related stuff.</p>
      </div>

      <ul class="sidebar-nav">
        <li class="sidebar-nav-item">
          <a href="/">Home</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/about/">About</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/archive/">Archive</a>
        </li>
      </ul>
      <div class="sidebar-footer">Website code available on <a href="https://github.com/pixelastic/blog.pixelastic.com">GitHub</a></div>
    </div>
  </div>

  <div class="content container">
    <div class="post">
  <h1 class="post-title">Tweaking tinyMCE</h1>
  <span class="post-date">13 Apr 2010</span>
  <p>I&#39;m in the process of tweaking a tinyMCE install to use a custom set of
plugins and a custom skin to better fit in the Caracole CMS. This would allow
me to re-use CSS and JS code I&#39;ve already coded.</p>

<p>Fortunatly, I&#39;m getting better and better at understanding the way tinyMCE
works and the various configuration options and how to tweak them.</p>

<p>I also want the tinyMCE CSS rules to be integrated into the main CSS file of
my app (packed and minified using CSSTidy). So I defined a custom skin in the
tinyMCE setup, named &#39;<code>caracole</code>&#39;. This way, all the CSS skinning classes will
be prefixed with <code>caracole</code>as I don&#39;t want to mess with the default skins.</p>

<p>I also copied the <code>ui.css</code> file from the <code>themes/advanced/skins/default</code> to my
own css directory, renamed it to <code>tinymce.css</code>, replaced all <code>.default</code>
occurences to <code>.caracole</code> and added this file to the list of files being
processed by the main packer.</p>

<p>This way I can easily update any css file from the same directory, without
having to dive into the tinymce subdirectories.</p>

<p>Unfortunatly, by doing so, tinyMCE continue to load the
<code>tiny_mce/themes/advanced/skins/caracole/ui.css</code> file (have a look at Firebug
if you don&#39;t trust me). It took me some time to figure out where that call was
made from. It is actually on <code>editor_template.js</code> (around line 150 in dev
version).</p>

<p>As I didn&#39;t want to load this file twice, I tried to disable this call. I
could have manually patched the source file but I don&#39;t want to, it would make
any future update a pain. So I tried to find an other way.</p>

<p>Looking at the <code>loadCSS</code>method, it appears that there is a mechanism to
prevent loading twice the same file. If the file is already present in the
<code>.files</code> array, it won&#39;t be added. Ok, so now I just have to manually add the
file before the call is made.</p>

<p>That&#39;s where the setup callback come into play. I just defined in my
inyMCE.init :</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">tinyMCE</span><span class="p">.</span><span class="nx">init</span><span class="p">({</span>
  <span class="nx">skin</span><span class="o">:</span> <span class="s1">&#39;caracole&#39;</span><span class="p">,</span>
  <span class="nx">editor_css</span><span class="o">:</span> <span class="s1">&#39;caracoleDoNotInclude&#39;</span><span class="p">,</span>
  <span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">editor</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tinymce</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="s1">&#39;http://&#39;</span><span class="o">+</span><span class="nb">document</span><span class="p">.</span><span class="nx">domain</span><span class="o">+</span><span class="s1">&#39;/caracoleDoNotInclude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Doing so, the <code>loadCSS</code>will try to load the <code>caracoleDoNotInclude</code> file
(clearly this name is a placeholder, I have no such file). And in the setup
method I manually tell tinyMCE that this file is already loaded so when it
will initiate, it won&#39;t load the file at all.</p>

<p>Same goes for the <code>content_css</code>, the file that handle the look and feel of the
editable zone. I don&#39;t want to have my file in the tinyMCE skin directory, I&#39;d
rather have it with my other CSS files.</p>

<p>So I defined a custom <code>content_css</code> to point to my file. I also had to update
the setup method to mark the file as already loaded. But this time, as the
file is loaded on a per instance basis, this is the <code>editor.dom.files</code> that I
have to update, not the general <code>tinymce.DOM</code>.</p>

<p>Fortunatly, the latest tinyMCE version expose their event API, so it was just
a matter of defining the following event in the main setup :</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">setup</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">editor</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">tinymce</span><span class="p">.</span><span class="nx">DOM</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="nx">baseUrl</span><span class="o">+</span><span class="s1">&#39;caracoleDoNotInclude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="nx">editor</span><span class="p">.</span><span class="nx">onPreInit</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">editor</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">editor</span><span class="p">.</span><span class="nx">dom</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="nx">baseUrl</span><span class="o">+</span><span class="s1">&#39;js/vendors/tiny_mce/themes/advanced/skins/caracole/content.css&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
   <span class="p">});</span>
 <span class="p">}</span>
</code></pre></div>
<h2>Edit :</h2>

<p>Note that in the latest tinyMCE version, the code is slightly different
because you have to call a special method on the url before adding it to the
<code>editor.dom.files</code></p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">editor</span><span class="p">.</span><span class="nx">onPreInit</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">editor</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">editor</span><span class="p">.</span><span class="nx">dom</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="nx">editor</span><span class="p">.</span><span class="nx">baseURI</span><span class="p">.</span><span class="nx">toAbsolute</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="o">+</span><span class="nb">document</span><span class="p">.</span><span class="nx">domain</span><span class="o">+</span><span class="s1">&#39;/js/vendors/tiny_mce/themes/advanced/skins/caracole/content.css&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>
  <div class="tag-list">
    
      <a href="/tags/tinymce">#tinymce</a>
    
      <a href="/tags/skins">#skins</a>
    
      <a href="/tags/tweak">#tweak</a>
    
  </div>
</div>

<!-- <div class="related"> -->
<!--   <h2>Related Posts</h2> -->
<!--   <ul class="related-posts"> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/2014/01/07/utf-8-encoding-included-jsp-files/"> -->
<!--             UTF-8 encoding for included .jsp files -->
<!--             <small>07 Jan 2014</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/2013/09/27/understanding-nginx-location-blocks-rewrite-rules/"> -->
<!--             Understanding nginx location blocks and rewrite rules -->
<!--             <small>27 Sep 2013</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/2013/09/09/telecharger-parisweb-2012-sous-forme-de-podcasts/"> -->
<!--             Télécharger ParisWeb 2012 sous forme de podcasts -->
<!--             <small>09 Sep 2013</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--   </ul> -->
<!-- </div> -->

  </div>

</body>

</html>
