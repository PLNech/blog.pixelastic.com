<!doctype html>
<html class="no-js" lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>
     Toggling insert/normal mode in vim with CapsLock - Pixelastic 
  </title>
  <meta name="description" content="Personal blog of Tim Carry. Posting mostly on tech-related stuff.">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="/public/css/forms.css">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

<body class="layout-reverse theme-base-0b">
  <div class="sidebar">
    <div class="container">
      <div class="sidebar-about">
        <h1><a href="/index.html">Pixelastic</a></h1>
        <p class="lead">Personal blog of Tim Carry. Posting mostly on tech-related stuff.</p>
      </div>

      <ul class="sidebar-nav">
        <li class="sidebar-nav-item">
          <a href="/">Home</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/about/">About</a>
        </li>
        <li class="sidebar-nav-item">
          <a href="/archive/">Archive</a>
        </li>
      </ul>
      <div class="sidebar-footer">Website code available on <a href="https://github.com/pixelastic/blog.pixelastic.com">GitHub</a></div>
    </div>
  </div>

  <div class="content container">
    <div class="post">
  <h1 class="post-title">Toggling insert/normal mode in vim with CapsLock</h1>
  <span class="post-date">09 Oct 2011</span>
  <p>You know that CapsLock key on your keyboard ? The sole usage of this key is to
SHOUT ON TEH INTERNETS§§§. I decided to disable it completly as I never use it
on purpose.</p>

<p>I also wanted to use it in vim to toggle between normal and insert mode with
one key instead of the default <code>i</code>/<code>Esc</code>.</p>

<h2>Disabling CapsLock</h2>

<p>Disabling CapsLock is a fairly straightforward process. The xmodmap program is
responsible for binding keyboard events to your software and you can change
the default behavior by creating an <code>~/.Xmodmap</code> file.</p>

<p>Just put the following code in it and the pressing the CapsLock key will no
longer block your next keys in Caps.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">clear Lock
</code></pre></div>
<h2>Catching it in vim</h2>

<p>Now, to get it in vim, you&#39;ll have a little more work to do. First, CapsLock
is not one of the default vim keycodes, so you won&#39;t be able to remap it to
any useful function. To use it in vim, we will hook it directly on xmodmap to
another key, one that is part of vim default keycodes.</p>

<p>I choose the virtual F13 key. Your physical keyboard might only have F keys
from 1 to 12, but the internal software seems to be able to react to 37 of
them. So, why not using them ?</p>

<p>In your <code>~/.Xmodmap</code> file, this is as easy as adding the following line</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">keycode 66 = F13
</code></pre></div>
<p>66 is the internal code for the CapsLock key. We just define that pressing the
physical CapsLock key should trigger the F13 virtual key.</p>

<p>Now, in <code>~/.vimrc</code>, we will tell vim to explictly listen to extended F keys
(from 13 to 37) which it does not do by default.</p>
<div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="k">set</span> <span class="p">&lt;</span>F13<span class="p">&gt;=</span>^[[<span class="m">25</span><span class="p">~</span>
</code></pre></div>
<p><code>^[[25~</code> is the special keyboard code sent to vim when the F13 key is
triggered. Here we just define that such a keyboard code should be interpreted
in vim as an <code>&lt;F13&gt;</code> vim key.</p>

<p>Now, you can use <code>&lt;F13&gt;</code> in your custom vim mappings</p>

<h2>Toggling normal/insert mode in vim</h2>

<p>vim accepts two kinds of mapping. Those triggered in normal mode (using
<code>nnoremap</code>) and those triggered in insert mode (using <code>inoremap</code>).</p>

<p>Here we want that pressing CapsLock (or <code>&lt;F13&gt;</code> in vim as we defined) in
normal mode will go to insert mode, like pressing <code>i</code> does. And we also want
to get back to normal mode when pressing CapsLock in insert mode, just like
pressing <code>Esc</code> does.</p>
<div class="highlight"><pre><code class="language-vim" data-lang="vim"><span class="nb">nnoremap</span> <span class="p">&lt;</span>F13<span class="p">&gt;</span> <span class="k">i</span>
<span class="nb">inoremap</span> <span class="p">&lt;</span>F13<span class="p">&gt;</span> <span class="p">&lt;</span>Esc<span class="p">&gt;</span><span class="k">l</span>
</code></pre></div>
<p>Notice the <code>l</code> after Esc. It is here to prevent the caret to move back one
character when exiting insert mode.</p>

<h2>Fixing the shell</h2>

<p>One last thing to fix is your shell. By defining in xmodmap that pressing
CapsLock would trigger an F13 event, it means that whatever software that
react on F13 will now react on CapsLock. Unfortunatly, zsh does react on F13.
It insert a <code>~</code> character on it (just like it does with F12).</p>

<p>To disable it, we&#39;ll simply define a key binding in <code>~/.zshrc</code> so pressing F13
does nothing.</p>
<div class="highlight"><pre><code class="language-sh" data-lang="sh">bindkey -s <span class="s2">&quot;\e[25~&quot;</span> <span class="s2">&quot;&quot;</span>
</code></pre></div>
<p>Here it is. You can now press CapsLock anywhere and it won&#39;t have any effect.
Plus, pressing it in vim will toggle insert/normal mode.</p>

  <div class="tag-list">
    
      <a href="/tags/vim">#vim</a>
    
      <a href="/tags/zsh">#zsh</a>
    
      <a href="/tags/xmodmap">#xmodmap</a>
    
  </div>
</div>

<!-- <div class="related"> -->
<!--   <h2>Related Posts</h2> -->
<!--   <ul class="related-posts"> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/2014/01/07/utf-8-encoding-included-jsp-files/"> -->
<!--             UTF-8 encoding for included .jsp files -->
<!--             <small>07 Jan 2014</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/2013/09/27/understanding-nginx-location-blocks-rewrite-rules/"> -->
<!--             Understanding nginx location blocks and rewrite rules -->
<!--             <small>27 Sep 2013</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--       <li> -->
<!--         <h3> -->
<!--           <a href="/2013/09/09/telecharger-parisweb-2012-sous-forme-de-podcasts/"> -->
<!--             Télécharger ParisWeb 2012 sous forme de podcasts -->
<!--             <small>09 Sep 2013</small> -->
<!--           </a> -->
<!--         </h3> -->
<!--       </li> -->
<!--      -->
<!--   </ul> -->
<!-- </div> -->

  </div>

</body>

</html>
